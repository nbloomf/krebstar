<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Sequences</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="../style.css">
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
</head>
<body>
<article>
<header>
<h1 class="title">Sequences</h1>
</header>
<div class="contents">
<ul>
<li><a href="#introduction">Introduction</a>: Specializing one-pointed lists</li>
<li><a href="#class-instances">Class instances</a>: Code for free</li>
<li><a href="#queries">Queries</a>: Getting information out of a sequence</li>
<li><a href="#navigation">Navigation</a>: Moving around</li>
<li><a href="#mutation">Mutation</a>: Making edits</li>
<li><a href="#concatenation">Concatenation</a>: Putting sequences together</li>
<li><a href="#testing-and-debugging">Testing and debugging</a>: For when things go wrong</li>
</ul>
</div>
<div class="frontmatter">
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ot">{-# LANGUAGE UndecidableInstances #-}</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="ot">{-# LANGUAGE FlexibleInstances #-}</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="ot">{-# LANGUAGE FlexibleContexts #-}</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="ot">{-# LANGUAGE InstanceSigs #-}</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">module</span> <span class="dt">Kreb.Struct.Sequence</span> (</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="dt">Sequence</span>()</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  , empty</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  , singleton</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">  , fromList</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"></a>
<a class="sourceLine" id="cb1-13" data-line-number="13">  , isEmpty</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  , isSingleton</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  , isAtInit</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">  , isAtLast</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">  , readPoint</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">  , readInit</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">  , readLast</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">  , getLength</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"></a>
<a class="sourceLine" id="cb1-22" data-line-number="22">  , movePointLeft</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">  , movePointRight</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">  , moveToInit</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">  , moveToLast</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">  , moveToIndex</a>
<a class="sourceLine" id="cb1-27" data-line-number="27"></a>
<a class="sourceLine" id="cb1-28" data-line-number="28">  , insertInit</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">  , deleteInit</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">  , insertLast</a>
<a class="sourceLine" id="cb1-31" data-line-number="31">  , deleteLast</a>
<a class="sourceLine" id="cb1-32" data-line-number="32">  , insertPointLeft</a>
<a class="sourceLine" id="cb1-33" data-line-number="33">  , deletePointLeft</a>
<a class="sourceLine" id="cb1-34" data-line-number="34">  , insertPointRight</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">  , deletePointRight</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">  , alterInit</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">  , alterLast</a>
<a class="sourceLine" id="cb1-38" data-line-number="38">  , alterPoint</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">  , alterPointM</a>
<a class="sourceLine" id="cb1-40" data-line-number="40"></a>
<a class="sourceLine" id="cb1-41" data-line-number="41">  , prepend</a>
<a class="sourceLine" id="cb1-42" data-line-number="42">  , append</a>
<a class="sourceLine" id="cb1-43" data-line-number="43"></a>
<a class="sourceLine" id="cb1-44" data-line-number="44">  , debugShowSequence</a>
<a class="sourceLine" id="cb1-45" data-line-number="45">) <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="kw">import</span> <span class="dt">Data.Foldable</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="kw">import</span>           <span class="dt">Kreb.Check</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50"><span class="kw">import</span>           <span class="dt">Kreb.Struct.Valued</span></a>
<a class="sourceLine" id="cb1-51" data-line-number="51"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Kreb.Struct.OnePointedList</span> <span class="kw">as</span> <span class="dt">OPL</span></a></code></pre></div>
</div>
<section id="introduction" class="level2">
<h2>Introduction</h2>
<p>So far we’ve developed the finger tree data type, and taken its derivative to get a linear structure with a distinguished and movable pointer somewhere in the middle. We’ll use this as the basis for a more specialized structure: <em>sequences</em>. This type uses our existing <code>Count</code> monoid to describe a list with efficient indexing.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">newtype</span> <span class="dt">Sequence</span> a <span class="fu">=</span> <span class="dt">Sequence</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  {<span class="ot"> unSequence ::</span> <span class="dt">OPL.OnePointedList</span> <span class="dt">Count</span> (<span class="dt">Item</span> a)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  } <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a></code></pre></div>
<p>The <code>Item</code> constructor allows us to hide the otherwise awkward <code>Valued</code> constraint from consumers of this module; because it is implemented as a newtype, it has no runtime overhead.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">newtype</span> <span class="dt">Item</span> a <span class="fu">=</span> <span class="dt">Item</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  {<span class="ot"> unItem ::</span> a</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  } <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw">instance</span> <span class="dt">Valued</span> <span class="dt">Count</span> (<span class="dt">Item</span> a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  value _ <span class="fu">=</span> <span class="dt">Count</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw">instance</span> <span class="dt">Functor</span> <span class="dt">Item</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">  fmap f (<span class="dt">Item</span> x) <span class="fu">=</span> <span class="dt">Item</span> (f x)</a></code></pre></div>
<p>Nearly all of the functionality we want out of sequences is already provided by one-pointed lists, so we can just lift the API of that module to work over the <code>Sequence</code> type. First are the basic constructors.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="ot">empty ::</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">empty <span class="fu">=</span> <span class="dt">Sequence</span> OPL.empty</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">singleton</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="ot">  ::</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">singleton <span class="fu">=</span> <span class="dt">Sequence</span> <span class="fu">.</span> OPL.singleton <span class="fu">.</span> <span class="dt">Item</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">fromList</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="ot">  ::</span> [a] <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">fromList <span class="fu">=</span> <span class="dt">Sequence</span> <span class="fu">.</span> OPL.fromList <span class="fu">.</span> fmap <span class="dt">Item</span></a></code></pre></div>
<div class="doctest">
<div class="sourceCode" id="cb5"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">--   x :: Sequence Int</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">--   x = singleton 5</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">-- in x == empty</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">-- False</span></a></code></pre></div>
</div>
<p>We also expose a constructor that gives us control over the location of the point; this is only used for testing and debugging.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" data-line-number="1">makePointSequence</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="ot">  ::</span> [a] <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [a]</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">makePointSequence as x bs <span class="fu">=</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="dt">Sequence</span> <span class="fu">$</span> OPL.makePoint</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">    (fmap <span class="dt">Item</span> as) (<span class="dt">Item</span> x) (fmap <span class="dt">Item</span> bs)</a></code></pre></div>
</section>
<section id="class-instances" class="level2">
<h2>Class instances</h2>
<p>We have a <code>Foldable</code> instance for <code>Sequence</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Foldable</span> <span class="dt">Sequence</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  toList <span class="fu">=</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    fmap unItem <span class="fu">.</span> toList <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">  foldr f e <span class="fu">=</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    <span class="kw">let</span> g (<span class="dt">Item</span> a) (<span class="dt">Item</span> b) <span class="fu">=</span> <span class="dt">Item</span> (f a b)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    <span class="kw">in</span> unItem <span class="fu">.</span> foldr g (<span class="dt">Item</span> e) <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb7-8" data-line-number="8"></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">  foldl f e <span class="fu">=</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">    <span class="kw">let</span> g (<span class="dt">Item</span> a) (<span class="dt">Item</span> b) <span class="fu">=</span> <span class="dt">Item</span> (f a b)</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    <span class="kw">in</span> unItem <span class="fu">.</span> foldl g (<span class="dt">Item</span> e) <span class="fu">.</span> unSequence</a></code></pre></div>
<p>Because we’ve hidden the <code>Valued</code> constraint, we can give a real <code>Functor</code> instance for sequences.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Functor</span> <span class="dt">Sequence</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  fmap f (<span class="dt">Sequence</span> x) <span class="fu">=</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    <span class="dt">Sequence</span> <span class="fu">$</span> OPL.fmapOPL (fmap f) x</a></code></pre></div>
<div class="doctest">
<div class="sourceCode" id="cb9"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">--   x, y :: Sequence Int</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">--   x = fromList [1,2,3]</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">--   y = fromList [2,4,6]</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">-- in y == fmap (*2) x</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">-- True</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Traversable</span> <span class="dt">Sequence</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  traverse f (<span class="dt">Sequence</span> x) <span class="fu">=</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">    <span class="dt">Sequence</span> <span class="fu">&lt;$&gt;</span> OPL.traverseOPL (fmap <span class="dt">Item</span> <span class="fu">.</span> f <span class="fu">.</span> unItem) x</a></code></pre></div>
</section>
<section id="queries" class="level2">
<h2>Queries</h2>
<p>Next we can get information out of a sequence. First are the basic predicates:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" data-line-number="1">isEmpty</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">isEmpty <span class="fu">=</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  OPL.isEmpty <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">isSingleton</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">isSingleton <span class="fu">=</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">  OPL.isSingleton <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">isAtInit</a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13">isAtInit <span class="fu">=</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">  OPL.isAtInit <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb11-15" data-line-number="15"></a>
<a class="sourceLine" id="cb11-16" data-line-number="16">isAtLast</a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18">isAtLast <span class="fu">=</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19">  OPL.isAtLast <span class="fu">.</span> unSequence</a></code></pre></div>
<p>And some examples for good measure.</p>
<div class="doctest">
<div class="sourceCode" id="cb12"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">--   x :: Sequence Int</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">--   x = makePointSequence</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">--     [] 1 [2,3]</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">-- in (isAtInit x, isAtLast x)</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">-- (True,False)</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">--</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">--   x :: Sequence Int</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">--   x = makePointSequence</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">--     [1,2] 3 []</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">-- in (isAtInit x, isAtLast x)</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">-- (False,True)</span></a></code></pre></div>
</div>
<p>Then we have functions for extracting the value at the point and at the ends of the sequence.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" data-line-number="1">readInit</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">readInit <span class="fu">=</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  fmap unItem <span class="fu">.</span> OPL.readInit <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">readLast</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">readLast <span class="fu">=</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">  fmap unItem <span class="fu">.</span> OPL.readLast <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb13-10" data-line-number="10"></a>
<a class="sourceLine" id="cb13-11" data-line-number="11">readPoint</a>
<a class="sourceLine" id="cb13-12" data-line-number="12"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">readPoint <span class="fu">=</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14">  fmap unItem <span class="fu">.</span> OPL.readPoint <span class="fu">.</span> unSequence</a></code></pre></div>
<p>And an example.</p>
<div class="doctest">
<div class="sourceCode" id="cb14"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">--   x :: Sequence Int</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">--   x = makePointSequence</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">--     [1,2] 3 [4,5,6]</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">-- in (readInit x, readPoint x, readLast x)</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">-- (Just 1,Just 3,Just 6)</span></a></code></pre></div>
</div>
<p>We’ll sometimes also want to get the length of a sequence.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" data-line-number="1">getLength</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">getLength (<span class="dt">Sequence</span> as) <span class="fu">=</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  <span class="kw">let</span> <span class="dt">Count</span> k <span class="fu">=</span> value as</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">  <span class="kw">in</span> k</a></code></pre></div>
<p>And some examples.</p>
<div class="doctest">
<div class="sourceCode" id="cb16"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">--   x :: Sequence Int</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">--   x = fromList [1,2,3,4,5]</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">-- in getLength x</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">-- 5</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">--</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">-- &gt;&gt;&gt; getLength (empty :: Sequence Int)</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">-- 0</span></a></code></pre></div>
</div>
</section>
<section id="navigation" class="level2">
<h2>Navigation</h2>
<p>Next we have the basic navigation primitives.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" data-line-number="1">movePointLeft</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">movePointLeft <span class="fu">=</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.movePointLeft <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">movePointRight</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">movePointRight <span class="fu">=</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.movePointRight <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb17-10" data-line-number="10"></a>
<a class="sourceLine" id="cb17-11" data-line-number="11">moveToInit</a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb17-13" data-line-number="13">moveToInit <span class="fu">=</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.moveToInit <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb17-15" data-line-number="15"></a>
<a class="sourceLine" id="cb17-16" data-line-number="16">moveToLast</a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb17-18" data-line-number="18">moveToLast <span class="fu">=</span></a>
<a class="sourceLine" id="cb17-19" data-line-number="19">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.moveToLast <span class="fu">.</span> unSequence</a></code></pre></div>
<p>And some examples:</p>
<div class="doctest">
<div class="sourceCode" id="cb18"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">--   x, y, z :: Sequence Int</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">--   x = makePointSequence</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">--     [1,2] 3 [4,5,6]</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">--   y = makePointSequence</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">--     [] 1 [2,3,4,5,6]</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">--   z = makePointSequence</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">--     [1,2,3,4,5] 6 []</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">-- in (y == moveToInit x, z == moveToLast x)</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">-- (True,True)</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">--</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co">--   x, y, z :: Sequence Int</span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co">--   x = makePointSequence</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co">--     [1,2] 3 [4,5,6]</span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="co">--   y = makePointSequence</span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="co">--     [1] 2 [3,4,5,6]</span></a>
<a class="sourceLine" id="cb18-22" data-line-number="22"><span class="co">--   z = makePointSequence</span></a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="co">--     [1,2,3] 4 [5,6]</span></a>
<a class="sourceLine" id="cb18-24" data-line-number="24"><span class="co">-- in (y == movePointLeft x, z == movePointRight x)</span></a>
<a class="sourceLine" id="cb18-25" data-line-number="25"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb18-26" data-line-number="26"><span class="co">-- (True,True)</span></a></code></pre></div>
</div>
<p>We can also navigate to an arbitrary index in the sequence, which is sort of the purpose of this type. :) Note that the indexing is zero-based.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" data-line-number="1">moveToIndex</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">moveToIndex k (<span class="dt">Sequence</span> as) <span class="fu">=</span> <span class="dt">Sequence</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4">  OPL.split</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    (\(<span class="dt">Count</span> i) <span class="ot">-&gt;</span> i <span class="fu">&gt;</span> k)</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">    (OPL.integrate as)</a></code></pre></div>
<div class="doctest">
<div class="sourceCode" id="cb20"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">--   x :: Sequence Char</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co">--   x = fromList [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;]</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">-- in readPoint (moveToIndex 0 x)</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">-- Just &#39;a&#39;</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">--</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">--   x :: Sequence Char</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">--   x = fromList [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;,&#39;e&#39;]</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">-- in readPoint (moveToIndex 3 x)</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">-- Just &#39;d&#39;</span></a></code></pre></div>
</div>
</section>
<section id="mutation" class="level2">
<h2>Mutation</h2>
<p>Finally we lift the mutation primitives. We have insert and delete at the ends:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" data-line-number="1">insertInit</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="ot">  ::</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">insertInit a <span class="fu">=</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.insertInit (<span class="dt">Item</span> a) <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"></a>
<a class="sourceLine" id="cb21-6" data-line-number="6">deleteInit</a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">deleteInit <span class="fu">=</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.deleteInit <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb21-10" data-line-number="10"></a>
<a class="sourceLine" id="cb21-11" data-line-number="11">insertLast</a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="ot">  ::</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb21-13" data-line-number="13">insertLast a <span class="fu">=</span></a>
<a class="sourceLine" id="cb21-14" data-line-number="14">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.insertLast (<span class="dt">Item</span> a) <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb21-15" data-line-number="15"></a>
<a class="sourceLine" id="cb21-16" data-line-number="16">deleteLast</a>
<a class="sourceLine" id="cb21-17" data-line-number="17"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb21-18" data-line-number="18">deleteLast <span class="fu">=</span></a>
<a class="sourceLine" id="cb21-19" data-line-number="19">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.deleteLast <span class="fu">.</span> unSequence</a></code></pre></div>
<p>Insert and delete at the point:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb22-1" data-line-number="1">insertPointLeft</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="ot">  ::</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">insertPointLeft a <span class="fu">=</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.insertPointLeft (<span class="dt">Item</span> a) <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb22-5" data-line-number="5"></a>
<a class="sourceLine" id="cb22-6" data-line-number="6">deletePointLeft</a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">deletePointLeft <span class="fu">=</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.deletePointLeft <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb22-10" data-line-number="10"></a>
<a class="sourceLine" id="cb22-11" data-line-number="11">insertPointRight</a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="ot">  ::</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb22-13" data-line-number="13">insertPointRight a <span class="fu">=</span></a>
<a class="sourceLine" id="cb22-14" data-line-number="14">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.insertPointRight (<span class="dt">Item</span> a) <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb22-15" data-line-number="15"></a>
<a class="sourceLine" id="cb22-16" data-line-number="16">deletePointRight</a>
<a class="sourceLine" id="cb22-17" data-line-number="17"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb22-18" data-line-number="18">deletePointRight <span class="fu">=</span></a>
<a class="sourceLine" id="cb22-19" data-line-number="19">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.deletePointRight <span class="fu">.</span> unSequence</a></code></pre></div>
<p>And alter at the ends and the point.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" data-line-number="1">alterInit</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="ot">  ::</span> (a <span class="ot">-&gt;</span> a)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">alterInit f <span class="fu">=</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.alterInit (fmap f) <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb23-6" data-line-number="6"></a>
<a class="sourceLine" id="cb23-7" data-line-number="7">alterLast</a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="ot">  ::</span> (a <span class="ot">-&gt;</span> a)</a>
<a class="sourceLine" id="cb23-9" data-line-number="9">  <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb23-10" data-line-number="10">alterLast f <span class="fu">=</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.alterLast (fmap f) <span class="fu">.</span> unSequence</a>
<a class="sourceLine" id="cb23-12" data-line-number="12"></a>
<a class="sourceLine" id="cb23-13" data-line-number="13">alterPoint</a>
<a class="sourceLine" id="cb23-14" data-line-number="14"><span class="ot">  ::</span> (a <span class="ot">-&gt;</span> a)</a>
<a class="sourceLine" id="cb23-15" data-line-number="15">  <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb23-16" data-line-number="16">alterPoint f <span class="fu">=</span></a>
<a class="sourceLine" id="cb23-17" data-line-number="17">  <span class="dt">Sequence</span> <span class="fu">.</span> OPL.alterPoint (fmap f) <span class="fu">.</span> unSequence</a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb24-1" data-line-number="1">alterPointM</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  <span class="ot">=&gt;</span> (a <span class="ot">-&gt;</span> m a)</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> m (<span class="dt">Sequence</span> a)</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">alterPointM f (<span class="dt">Sequence</span> seq) <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6">  seq&#39; <span class="ot">&lt;-</span> OPL.alterPointA (\(<span class="dt">Item</span> x) <span class="ot">-&gt;</span> fmap <span class="dt">Item</span> <span class="fu">$</span> f x) seq</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">  return <span class="fu">$</span> <span class="dt">Sequence</span> seq&#39;</a></code></pre></div>
</section>
<section id="concatenation" class="level2">
<h2>Concatenation</h2>
<p>It will also be useful to concatenate sequences. Like one-pointed lists, we have two versions of this, depending on whether we want to preserve the left or right point.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb25-1" data-line-number="1">prepend</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">prepend as bs <span class="fu">=</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4">  <span class="dt">Sequence</span> <span class="fu">$</span> OPL.prepend (unSequence as) (unSequence bs)</a>
<a class="sourceLine" id="cb25-5" data-line-number="5"></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">append</a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="ot">  ::</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a</a>
<a class="sourceLine" id="cb25-8" data-line-number="8">append as bs <span class="fu">=</span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9">  <span class="dt">Sequence</span> <span class="fu">$</span> OPL.append (unSequence as) (unSequence bs)</a></code></pre></div>
<p>And some examples:</p>
<div class="doctest">
<div class="sourceCode" id="cb26"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="co">--   x,y,z :: Sequence Int</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co">--   x = makePointSequence</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="co">--     [1] 2 [3]</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="co">--   y = makePointSequence</span></a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="co">--     [4] 5 [6]</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="co">--   z = makePointSequence</span></a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="co">--     [4,5,6,1] 2 [3]</span></a>
<a class="sourceLine" id="cb26-11" data-line-number="11"><span class="co">-- in z == prepend y x</span></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="co">-- True</span></a>
<a class="sourceLine" id="cb26-14" data-line-number="14"><span class="co">--</span></a>
<a class="sourceLine" id="cb26-15" data-line-number="15"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb26-16" data-line-number="16"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb26-17" data-line-number="17"><span class="co">--   x,y,z :: Sequence Int</span></a>
<a class="sourceLine" id="cb26-18" data-line-number="18"><span class="co">--   x = makePointSequence</span></a>
<a class="sourceLine" id="cb26-19" data-line-number="19"><span class="co">--     [1] 2 [3]</span></a>
<a class="sourceLine" id="cb26-20" data-line-number="20"><span class="co">--   y = makePointSequence</span></a>
<a class="sourceLine" id="cb26-21" data-line-number="21"><span class="co">--     [4] 5 [6]</span></a>
<a class="sourceLine" id="cb26-22" data-line-number="22"><span class="co">--   z = makePointSequence</span></a>
<a class="sourceLine" id="cb26-23" data-line-number="23"><span class="co">--     [1] 2 [3,4,5,6]</span></a>
<a class="sourceLine" id="cb26-24" data-line-number="24"><span class="co">-- in z == append y x</span></a>
<a class="sourceLine" id="cb26-25" data-line-number="25"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb26-26" data-line-number="26"><span class="co">-- True</span></a></code></pre></div>
</div>
</section>
<section id="testing-and-debugging" class="level2">
<h2>Testing and debugging</h2>
<p>We have the usual class instances for interacting with the property testing framework.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">  ( <span class="dt">Arb</span> a</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (<span class="dt">Item</span> a)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5">    arb <span class="fu">=</span> fmap <span class="dt">Item</span> arb</a>
<a class="sourceLine" id="cb27-6" data-line-number="6"></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8">  ( <span class="dt">Prune</span> a</a>
<a class="sourceLine" id="cb27-9" data-line-number="9">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (<span class="dt">Item</span> a)</a>
<a class="sourceLine" id="cb27-10" data-line-number="10">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11">    prune (<span class="dt">Item</span> x) <span class="fu">=</span> map <span class="dt">Item</span> <span class="fu">$</span> prune x</a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">  ( <span class="dt">Arb</span> a</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (<span class="dt">Sequence</span> a)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5">    arb <span class="fu">=</span> <span class="dt">Sequence</span> <span class="fu">&lt;$&gt;</span> arb</a>
<a class="sourceLine" id="cb28-6" data-line-number="6"></a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8">  ( <span class="dt">Prune</span> a</a>
<a class="sourceLine" id="cb28-9" data-line-number="9">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (<span class="dt">Sequence</span> a)</a>
<a class="sourceLine" id="cb28-10" data-line-number="10">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11">    prune (<span class="dt">Sequence</span> x) <span class="fu">=</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12">      map <span class="dt">Sequence</span> <span class="fu">$</span> prune x</a></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb29-1" data-line-number="1">debugShowSequence</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="ot">  ::</span> (a <span class="ot">-&gt;</span> <span class="dt">String</span>) <span class="ot">-&gt;</span> <span class="dt">Sequence</span> a <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3">debugShowSequence p xs <span class="fu">=</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">  <span class="st">&quot;Seq\n===\n&quot;</span> <span class="fu">++</span> unlines [] <span class="co">-- TODO: fix this -- (map p $ unTape xs)</span></a></code></pre></div>
</section>
</article>
</body>
</html>
