<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Text Boxes</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="../style.css">
</head>
<body>
<article>
<header>
<h1 class="title">Text Boxes</h1>
</header>
<div class="contents">
<ul>
<li><a href="#introduction">Introduction</a>: The problem we’re solving</li>
<li><a href="#queries">Queries</a>: Getting information out of a text box</li>
<li><a href="#rendering">Rendering</a>: Representing the viewable region</li>
<li><a href="#mutation">Mutation</a>: Altering the text box</li>
</ul>
</div>
<div class="frontmatter">
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# LANGUAGE FlexibleContexts #-}</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ot">{-# LANGUAGE RecordWildCards #-}</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">module</span> <span class="dt">Kreb.Text.TextBox</span> (</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">    <span class="dt">TextBox</span>(<span class="fu">..</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  , emptyTextBox</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  , stringTextBox</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  , getTextBoxWidth</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">  , getTextBoxHeight</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">  , getTextBoxTabStop</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">  , getTextBoxBytes</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">  , getTextBoxLineCol</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  , getTextBoxScreenCoords</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1">  , mkTextBox</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  , textboxLabelWidth</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="co">-- * Mutation</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  , alterTextBox</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  , <span class="dt">TextBoxAction</span>(<span class="fu">..</span>)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  <span class="co">-- * Queries</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  , getTextBoxCursor</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  , getTextBoxOffset</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  , getTextBoxBuffer</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  , getTextBoxString</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1">  , getTextBoxFocusLineCol</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  , getTextBoxFocusScreenCoords</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1">  , setTextBoxOffset</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  , setTextBoxCursor</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1">  , editTextBoxBuffer</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" data-line-number="1">  , textboxNearestScreenCoords</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1">  , renderTextBox</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1">  , <span class="dt">DebugTextBox</span>(<span class="fu">..</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  , debugTextBox</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  , writeDebugTextBoxActions</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">) <span class="kw">where</span></a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">import</span> <span class="dt">Data.List</span> (unlines)</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">import</span> <span class="dt">Kreb.Check</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">import</span> <span class="dt">Kreb.Control</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw">import</span> <span class="dt">Kreb.Text.MeasureText</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw">import</span> <span class="dt">Kreb.Text.ScreenOffset</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">import</span> <span class="dt">Kreb.Text.Pigment</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="kw">import</span> <span class="dt">Kreb.Text.Buffer</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="kw">import</span> <span class="dt">Kreb.Text.Glyph</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="kw">import</span> <span class="dt">Kreb.Text.Cell</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="kw">import</span> <span class="dt">Kreb.Text.SizedBuffer</span></a></code></pre></div>
</div>
<section id="introduction" class="level2">
<h2>Introduction</h2>
<p>There’s a pretty big gap between a buffer data structure and a usable text editor. In a way the concrete data structure is the easy part, because it is all algorithms and data layout, while the gritty details of a usable text editor involve mostly <em>policy</em> and <em>compromise</em> – it’s more politics than engineering. We can still build up to the usable editor in layers, though, so that the policy choices are made at properly separate levels and as naturally as possible – the code that interprets keystrokes can and should be independent of the code that draws to the screen, even though both of these activities are almost 100% policy decisions.</p>
<p>In this module we’ll build the bottom layer of the editor cake. It may seem odd to call this the bottom layer since it depends on a ton of code already. But here for the first time a recognizable <em>editor API</em> will start to emerge. Specifically, this module represents the basic text buffer data structure <em>as exposed to the editor</em> as well as the operations that can be performed with it.</p>
<p>To that end, we need to draw some boundaries around what exactly we’re trying to do here.</p>
<p>The <code>TextBox</code> structure should represent the following as generically as possible:</p>
<ol type="1">
<li>A sized buffer of text</li>
<li>A pointer to the <em>persistent source</em> of the text, if one exists (e.g. the filename)</li>
<li>A representation of the <em>screen view</em> into the text</li>
<li>A distinguished <em>cursor position</em> measured in screen coordinates</li>
</ol>
<p>We represent this information with the following type.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">data</span> <span class="dt">TextBox</span> <span class="fu">=</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="co">-- The sized buffer</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  {<span class="ot"> textboxBuffer     ::</span> <span class="dt">SizedBuffer</span> (<span class="dt">Glyph</span> <span class="dt">Char</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="co">-- The persistent source</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  ,<span class="ot"> textboxSource     ::</span> <span class="dt">Maybe</span> FilePath</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  ,<span class="ot"> textboxHasChanged ::</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">  <span class="co">-- The view</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">  ,<span class="ot"> textboxOffset     ::</span> <span class="dt">Int</span> <span class="co">-- ^ The top screen line index</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">  ,<span class="ot"> textboxHeight     ::</span> <span class="dt">Int</span> <span class="co">-- ^ Height in cells</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  ,<span class="ot"> textboxLabelBase  ::</span> <span class="dt">Int</span> <span class="co">-- ^ Numeric base of line labels</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">  <span class="co">-- The cursor</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">  ,<span class="ot"> textboxCursor     ::</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) <span class="co">-- ^ Relative cursor position</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16">  } <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a></code></pre></div>
<p>The <code>Eq</code> and <code>Show</code> instances are just for testing. Under normal use we won’t care about checking text boxes for equality, and the derived show instance is practically useless.</p>
<p>Definitely not useless are the functions for constructing text boxes. First we have the empty box:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1">emptyTextBox</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="ot">  ::</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) <span class="co">-- ^ Screen dimensions: (Width, Height)</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">Int</span>        <span class="co">-- ^ Tab width</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">emptyTextBox (w,h) t <span class="fu">=</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  <span class="kw">if</span> (w <span class="fu">&lt;=</span> <span class="dv">0</span>) <span class="fu">||</span> (h <span class="fu">&lt;=</span> <span class="dv">0</span>) <span class="fu">||</span> (t <span class="fu">&lt;=</span> <span class="dv">0</span>) <span class="fu">||</span> (w <span class="fu">&lt;</span> t)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">    <span class="kw">then</span> error <span class="st">&quot;emptyTextBox: panic (invalid dimensions)&quot;</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">    <span class="kw">else</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9">      { textboxHeight     <span class="fu">=</span> h</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">      , textboxCursor     <span class="fu">=</span> (<span class="dv">0</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">      , textboxBuffer     <span class="fu">=</span> emptySizedBuffer w t</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">      , textboxOffset     <span class="fu">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13">      , textboxLabelBase  <span class="fu">=</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14">      , textboxSource     <span class="fu">=</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15">      , textboxHasChanged <span class="fu">=</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16">      }</a></code></pre></div>
<p>And we can build a text box out of an arbitrary string:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" data-line-number="1">stringTextBox</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="ot">  ::</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) <span class="co">-- ^ Screen dimensions: (Width, Height)</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">Int</span>        <span class="co">-- ^ Tab width</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">stringTextBox (w,h) t str <span class="fu">=</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">  <span class="kw">if</span> (w <span class="fu">&lt;=</span> <span class="dv">0</span>) <span class="fu">||</span> (h <span class="fu">&lt;=</span> <span class="dv">0</span>) <span class="fu">||</span> (t <span class="fu">&lt;=</span> <span class="dv">0</span>) <span class="fu">||</span> (w <span class="fu">&lt;</span> t)</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">    <span class="kw">then</span> error <span class="st">&quot;emptyTextBox: panic (invalid dimensions)&quot;</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">    <span class="kw">else</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10">      { textboxHeight     <span class="fu">=</span> h</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">      , textboxCursor     <span class="fu">=</span> (<span class="dv">0</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">      , textboxBuffer     <span class="fu">=</span> makeSizedBuffer w t <span class="fu">$</span> map plainGlyph str</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">      , textboxOffset     <span class="fu">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14">      , textboxLabelBase  <span class="fu">=</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15">      , textboxSource     <span class="fu">=</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16">      , textboxHasChanged <span class="fu">=</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17">      }</a></code></pre></div>
</section>
<section id="queries" class="level2">
<h2>Queries</h2>
<p>Text boxes have lots of properties, and we’d like to know what those properties are.</p>
<p>We can extract the screen width of the box:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" data-line-number="1">getTextBoxWidth</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3">getTextBoxWidth box <span class="fu">=</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  querySizedBuffer getBufferWidth</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">    <span class="fu">$</span> textboxBuffer box</a></code></pre></div>
<p>And an example for fun:</p>
<div class="doctest">
<div class="sourceCode" id="cb15"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">--   x = stringTextBox (8,3) 2</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">--     &quot;hello world!&quot;</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co">-- in getTextBoxWidth x</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">-- 8</span></a></code></pre></div>
</div>
<p>We can extract the view height of the box:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" data-line-number="1">getTextBoxHeight</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">getTextBoxHeight <span class="fu">=</span> textboxHeight</a></code></pre></div>
<p>And an example for fun:</p>
<div class="doctest">
<div class="sourceCode" id="cb17"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">--   x = stringTextBox (8,3) 2</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">--     &quot;hello world!&quot;</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">-- in getTextBoxHeight x</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">-- 3</span></a></code></pre></div>
</div>
<p>We can extract the tab stop width of the box:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" data-line-number="1">getTextBoxTabStop</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">getTextBoxTabStop box <span class="fu">=</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  querySizedBuffer getBufferTabStop</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">    <span class="fu">$</span> textboxBuffer box</a></code></pre></div>
<p>And an example for fun:</p>
<div class="doctest">
<div class="sourceCode" id="cb19"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">--   x = stringTextBox (8,3) 2</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">--     &quot;hello world!&quot;</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">-- in getTextBoxTabStop x</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">-- 2</span></a></code></pre></div>
</div>
<p>We can extract the number of bytes in the box:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" data-line-number="1">getTextBoxBytes</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3">getTextBoxBytes box <span class="fu">=</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4">  querySizedBuffer getBufferByteCount</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">    <span class="fu">$</span> textboxBuffer box</a></code></pre></div>
<div class="doctest">
<p>And an example for fun:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co">--   x = stringTextBox (8,3) 2</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="co">--     &quot;hello world!&quot;</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="co">-- in getTextBoxBytes x</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co">-- 12</span></a></code></pre></div>
</div>
<p>We can extract the logical size (line and column) of the box:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb22-1" data-line-number="1">getTextBoxLineCol</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">LineCol</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">getTextBoxLineCol box <span class="fu">=</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">  querySizedBuffer getBufferLineCol</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">    <span class="fu">$</span> textboxBuffer box</a></code></pre></div>
<div class="doctest">
<p>And some examples for fun:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co">--   x = stringTextBox (8,3) 2</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="co">--     &quot;hello world!&quot;</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="co">-- in getTextBoxLineCol x</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="co">-- l0c11</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"><span class="co">--</span></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="co">--   x = stringTextBox (8,3) 2</span></a>
<a class="sourceLine" id="cb23-13" data-line-number="13"><span class="co">--     &quot;hello there,\nworld!&quot;</span></a>
<a class="sourceLine" id="cb23-14" data-line-number="14"><span class="co">-- in getTextBoxLineCol x</span></a>
<a class="sourceLine" id="cb23-15" data-line-number="15"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb23-16" data-line-number="16"><span class="co">-- l1c5</span></a></code></pre></div>
</div>
<p>We can extract the dimensions of the box in screen space:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb24-1" data-line-number="1">getTextBoxScreenCoords</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">getTextBoxScreenCoords box <span class="fu">=</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">  querySizedBuffer getBufferScreenCoords</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">    <span class="fu">$</span> textboxBuffer box</a></code></pre></div>
<p>And some examples for fun:</p>
<div class="doctest">
<div class="sourceCode" id="cb25"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="co">--   x = stringTextBox (8,3) 2</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="co">--     &quot;hello world!&quot;</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="co">-- in getTextBoxScreenCoords x</span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="co">-- (3,1)</span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="co">--</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb25-12" data-line-number="12"><span class="co">--   x = stringTextBox (8,3) 2</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13"><span class="co">--     &quot;hello there,\nworld!&quot;</span></a>
<a class="sourceLine" id="cb25-14" data-line-number="14"><span class="co">-- in getTextBoxScreenCoords x</span></a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="co">-- (5,2)</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb26-1" data-line-number="1">getTextBoxString</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3">getTextBoxString box <span class="fu">=</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4">  querySizedBuffer (map toChar <span class="fu">.</span> toList)</a>
<a class="sourceLine" id="cb26-5" data-line-number="5">    <span class="fu">$</span> textboxBuffer box</a></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb27-1" data-line-number="1"></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">getTextBoxCursor</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">getTextBoxCursor <span class="fu">=</span> textboxCursor</a>
<a class="sourceLine" id="cb27-5" data-line-number="5"></a>
<a class="sourceLine" id="cb27-6" data-line-number="6">getTextBoxOffset</a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8">getTextBoxOffset <span class="fu">=</span> textboxOffset</a>
<a class="sourceLine" id="cb27-9" data-line-number="9"></a>
<a class="sourceLine" id="cb27-10" data-line-number="10">getTextBoxBuffer</a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">SizedBuffer</span> (<span class="dt">Glyph</span> <span class="dt">Char</span>)</a>
<a class="sourceLine" id="cb27-12" data-line-number="12">getTextBoxBuffer <span class="fu">=</span> textboxBuffer</a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb28-1" data-line-number="1">getTextBoxHasChanged</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3">getTextBoxHasChanged <span class="fu">=</span> textboxHasChanged</a></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb29-1" data-line-number="1">getTextBoxFocusLineCol</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">LineCol</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3">getTextBoxFocusLineCol box <span class="fu">=</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">  querySizedBuffer getPointLineCol</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">    <span class="fu">$</span> textboxBuffer box</a>
<a class="sourceLine" id="cb29-6" data-line-number="6"></a>
<a class="sourceLine" id="cb29-7" data-line-number="7">getTextBoxFocusScreenCoords</a>
<a class="sourceLine" id="cb29-8" data-line-number="8"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)</a>
<a class="sourceLine" id="cb29-9" data-line-number="9">getTextBoxFocusScreenCoords box <span class="fu">=</span></a>
<a class="sourceLine" id="cb29-10" data-line-number="10">  querySizedBuffer getPointScreenCoords</a>
<a class="sourceLine" id="cb29-11" data-line-number="11">    <span class="fu">$</span> textboxBuffer box</a></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb30-1" data-line-number="1">editTextBoxBuffer</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="ot">  ::</span> (<span class="dt">SizedBuffer</span> (<span class="dt">Glyph</span> <span class="dt">Char</span>) <span class="ot">-&gt;</span> <span class="dt">SizedBuffer</span> (<span class="dt">Glyph</span> <span class="dt">Char</span>))</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4">editTextBoxBuffer f box <span class="fu">=</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5">  box { textboxBuffer <span class="fu">=</span> f (textboxBuffer box) }</a></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb31-1" data-line-number="1">setTextBoxHeight</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3">setTextBoxHeight h box <span class="fu">=</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4">  box { textboxHeight <span class="fu">=</span> h }</a></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb32-1" data-line-number="1">setTextBoxOffset</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3">setTextBoxOffset k box <span class="fu">=</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4">  box { textboxOffset <span class="fu">=</span> k }</a></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb33-1" data-line-number="1">setTextBoxCursor</a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="ot">  ::</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3">setTextBoxCursor pos box <span class="fu">=</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4">  box { textboxCursor <span class="fu">=</span> pos }</a></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb34-1" data-line-number="1">highlightRegion</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Glyph</span> <span class="dt">Char</span> <span class="ot">-&gt;</span> <span class="dt">Glyph</span> <span class="dt">Char</span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3">highlightRegion z <span class="fu">=</span> <span class="kw">case</span> z <span class="kw">of</span></a>
<a class="sourceLine" id="cb34-4" data-line-number="4">  <span class="dt">Glyph</span> c f _ <span class="ot">-&gt;</span> <span class="dt">Glyph</span> c dullBlack vividWhite</a></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb35-1" data-line-number="1">renderTextBox</a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3">  <span class="ot">-&gt;</span> ([[(<span class="dt">Glyph</span> <span class="dt">Char</span>, <span class="dt">Int</span>)]], <span class="dt">Int</span>, [[(<span class="dt">Glyph</span> <span class="dt">Char</span>, <span class="dt">Int</span>)]], (<span class="dt">Int</span>, <span class="dt">Int</span>), (<span class="dt">Int</span>, <span class="dt">Int</span>))</a>
<a class="sourceLine" id="cb35-4" data-line-number="4">renderTextBox box<span class="fu">@</span><span class="dt">TextBox</span>{<span class="fu">..</span>} <span class="fu">=</span></a>
<a class="sourceLine" id="cb35-5" data-line-number="5">  <span class="kw">let</span></a>
<a class="sourceLine" id="cb35-6" data-line-number="6">    w <span class="fu">=</span> getTextBoxWidth box</a>
<a class="sourceLine" id="cb35-7" data-line-number="7">    (labels&#39;, lines&#39;) <span class="fu">=</span></a>
<a class="sourceLine" id="cb35-8" data-line-number="8">      querySizedBuffer</a>
<a class="sourceLine" id="cb35-9" data-line-number="9">        (renderScreenLinesWithRegion highlightRegion textboxOffset textboxHeight) <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-10" data-line-number="10">      textboxBuffer</a>
<a class="sourceLine" id="cb35-11" data-line-number="11"></a>
<a class="sourceLine" id="cb35-12" data-line-number="12"><span class="ot">    firstMaybe ::</span> [<span class="dt">Maybe</span> a] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb35-13" data-line-number="13">    firstMaybe xs <span class="fu">=</span> <span class="kw">case</span> xs <span class="kw">of</span></a>
<a class="sourceLine" id="cb35-14" data-line-number="14">      [] <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb35-15" data-line-number="15">      <span class="dt">Nothing</span> <span class="fu">:</span> ys <span class="ot">-&gt;</span> firstMaybe ys</a>
<a class="sourceLine" id="cb35-16" data-line-number="16">      <span class="dt">Just</span> a <span class="fu">:</span> _ <span class="ot">-&gt;</span> <span class="dt">Just</span> a</a>
<a class="sourceLine" id="cb35-17" data-line-number="17"></a>
<a class="sourceLine" id="cb35-18" data-line-number="18"><span class="ot">    labelW ::</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb35-19" data-line-number="19">    labelW <span class="fu">=</span> <span class="kw">case</span> firstMaybe labels&#39; <span class="kw">of</span></a>
<a class="sourceLine" id="cb35-20" data-line-number="20">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb35-21" data-line-number="21">      <span class="dt">Just</span> k <span class="ot">-&gt;</span> <span class="dv">1</span> <span class="fu">+</span> length (show k)</a>
<a class="sourceLine" id="cb35-22" data-line-number="22"></a>
<a class="sourceLine" id="cb35-23" data-line-number="23"><span class="ot">    showLabel ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> [(<span class="dt">Glyph</span> <span class="dt">Char</span>, <span class="dt">Int</span>)]</a>
<a class="sourceLine" id="cb35-24" data-line-number="24">    showLabel z <span class="fu">=</span> <span class="kw">case</span> z <span class="kw">of</span></a>
<a class="sourceLine" id="cb35-25" data-line-number="25">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> [(fromChar <span class="ch">&#39; &#39;</span>, <span class="dv">0</span>)]</a>
<a class="sourceLine" id="cb35-26" data-line-number="26">      <span class="dt">Just</span> k <span class="ot">-&gt;</span> zip ((map fromChar (show k)) <span class="fu">++</span> [fromChar <span class="ch">&#39; &#39;</span>]) [<span class="dv">0</span><span class="fu">..</span>]</a>
<a class="sourceLine" id="cb35-27" data-line-number="27">  <span class="kw">in</span></a>
<a class="sourceLine" id="cb35-28" data-line-number="28">    ( take textboxHeight <span class="fu">$</span> (map showLabel labels&#39;) <span class="fu">++</span> repeat []</a>
<a class="sourceLine" id="cb35-29" data-line-number="29">    , labelW</a>
<a class="sourceLine" id="cb35-30" data-line-number="30">    , map (\ln <span class="ot">-&gt;</span> take w <span class="fu">$</span> ln <span class="fu">++</span> repeat (fromChar <span class="ch">&#39; &#39;</span>, <span class="dv">1</span>)) <span class="fu">$</span></a>
<a class="sourceLine" id="cb35-31" data-line-number="31">        take textboxHeight <span class="fu">$</span> lines&#39; <span class="fu">++</span> repeat []</a>
<a class="sourceLine" id="cb35-32" data-line-number="32">    , (w, textboxHeight)</a>
<a class="sourceLine" id="cb35-33" data-line-number="33">    , textboxCursor</a>
<a class="sourceLine" id="cb35-34" data-line-number="34">    )</a></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="co">-- | Width in character cells of the line labels for</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="co">-- a @TextBox@.</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="ot">textboxLabelWidth ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb36-4" data-line-number="4">textboxLabelWidth box <span class="fu">=</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5">  <span class="kw">let</span> m <span class="fu">=</span> textboxOffset box <span class="kw">in</span></a>
<a class="sourceLine" id="cb36-6" data-line-number="6">  <span class="dv">1</span> <span class="fu">+</span> dlog (textboxLabelBase box) m</a></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb37-1" data-line-number="1">mkTextBox</a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="ot">  ::</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3">  <span class="ot">-&gt;</span> [<span class="dt">TextBoxAction</span>]</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb37-5" data-line-number="5">mkTextBox (x,y) tab acts <span class="fu">=</span></a>
<a class="sourceLine" id="cb37-6" data-line-number="6">  alterTextBox acts <span class="fu">$</span> emptyTextBox (x,y) tab</a></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="co">-- | Digital logarithm; number of digits needed to express</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="co">-- positive @k@ in base @b@.</span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="ot">dlog ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb38-4" data-line-number="4">dlog b k <span class="fu">=</span></a>
<a class="sourceLine" id="cb38-5" data-line-number="5">  <span class="kw">if</span> (b <span class="fu">&lt;=</span> <span class="dv">1</span>) <span class="fu">||</span> (k <span class="fu">&lt;</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb38-6" data-line-number="6">    <span class="kw">then</span> error <span class="st">&quot;dlog: bad argument&quot;</span></a>
<a class="sourceLine" id="cb38-7" data-line-number="7">    <span class="kw">else</span> dlog&#39; k</a>
<a class="sourceLine" id="cb38-8" data-line-number="8">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9">    dlog&#39; m <span class="fu">=</span> <span class="kw">if</span> m <span class="fu">&lt;</span> b</a>
<a class="sourceLine" id="cb38-10" data-line-number="10">      <span class="kw">then</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb38-11" data-line-number="11">      <span class="kw">else</span> <span class="dv">1</span> <span class="fu">+</span> (dlog&#39; <span class="fu">$</span> div m b)</a></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb39-1" data-line-number="1">textboxNearestScreenCoords</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) <span class="ot">-&gt;</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">textboxNearestScreenCoords box coords <span class="fu">=</span></a>
<a class="sourceLine" id="cb39-4" data-line-number="4">  querySizedBuffer</a>
<a class="sourceLine" id="cb39-5" data-line-number="5">    (seekScreenCoords coords)</a>
<a class="sourceLine" id="cb39-6" data-line-number="6">    (textboxBuffer box)</a></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">data</span> <span class="dt">TextBoxAction</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2">  <span class="co">-- Text Manipulation</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3">  <span class="fu">=</span> <span class="dt">TextBoxInsert</span> (<span class="dt">Glyph</span> <span class="dt">Char</span>)</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">  <span class="fu">|</span> <span class="dt">TextBoxInsertMany</span> [<span class="dt">Glyph</span> <span class="dt">Char</span>]</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">  <span class="fu">|</span> <span class="dt">TextBoxBackspace</span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"></a>
<a class="sourceLine" id="cb40-7" data-line-number="7">  <span class="co">-- Navigation</span></a>
<a class="sourceLine" id="cb40-8" data-line-number="8">  <span class="fu">|</span> <span class="dt">TextBoxCursorDown</span></a>
<a class="sourceLine" id="cb40-9" data-line-number="9">  <span class="fu">|</span> <span class="dt">TextBoxCursorUp</span></a>
<a class="sourceLine" id="cb40-10" data-line-number="10">  <span class="fu">|</span> <span class="dt">TextBoxCursorRight</span></a>
<a class="sourceLine" id="cb40-11" data-line-number="11">  <span class="fu">|</span> <span class="dt">TextBoxCursorLeft</span></a>
<a class="sourceLine" id="cb40-12" data-line-number="12"></a>
<a class="sourceLine" id="cb40-13" data-line-number="13">  <span class="fu">|</span> <span class="dt">TextBoxLineStart</span></a>
<a class="sourceLine" id="cb40-14" data-line-number="14">  <span class="fu">|</span> <span class="dt">TextBoxLineEnd</span></a>
<a class="sourceLine" id="cb40-15" data-line-number="15">  <span class="fu">|</span> <span class="dt">TextBoxPageUp</span></a>
<a class="sourceLine" id="cb40-16" data-line-number="16">  <span class="fu">|</span> <span class="dt">TextBoxPageDown</span></a>
<a class="sourceLine" id="cb40-17" data-line-number="17">  <span class="fu">|</span> <span class="dt">TextBoxToTop</span></a>
<a class="sourceLine" id="cb40-18" data-line-number="18">  <span class="fu">|</span> <span class="dt">TextBoxToBottom</span></a>
<a class="sourceLine" id="cb40-19" data-line-number="19"></a>
<a class="sourceLine" id="cb40-20" data-line-number="20">  <span class="fu">|</span> <span class="dt">TextBoxLeaveMark</span></a>
<a class="sourceLine" id="cb40-21" data-line-number="21">  <span class="fu">|</span> <span class="dt">TextBoxClearMark</span></a>
<a class="sourceLine" id="cb40-22" data-line-number="22"></a>
<a class="sourceLine" id="cb40-23" data-line-number="23">  <span class="co">-- </span></a>
<a class="sourceLine" id="cb40-24" data-line-number="24">  <span class="fu">|</span> <span class="dt">TextBoxResize</span> (<span class="dt">Int</span>, <span class="dt">Int</span>)</a></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb41-1" data-line-number="1">  <span class="fu">|</span> <span class="dt">TextBoxLoad</span> FilePath <span class="dt">String</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2">  <span class="fu">|</span> <span class="dt">TextBoxClear</span></a>
<a class="sourceLine" id="cb41-3" data-line-number="3">  <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Arb</span> <span class="dt">TextBoxAction</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2">  arb <span class="fu">=</span> selectFrom</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">    [ <span class="dt">TextBoxInsert</span> <span class="fu">&lt;$&gt;</span> arb</a>
<a class="sourceLine" id="cb42-4" data-line-number="4">    , <span class="dt">TextBoxInsertMany</span> <span class="fu">&lt;$&gt;</span> arb</a>
<a class="sourceLine" id="cb42-5" data-line-number="5">    , return <span class="dt">TextBoxBackspace</span></a>
<a class="sourceLine" id="cb42-6" data-line-number="6">    , return <span class="dt">TextBoxCursorDown</span></a>
<a class="sourceLine" id="cb42-7" data-line-number="7">    , return <span class="dt">TextBoxCursorUp</span></a>
<a class="sourceLine" id="cb42-8" data-line-number="8">    , return <span class="dt">TextBoxCursorRight</span></a>
<a class="sourceLine" id="cb42-9" data-line-number="9">    , return <span class="dt">TextBoxCursorLeft</span></a>
<a class="sourceLine" id="cb42-10" data-line-number="10">    , return <span class="dt">TextBoxLeaveMark</span></a>
<a class="sourceLine" id="cb42-11" data-line-number="11">    , return <span class="dt">TextBoxClearMark</span></a>
<a class="sourceLine" id="cb42-12" data-line-number="12">    , <span class="kw">do</span></a>
<a class="sourceLine" id="cb42-13" data-line-number="13">        <span class="dt">Positive</span> w <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb42-14" data-line-number="14">        <span class="dt">Positive</span> h <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb42-15" data-line-number="15">        return <span class="fu">$</span> <span class="dt">TextBoxResize</span> (w,h)</a>
<a class="sourceLine" id="cb42-16" data-line-number="16">    ]</a>
<a class="sourceLine" id="cb42-17" data-line-number="17"></a>
<a class="sourceLine" id="cb42-18" data-line-number="18"><span class="kw">instance</span> <span class="dt">Prune</span> <span class="dt">TextBoxAction</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb42-19" data-line-number="19">  prune x <span class="fu">=</span> <span class="kw">case</span> x <span class="kw">of</span></a>
<a class="sourceLine" id="cb42-20" data-line-number="20">    <span class="dt">TextBoxInsertMany</span> cs <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb42-21" data-line-number="21">      map <span class="dt">TextBoxInsertMany</span> <span class="fu">$</span> prune cs</a>
<a class="sourceLine" id="cb42-22" data-line-number="22">    _ <span class="ot">-&gt;</span> []</a></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Arb</span> <span class="dt">TextBox</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2">  arb <span class="fu">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb43-3" data-line-number="3">    <span class="dt">Positive</span> x <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb43-4" data-line-number="4">    <span class="dt">Positive</span> y <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb43-5" data-line-number="5">    <span class="dt">Positive</span> t <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb43-6" data-line-number="6">    mkTextBox (x,y) t <span class="fu">&lt;$&gt;</span> arb</a></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb44-1" data-line-number="1">alterTextBox</a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="ot">  ::</span> [<span class="dt">TextBoxAction</span>]</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb44-4" data-line-number="4">alterTextBox acts box <span class="fu">=</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5">  foldl (flip alterTextBoxPrimitive) box acts</a></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb45-1" data-line-number="1">alterTextBoxPrimitive</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBoxAction</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4">alterTextBoxPrimitive act <span class="fu">=</span> <span class="kw">case</span> act <span class="kw">of</span></a>
<a class="sourceLine" id="cb45-5" data-line-number="5">  <span class="dt">TextBoxInsert</span> c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-6" data-line-number="6">    textBoxInsert c</a>
<a class="sourceLine" id="cb45-7" data-line-number="7"></a>
<a class="sourceLine" id="cb45-8" data-line-number="8">  <span class="dt">TextBoxInsertMany</span> cs <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-9" data-line-number="9">    textBoxInsertMany cs</a>
<a class="sourceLine" id="cb45-10" data-line-number="10"></a>
<a class="sourceLine" id="cb45-11" data-line-number="11">  <span class="dt">TextBoxBackspace</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-12" data-line-number="12">    textBoxBackspace</a>
<a class="sourceLine" id="cb45-13" data-line-number="13"></a>
<a class="sourceLine" id="cb45-14" data-line-number="14">  <span class="dt">TextBoxCursorDown</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-15" data-line-number="15">    textboxCursorDown</a>
<a class="sourceLine" id="cb45-16" data-line-number="16"></a>
<a class="sourceLine" id="cb45-17" data-line-number="17">  <span class="dt">TextBoxCursorUp</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-18" data-line-number="18">    textboxCursorUp</a>
<a class="sourceLine" id="cb45-19" data-line-number="19"></a>
<a class="sourceLine" id="cb45-20" data-line-number="20">  <span class="dt">TextBoxCursorRight</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-21" data-line-number="21">    textboxCursorRight</a>
<a class="sourceLine" id="cb45-22" data-line-number="22"></a>
<a class="sourceLine" id="cb45-23" data-line-number="23">  <span class="dt">TextBoxCursorLeft</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-24" data-line-number="24">    textboxCursorLeft</a>
<a class="sourceLine" id="cb45-25" data-line-number="25"></a>
<a class="sourceLine" id="cb45-26" data-line-number="26">  <span class="dt">TextBoxResize</span> dim <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-27" data-line-number="27">    textboxResize dim</a>
<a class="sourceLine" id="cb45-28" data-line-number="28"></a>
<a class="sourceLine" id="cb45-29" data-line-number="29">  <span class="dt">TextBoxLoad</span> path str <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-30" data-line-number="30">    textboxLoad path str</a>
<a class="sourceLine" id="cb45-31" data-line-number="31"></a>
<a class="sourceLine" id="cb45-32" data-line-number="32">  <span class="dt">TextBoxLeaveMark</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-33" data-line-number="33">    textboxLeaveMark</a>
<a class="sourceLine" id="cb45-34" data-line-number="34"></a>
<a class="sourceLine" id="cb45-35" data-line-number="35">  <span class="dt">TextBoxClearMark</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-36" data-line-number="36">    textboxClearMark</a>
<a class="sourceLine" id="cb45-37" data-line-number="37"></a>
<a class="sourceLine" id="cb45-38" data-line-number="38">  <span class="dt">TextBoxClear</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb45-39" data-line-number="39">    textboxClear</a></code></pre></div>
<p>– ================= – – Primitive Actions – – ================= –</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb46-1" data-line-number="1">textboxClear</a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3">textboxClear box <span class="fu">=</span> box</a>
<a class="sourceLine" id="cb46-4" data-line-number="4">  { textboxBuffer <span class="fu">=</span> emptySizedBuffer</a>
<a class="sourceLine" id="cb46-5" data-line-number="5">      (getTextBoxWidth box) (getTextBoxHeight box)</a>
<a class="sourceLine" id="cb46-6" data-line-number="6">  , textboxOffset <span class="fu">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb46-7" data-line-number="7">  , textboxCursor <span class="fu">=</span> (<span class="dv">0</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb46-8" data-line-number="8">  , textboxSource <span class="fu">=</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb46-9" data-line-number="9">  , textboxHasChanged <span class="fu">=</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb46-10" data-line-number="10">  }</a></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb47-1" data-line-number="1">textboxLoad</a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="ot">  ::</span> FilePath <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb47-3" data-line-number="3">textboxLoad path str box <span class="fu">=</span> box</a>
<a class="sourceLine" id="cb47-4" data-line-number="4">  { textboxBuffer <span class="fu">=</span> makeSizedBuffer</a>
<a class="sourceLine" id="cb47-5" data-line-number="5">      (getTextBoxWidth box) (getTextBoxHeight box) (map fromChar str)</a>
<a class="sourceLine" id="cb47-6" data-line-number="6">  , textboxOffset <span class="fu">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb47-7" data-line-number="7">  , textboxCursor <span class="fu">=</span> (<span class="dv">0</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb47-8" data-line-number="8">  , textboxSource <span class="fu">=</span> <span class="dt">Just</span> path</a>
<a class="sourceLine" id="cb47-9" data-line-number="9">  , textboxHasChanged <span class="fu">=</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb47-10" data-line-number="10">  }</a></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb48-1" data-line-number="1">textboxLeaveMark</a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb48-3" data-line-number="3">textboxLeaveMark box <span class="fu">=</span></a>
<a class="sourceLine" id="cb48-4" data-line-number="4">  <span class="kw">let</span></a>
<a class="sourceLine" id="cb48-5" data-line-number="5">    buf <span class="fu">=</span></a>
<a class="sourceLine" id="cb48-6" data-line-number="6">      alterSizedBuffer (leaveMark) <span class="fu">$</span></a>
<a class="sourceLine" id="cb48-7" data-line-number="7">      textboxBuffer box</a>
<a class="sourceLine" id="cb48-8" data-line-number="8">  <span class="kw">in</span> box</a>
<a class="sourceLine" id="cb48-9" data-line-number="9">    { textboxBuffer <span class="fu">=</span> buf</a>
<a class="sourceLine" id="cb48-10" data-line-number="10">    }</a></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb49-1" data-line-number="1">textboxClearMark</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb49-3" data-line-number="3">textboxClearMark box <span class="fu">=</span></a>
<a class="sourceLine" id="cb49-4" data-line-number="4">  <span class="kw">let</span></a>
<a class="sourceLine" id="cb49-5" data-line-number="5">    buf <span class="fu">=</span></a>
<a class="sourceLine" id="cb49-6" data-line-number="6">      alterSizedBuffer (clearMark) <span class="fu">$</span></a>
<a class="sourceLine" id="cb49-7" data-line-number="7">      textboxBuffer box</a>
<a class="sourceLine" id="cb49-8" data-line-number="8">  <span class="kw">in</span> box</a>
<a class="sourceLine" id="cb49-9" data-line-number="9">    { textboxBuffer <span class="fu">=</span> buf</a>
<a class="sourceLine" id="cb49-10" data-line-number="10">    }</a></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb50-1" data-line-number="1">textBoxInsert</a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">Glyph</span> <span class="dt">Char</span></a>
<a class="sourceLine" id="cb50-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb50-4" data-line-number="4">textBoxInsert c box <span class="fu">=</span></a>
<a class="sourceLine" id="cb50-5" data-line-number="5">  <span class="kw">let</span></a>
<a class="sourceLine" id="cb50-6" data-line-number="6">    (x,y) <span class="fu">=</span> textboxCursor box</a>
<a class="sourceLine" id="cb50-7" data-line-number="7">    l <span class="fu">=</span> textboxOffset box</a>
<a class="sourceLine" id="cb50-8" data-line-number="8">    h <span class="fu">=</span> textboxHeight box</a>
<a class="sourceLine" id="cb50-9" data-line-number="9"></a>
<a class="sourceLine" id="cb50-10" data-line-number="10">    buf <span class="fu">=</span></a>
<a class="sourceLine" id="cb50-11" data-line-number="11">      alterSizedBuffer (insertPointLeft c) <span class="fu">$</span></a>
<a class="sourceLine" id="cb50-12" data-line-number="12">      alterSizedBuffer (movePointToScreenCoords (x, y<span class="fu">+</span>l)) <span class="fu">$</span></a>
<a class="sourceLine" id="cb50-13" data-line-number="13">      textboxBuffer box</a>
<a class="sourceLine" id="cb50-14" data-line-number="14"></a>
<a class="sourceLine" id="cb50-15" data-line-number="15">    (u,v) <span class="fu">=</span></a>
<a class="sourceLine" id="cb50-16" data-line-number="16">      querySizedBuffer getPointScreenCoords <span class="fu">$</span></a>
<a class="sourceLine" id="cb50-17" data-line-number="17">      buf</a>
<a class="sourceLine" id="cb50-18" data-line-number="18"></a>
<a class="sourceLine" id="cb50-19" data-line-number="19">    (v&#39;, l&#39;) <span class="fu">=</span> <span class="kw">if</span> v <span class="fu">&gt;=</span> l<span class="fu">+</span>h</a>
<a class="sourceLine" id="cb50-20" data-line-number="20">      <span class="kw">then</span> (h<span class="fu">-</span><span class="dv">1</span>, l<span class="fu">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb50-21" data-line-number="21">      <span class="kw">else</span> (v<span class="fu">-</span>l, l)</a>
<a class="sourceLine" id="cb50-22" data-line-number="22">  <span class="kw">in</span> box</a>
<a class="sourceLine" id="cb50-23" data-line-number="23">    { textboxBuffer <span class="fu">=</span> buf</a>
<a class="sourceLine" id="cb50-24" data-line-number="24">    , textboxCursor <span class="fu">=</span> (u,v&#39;)</a>
<a class="sourceLine" id="cb50-25" data-line-number="25">    , textboxOffset <span class="fu">=</span> l&#39;</a>
<a class="sourceLine" id="cb50-26" data-line-number="26">    , textboxHasChanged <span class="fu">=</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb50-27" data-line-number="27">    }</a></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb51-1" data-line-number="1">textBoxInsertMany</a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="ot">  ::</span> [<span class="dt">Glyph</span> <span class="dt">Char</span>]</a>
<a class="sourceLine" id="cb51-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb51-4" data-line-number="4">textBoxInsertMany cs box <span class="fu">=</span></a>
<a class="sourceLine" id="cb51-5" data-line-number="5">  foldl (flip textBoxInsert) box cs</a></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb52-1" data-line-number="1">textBoxBackspace</a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb52-3" data-line-number="3">textBoxBackspace box <span class="fu">=</span></a>
<a class="sourceLine" id="cb52-4" data-line-number="4">  <span class="kw">let</span></a>
<a class="sourceLine" id="cb52-5" data-line-number="5">    (x,y) <span class="fu">=</span> textboxCursor box</a>
<a class="sourceLine" id="cb52-6" data-line-number="6">    l <span class="fu">=</span> textboxOffset box</a>
<a class="sourceLine" id="cb52-7" data-line-number="7"></a>
<a class="sourceLine" id="cb52-8" data-line-number="8">    buf <span class="fu">=</span></a>
<a class="sourceLine" id="cb52-9" data-line-number="9">      alterSizedBuffer deletePointLeft <span class="fu">$</span></a>
<a class="sourceLine" id="cb52-10" data-line-number="10">      alterSizedBuffer (movePointToScreenCoords (x, y<span class="fu">+</span>l)) <span class="fu">$</span></a>
<a class="sourceLine" id="cb52-11" data-line-number="11">      textboxBuffer box</a>
<a class="sourceLine" id="cb52-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb52-13" data-line-number="13">    (u,v) <span class="fu">=</span></a>
<a class="sourceLine" id="cb52-14" data-line-number="14">      querySizedBuffer getPointScreenCoords <span class="fu">$</span></a>
<a class="sourceLine" id="cb52-15" data-line-number="15">      buf</a>
<a class="sourceLine" id="cb52-16" data-line-number="16"></a>
<a class="sourceLine" id="cb52-17" data-line-number="17">    (v&#39;, l&#39;) <span class="fu">=</span></a>
<a class="sourceLine" id="cb52-18" data-line-number="18">      <span class="kw">if</span> (v <span class="fu">&lt;</span> l) <span class="fu">&amp;&amp;</span> (l <span class="fu">&gt;</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb52-19" data-line-number="19">        <span class="kw">then</span> (<span class="dv">0</span>, l<span class="fu">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb52-20" data-line-number="20">        <span class="kw">else</span> (v<span class="fu">-</span>l, l)</a>
<a class="sourceLine" id="cb52-21" data-line-number="21"></a>
<a class="sourceLine" id="cb52-22" data-line-number="22">  <span class="kw">in</span> <span class="kw">if</span> (x,y<span class="fu">+</span>l) <span class="fu">==</span> (<span class="dv">0</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb52-23" data-line-number="23">    <span class="kw">then</span> box</a>
<a class="sourceLine" id="cb52-24" data-line-number="24">    <span class="kw">else</span> box</a>
<a class="sourceLine" id="cb52-25" data-line-number="25">      { textboxCursor <span class="fu">=</span> (u, v&#39;)</a>
<a class="sourceLine" id="cb52-26" data-line-number="26">      , textboxOffset <span class="fu">=</span> l&#39;</a>
<a class="sourceLine" id="cb52-27" data-line-number="27">      , textboxBuffer <span class="fu">=</span> buf</a>
<a class="sourceLine" id="cb52-28" data-line-number="28">      , textboxHasChanged <span class="fu">=</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb52-29" data-line-number="29">      }</a></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb53-1" data-line-number="1">textboxCursorDown</a>
<a class="sourceLine" id="cb53-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb53-3" data-line-number="3">textboxCursorDown box <span class="fu">=</span></a>
<a class="sourceLine" id="cb53-4" data-line-number="4">  localSt box <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb53-5" data-line-number="5">    (x,y) <span class="ot">&lt;-</span> readSt getTextBoxCursor</a>
<a class="sourceLine" id="cb53-6" data-line-number="6"></a>
<a class="sourceLine" id="cb53-7" data-line-number="7">    l <span class="ot">&lt;-</span> readSt getTextBoxOffset</a>
<a class="sourceLine" id="cb53-8" data-line-number="8">    h <span class="ot">&lt;-</span> readSt getTextBoxHeight</a>
<a class="sourceLine" id="cb53-9" data-line-number="9"></a>
<a class="sourceLine" id="cb53-10" data-line-number="10">    editSt <span class="fu">$</span> editTextBoxBuffer <span class="fu">$</span> alterSizedBuffer <span class="fu">$</span></a>
<a class="sourceLine" id="cb53-11" data-line-number="11">      movePointToScreenCoords (x,y<span class="fu">+</span>l<span class="fu">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb53-12" data-line-number="12"></a>
<a class="sourceLine" id="cb53-13" data-line-number="13">    (u,v) <span class="ot">&lt;-</span> readSt <span class="fu">$</span></a>
<a class="sourceLine" id="cb53-14" data-line-number="14">      querySizedBuffer getPointScreenCoords</a>
<a class="sourceLine" id="cb53-15" data-line-number="15">        <span class="fu">.</span> getTextBoxBuffer</a>
<a class="sourceLine" id="cb53-16" data-line-number="16"></a>
<a class="sourceLine" id="cb53-17" data-line-number="17">    (_,q) <span class="ot">&lt;-</span> readSt <span class="fu">$</span></a>
<a class="sourceLine" id="cb53-18" data-line-number="18">      querySizedBuffer getBufferScreenCoords</a>
<a class="sourceLine" id="cb53-19" data-line-number="19">        <span class="fu">.</span> getTextBoxBuffer</a>
<a class="sourceLine" id="cb53-20" data-line-number="20"></a>
<a class="sourceLine" id="cb53-21" data-line-number="21">    <span class="kw">let</span></a>
<a class="sourceLine" id="cb53-22" data-line-number="22">      (v&#39;, l&#39;) <span class="fu">=</span></a>
<a class="sourceLine" id="cb53-23" data-line-number="23">        <span class="kw">if</span> v <span class="fu">&gt;=</span> l<span class="fu">+</span>h</a>
<a class="sourceLine" id="cb53-24" data-line-number="24">          <span class="kw">then</span> <span class="kw">if</span> v <span class="fu">&lt;</span> q</a>
<a class="sourceLine" id="cb53-25" data-line-number="25">            <span class="kw">then</span> (h<span class="fu">-</span><span class="dv">1</span>, l<span class="fu">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb53-26" data-line-number="26">            <span class="kw">else</span> (h<span class="fu">-</span><span class="dv">1</span>, l)</a>
<a class="sourceLine" id="cb53-27" data-line-number="27">          <span class="kw">else</span> (v<span class="fu">-</span>l, l)</a>
<a class="sourceLine" id="cb53-28" data-line-number="28"></a>
<a class="sourceLine" id="cb53-29" data-line-number="29">    editSt <span class="fu">$</span> setTextBoxOffset l&#39;</a>
<a class="sourceLine" id="cb53-30" data-line-number="30">    editSt <span class="fu">$</span> setTextBoxCursor (u, v&#39;)</a></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb54-1" data-line-number="1">textboxCursorUp</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb54-3" data-line-number="3">textboxCursorUp box <span class="fu">=</span></a>
<a class="sourceLine" id="cb54-4" data-line-number="4">  localSt box <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb54-5" data-line-number="5">    (x,y) <span class="ot">&lt;-</span> readSt getTextBoxCursor</a>
<a class="sourceLine" id="cb54-6" data-line-number="6">    l <span class="ot">&lt;-</span> readSt getTextBoxOffset</a>
<a class="sourceLine" id="cb54-7" data-line-number="7"></a>
<a class="sourceLine" id="cb54-8" data-line-number="8">    editSt <span class="fu">$</span> editTextBoxBuffer <span class="fu">$</span> alterSizedBuffer <span class="fu">$</span></a>
<a class="sourceLine" id="cb54-9" data-line-number="9">      movePointToScreenCoords (x,y<span class="fu">+</span>l<span class="fu">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb54-10" data-line-number="10"></a>
<a class="sourceLine" id="cb54-11" data-line-number="11">    (u,v) <span class="ot">&lt;-</span> readSt <span class="fu">$</span></a>
<a class="sourceLine" id="cb54-12" data-line-number="12">      querySizedBuffer getPointScreenCoords</a>
<a class="sourceLine" id="cb54-13" data-line-number="13">        <span class="fu">.</span> getTextBoxBuffer</a>
<a class="sourceLine" id="cb54-14" data-line-number="14"></a>
<a class="sourceLine" id="cb54-15" data-line-number="15">    <span class="kw">let</span></a>
<a class="sourceLine" id="cb54-16" data-line-number="16">      (v&#39;, l&#39;) <span class="fu">=</span></a>
<a class="sourceLine" id="cb54-17" data-line-number="17">        <span class="kw">if</span> (v <span class="fu">&lt;</span> l) <span class="fu">&amp;&amp;</span> (l <span class="fu">&gt;</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb54-18" data-line-number="18">          <span class="kw">then</span> (<span class="dv">0</span>, l<span class="fu">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb54-19" data-line-number="19">          <span class="kw">else</span> (v<span class="fu">-</span>l, l)</a>
<a class="sourceLine" id="cb54-20" data-line-number="20"></a>
<a class="sourceLine" id="cb54-21" data-line-number="21">    editSt <span class="fu">$</span> setTextBoxOffset l&#39;</a>
<a class="sourceLine" id="cb54-22" data-line-number="22">    editSt <span class="fu">$</span> setTextBoxCursor (u, v&#39;)</a></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb55-1" data-line-number="1">textboxCursorLeft</a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb55-3" data-line-number="3">textboxCursorLeft box <span class="fu">=</span></a>
<a class="sourceLine" id="cb55-4" data-line-number="4">  <span class="kw">let</span></a>
<a class="sourceLine" id="cb55-5" data-line-number="5">    l <span class="fu">=</span> textboxOffset box</a>
<a class="sourceLine" id="cb55-6" data-line-number="6"></a>
<a class="sourceLine" id="cb55-7" data-line-number="7">    buf <span class="fu">=</span></a>
<a class="sourceLine" id="cb55-8" data-line-number="8">      alterSizedBuffer (movePointLeft) <span class="fu">$</span></a>
<a class="sourceLine" id="cb55-9" data-line-number="9">        textboxBuffer box</a>
<a class="sourceLine" id="cb55-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb55-11" data-line-number="11">    (u,v) <span class="fu">=</span></a>
<a class="sourceLine" id="cb55-12" data-line-number="12">      querySizedBuffer getPointScreenCoords <span class="fu">$</span></a>
<a class="sourceLine" id="cb55-13" data-line-number="13">      buf</a>
<a class="sourceLine" id="cb55-14" data-line-number="14"></a>
<a class="sourceLine" id="cb55-15" data-line-number="15">    (v&#39;, l&#39;) <span class="fu">=</span></a>
<a class="sourceLine" id="cb55-16" data-line-number="16">      <span class="kw">if</span> (v <span class="fu">&lt;</span> l) <span class="fu">&amp;&amp;</span> (l <span class="fu">&gt;</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb55-17" data-line-number="17">        <span class="kw">then</span> (<span class="dv">0</span>, l<span class="fu">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb55-18" data-line-number="18">        <span class="kw">else</span> (v<span class="fu">-</span>l, l)</a>
<a class="sourceLine" id="cb55-19" data-line-number="19">  <span class="kw">in</span> box</a>
<a class="sourceLine" id="cb55-20" data-line-number="20">    { textboxCursor <span class="fu">=</span> (u, v&#39;)</a>
<a class="sourceLine" id="cb55-21" data-line-number="21">    , textboxOffset <span class="fu">=</span> l&#39;</a>
<a class="sourceLine" id="cb55-22" data-line-number="22">    , textboxBuffer <span class="fu">=</span> buf</a>
<a class="sourceLine" id="cb55-23" data-line-number="23">    }</a></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb56-1" data-line-number="1">textboxCursorRight</a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb56-3" data-line-number="3">textboxCursorRight box <span class="fu">=</span></a>
<a class="sourceLine" id="cb56-4" data-line-number="4">  localSt box <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb56-5" data-line-number="5">    editSt <span class="fu">$</span> editTextBoxBuffer <span class="fu">$</span></a>
<a class="sourceLine" id="cb56-6" data-line-number="6">      alterSizedBuffer (movePointRight)</a>
<a class="sourceLine" id="cb56-7" data-line-number="7"></a>
<a class="sourceLine" id="cb56-8" data-line-number="8">    (x,y) <span class="ot">&lt;-</span> readSt getTextBoxCursor</a>
<a class="sourceLine" id="cb56-9" data-line-number="9"></a>
<a class="sourceLine" id="cb56-10" data-line-number="10">    l <span class="ot">&lt;-</span> readSt getTextBoxOffset</a>
<a class="sourceLine" id="cb56-11" data-line-number="11">    h <span class="ot">&lt;-</span> readSt getTextBoxHeight</a>
<a class="sourceLine" id="cb56-12" data-line-number="12"></a>
<a class="sourceLine" id="cb56-13" data-line-number="13">    (u,v) <span class="ot">&lt;-</span> readSt <span class="fu">$</span></a>
<a class="sourceLine" id="cb56-14" data-line-number="14">      querySizedBuffer getPointScreenCoords</a>
<a class="sourceLine" id="cb56-15" data-line-number="15">        <span class="fu">.</span> getTextBoxBuffer</a>
<a class="sourceLine" id="cb56-16" data-line-number="16"></a>
<a class="sourceLine" id="cb56-17" data-line-number="17">    <span class="kw">let</span></a>
<a class="sourceLine" id="cb56-18" data-line-number="18">      (v&#39;, l&#39;) <span class="fu">=</span></a>
<a class="sourceLine" id="cb56-19" data-line-number="19">        <span class="kw">if</span> (v <span class="fu">&gt;=</span> l<span class="fu">+</span>h)</a>
<a class="sourceLine" id="cb56-20" data-line-number="20">          <span class="kw">then</span> (h<span class="fu">-</span><span class="dv">1</span>, l<span class="fu">+</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb56-21" data-line-number="21">          <span class="kw">else</span> (v<span class="fu">-</span>l, l)</a>
<a class="sourceLine" id="cb56-22" data-line-number="22"></a>
<a class="sourceLine" id="cb56-23" data-line-number="23">    editSt <span class="fu">$</span> setTextBoxCursor (u, v&#39;)</a>
<a class="sourceLine" id="cb56-24" data-line-number="24">    editSt <span class="fu">$</span> setTextBoxOffset l&#39;</a></code></pre></div>
<p>Resizing should not change the logical coordinates of the focus.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb57-1" data-line-number="1">textboxResize</a>
<a class="sourceLine" id="cb57-2" data-line-number="2"><span class="ot">  ::</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) <span class="ot">-&gt;</span> <span class="dt">TextBox</span> <span class="ot">-&gt;</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb57-3" data-line-number="3">textboxResize (w, h) box <span class="fu">=</span></a>
<a class="sourceLine" id="cb57-4" data-line-number="4">  localSt box <span class="fu">$</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb57-5" data-line-number="5">    pos <span class="ot">&lt;-</span> readSt <span class="fu">$</span></a>
<a class="sourceLine" id="cb57-6" data-line-number="6">      querySizedBuffer getPointLineCol</a>
<a class="sourceLine" id="cb57-7" data-line-number="7">        <span class="fu">.</span> getTextBoxBuffer</a>
<a class="sourceLine" id="cb57-8" data-line-number="8"></a>
<a class="sourceLine" id="cb57-9" data-line-number="9">    (_,v3) <span class="ot">&lt;-</span> readSt getTextBoxCursor</a>
<a class="sourceLine" id="cb57-10" data-line-number="10"></a>
<a class="sourceLine" id="cb57-11" data-line-number="11">    t <span class="ot">&lt;-</span> readSt <span class="fu">$</span></a>
<a class="sourceLine" id="cb57-12" data-line-number="12">      querySizedBuffer getBufferTabStop</a>
<a class="sourceLine" id="cb57-13" data-line-number="13">        <span class="fu">.</span> getTextBoxBuffer</a>
<a class="sourceLine" id="cb57-14" data-line-number="14"></a>
<a class="sourceLine" id="cb57-15" data-line-number="15">    editSt <span class="fu">$</span> editTextBoxBuffer <span class="fu">$</span></a>
<a class="sourceLine" id="cb57-16" data-line-number="16">      alterSizedBuffer (movePointToLineCol pos)</a>
<a class="sourceLine" id="cb57-17" data-line-number="17">        <span class="fu">.</span> shapeSizedBuffer w t</a>
<a class="sourceLine" id="cb57-18" data-line-number="18"></a>
<a class="sourceLine" id="cb57-19" data-line-number="19">    (u2,v2) <span class="ot">&lt;-</span> readSt <span class="fu">$</span></a>
<a class="sourceLine" id="cb57-20" data-line-number="20">      querySizedBuffer getPointScreenCoords</a>
<a class="sourceLine" id="cb57-21" data-line-number="21">        <span class="fu">.</span> getTextBoxBuffer</a>
<a class="sourceLine" id="cb57-22" data-line-number="22"></a>
<a class="sourceLine" id="cb57-23" data-line-number="23">    <span class="kw">let</span></a>
<a class="sourceLine" id="cb57-24" data-line-number="24">      l2 <span class="fu">=</span></a>
<a class="sourceLine" id="cb57-25" data-line-number="25">        <span class="kw">let</span> z <span class="fu">=</span> max <span class="dv">0</span> (v2 <span class="fu">-</span> v3) <span class="kw">in</span></a>
<a class="sourceLine" id="cb57-26" data-line-number="26">        <span class="kw">if</span> v2 <span class="fu">&gt;=</span> z <span class="fu">+</span> h</a>
<a class="sourceLine" id="cb57-27" data-line-number="27">          <span class="kw">then</span> v2 <span class="fu">-</span> h <span class="fu">+</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb57-28" data-line-number="28">          <span class="kw">else</span> z</a>
<a class="sourceLine" id="cb57-29" data-line-number="29"></a>
<a class="sourceLine" id="cb57-30" data-line-number="30">    editSt <span class="fu">$</span> setTextBoxHeight h</a>
<a class="sourceLine" id="cb57-31" data-line-number="31">    editSt <span class="fu">$</span> setTextBoxOffset l2</a>
<a class="sourceLine" id="cb57-32" data-line-number="32">    editSt <span class="fu">$</span> setTextBoxCursor (u2, v2<span class="fu">-</span>l2)</a></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw">data</span> <span class="dt">DebugTextBox</span> <span class="fu">=</span> <span class="dt">DebugTextBox</span></a>
<a class="sourceLine" id="cb58-2" data-line-number="2">  {<span class="ot"> _labels ::</span> [[(<span class="dt">Glyph</span> <span class="dt">Char</span>, <span class="dt">Int</span>)]]</a>
<a class="sourceLine" id="cb58-3" data-line-number="3">  ,<span class="ot"> _lines  ::</span> [[(<span class="dt">Glyph</span> <span class="dt">Char</span>, <span class="dt">Int</span>)]]</a>
<a class="sourceLine" id="cb58-4" data-line-number="4">  ,<span class="ot"> _box    ::</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb58-5" data-line-number="5">  }</a></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Show</span> <span class="dt">DebugTextBox</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2">  show <span class="dt">DebugTextBox</span>{<span class="fu">..</span>} <span class="fu">=</span> unlines</a>
<a class="sourceLine" id="cb59-3" data-line-number="3">    [ <span class="st">&quot;== DebugTextBox ==&quot;</span></a>
<a class="sourceLine" id="cb59-4" data-line-number="4">    , <span class="st">&quot;Line Labels:&quot;</span></a>
<a class="sourceLine" id="cb59-5" data-line-number="5">    , show _labels</a>
<a class="sourceLine" id="cb59-6" data-line-number="6">    , <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb59-7" data-line-number="7">    , <span class="st">&quot;Rendered Lines:&quot;</span></a>
<a class="sourceLine" id="cb59-8" data-line-number="8">    , show _lines</a>
<a class="sourceLine" id="cb59-9" data-line-number="9">    , <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb59-10" data-line-number="10">    , <span class="st">&quot;TextBox State:&quot;</span></a>
<a class="sourceLine" id="cb59-11" data-line-number="11">    , show _box</a>
<a class="sourceLine" id="cb59-12" data-line-number="12">    , <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb59-13" data-line-number="13">    , <span class="st">&quot;Buffer State: UNIMPLEMENTED&quot;</span></a>
<a class="sourceLine" id="cb59-14" data-line-number="14">    ]</a></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb60-1" data-line-number="1">debugTextBox</a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TextBox</span></a>
<a class="sourceLine" id="cb60-3" data-line-number="3">  <span class="ot">-&gt;</span> <span class="dt">DebugTextBox</span></a>
<a class="sourceLine" id="cb60-4" data-line-number="4">debugTextBox box <span class="fu">=</span></a>
<a class="sourceLine" id="cb60-5" data-line-number="5">  <span class="kw">let</span> (lb,_, ln, _, _) <span class="fu">=</span> renderTextBox box</a>
<a class="sourceLine" id="cb60-6" data-line-number="6">  <span class="kw">in</span> <span class="dt">DebugTextBox</span> lb ln box</a></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb61-1" data-line-number="1">debugTextBoxActions</a>
<a class="sourceLine" id="cb61-2" data-line-number="2"><span class="ot">  ::</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> [<span class="dt">TextBoxAction</span>]</a>
<a class="sourceLine" id="cb61-3" data-line-number="3">  <span class="ot">-&gt;</span> (<span class="dt">DebugTextBox</span>, [(<span class="dt">TextBoxAction</span>, <span class="dt">Maybe</span> <span class="dt">DebugTextBox</span>)])</a>
<a class="sourceLine" id="cb61-4" data-line-number="4">debugTextBoxActions dim tab acts <span class="fu">=</span></a>
<a class="sourceLine" id="cb61-5" data-line-number="5">  <span class="kw">let</span></a>
<a class="sourceLine" id="cb61-6" data-line-number="6">    box <span class="fu">=</span> mkTextBox dim tab []</a>
<a class="sourceLine" id="cb61-7" data-line-number="7">    f x as <span class="fu">=</span> <span class="kw">case</span> as <span class="kw">of</span></a>
<a class="sourceLine" id="cb61-8" data-line-number="8">      [] <span class="ot">-&gt;</span> []</a>
<a class="sourceLine" id="cb61-9" data-line-number="9">      b<span class="fu">:</span>bs <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb61-10" data-line-number="10">        <span class="kw">let</span></a>
<a class="sourceLine" id="cb61-11" data-line-number="11">          y <span class="fu">=</span> alterTextBoxPrimitive b x</a>
<a class="sourceLine" id="cb61-12" data-line-number="12">          z <span class="fu">=</span> <span class="kw">if</span> x <span class="fu">==</span> y</a>
<a class="sourceLine" id="cb61-13" data-line-number="13">            <span class="kw">then</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb61-14" data-line-number="14">            <span class="kw">else</span> <span class="dt">Just</span> <span class="fu">$</span> debugTextBox y</a>
<a class="sourceLine" id="cb61-15" data-line-number="15">        <span class="kw">in</span> (b, z) <span class="fu">:</span> f y bs</a>
<a class="sourceLine" id="cb61-16" data-line-number="16">  <span class="kw">in</span> (debugTextBox box, f box acts)</a></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb62-1" data-line-number="1">printDebugTextBoxActions</a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="ot">  ::</span> (<span class="dt">DebugTextBox</span>, [(<span class="dt">TextBoxAction</span>, <span class="dt">Maybe</span> <span class="dt">DebugTextBox</span>)]) <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3">printDebugTextBoxActions (init, steps) <span class="fu">=</span> unlines</a>
<a class="sourceLine" id="cb62-4" data-line-number="4">  [ <span class="st">&quot;=== START ===&quot;</span></a>
<a class="sourceLine" id="cb62-5" data-line-number="5">  , show init</a>
<a class="sourceLine" id="cb62-6" data-line-number="6">  , <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb62-7" data-line-number="7">  , p <span class="fu">$</span> zip steps [<span class="dv">1</span><span class="fu">..</span>]</a>
<a class="sourceLine" id="cb62-8" data-line-number="8">  ]</a>
<a class="sourceLine" id="cb62-9" data-line-number="9">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb62-10" data-line-number="10">    p xs <span class="fu">=</span> <span class="kw">case</span> xs <span class="kw">of</span></a>
<a class="sourceLine" id="cb62-11" data-line-number="11">      [] <span class="ot">-&gt;</span> <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb62-12" data-line-number="12">      ((a,b),k)<span class="fu">:</span>ys <span class="ot">-&gt;</span> unlines</a>
<a class="sourceLine" id="cb62-13" data-line-number="13">        [ <span class="st">&quot;=== THEN (&quot;</span> <span class="fu">++</span> show k <span class="fu">++</span> <span class="st">&quot;) ===&quot;</span></a>
<a class="sourceLine" id="cb62-14" data-line-number="14">        , show a</a>
<a class="sourceLine" id="cb62-15" data-line-number="15">        , <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb62-16" data-line-number="16">        , <span class="kw">case</span> b <span class="kw">of</span></a>
<a class="sourceLine" id="cb62-17" data-line-number="17">            <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="st">&quot;&gt;&gt;&gt; No Change &lt;&lt;&lt;&quot;</span></a>
<a class="sourceLine" id="cb62-18" data-line-number="18">            <span class="dt">Just</span> z <span class="ot">-&gt;</span> show z</a>
<a class="sourceLine" id="cb62-19" data-line-number="19">        , <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb62-20" data-line-number="20">        , p ys</a>
<a class="sourceLine" id="cb62-21" data-line-number="21">        ]</a></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb63-1" data-line-number="1">writeDebugTextBoxActions</a>
<a class="sourceLine" id="cb63-2" data-line-number="2"><span class="ot">  ::</span> FilePath</a>
<a class="sourceLine" id="cb63-3" data-line-number="3">  <span class="ot">-&gt;</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> [<span class="dt">TextBoxAction</span>]</a>
<a class="sourceLine" id="cb63-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb63-5" data-line-number="5">writeDebugTextBoxActions path dim tab acts <span class="fu">=</span></a>
<a class="sourceLine" id="cb63-6" data-line-number="6">  writeFile path</a>
<a class="sourceLine" id="cb63-7" data-line-number="7">    <span class="fu">$</span> printDebugTextBoxActions</a>
<a class="sourceLine" id="cb63-8" data-line-number="8">    <span class="fu">$</span> debugTextBoxActions dim tab acts</a></code></pre></div>
</section>
</article>
</body>
</html>
