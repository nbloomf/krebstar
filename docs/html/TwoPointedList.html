<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Two-Pointed Lists</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../style.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<article>
<header>
<h1 class="title">Two-Pointed Lists</h1>
</header>
<div class="contents">
<ul>
<li><a href="#higher-derivatives">Higher Derivatives</a>: A type of two-hole contexts</li>
<li><a href="#constructors">Constructors</a>: Building examples</li>
<li><a href="#class-instances">Class Instances</a>: Code for free</li>
<li><a href="#queries">Queries</a>: Extracting value from a two-pointed list</li>
<li><a href="#navigation">Navigation</a>: Moving the point and mark</li>
<li><a href="#mutation">Mutation</a>: Altering state</li>
<li><a href="#region-operations">Region Operations</a>: Read, delete, and alter the region</li>
<li><a href="#measurement">Measurement</a>: Working with value annotations</li>
<li><a href="#splitting">Splitting</a>: Breaking and searching</li>
<li><a href="#testing-and-debugging">Testing and Debugging</a>: For when things go wrong</li>
</ul>
</div>
<div class="frontmatter">
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="ot">{-# LANGUAGE FlexibleInstances #-}</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="ot">{-# LANGUAGE InstanceSigs #-}</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">module</span> <span class="dt">Kreb.Struct.TwoPointedList</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">import</span> <span class="dt">Data.Foldable</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">import</span> <span class="dt">Data.List</span> (unwords)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">import</span>           <span class="dt">Kreb.Check</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">import</span>           <span class="dt">Kreb.Struct.Valued</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Kreb.Struct.FingerTree</span> <span class="kw">as</span> <span class="dt">FT</span></a></code></pre></div>
</div>
<section id="higher-derivatives" class="level2">
<h2>Higher Derivatives</h2>
<p>In <code>OnePointedList</code>, we saw how a certain concept of <em>derivative</em> lets us systematically construct a type of one-hole contexts over some other type. Specifically, we defined a data type that behaved sort of like a list, but with a movable read head we could use to access items in the list. It’s not terribly surprising that this process can be repeated, and higher derivatives give us contexts with more than one hole – more than one read head where access is cheap. This is useful for us because text buffers naturally have <em>two</em> important positions: the location of the cursor, called the <em>point</em>, and a second location, called the <em>mark</em>, which is used for (say) highlighting text or delimiting the effects of an operation.</p>
<p>In this module we’ll develop a type of two-pointed lists. This code is analogous to that for one-pointed lists, and many of the functions have the same names. It’s expected that we’ll import this module qualified when we use it later.</p>
<p>Calling this type the second derivative of the list functor is a little too simplistic. In a text buffer, we always want to have a point, but we may not care to have a mark. However the point and the mark (if present) should be independently mobile, so it may happen that the point and the mark are at the same position.</p>
<p>With <code>OnePointedList</code>, we used a triple to model a distinguished list item with its left and right contexts. For <code>TwoPointedList</code> things are a little more complicated; if both the point and the mark are present, we need to keep track of which is “on the left” in the list (or if they are distinct at all). If the mark is not present then our type degenerates to <code>OnePointedList</code>. We can model this with the following definition.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">data</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="fu">=</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="fu">|</span> <span class="dt">PointOnly</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">      (<span class="dt">FT.FingerTree</span> m a, a, <span class="dt">FT.FingerTree</span> m a)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="fu">|</span> <span class="dt">Coincide</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">      (<span class="dt">FT.FingerTree</span> m a, a, <span class="dt">FT.FingerTree</span> m a)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="fu">|</span> <span class="dt">PointMark</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">      (<span class="dt">FT.FingerTree</span> m a, a, <span class="dt">FT.FingerTree</span> m a, a, <span class="dt">FT.FingerTree</span> m a)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="fu">|</span> <span class="dt">MarkPoint</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">      (<span class="dt">FT.FingerTree</span> m a, a, <span class="dt">FT.FingerTree</span> m a, a, <span class="dt">FT.FingerTree</span> m a)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a></code></pre></div>
<p>This is a little hairy! But consumers of this code should not have to worry about the details of how this type is implemented. The goal is to allow client code to treat a <code>TwoPointedList</code> like, well, a list of items with one and maybe a second read head.</p>
</section>
<section id="constructors" class="level2">
<h2>Constructors</h2>
<p>Next we define some constructors for this type. We have the usual <code>empty</code> and <code>singleton</code> constructors for list-like types:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1">empty</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="ot">  ::</span><span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">empty <span class="fu">=</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">singleton</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">singleton a <span class="fu">=</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">  <span class="dt">PointOnly</span> (mempty, a, mempty)</a></code></pre></div>
<p>We can also convert a list into a two-pointed list. This is analogous to <code>makeFromList</code> on one-pointed lists; the head of the input list becomes the point, and the tail the right context. We’ll also implement a version of this constructor for finger trees.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1">makeFromList</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">makeFromList xs <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="kw">case</span> xs <span class="kw">of</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    [] <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    u<span class="fu">:</span>us <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (mempty, u, FT.fromList us)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">fromFingerTree</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">  <span class="ot">=&gt;</span> <span class="dt">FT.FingerTree</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">fromFingerTree as <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">  <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">    <span class="dt">Just</span> (u, us) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (mempty, u, us)</a></code></pre></div>
<p>For testing purposes it will be handy to have constructors which allow precise placement of the point and the mark. In principle these should not be used in real code, although there’s no harm in it.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1">makePointOnly</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [a]</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">makePointOnly as x bs <span class="fu">=</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  <span class="dt">PointOnly</span> ( FT.fromList as, x, FT.fromList bs )</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">makeCoincide</a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [a]</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">  <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">makeCoincide as x bs <span class="fu">=</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13">  <span class="dt">Coincide</span> ( FT.fromList as, x, FT.fromList bs )</a>
<a class="sourceLine" id="cb5-14" data-line-number="14"></a>
<a class="sourceLine" id="cb5-15" data-line-number="15">makePointMark</a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">  <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [a]</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">  <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">makePointMark as x bs y cs <span class="fu">=</span> <span class="dt">PointMark</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20">  ( FT.fromList as, x, FT.fromList bs, y, FT.fromList cs )</a>
<a class="sourceLine" id="cb5-21" data-line-number="21"></a>
<a class="sourceLine" id="cb5-22" data-line-number="22">makeMarkPoint</a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb5-24" data-line-number="24">  <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [a]</a>
<a class="sourceLine" id="cb5-25" data-line-number="25">  <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb5-26" data-line-number="26">makeMarkPoint as x bs y cs <span class="fu">=</span> <span class="dt">MarkPoint</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27">  ( FT.fromList as, x, FT.fromList bs, y, FT.fromList cs )</a></code></pre></div>
</section>
<section id="class-instances" class="level2">
<h2>Class Instances</h2>
<p>Since two-pointed lists are essentially lists, it’s not surprising they have a <code>Foldable</code> instance.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">instance</span> <span class="dt">Foldable</span> (<span class="dt">TwoPointedList</span> m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  toList</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="ot">    ::</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> [a]</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  toList w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    <span class="dt">Vacant</span> <span class="ot">-&gt;</span> []</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">    <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> concat</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">      [ toList as, [x], toList bs ]</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">    <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> concat</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">      [ toList as, [x], toList bs ]</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">    <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> concat</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">      [ toList as, [x], toList bs, [y], toList cs ]</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">    <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> concat</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">      [ toList as, [x], toList bs, [y], toList cs ]</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"></a>
<a class="sourceLine" id="cb6-15" data-line-number="15">  foldr</a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="ot">    ::</span> (a <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> b</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">    <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> b</a>
<a class="sourceLine" id="cb6-18" data-line-number="18">  foldr f e w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19">    <span class="dt">Vacant</span> <span class="ot">-&gt;</span> e</a>
<a class="sourceLine" id="cb6-20" data-line-number="20">    <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21">      foldr f (f x (foldr f e bs)) as</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">    <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-23" data-line-number="23">      foldr f (f x (foldr f e bs)) as</a>
<a class="sourceLine" id="cb6-24" data-line-number="24">    <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25">      foldr f (f x (foldr f (f y (foldr f e cs)) bs)) as</a>
<a class="sourceLine" id="cb6-26" data-line-number="26">    <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27">      foldr f (f x (foldr f (f y (foldr f e cs)) bs)) as</a>
<a class="sourceLine" id="cb6-28" data-line-number="28"></a>
<a class="sourceLine" id="cb6-29" data-line-number="29">  foldl</a>
<a class="sourceLine" id="cb6-30" data-line-number="30"><span class="ot">    ::</span> (b <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> b) <span class="ot">-&gt;</span> b</a>
<a class="sourceLine" id="cb6-31" data-line-number="31">    <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> b</a>
<a class="sourceLine" id="cb6-32" data-line-number="32">  foldl f e w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33">    <span class="dt">Vacant</span> <span class="ot">-&gt;</span> e</a>
<a class="sourceLine" id="cb6-34" data-line-number="34">    <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-35" data-line-number="35">      foldl f (f (foldl f e as) x) bs</a>
<a class="sourceLine" id="cb6-36" data-line-number="36">    <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-37" data-line-number="37">      foldl f (f (foldl f e as) x) bs</a>
<a class="sourceLine" id="cb6-38" data-line-number="38">    <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-39" data-line-number="39">      foldl f (f (foldl f (f (foldl f e as) x) bs) y) cs</a>
<a class="sourceLine" id="cb6-40" data-line-number="40">    <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-41" data-line-number="41">      foldl f (f (foldl f (f (foldl f e as) x) bs) y) cs</a></code></pre></div>
<p>We’d also like <code>TwoPointedList</code> to be a functor. But as was the case with <code>OnePointedList</code>, the extra <code>Valued</code> constraint means we can’t express this as a proper type class. Instead we define a plain function which can be used to define proper <code>Functor</code> instances on types which specialize the value parameter.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1">fmapList</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="ot">  ::</span> forall m1 m2 a1 a2</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">   <span class="fu">.</span> ( <span class="dt">Valued</span> m1 a1, <span class="dt">Valued</span> m2 a2 )</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="ot">=&gt;</span> (a1 <span class="ot">-&gt;</span> a2) <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m1 a1 <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m2 a2</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">fmapList f w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">    <span class="dt">PointOnly</span> (FT.fmapFT f as, f x, FT.fmapFT f bs)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">    <span class="dt">Coincide</span> (FT.fmapFT f as, f x, FT.fmapFT f bs)</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">    <span class="dt">PointMark</span> (FT.fmapFT f as, f x, FT.fmapFT f bs, f y, FT.fmapFT f cs)</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">    <span class="dt">MarkPoint</span> (FT.fmapFT f as, f x, FT.fmapFT f bs, f y, FT.fmapFT f cs)</a></code></pre></div>
</section>
<section id="queries" class="level2">
<h2>Queries</h2>
<p>Next we define some helper functions for extracting information from a two-pointed list. First we can define some simple predicates based on the constructor.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1">isEmpty</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">isEmpty w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">hasMark</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="ot">  ::</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">hasMark w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">  <span class="dt">PointOnly</span> _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">  _ <span class="ot">-&gt;</span> <span class="dt">True</span></a></code></pre></div>
<p>It will also be useful to detect when a two-pointed list has exactly one item in it.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1">isSingleton</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">isSingleton w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="dt">PointOnly</span> (as, _, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    (FT.isEmpty as) <span class="fu">&amp;&amp;</span> (FT.isEmpty bs)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="dt">Coincide</span> (as, _, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    (FT.isEmpty as) <span class="fu">&amp;&amp;</span> (FT.isEmpty bs)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">  _ <span class="ot">-&gt;</span> <span class="dt">False</span></a></code></pre></div>
<p>We can also detect when the point is at the first or last position in the list.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1">isPointAtStart</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">isPointAtStart w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">  <span class="dt">PointOnly</span> (as, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9">      _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">  <span class="dt">Coincide</span> (as, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11">    <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13">      _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14">  <span class="dt">PointMark</span> (as, _, _, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15">    <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17">      _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18">  <span class="dt">MarkPoint</span> _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"></a>
<a class="sourceLine" id="cb10-20" data-line-number="20">isPointAtEnd</a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb10-22" data-line-number="22">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23">isPointAtEnd w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25">  <span class="dt">PointOnly</span> (_, _, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb10-27" data-line-number="27">    _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28">  <span class="dt">Coincide</span> (_, _, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb10-30" data-line-number="30">    _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31">  <span class="dt">PointMark</span> _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb10-32" data-line-number="32">  <span class="dt">MarkPoint</span> (_, _, _, _, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb10-34" data-line-number="34">    _ <span class="ot">-&gt;</span> <span class="dt">False</span></a></code></pre></div>
<p>We can do the same for the mark, although it’s less clear when this would be useful outside of tests.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" data-line-number="1">isMarkAtStart</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">isMarkAtStart w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  <span class="dt">PointOnly</span> _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  <span class="dt">Coincide</span> (as, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">    <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">      _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">  <span class="dt">PointMark</span> _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  <span class="dt">MarkPoint</span> (as, _, _, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13">    <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">      _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"></a>
<a class="sourceLine" id="cb11-17" data-line-number="17">isMarkAtEnd</a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20">isMarkAtEnd w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22">  <span class="dt">PointOnly</span> _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23">  <span class="dt">Coincide</span> (_, _, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25">    _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26">  <span class="dt">PointMark</span> (_, _, _, _, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28">    _ <span class="ot">-&gt;</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29">  <span class="dt">MarkPoint</span> _ <span class="ot">-&gt;</span> <span class="dt">False</span></a></code></pre></div>
<p>And we’ll need to read the item at the point and the mark.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1">readPoint</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">readPoint w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  <span class="dt">PointOnly</span> (_, x, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">  <span class="dt">Coincide</span> (_, x, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">  <span class="dt">PointMark</span> (_, x, _, _, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">  <span class="dt">MarkPoint</span> (_, _, _, x, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">readMark</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="ot">  ::</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">readMark w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14">  <span class="dt">PointOnly</span> _ <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15">  <span class="dt">Coincide</span> (_, x, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">  <span class="dt">PointMark</span> (_, _, _, x, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a>
<a class="sourceLine" id="cb12-17" data-line-number="17">  <span class="dt">MarkPoint</span> (_, x, _, _, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a></code></pre></div>
</section>
<section id="navigation" class="level2">
<h2>Navigation</h2>
<p>Some of the most important operations on two-pointed lists are those which move the point and the mark around. There are up to two read heads, and four special movement operations – move to start or end and move left or right – yielding eight navigation primitives.</p>
<p>When navigating a two-pointed list we need to be deliberate about what happens to the mark, if it is set. In particular it will be most useful to leave the mark alone, and if a particular situation requires the mark to be cleared, do that explicitly.</p>
<p>We can move the point directly to the start or end position:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" data-line-number="1">movePointToStart</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">movePointToStart w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (mempty, a, FT.snoc x as&#39; <span class="fu">&lt;&gt;</span> bs)</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (mempty, a, as&#39;, x, bs)</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (mempty, x, bs, y, cs)</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (mempty, a, FT.snoc x as&#39; <span class="fu">&lt;&gt;</span> bs, y, cs)</a>
<a class="sourceLine" id="cb13-15" data-line-number="15">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, x, bs <span class="fu">&lt;&gt;</span> FT.cons y cs)</a>
<a class="sourceLine" id="cb13-17" data-line-number="17">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (mempty, a, as&#39;, x, FT.snoc y bs <span class="fu">&lt;&gt;</span> cs)</a>
<a class="sourceLine" id="cb13-18" data-line-number="18"></a>
<a class="sourceLine" id="cb13-19" data-line-number="19">movePointToEnd</a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb13-21" data-line-number="21">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb13-22" data-line-number="22">movePointToEnd w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb13-26" data-line-number="26">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (FT.snoc x as <span class="fu">&lt;&gt;</span> bs&#39;, b, mempty)</a>
<a class="sourceLine" id="cb13-27" data-line-number="27">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb13-29" data-line-number="29">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs&#39;, b, mempty)</a>
<a class="sourceLine" id="cb13-30" data-line-number="30">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-31" data-line-number="31">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (FT.snoc x as <span class="fu">&lt;&gt;</span> bs, y, mempty)</a>
<a class="sourceLine" id="cb13-32" data-line-number="32">    <span class="dt">Just</span> (c, cs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (FT.snoc x as <span class="fu">&lt;&gt;</span> bs, y, cs&#39;, c, mempty)</a>
<a class="sourceLine" id="cb13-33" data-line-number="33">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs, y, mempty)</a>
<a class="sourceLine" id="cb13-35" data-line-number="35">    <span class="dt">Just</span> (c, cs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs <span class="fu">&lt;&gt;</span> FT.cons y cs&#39;, c, mempty)</a></code></pre></div>
<p>And we can move the point left and right by one item.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" data-line-number="1">movePointLeft</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">movePointLeft w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as&#39;, a, FT.cons x bs)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as&#39;, a, mempty, x, bs)</a>
<a class="sourceLine" id="cb14-12" data-line-number="12">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (mempty, x, bs, y, cs)</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as&#39;, a, FT.cons x bs, y, cs)</a>
<a class="sourceLine" id="cb14-15" data-line-number="15">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, FT.cons y cs)</a>
<a class="sourceLine" id="cb14-17" data-line-number="17">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs&#39;, b, FT.cons y cs)</a>
<a class="sourceLine" id="cb14-18" data-line-number="18"></a>
<a class="sourceLine" id="cb14-19" data-line-number="19">movePointRight</a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb14-21" data-line-number="21">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb14-22" data-line-number="22">movePointRight w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb14-26" data-line-number="26">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (FT.snoc x as, b, bs&#39;)</a>
<a class="sourceLine" id="cb14-27" data-line-number="27">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-28" data-line-number="28">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb14-29" data-line-number="29">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, mempty, b, bs&#39;)</a>
<a class="sourceLine" id="cb14-30" data-line-number="30">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-31" data-line-number="31">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (FT.snoc x as, y, cs)</a>
<a class="sourceLine" id="cb14-32" data-line-number="32">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (FT.snoc x as, b, bs&#39;, y, cs)</a>
<a class="sourceLine" id="cb14-33" data-line-number="33">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-34" data-line-number="34">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs, y, mempty)</a>
<a class="sourceLine" id="cb14-35" data-line-number="35">    <span class="dt">Just</span> (c, cs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, FT.snoc y bs, c, cs&#39;)</a></code></pre></div>
<p>And a few examples to test our understanding.</p>
<div class="doctest">
<div class="sourceCode" id="cb15"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">--   x, xL, xR :: TwoPointedList Count Char</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">--   x = makePointMark [&#39;a&#39;,&#39;b&#39;] &#39;c&#39; [&#39;d&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co">--   xL = makePointMark [&#39;a&#39;] &#39;b&#39; [&#39;c&#39;,&#39;d&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">--   xR = makePointMark [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;] &#39;d&#39; [] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">-- in (xL == movePointLeft x, xR == movePointRight x)</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">-- (True,True)</span></a></code></pre></div>
</div>
<p>We can perform the same actions on the mark. In this case, if the mark is not set the navigation primitives act like the identity.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" data-line-number="1">moveMarkToStart</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">moveMarkToStart w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as, x, bs)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (mempty, a, as&#39;, x, bs)</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, x, bs <span class="fu">&lt;&gt;</span> FT.cons y cs)</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (mempty, a, as&#39;, x, FT.snoc y bs <span class="fu">&lt;&gt;</span> cs)</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (mempty, x, bs, y, cs)</a>
<a class="sourceLine" id="cb16-15" data-line-number="15">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (mempty, a, FT.snoc x as&#39; <span class="fu">&lt;&gt;</span> bs, y, cs)</a>
<a class="sourceLine" id="cb16-16" data-line-number="16"></a>
<a class="sourceLine" id="cb16-17" data-line-number="17">moveMarkToEnd</a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb16-19" data-line-number="19">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb16-20" data-line-number="20">moveMarkToEnd w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as, x, bs)</a>
<a class="sourceLine" id="cb16-23" data-line-number="23">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb16-25" data-line-number="25">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, bs&#39;, b, mempty)</a>
<a class="sourceLine" id="cb16-26" data-line-number="26">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, bs, y, mempty)</a>
<a class="sourceLine" id="cb16-28" data-line-number="28">    <span class="dt">Just</span> (c, cs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, bs <span class="fu">&lt;&gt;</span> FT.cons y cs&#39;, c, mempty)</a>
<a class="sourceLine" id="cb16-29" data-line-number="29">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-30" data-line-number="30">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (FT.snoc x as <span class="fu">&lt;&gt;</span> bs, y, mempty)</a>
<a class="sourceLine" id="cb16-31" data-line-number="31">    <span class="dt">Just</span> (c, cs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (FT.snoc x as <span class="fu">&lt;&gt;</span> bs, y, cs&#39;, c, mempty)</a>
<a class="sourceLine" id="cb16-32" data-line-number="32"></a>
<a class="sourceLine" id="cb16-33" data-line-number="33">moveMarkLeft</a>
<a class="sourceLine" id="cb16-34" data-line-number="34"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb16-35" data-line-number="35">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb16-36" data-line-number="36">moveMarkLeft w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-37" data-line-number="37">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb16-38" data-line-number="38">  <span class="dt">PointOnly</span> z <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> z</a>
<a class="sourceLine" id="cb16-39" data-line-number="39">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-40" data-line-number="40">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb16-41" data-line-number="41">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as&#39;, a, mempty, x, bs)</a>
<a class="sourceLine" id="cb16-42" data-line-number="42">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-43" data-line-number="43">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, FT.cons y cs)</a>
<a class="sourceLine" id="cb16-44" data-line-number="44">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, bs&#39;, b, FT.cons y cs)</a>
<a class="sourceLine" id="cb16-45" data-line-number="45">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-46" data-line-number="46">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (mempty, x, bs, y, cs)</a>
<a class="sourceLine" id="cb16-47" data-line-number="47">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as&#39;, a, FT.cons x bs, y, cs)</a>
<a class="sourceLine" id="cb16-48" data-line-number="48"></a>
<a class="sourceLine" id="cb16-49" data-line-number="49">moveMarkRight</a>
<a class="sourceLine" id="cb16-50" data-line-number="50"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb16-51" data-line-number="51">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb16-52" data-line-number="52">moveMarkRight w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-53" data-line-number="53">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb16-54" data-line-number="54">  <span class="dt">PointOnly</span> z <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> z</a>
<a class="sourceLine" id="cb16-55" data-line-number="55">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-56" data-line-number="56">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb16-57" data-line-number="57">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, mempty, b, bs&#39;)</a>
<a class="sourceLine" id="cb16-58" data-line-number="58">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-59" data-line-number="59">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, bs, y, mempty)</a>
<a class="sourceLine" id="cb16-60" data-line-number="60">    <span class="dt">Just</span> (c, cs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, FT.snoc y bs, c, cs&#39;)</a>
<a class="sourceLine" id="cb16-61" data-line-number="61">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-62" data-line-number="62">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (FT.snoc x as, y, cs)</a>
<a class="sourceLine" id="cb16-63" data-line-number="63">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (FT.snoc x as, b, bs&#39;, y, cs)</a></code></pre></div>
</section>
<section id="mutation" class="level2">
<h2>Mutation</h2>
<p>Next we define our two main primitives for bringing the mark in and out of existence. The first introduces a mark if one doesn’t already exist, and if it does, leaves it alone.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" data-line-number="1">leaveMark</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">leaveMark w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, bs)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">  _ <span class="ot">-&gt;</span> w</a></code></pre></div>
<p>The second primitive clears the mark by resorbing it into the rest of the list.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" data-line-number="1">clearMark</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">clearMark w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">    <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8">    <span class="dt">PointOnly</span> (as, x, bs)</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10">    <span class="dt">PointOnly</span> (as, x, bs)</a>
<a class="sourceLine" id="cb18-11" data-line-number="11">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12">    <span class="dt">PointOnly</span> (as, x, bs <span class="fu">&lt;&gt;</span> (FT.cons y cs))</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14">    <span class="dt">PointOnly</span> (as <span class="fu">&lt;&gt;</span> (FT.cons x bs), y, cs)</a></code></pre></div>
<p>And of course we have efficient operations for insertion and deletion. First at the start and end – these are analogous to <code>cons/snoc</code> and <code>uncons/unsnoc</code> on ordinary lists, but we give them different names.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" data-line-number="1">insertAtStart</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">insertAtStart u w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">    <span class="dt">PointOnly</span> (mempty, u, mempty)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8">    <span class="dt">PointOnly</span> (FT.cons u as, x, bs)</a>
<a class="sourceLine" id="cb19-9" data-line-number="9">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10">    <span class="dt">Coincide</span> (FT.cons u as, x, bs)</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12">    <span class="dt">PointMark</span> (FT.cons u as, x, bs, y, cs)</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14">    <span class="dt">MarkPoint</span> (FT.cons u as, x, bs, y, cs)</a>
<a class="sourceLine" id="cb19-15" data-line-number="15"></a>
<a class="sourceLine" id="cb19-16" data-line-number="16">viewAtStart</a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb19-18" data-line-number="18">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (a, <span class="dt">TwoPointedList</span> m a)</a>
<a class="sourceLine" id="cb19-19" data-line-number="19">viewAtStart w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-20" data-line-number="20">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb19-21" data-line-number="21">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-22" data-line-number="22">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-23" data-line-number="23">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> (x, empty)</a>
<a class="sourceLine" id="cb19-24" data-line-number="24">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> (x, <span class="dt">PointOnly</span> (mempty, b, bs&#39;))</a>
<a class="sourceLine" id="cb19-25" data-line-number="25">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> (a, <span class="dt">PointOnly</span> (as&#39;, x, bs))</a>
<a class="sourceLine" id="cb19-26" data-line-number="26">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-27" data-line-number="27">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-28" data-line-number="28">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> (x, empty)</a>
<a class="sourceLine" id="cb19-29" data-line-number="29">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> (x, <span class="dt">Coincide</span> (mempty, b, bs))</a>
<a class="sourceLine" id="cb19-30" data-line-number="30">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> (a, <span class="dt">Coincide</span> (as&#39;, x, bs))</a>
<a class="sourceLine" id="cb19-31" data-line-number="31">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-32" data-line-number="32">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-33" data-line-number="33">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> (x, <span class="dt">Coincide</span> (mempty, y, cs))</a>
<a class="sourceLine" id="cb19-34" data-line-number="34">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> (x, <span class="dt">PointMark</span> (mempty, b, bs&#39;, y, cs))</a>
<a class="sourceLine" id="cb19-35" data-line-number="35">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> (a, <span class="dt">PointMark</span> (as&#39;, x, bs, y, cs))</a>
<a class="sourceLine" id="cb19-36" data-line-number="36">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-37" data-line-number="37">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-38" data-line-number="38">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> (x, <span class="dt">Coincide</span> (mempty, y, cs))</a>
<a class="sourceLine" id="cb19-39" data-line-number="39">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> (x, <span class="dt">MarkPoint</span> (mempty, b, bs&#39;, y, cs))</a>
<a class="sourceLine" id="cb19-40" data-line-number="40">    <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> (a, <span class="dt">MarkPoint</span> (as&#39;, x, bs, y, cs))</a>
<a class="sourceLine" id="cb19-41" data-line-number="41"></a>
<a class="sourceLine" id="cb19-42" data-line-number="42">deleteAtStart</a>
<a class="sourceLine" id="cb19-43" data-line-number="43"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb19-44" data-line-number="44">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb19-45" data-line-number="45">deleteAtStart w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-46" data-line-number="46">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb19-47" data-line-number="47">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-48" data-line-number="48">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-49" data-line-number="49">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb19-50" data-line-number="50">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (mempty, b, bs&#39;)</a>
<a class="sourceLine" id="cb19-51" data-line-number="51">    <span class="dt">Just</span> (_, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as&#39;, x, bs)</a>
<a class="sourceLine" id="cb19-52" data-line-number="52">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-53" data-line-number="53">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-54" data-line-number="54">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb19-55" data-line-number="55">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, b, bs&#39;)</a>
<a class="sourceLine" id="cb19-56" data-line-number="56">    <span class="dt">Just</span> (_, as&#39;) <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as&#39;, x, bs)</a>
<a class="sourceLine" id="cb19-57" data-line-number="57">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-58" data-line-number="58">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-59" data-line-number="59">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, y, cs)</a>
<a class="sourceLine" id="cb19-60" data-line-number="60">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (mempty, b, bs&#39;, y, cs)</a>
<a class="sourceLine" id="cb19-61" data-line-number="61">    <span class="dt">Just</span> (_, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as&#39;, x, bs, y, cs)</a>
<a class="sourceLine" id="cb19-62" data-line-number="62">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-63" data-line-number="63">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-64" data-line-number="64">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, y, cs)</a>
<a class="sourceLine" id="cb19-65" data-line-number="65">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (mempty, b, bs&#39;, y, cs)</a>
<a class="sourceLine" id="cb19-66" data-line-number="66">    <span class="dt">Just</span> (_, as&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as&#39;, x, bs, y, cs)</a>
<a class="sourceLine" id="cb19-67" data-line-number="67"></a>
<a class="sourceLine" id="cb19-68" data-line-number="68">insertAtEnd</a>
<a class="sourceLine" id="cb19-69" data-line-number="69"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb19-70" data-line-number="70">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb19-71" data-line-number="71">insertAtEnd u w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-72" data-line-number="72">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-73" data-line-number="73">    <span class="dt">PointOnly</span> (mempty, u, mempty)</a>
<a class="sourceLine" id="cb19-74" data-line-number="74">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-75" data-line-number="75">    <span class="dt">PointOnly</span> (as, x, FT.snoc u bs)</a>
<a class="sourceLine" id="cb19-76" data-line-number="76">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-77" data-line-number="77">    <span class="dt">Coincide</span> (as, x, FT.snoc u bs)</a>
<a class="sourceLine" id="cb19-78" data-line-number="78">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-79" data-line-number="79">    <span class="dt">PointMark</span> (as, x, bs, y, FT.snoc u cs)</a>
<a class="sourceLine" id="cb19-80" data-line-number="80">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb19-81" data-line-number="81">    <span class="dt">MarkPoint</span> (as, x, bs, y, FT.snoc u cs)</a>
<a class="sourceLine" id="cb19-82" data-line-number="82"></a>
<a class="sourceLine" id="cb19-83" data-line-number="83">viewAtEnd</a>
<a class="sourceLine" id="cb19-84" data-line-number="84"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb19-85" data-line-number="85">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (a, <span class="dt">TwoPointedList</span> m a)</a>
<a class="sourceLine" id="cb19-86" data-line-number="86">viewAtEnd w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-87" data-line-number="87">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb19-88" data-line-number="88">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-89" data-line-number="89">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-90" data-line-number="90">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> (x, empty)</a>
<a class="sourceLine" id="cb19-91" data-line-number="91">      <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> (x, <span class="dt">PointOnly</span> (as&#39;, a, mempty))</a>
<a class="sourceLine" id="cb19-92" data-line-number="92">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> (b, <span class="dt">PointOnly</span> (as, x, bs&#39;))</a>
<a class="sourceLine" id="cb19-93" data-line-number="93">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-94" data-line-number="94">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-95" data-line-number="95">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> (x, empty)</a>
<a class="sourceLine" id="cb19-96" data-line-number="96">      <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> (x, <span class="dt">Coincide</span> (as&#39;, a, mempty))</a>
<a class="sourceLine" id="cb19-97" data-line-number="97">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> (b, <span class="dt">Coincide</span> (as, x, bs&#39;))</a>
<a class="sourceLine" id="cb19-98" data-line-number="98">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-99" data-line-number="99">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-100" data-line-number="100">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> (y, <span class="dt">Coincide</span> (as, x, mempty))</a>
<a class="sourceLine" id="cb19-101" data-line-number="101">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> (y, <span class="dt">PointMark</span> (as, x, bs&#39;, b, mempty))</a>
<a class="sourceLine" id="cb19-102" data-line-number="102">    <span class="dt">Just</span> (c, cs&#39;) <span class="ot">-&gt;</span> (c, <span class="dt">PointMark</span> (as, x, bs, y, cs&#39;))</a>
<a class="sourceLine" id="cb19-103" data-line-number="103">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-104" data-line-number="104">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-105" data-line-number="105">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> (y, <span class="dt">Coincide</span> (as, x, mempty))</a>
<a class="sourceLine" id="cb19-106" data-line-number="106">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> (y, <span class="dt">MarkPoint</span> (as, x, bs&#39;, b, mempty))</a>
<a class="sourceLine" id="cb19-107" data-line-number="107">    <span class="dt">Just</span> (c, cs&#39;) <span class="ot">-&gt;</span> (c, <span class="dt">MarkPoint</span> (as, x, bs, y, cs&#39;))</a>
<a class="sourceLine" id="cb19-108" data-line-number="108"></a>
<a class="sourceLine" id="cb19-109" data-line-number="109">deleteAtEnd</a>
<a class="sourceLine" id="cb19-110" data-line-number="110"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb19-111" data-line-number="111">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb19-112" data-line-number="112">deleteAtEnd w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-113" data-line-number="113">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb19-114" data-line-number="114">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-115" data-line-number="115">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-116" data-line-number="116">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb19-117" data-line-number="117">      <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as&#39;, a, mempty)</a>
<a class="sourceLine" id="cb19-118" data-line-number="118">    <span class="dt">Just</span> (_, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as, x, bs&#39;)</a>
<a class="sourceLine" id="cb19-119" data-line-number="119">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-120" data-line-number="120">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-121" data-line-number="121">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb19-122" data-line-number="122">      <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as&#39;, a, mempty)</a>
<a class="sourceLine" id="cb19-123" data-line-number="123">    <span class="dt">Just</span> (_, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, bs&#39;)</a>
<a class="sourceLine" id="cb19-124" data-line-number="124">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-125" data-line-number="125">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-126" data-line-number="126">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb19-127" data-line-number="127">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, bs&#39;, b, mempty)</a>
<a class="sourceLine" id="cb19-128" data-line-number="128">    <span class="dt">Just</span> (_, cs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, bs, y, cs&#39;)</a>
<a class="sourceLine" id="cb19-129" data-line-number="129">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-130" data-line-number="130">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-131" data-line-number="131">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb19-132" data-line-number="132">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs&#39;, b, mempty)</a>
<a class="sourceLine" id="cb19-133" data-line-number="133">    <span class="dt">Just</span> (_, cs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs, y, cs&#39;)</a></code></pre></div>
<p>And next to the left and the right of the point.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" data-line-number="1">insertPointLeft</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">insertPointLeft u w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6">    <span class="dt">PointOnly</span> (mempty, u, mempty)</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8">    <span class="dt">PointOnly</span> (FT.snoc u as, x, bs)</a>
<a class="sourceLine" id="cb20-9" data-line-number="9">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10">    <span class="dt">Coincide</span> (FT.snoc u as, x, bs)</a>
<a class="sourceLine" id="cb20-11" data-line-number="11">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12">    <span class="dt">PointMark</span> (FT.snoc u as, x, bs, y, cs)</a>
<a class="sourceLine" id="cb20-13" data-line-number="13">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14">    <span class="dt">MarkPoint</span> (as, x, FT.snoc u bs, y, cs)</a>
<a class="sourceLine" id="cb20-15" data-line-number="15"></a>
<a class="sourceLine" id="cb20-16" data-line-number="16">deletePointLeft</a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb20-18" data-line-number="18">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb20-19" data-line-number="19">deletePointLeft w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-20" data-line-number="20">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-21" data-line-number="21">    <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb20-22" data-line-number="22">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-23" data-line-number="23">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb20-24" data-line-number="24">    <span class="dt">Just</span> (_, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as&#39;, x, bs)</a>
<a class="sourceLine" id="cb20-25" data-line-number="25">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-26" data-line-number="26">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb20-27" data-line-number="27">    <span class="dt">Just</span> (_, as&#39;) <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as&#39;, x, bs)</a>
<a class="sourceLine" id="cb20-28" data-line-number="28">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-29" data-line-number="29">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (mempty, x, bs, y, cs)</a>
<a class="sourceLine" id="cb20-30" data-line-number="30">    <span class="dt">Just</span> (_, as&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as&#39;, x, bs, y, cs)</a>
<a class="sourceLine" id="cb20-31" data-line-number="31">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-32" data-line-number="32">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, y, cs)</a>
<a class="sourceLine" id="cb20-33" data-line-number="33">    <span class="dt">Just</span> (_, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs&#39;, y, cs)</a>
<a class="sourceLine" id="cb20-34" data-line-number="34"></a>
<a class="sourceLine" id="cb20-35" data-line-number="35">insertPointRight</a>
<a class="sourceLine" id="cb20-36" data-line-number="36"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb20-37" data-line-number="37">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb20-38" data-line-number="38">insertPointRight u w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-39" data-line-number="39">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-40" data-line-number="40">    <span class="dt">PointOnly</span> (mempty, u, mempty)</a>
<a class="sourceLine" id="cb20-41" data-line-number="41">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-42" data-line-number="42">    <span class="dt">PointOnly</span> (as, x, FT.cons u bs)</a>
<a class="sourceLine" id="cb20-43" data-line-number="43">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-44" data-line-number="44">    <span class="dt">Coincide</span> (as, x, FT.cons u bs)</a>
<a class="sourceLine" id="cb20-45" data-line-number="45">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-46" data-line-number="46">    <span class="dt">PointMark</span> (as, x, FT.cons u bs, y, cs)</a>
<a class="sourceLine" id="cb20-47" data-line-number="47">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-48" data-line-number="48">    <span class="dt">MarkPoint</span> (as, x, bs, y, FT.cons u cs)</a>
<a class="sourceLine" id="cb20-49" data-line-number="49"></a>
<a class="sourceLine" id="cb20-50" data-line-number="50">deletePointRight</a>
<a class="sourceLine" id="cb20-51" data-line-number="51"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb20-52" data-line-number="52">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb20-53" data-line-number="53">deletePointRight w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-54" data-line-number="54">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-55" data-line-number="55">    <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb20-56" data-line-number="56">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-57" data-line-number="57">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb20-58" data-line-number="58">    <span class="dt">Just</span> (_, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as, x, bs&#39;)</a>
<a class="sourceLine" id="cb20-59" data-line-number="59">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-60" data-line-number="60">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb20-61" data-line-number="61">    <span class="dt">Just</span> (_, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, bs&#39;)</a>
<a class="sourceLine" id="cb20-62" data-line-number="62">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-63" data-line-number="63">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, x, cs)</a>
<a class="sourceLine" id="cb20-64" data-line-number="64">    <span class="dt">Just</span> (_, bs&#39;) <span class="ot">-&gt;</span> <span class="dt">PointMark</span> (as, x, bs&#39;, y, cs)</a>
<a class="sourceLine" id="cb20-65" data-line-number="65">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.uncons cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-66" data-line-number="66">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs, y, mempty)</a>
<a class="sourceLine" id="cb20-67" data-line-number="67">    <span class="dt">Just</span> (_, cs&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, x, bs, y, cs&#39;)</a></code></pre></div>
</section>
<section id="region-operations" class="level2">
<h2>Region Operations</h2>
<p>Our goal is to use two-pointed lists to represent buffers of text. With that in mind, it will also be useful to have operations for working with the <em>region</em> – the portion of the list between the point and the mark. The main operations are, in rough terms, <em>copy</em>, <em>cut</em>, and <em>alter</em>.</p>
<p>It’s important to be careful and consistent here about exactly what “between the point and the mark” means. In particular, are either the point or the mark themselves included? I can think of a few ways to resolve this:</p>
<ul>
<li>Include the point but not the mark;</li>
<li>Include the mark but not the point;</li>
<li>Include both the mark and the point;</li>
<li>Include neither the mark nor the point;</li>
<li>Include the right endpoint but not the left (whether it’s the point or the mark); or</li>
<li>Include the left endpoint but not the left (whether it’s the point or the mark).</li>
</ul>
<p>I can certainly imagine scenarios where any of these interpretations would make sense. However the last one in particular jumps out as more “natural” for the purpose of text editing. To see why, consider the way terminals work when the cursor symbol is set to a block character. In this setting, usually the insertion point acts as if it is at the <em>left edge</em> of the highlighted cursor block.</p>
<p>So our region editing operations will all be <em>left biased</em>, affecting the left endpoint of the region but not the right, regardless of which is the point and which the mark.</p>
<p>To start, here’s a left-biased region version of <code>fmap</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" data-line-number="1">alterRegionL</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="ot">  ::</span> forall m a</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">   <span class="fu">.</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">  <span class="ot">=&gt;</span> (a <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">alterRegionL f w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8">    <span class="dt">PointOnly</span> (as, f x, bs)</a>
<a class="sourceLine" id="cb21-9" data-line-number="9">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10">    <span class="dt">Coincide</span> (as, f x, bs)</a>
<a class="sourceLine" id="cb21-11" data-line-number="11">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12">    <span class="dt">PointMark</span> (as, f x, FT.fmapFT f bs, y, cs)</a>
<a class="sourceLine" id="cb21-13" data-line-number="13">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb21-14" data-line-number="14">    <span class="dt">MarkPoint</span> (as, f x, FT.fmapFT f bs, y, cs)</a></code></pre></div>
<p>An example of <code>alterRegionL</code> is useful here.</p>
<div class="doctest">
<div class="sourceCode" id="cb22"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co">--   x, y :: TwoPointedList Count Char</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co">--   x = makeMarkPoint [&#39;a&#39;] &#39;b&#39; [&#39;c&#39;,&#39;d&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co">--   y = makeMarkPoint [&#39;a&#39;] &#39;z&#39; [&#39;z&#39;,&#39;z&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co">-- in y == alterRegionL (const &#39;z&#39;) x</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="co">-- True</span></a></code></pre></div>
</div>
<p>The next simplest operation simply extracts the region.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" data-line-number="1">copyRegionL</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="ot">  ::</span> forall m a</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">   <span class="fu">.</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">  <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (<span class="dt">FT.FingerTree</span> m a)</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">copyRegionL w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8">  <span class="dt">PointOnly</span> _ <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9">  <span class="dt">Coincide</span> (_, x, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> (FT.singleton x)</a>
<a class="sourceLine" id="cb23-10" data-line-number="10">  <span class="dt">PointMark</span> (_, x, bs, _, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> (FT.cons x bs)</a>
<a class="sourceLine" id="cb23-11" data-line-number="11">  <span class="dt">MarkPoint</span> (_, x, bs, _, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> (FT.cons x bs)</a></code></pre></div>
<p>Our next region operation is <em>cut</em>. This removes the region, returning it along with the remainder of the list spliced together. Notably, after a cut operation the remaining list no longer has a mark set. The only tricky case is when the point and mark coincide with each other.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb24-1" data-line-number="1">cutRegionL</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="ot">  ::</span> forall m a</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">   <span class="fu">.</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">  <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (<span class="dt">FT.FingerTree</span> m a, <span class="dt">TwoPointedList</span> m a)</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">cutRegionL w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8">  <span class="dt">PointOnly</span> _ <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> FT.uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10">    <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11">      (FT.singleton x, <span class="dt">PointOnly</span> (as, b, bs&#39;))</a>
<a class="sourceLine" id="cb24-12" data-line-number="12">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb24-13" data-line-number="13">      <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb24-14" data-line-number="14">        (FT.singleton x, <span class="dt">PointOnly</span> (as&#39;, a, mempty))</a>
<a class="sourceLine" id="cb24-15" data-line-number="15">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> (FT.singleton x, <span class="dt">Vacant</span>)</a>
<a class="sourceLine" id="cb24-16" data-line-number="16">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb24-17" data-line-number="17">    <span class="dt">Just</span> (FT.cons x bs, <span class="dt">PointOnly</span> (as, y, cs))</a>
<a class="sourceLine" id="cb24-18" data-line-number="18">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb24-19" data-line-number="19">    <span class="dt">Just</span> (FT.cons x bs, <span class="dt">PointOnly</span> (as, y, cs))</a></code></pre></div>
<p>Finally, we have <em>insert</em>. We’d like insert and cut to be as close to inverses of each other as possible, although this is tricky; I think the best we can hope for is that cut is a left inverse of insert “up to a clearing of the mark”.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb25-1" data-line-number="1">insertRegionL</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="ot">  ::</span> forall m a</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">   <span class="fu">.</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">  <span class="ot">=&gt;</span> <span class="dt">FT.FingerTree</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">insertRegionL us w <span class="fu">=</span> <span class="kw">case</span> FT.uncons us <span class="kw">of</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">  <span class="dt">Nothing</span> <span class="ot">-&gt;</span> w</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">  <span class="dt">Just</span> (u, us&#39;) <span class="ot">-&gt;</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8">    <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc us&#39; <span class="kw">of</span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (mempty, u, mempty)</a>
<a class="sourceLine" id="cb25-10" data-line-number="10">      <span class="dt">Just</span> (v, us&#39;&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (mempty, u, us&#39;, v, mempty)</a>
<a class="sourceLine" id="cb25-11" data-line-number="11">    <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, u, us&#39;, x, bs)</a>
<a class="sourceLine" id="cb25-12" data-line-number="12">    <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> FT.unsnoc us&#39; <span class="kw">of</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Coincide</span> (as, u, bs)</a>
<a class="sourceLine" id="cb25-14" data-line-number="14">      <span class="dt">Just</span> (v, us&#39;&#39;) <span class="ot">-&gt;</span> <span class="dt">MarkPoint</span> (as, u, us&#39;&#39;, v, bs)</a>
<a class="sourceLine" id="cb25-15" data-line-number="15">    <span class="dt">PointMark</span> (as, _, _, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb25-16" data-line-number="16">      <span class="dt">MarkPoint</span> (as, u, us&#39;, y, cs)</a>
<a class="sourceLine" id="cb25-17" data-line-number="17">    <span class="dt">MarkPoint</span> (as, _, _, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb25-18" data-line-number="18">      <span class="dt">MarkPoint</span> (as, u, us&#39;, y, cs)</a></code></pre></div>
<p>Cut an insert are complicated enough that some examples would be helpful.</p>
<div class="doctest">
<div class="sourceCode" id="cb26"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="co">--   x :: TwoPointedList Count Char</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co">--   x = makePointMark [&#39;a&#39;,&#39;b&#39;] &#39;c&#39; [&#39;d&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="co">--   --</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="co">--   y :: FT.FingerTree Count Char</span></a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="co">--   y = FT.fromList [&#39;x&#39;,&#39;y&#39;,&#39;z&#39;]</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="co">--   --</span></a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="co">--   z :: TwoPointedList Count Char</span></a>
<a class="sourceLine" id="cb26-11" data-line-number="11"><span class="co">--   z = makeMarkPoint [&#39;a&#39;,&#39;b&#39;] &#39;x&#39; [&#39;y&#39;,&#39;z&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"><span class="co">-- in z == insertRegionL y x</span></a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb26-14" data-line-number="14"><span class="co">-- True</span></a>
<a class="sourceLine" id="cb26-15" data-line-number="15"><span class="co">--</span></a>
<a class="sourceLine" id="cb26-16" data-line-number="16"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb26-17" data-line-number="17"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb26-18" data-line-number="18"><span class="co">--   x :: TwoPointedList Count Char</span></a>
<a class="sourceLine" id="cb26-19" data-line-number="19"><span class="co">--   x = makePointMark [&#39;a&#39;,&#39;b&#39;] &#39;c&#39; [&#39;d&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb26-20" data-line-number="20"><span class="co">--   --</span></a>
<a class="sourceLine" id="cb26-21" data-line-number="21"><span class="co">--   y :: TwoPointedList Count Char</span></a>
<a class="sourceLine" id="cb26-22" data-line-number="22"><span class="co">--   y = makePointOnly [&#39;a&#39;,&#39;b&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb26-23" data-line-number="23"><span class="co">--   --</span></a>
<a class="sourceLine" id="cb26-24" data-line-number="24"><span class="co">--   z :: FT.FingerTree Count Char</span></a>
<a class="sourceLine" id="cb26-25" data-line-number="25"><span class="co">--   z = FT.fromList [&#39;c&#39;,&#39;d&#39;]</span></a>
<a class="sourceLine" id="cb26-26" data-line-number="26"><span class="co">-- in Just (z, y) == cutRegionL x</span></a>
<a class="sourceLine" id="cb26-27" data-line-number="27"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb26-28" data-line-number="28"><span class="co">-- True</span></a></code></pre></div>
</div>
</section>
<section id="measurement" class="level2">
<h2>Measurement</h2>
<p>As with one-pointed lists, it will be handy to have access to the accumulated value annotations at the point, mark, and end of a two-pointed list. First we define a <code>Valued</code> instance, which gives us the accumulated value at the end.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">  ( <span class="dt">Valued</span> m a</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">  ) <span class="ot">=&gt;</span> <span class="dt">Valued</span> m (<span class="dt">TwoPointedList</span> m a)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5">    value w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6">      <span class="dt">Vacant</span> <span class="ot">-&gt;</span> mempty</a>
<a class="sourceLine" id="cb27-7" data-line-number="7">      <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span> mconcat</a>
<a class="sourceLine" id="cb27-8" data-line-number="8">        [value as, value x, value bs]</a>
<a class="sourceLine" id="cb27-9" data-line-number="9">      <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span> mconcat</a>
<a class="sourceLine" id="cb27-10" data-line-number="10">        [value as, value x, value bs]</a>
<a class="sourceLine" id="cb27-11" data-line-number="11">      <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> mconcat</a>
<a class="sourceLine" id="cb27-12" data-line-number="12">        [value as, value x, value bs, value y, value cs]</a>
<a class="sourceLine" id="cb27-13" data-line-number="13">      <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> mconcat</a>
<a class="sourceLine" id="cb27-14" data-line-number="14">        [value as, value x, value bs, value y, value cs]</a></code></pre></div>
<p>We can also extract the accumulated value at the point and the mark. These return a <code>Maybe</code> to account for the case where the mark (or point!) is not set.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb28-1" data-line-number="1">valueBeforePoint</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> m</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">valueBeforePoint w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6">    <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7">  <span class="dt">PointOnly</span> (as, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8">    <span class="dt">Just</span> (value as)</a>
<a class="sourceLine" id="cb28-9" data-line-number="9">  <span class="dt">Coincide</span> (as, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10">    <span class="dt">Just</span> (value as)</a>
<a class="sourceLine" id="cb28-11" data-line-number="11">  <span class="dt">PointMark</span> (as, _, _, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12">    <span class="dt">Just</span> (value as)</a>
<a class="sourceLine" id="cb28-13" data-line-number="13">  <span class="dt">MarkPoint</span> (as, x, bs, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14">    <span class="dt">Just</span> (value as <span class="fu">&lt;&gt;</span> value x <span class="fu">&lt;&gt;</span> value bs)</a>
<a class="sourceLine" id="cb28-15" data-line-number="15"></a>
<a class="sourceLine" id="cb28-16" data-line-number="16">valueAtPoint</a>
<a class="sourceLine" id="cb28-17" data-line-number="17"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb28-18" data-line-number="18">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> m</a>
<a class="sourceLine" id="cb28-19" data-line-number="19">valueAtPoint w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb28-20" data-line-number="20">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb28-21" data-line-number="21">  <span class="dt">PointOnly</span> (_, x, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-22" data-line-number="22">    <span class="dt">Just</span> (value x)</a>
<a class="sourceLine" id="cb28-23" data-line-number="23">  <span class="dt">Coincide</span> (_, x, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-24" data-line-number="24">    <span class="dt">Just</span> (value x)</a>
<a class="sourceLine" id="cb28-25" data-line-number="25">  <span class="dt">PointMark</span> (_, x, _, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-26" data-line-number="26">    <span class="dt">Just</span> (value x)</a>
<a class="sourceLine" id="cb28-27" data-line-number="27">  <span class="dt">MarkPoint</span> (_, _, _, y, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-28" data-line-number="28">    <span class="dt">Just</span> (value y)</a>
<a class="sourceLine" id="cb28-29" data-line-number="29"></a>
<a class="sourceLine" id="cb28-30" data-line-number="30">valueUpToPoint</a>
<a class="sourceLine" id="cb28-31" data-line-number="31"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb28-32" data-line-number="32">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> m</a>
<a class="sourceLine" id="cb28-33" data-line-number="33">valueUpToPoint w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb28-34" data-line-number="34">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-35" data-line-number="35">    <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb28-36" data-line-number="36">  <span class="dt">PointOnly</span> (as, x, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-37" data-line-number="37">    <span class="dt">Just</span> (value as <span class="fu">&lt;&gt;</span> value x)</a>
<a class="sourceLine" id="cb28-38" data-line-number="38">  <span class="dt">Coincide</span> (as, x, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-39" data-line-number="39">    <span class="dt">Just</span> (value as <span class="fu">&lt;&gt;</span> value x)</a>
<a class="sourceLine" id="cb28-40" data-line-number="40">  <span class="dt">PointMark</span> (as, x, _, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-41" data-line-number="41">    <span class="dt">Just</span> (value as <span class="fu">&lt;&gt;</span> value x)</a>
<a class="sourceLine" id="cb28-42" data-line-number="42">  <span class="dt">MarkPoint</span> (as, x, bs, y, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-43" data-line-number="43">    <span class="dt">Just</span> (value as <span class="fu">&lt;&gt;</span> value x <span class="fu">&lt;&gt;</span> value bs <span class="fu">&lt;&gt;</span> value y)</a>
<a class="sourceLine" id="cb28-44" data-line-number="44"></a>
<a class="sourceLine" id="cb28-45" data-line-number="45">valueUpToMark</a>
<a class="sourceLine" id="cb28-46" data-line-number="46"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb28-47" data-line-number="47">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> m</a>
<a class="sourceLine" id="cb28-48" data-line-number="48">valueUpToMark w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb28-49" data-line-number="49">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-50" data-line-number="50">    <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb28-51" data-line-number="51">  <span class="dt">PointOnly</span> _ <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-52" data-line-number="52">    <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb28-53" data-line-number="53">  <span class="dt">Coincide</span> (as, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-54" data-line-number="54">    <span class="dt">Just</span> (value as)</a>
<a class="sourceLine" id="cb28-55" data-line-number="55">  <span class="dt">PointMark</span> (as, x, bs, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-56" data-line-number="56">    <span class="dt">Just</span> (value as <span class="fu">&lt;&gt;</span> value x <span class="fu">&lt;&gt;</span> value bs)</a>
<a class="sourceLine" id="cb28-57" data-line-number="57">  <span class="dt">MarkPoint</span> (as, _, _, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-58" data-line-number="58">    <span class="dt">Just</span> (value as)</a>
<a class="sourceLine" id="cb28-59" data-line-number="59"></a>
<a class="sourceLine" id="cb28-60" data-line-number="60">valueAtMark</a>
<a class="sourceLine" id="cb28-61" data-line-number="61"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb28-62" data-line-number="62">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> m</a>
<a class="sourceLine" id="cb28-63" data-line-number="63">valueAtMark w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb28-64" data-line-number="64">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb28-65" data-line-number="65">  <span class="dt">PointOnly</span> _ <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb28-66" data-line-number="66">  <span class="dt">Coincide</span> (_, x, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-67" data-line-number="67">    <span class="dt">Just</span> (value x)</a>
<a class="sourceLine" id="cb28-68" data-line-number="68">  <span class="dt">PointMark</span> (_, _, _, y, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-69" data-line-number="69">    <span class="dt">Just</span> (value y)</a>
<a class="sourceLine" id="cb28-70" data-line-number="70">  <span class="dt">MarkPoint</span> (_, x, _, _, _) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb28-71" data-line-number="71">    <span class="dt">Just</span> (value x)</a></code></pre></div>
<p>Finally, we can remeasure a two-pointed list. This will be especially useful for working with text buffers, where the value will encode type level parameters.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb29-1" data-line-number="1">remeasure</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m1 a, <span class="dt">Valued</span> m2 a )</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m1 a <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m2 a</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">remeasure w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb29-6" data-line-number="6">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb29-7" data-line-number="7">    <span class="dt">PointOnly</span> (FT.remeasure as, x, FT.remeasure bs)</a>
<a class="sourceLine" id="cb29-8" data-line-number="8">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9">    <span class="dt">Coincide</span> (FT.remeasure as, x, FT.remeasure bs)</a>
<a class="sourceLine" id="cb29-10" data-line-number="10">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11">    <span class="dt">PointMark</span> (FT.remeasure as, x, FT.remeasure bs, y, FT.remeasure cs)</a>
<a class="sourceLine" id="cb29-12" data-line-number="12">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb29-13" data-line-number="13">    <span class="dt">MarkPoint</span> (FT.remeasure as, x, FT.remeasure bs, y, FT.remeasure cs)</a></code></pre></div>
</section>
<section id="splitting" class="level2">
<h2>Splitting</h2>
<p>We can convert a two-pointed list back into a finger tree; this looks sort of like integration at the type level.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb30-1" data-line-number="1">integrate</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">FT.FingerTree</span> m a</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">integrate w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6">    mempty</a>
<a class="sourceLine" id="cb30-7" data-line-number="7">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8">    as <span class="fu">&lt;&gt;</span> (FT.cons x bs)</a>
<a class="sourceLine" id="cb30-9" data-line-number="9">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb30-10" data-line-number="10">    as <span class="fu">&lt;&gt;</span> (FT.cons x bs)</a>
<a class="sourceLine" id="cb30-11" data-line-number="11">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12">    as <span class="fu">&lt;&gt;</span> (FT.cons x bs) <span class="fu">&lt;&gt;</span> (FT.cons y cs)</a>
<a class="sourceLine" id="cb30-13" data-line-number="13">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb30-14" data-line-number="14">    as <span class="fu">&lt;&gt;</span> (FT.cons x bs) <span class="fu">&lt;&gt;</span> (FT.cons y cs)</a></code></pre></div>
<p>Conversely, we can use split on finger trees to manipulate the point and mark of a two-pointed list. This is the operation that makes two-pointed lists practical; with an appropriate value annotation we can use it to get log complexity random access.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb31-1" data-line-number="1">split</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb31-3" data-line-number="3">  <span class="ot">=&gt;</span> (m <span class="ot">-&gt;</span> <span class="dt">Bool</span>)       <span class="co">-- point predicate</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (m <span class="ot">-&gt;</span> <span class="dt">Bool</span>) <span class="co">-- mark predicate</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5">  <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (<span class="dt">TwoPointedList</span> m a)</a>
<a class="sourceLine" id="cb31-6" data-line-number="6">split pointP q w <span class="fu">=</span></a>
<a class="sourceLine" id="cb31-7" data-line-number="7">  <span class="kw">let</span> xs <span class="fu">=</span> integrate w</a>
<a class="sourceLine" id="cb31-8" data-line-number="8">  <span class="kw">in</span> <span class="kw">case</span> FT.split pointP xs <span class="kw">of</span></a>
<a class="sourceLine" id="cb31-9" data-line-number="9">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb31-10" data-line-number="10">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="kw">case</span> q <span class="kw">of</span></a>
<a class="sourceLine" id="cb31-11" data-line-number="11">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as, x, bs)</a>
<a class="sourceLine" id="cb31-12" data-line-number="12">      <span class="dt">Just</span> markP <span class="ot">-&gt;</span> <span class="kw">case</span> FT.split markP as <span class="kw">of</span></a>
<a class="sourceLine" id="cb31-13" data-line-number="13">        <span class="dt">Just</span> (us, y, vs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb31-14" data-line-number="14">          <span class="dt">MarkPoint</span> (us, y, vs, x, bs)</a>
<a class="sourceLine" id="cb31-15" data-line-number="15">        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.split markP bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb31-16" data-line-number="16">          <span class="dt">Just</span> (us, y, vs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb31-17" data-line-number="17">            <span class="dt">PointMark</span> (as, x, us, y, vs)</a>
<a class="sourceLine" id="cb31-18" data-line-number="18">          <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">PointOnly</span> (as, x, bs)</a></code></pre></div>
<p>We also provide a splitting function that preserves the mark.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb32-1" data-line-number="1">splitPoint</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">  <span class="ot">=&gt;</span> (m <span class="ot">-&gt;</span> <span class="dt">Bool</span>) <span class="co">-- point predicate</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> (<span class="dt">TwoPointedList</span> m a)</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">splitPoint pointP w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7">  <span class="dt">PointOnly</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8">    <span class="kw">let</span> xs <span class="fu">=</span> as <span class="fu">&lt;&gt;</span> FT.cons x bs</a>
<a class="sourceLine" id="cb32-9" data-line-number="9">    <span class="kw">in</span> <span class="kw">case</span> FT.split pointP xs <span class="kw">of</span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11">      <span class="dt">Just</span> (us, y, vs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12">        <span class="dt">Just</span> <span class="fu">$</span> <span class="dt">PointOnly</span> (us, y, vs)</a>
<a class="sourceLine" id="cb32-13" data-line-number="13">  <span class="dt">Coincide</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb32-14" data-line-number="14">    <span class="kw">if</span> (not (pointP (value as))) <span class="fu">&amp;&amp;</span> (pointP (value as <span class="fu">&lt;&gt;</span> value x))</a>
<a class="sourceLine" id="cb32-15" data-line-number="15">      <span class="kw">then</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="dt">Coincide</span> (as, x, bs)</a>
<a class="sourceLine" id="cb32-16" data-line-number="16">      <span class="kw">else</span> <span class="kw">case</span> FT.split pointP as <span class="kw">of</span></a>
<a class="sourceLine" id="cb32-17" data-line-number="17">        <span class="dt">Just</span> (us, y, vs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="dt">PointMark</span> (us, y, vs, x, bs)</a>
<a class="sourceLine" id="cb32-18" data-line-number="18">        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.splitWithContext (value as <span class="fu">&lt;&gt;</span> value x) pointP bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb32-19" data-line-number="19">          <span class="dt">Just</span> (us, y, vs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="dt">MarkPoint</span> (as, x, us, y, vs)</a>
<a class="sourceLine" id="cb32-20" data-line-number="20">          <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb32-21" data-line-number="21">  <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb32-22" data-line-number="22">    <span class="kw">let</span> ds <span class="fu">=</span> as <span class="fu">&lt;&gt;</span> FT.cons x bs</a>
<a class="sourceLine" id="cb32-23" data-line-number="23">    <span class="kw">in</span> <span class="kw">case</span> FT.split pointP ds <span class="kw">of</span></a>
<a class="sourceLine" id="cb32-24" data-line-number="24">      <span class="dt">Just</span> (us, z, vs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="dt">PointMark</span> (us, z, vs, y, cs)</a>
<a class="sourceLine" id="cb32-25" data-line-number="25">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.splitWithContext (value ds <span class="fu">&lt;&gt;</span> value y) pointP cs <span class="kw">of</span></a>
<a class="sourceLine" id="cb32-26" data-line-number="26">        <span class="dt">Just</span> (us, z, vs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="dt">MarkPoint</span> (ds, y, us, z, vs )</a>
<a class="sourceLine" id="cb32-27" data-line-number="27">        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb32-28" data-line-number="28">  <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb32-29" data-line-number="29">    <span class="kw">let</span> ds <span class="fu">=</span> bs <span class="fu">&lt;&gt;</span> FT.cons y cs</a>
<a class="sourceLine" id="cb32-30" data-line-number="30">    <span class="kw">in</span> <span class="kw">case</span> FT.split pointP as <span class="kw">of</span></a>
<a class="sourceLine" id="cb32-31" data-line-number="31">      <span class="dt">Just</span> (us, z, vs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="dt">PointMark</span> (us, z, vs, x, ds)</a>
<a class="sourceLine" id="cb32-32" data-line-number="32">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> FT.splitWithContext (value as <span class="fu">&lt;&gt;</span> value x) pointP ds <span class="kw">of</span></a>
<a class="sourceLine" id="cb32-33" data-line-number="33">        <span class="dt">Just</span> (us, z, vs) <span class="ot">-&gt;</span> <span class="dt">Just</span> <span class="fu">$</span> <span class="dt">MarkPoint</span> (as, x, us, z, vs)</a>
<a class="sourceLine" id="cb32-34" data-line-number="34">        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a></code></pre></div>
<p>Some examples:</p>
<div class="doctest">
<div class="sourceCode" id="cb33"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="co">-- $</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="co">--   x, y :: TwoPointedList Count Char</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="co">--   x = makePointMark [&#39;a&#39;] &#39;b&#39; [&#39;c&#39;,&#39;d&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="co">--   y = makePointMark [&#39;a&#39;,&#39;b&#39;] &#39;c&#39; [&#39;d&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7"><span class="co">-- in (Just y) == (splitPoint (\k -&gt; k == Count 3) x)</span></a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb33-9" data-line-number="9"><span class="co">-- True</span></a>
<a class="sourceLine" id="cb33-10" data-line-number="10"><span class="co">--</span></a>
<a class="sourceLine" id="cb33-11" data-line-number="11"><span class="co">-- &gt;&gt;&gt; :{</span></a>
<a class="sourceLine" id="cb33-12" data-line-number="12"><span class="co">-- let</span></a>
<a class="sourceLine" id="cb33-13" data-line-number="13"><span class="co">--   x, y :: TwoPointedList Count Char</span></a>
<a class="sourceLine" id="cb33-14" data-line-number="14"><span class="co">--   x = makePointMark [&#39;a&#39;] &#39;b&#39; [&#39;c&#39;,&#39;d&#39;] &#39;e&#39; [&#39;f&#39;]</span></a>
<a class="sourceLine" id="cb33-15" data-line-number="15"><span class="co">--   y = makeMarkPoint [&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;] &#39;e&#39; [] &#39;f&#39; []</span></a>
<a class="sourceLine" id="cb33-16" data-line-number="16"><span class="co">-- in (Just y) == (splitPoint (\k -&gt; k == Count 6) x)</span></a>
<a class="sourceLine" id="cb33-17" data-line-number="17"><span class="co">-- :}</span></a>
<a class="sourceLine" id="cb33-18" data-line-number="18"><span class="co">-- True</span></a></code></pre></div>
</div>
<p>While we’re here, it is also useful to convert two-pointed lists to ordinary lists with the accumulated value annotation.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb34-1" data-line-number="1">toAnnotatedList</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> [(a,m)]</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">toAnnotatedList <span class="fu">=</span></a>
<a class="sourceLine" id="cb34-5" data-line-number="5">  FT.toAnnotatedList <span class="fu">.</span> integrate</a></code></pre></div>
</section>
<section id="testing-and-debugging" class="level2">
<h2>Testing and Debugging</h2>
<p>We end with some utility code. First, we need some class instances for interoperating with our property testing library.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2">  ( <span class="dt">Arb</span> a, <span class="dt">Valued</span> m a</a>
<a class="sourceLine" id="cb35-3" data-line-number="3">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (<span class="dt">TwoPointedList</span> m a)</a>
<a class="sourceLine" id="cb35-4" data-line-number="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-5" data-line-number="5">    arb <span class="fu">=</span> pickFrom5</a>
<a class="sourceLine" id="cb35-6" data-line-number="6">      ( pure <span class="dt">Vacant</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7">      , <span class="dt">PointOnly</span> <span class="fu">&lt;$&gt;</span> arb</a>
<a class="sourceLine" id="cb35-8" data-line-number="8">      , <span class="dt">Coincide</span> <span class="fu">&lt;$&gt;</span> arb</a>
<a class="sourceLine" id="cb35-9" data-line-number="9">      , <span class="dt">PointMark</span> <span class="fu">&lt;$&gt;</span> arb</a>
<a class="sourceLine" id="cb35-10" data-line-number="10">      , <span class="dt">MarkPoint</span> <span class="fu">&lt;$&gt;</span> arb</a>
<a class="sourceLine" id="cb35-11" data-line-number="11">      )</a>
<a class="sourceLine" id="cb35-12" data-line-number="12"></a>
<a class="sourceLine" id="cb35-13" data-line-number="13"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb35-14" data-line-number="14">  ( <span class="dt">Prune</span> a, <span class="dt">Valued</span> m a</a>
<a class="sourceLine" id="cb35-15" data-line-number="15">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (<span class="dt">TwoPointedList</span> m a)</a>
<a class="sourceLine" id="cb35-16" data-line-number="16">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb35-17" data-line-number="17">    prune w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb35-18" data-line-number="18">      <span class="dt">Vacant</span> <span class="ot">-&gt;</span> []</a>
<a class="sourceLine" id="cb35-19" data-line-number="19">      <span class="dt">PointOnly</span> z <span class="ot">-&gt;</span> concat</a>
<a class="sourceLine" id="cb35-20" data-line-number="20">        [ [ <span class="dt">Vacant</span> ]</a>
<a class="sourceLine" id="cb35-21" data-line-number="21">        , <span class="dt">PointOnly</span> <span class="fu">&lt;$&gt;</span> prune z</a>
<a class="sourceLine" id="cb35-22" data-line-number="22">        ]</a>
<a class="sourceLine" id="cb35-23" data-line-number="23">      <span class="dt">Coincide</span> z <span class="ot">-&gt;</span> concat</a>
<a class="sourceLine" id="cb35-24" data-line-number="24">        [ [ <span class="dt">Vacant</span>, <span class="dt">PointOnly</span> z ]</a>
<a class="sourceLine" id="cb35-25" data-line-number="25">        , <span class="dt">Coincide</span> <span class="fu">&lt;$&gt;</span> prune z</a>
<a class="sourceLine" id="cb35-26" data-line-number="26">        ]</a>
<a class="sourceLine" id="cb35-27" data-line-number="27">      <span class="dt">PointMark</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> concat</a>
<a class="sourceLine" id="cb35-28" data-line-number="28">        [ [ <span class="dt">Vacant</span>, <span class="dt">Coincide</span> (as, x, bs), <span class="dt">Coincide</span> (bs, y, cs) ]</a>
<a class="sourceLine" id="cb35-29" data-line-number="29">        , <span class="dt">PointMark</span> <span class="fu">&lt;$&gt;</span> prune (as, x, bs, y, cs)</a>
<a class="sourceLine" id="cb35-30" data-line-number="30">        ]</a>
<a class="sourceLine" id="cb35-31" data-line-number="31">      <span class="dt">MarkPoint</span> (as, x, bs, y, cs) <span class="ot">-&gt;</span> concat</a>
<a class="sourceLine" id="cb35-32" data-line-number="32">        [ [ <span class="dt">Vacant</span>, <span class="dt">Coincide</span> (as, x, bs), <span class="dt">Coincide</span> (bs, y, cs) ]</a>
<a class="sourceLine" id="cb35-33" data-line-number="33">        , <span class="dt">MarkPoint</span> <span class="fu">&lt;$&gt;</span> prune (as, x, bs, y, cs)</a>
<a class="sourceLine" id="cb35-34" data-line-number="34">        ]</a></code></pre></div>
<p>And finally, since two-pointed lists are built out of finger trees, it will be handy to have a function checking that the underlying structure is valid.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb36-1" data-line-number="1">validate</a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Eq</span> m, <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">TwoPointedList</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb36-4" data-line-number="4">validate w <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5">  <span class="dt">Vacant</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb36-6" data-line-number="6">  <span class="dt">PointOnly</span> (as, _, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb36-7" data-line-number="7">    (FT.validate as) <span class="fu">&amp;&amp;</span> (FT.validate bs)</a>
<a class="sourceLine" id="cb36-8" data-line-number="8">  <span class="dt">Coincide</span> (as, _, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb36-9" data-line-number="9">    (FT.validate as) <span class="fu">&amp;&amp;</span> (FT.validate bs)</a>
<a class="sourceLine" id="cb36-10" data-line-number="10">  <span class="dt">PointMark</span> (as, _, bs, _, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb36-11" data-line-number="11">    (FT.validate as) <span class="fu">&amp;&amp;</span> (FT.validate bs) <span class="fu">&amp;&amp;</span> (FT.validate cs)</a>
<a class="sourceLine" id="cb36-12" data-line-number="12">  <span class="dt">MarkPoint</span> (as, _, bs, _, cs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb36-13" data-line-number="13">    (FT.validate as) <span class="fu">&amp;&amp;</span> (FT.validate bs) <span class="fu">&amp;&amp;</span> (FT.validate cs)</a></code></pre></div>
</section>
</article>
</body>
</html>
