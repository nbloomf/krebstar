<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="nbloomf">
  <title>Lawfulness Proofs for EnvT</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="../../../../../../../../../styles/style.css">
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
  <script>
    window.MathJax = {
      tex: {
        macros: {
          dom: "\\mathsf{dom}",
          cod: "\\mathsf{cod}",
          id:  "\\mathsf{id}",
          Hask: "\\mathsf{Hask}",
        }
      }
    };
  </script
</head>
<body>
<article>
<header>
<h1 class="title">Lawfulness Proofs for EnvT</h1>
<p class="byline">nbloomf</p>
</header>
<div class="frontmatter">
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">module</span> <span class="dt">Kreb.Control.Monad.Trans.EnvT.Proofs</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">import</span> <span class="dt">Kreb.Control.Compare</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">import</span> <span class="dt">Kreb.Control.Monad</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">import</span> <span class="dt">Kreb.Control.Monad.Trans</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">import</span> <span class="dt">Kreb.Control.Monad.Trans.EnvT</span></a></code></pre></div>
</div>
<section class="level2">
<h2>Introduction</h2>
<p>In this section we give lawfulness proofs for the various typeclass instances of <code>EnvT</code>. A nice side effect (!) of referential transparency is that we can write <em>equational proofs</em> that program transformations are semantics-preserving, and that's what we're doing here. These can be safely ignored if all you want to know is how the instances are defined.</p>
</section>
<section class="level2">
<h2>Monad Laws</h2>
<p><a name='crossref-0'></a></p>
<p>Recall the three <em>monad laws</em>:</p>
<dl>
<dt>Left Identity Law</dt>
<dd><code>return a &gt;&gt;= f</code> is equivalent to <code>f a</code>
</dd>
<dt>Right Identity Law</dt>
<dd><code>x &gt;&gt;= return</code> is equivalent to <code>x</code>
</dd>
<dt>Associative Law</dt>
<dd><code>(x &gt;&gt;= f) &gt;&gt;= g</code> is equivalent to <code>x &gt;&gt;= (\a -&gt; f a &gt;&gt;= g)</code>
</dd>
</dl>
<p>Here we show that if <code>m</code> is a monad, then <code>EnvT s m</code> is also a monad. To that end suppose <code>m</code> is a monad.</p>
<p>First: <code>EnvT s m</code> satisfies the left identity law.</p>
<div class="example">
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1">_EnvT_left_identity_law</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r m a b</a>
<a class="sourceLine" id="cb2-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m b)</a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m b]</a>
<a class="sourceLine" id="cb2-6" title="6">_EnvT_left_identity_law a f <span class="ot">=</span></a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8">  [ <span class="fu">return</span> a <span class="op">&gt;&gt;=</span> f</a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-13" title="13">      unEnvT (<span class="fu">return</span> a) r <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (f c) r)</a>
<a class="sourceLine" id="cb2-14" title="14"></a>
<a class="sourceLine" id="cb2-15" title="15">  <span class="co">-- (expand return)</span></a>
<a class="sourceLine" id="cb2-16" title="16"></a>
<a class="sourceLine" id="cb2-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-18" title="18">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> <span class="fu">return</span> a) r</a>
<a class="sourceLine" id="cb2-19" title="19">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (f c) r)</a>
<a class="sourceLine" id="cb2-20" title="20"></a>
<a class="sourceLine" id="cb2-21" title="21">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb2-22" title="22"></a>
<a class="sourceLine" id="cb2-23" title="23">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-24" title="24">      (\_ <span class="ot">-&gt;</span> <span class="fu">return</span> a) r</a>
<a class="sourceLine" id="cb2-25" title="25">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (f c) r)</a>
<a class="sourceLine" id="cb2-26" title="26"></a>
<a class="sourceLine" id="cb2-27" title="27">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb2-28" title="28"></a>
<a class="sourceLine" id="cb2-29" title="29">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-30" title="30">      <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb2-31" title="31">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (f c) r)</a>
<a class="sourceLine" id="cb2-32" title="32"></a>
<a class="sourceLine" id="cb2-33" title="33">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb2-34" title="34"></a>
<a class="sourceLine" id="cb2-35" title="35">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-36" title="36">      (\c <span class="ot">-&gt;</span> unEnvT (f c) r) a</a>
<a class="sourceLine" id="cb2-37" title="37"></a>
<a class="sourceLine" id="cb2-38" title="38">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb2-39" title="39"></a>
<a class="sourceLine" id="cb2-40" title="40">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-41" title="41">      unEnvT (f a) r</a>
<a class="sourceLine" id="cb2-42" title="42"></a>
<a class="sourceLine" id="cb2-43" title="43">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb2-44" title="44"></a>
<a class="sourceLine" id="cb2-45" title="45">  , <span class="dt">EnvT</span> <span class="op">$</span> unEnvT (f a)</a>
<a class="sourceLine" id="cb2-46" title="46"></a>
<a class="sourceLine" id="cb2-47" title="47">  <span class="co">-- (EnvT . unEnvT == id)</span></a>
<a class="sourceLine" id="cb2-48" title="48"></a>
<a class="sourceLine" id="cb2-49" title="49">  , f a</a>
<a class="sourceLine" id="cb2-50" title="50">  ]</a></code></pre></div>
</div>
<p>Second: <code>EnvT s m</code> satisfies the right identity law.</p>
<div class="example">
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1">_EnvT_right_identity_law</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m a</a>
<a class="sourceLine" id="cb3-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="ot">=&gt;</span> (<span class="dt">EnvT</span> s m a)</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> s m a]</a>
<a class="sourceLine" id="cb3-6" title="6">_EnvT_right_identity_law x <span class="ot">=</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8">  [ x <span class="op">&gt;&gt;=</span> <span class="fu">return</span></a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-13" title="13">      unEnvT x r</a>
<a class="sourceLine" id="cb3-14" title="14">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="fu">return</span> a) r)</a>
<a class="sourceLine" id="cb3-15" title="15"></a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="co">-- (expand return)</span></a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-19" title="19">      unEnvT x r</a>
<a class="sourceLine" id="cb3-20" title="20">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> <span class="fu">return</span> a) r)</a>
<a class="sourceLine" id="cb3-21" title="21"></a>
<a class="sourceLine" id="cb3-22" title="22">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb3-23" title="23"></a>
<a class="sourceLine" id="cb3-24" title="24">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-25" title="25">      unEnvT x r</a>
<a class="sourceLine" id="cb3-26" title="26">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> (\_ <span class="ot">-&gt;</span> <span class="fu">return</span> a) r)</a>
<a class="sourceLine" id="cb3-27" title="27"></a>
<a class="sourceLine" id="cb3-28" title="28">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb3-29" title="29"></a>
<a class="sourceLine" id="cb3-30" title="30">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-31" title="31">      unEnvT x r</a>
<a class="sourceLine" id="cb3-32" title="32">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> a)</a>
<a class="sourceLine" id="cb3-33" title="33"></a>
<a class="sourceLine" id="cb3-34" title="34">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb3-35" title="35"></a>
<a class="sourceLine" id="cb3-36" title="36">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-37" title="37">      unEnvT x r <span class="op">&gt;&gt;=</span> <span class="fu">return</span></a>
<a class="sourceLine" id="cb3-38" title="38"></a>
<a class="sourceLine" id="cb3-39" title="39">  <span class="co">-- (right identity law in m)</span></a>
<a class="sourceLine" id="cb3-40" title="40"></a>
<a class="sourceLine" id="cb3-41" title="41">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-42" title="42">      unEnvT x r</a>
<a class="sourceLine" id="cb3-43" title="43"></a>
<a class="sourceLine" id="cb3-44" title="44">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb3-45" title="45"></a>
<a class="sourceLine" id="cb3-46" title="46">  , <span class="dt">EnvT</span> (unEnvT x)</a>
<a class="sourceLine" id="cb3-47" title="47"></a>
<a class="sourceLine" id="cb3-48" title="48">  <span class="co">-- (EnvT . unEnvT == id)</span></a>
<a class="sourceLine" id="cb3-49" title="49"></a>
<a class="sourceLine" id="cb3-50" title="50">  , x</a>
<a class="sourceLine" id="cb3-51" title="51">  ]</a></code></pre></div>
</div>
<p>Third: <code>EnvT s m</code> satisfies the associative law.</p>
<div class="example">
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1">_EnvT_associativity_law</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m a b c</a>
<a class="sourceLine" id="cb4-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="ot">=&gt;</span> <span class="dt">EnvT</span> s m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">EnvT</span> s m b) <span class="ot">-&gt;</span> (b <span class="ot">-&gt;</span> <span class="dt">EnvT</span> s m c)</a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> s m c]</a>
<a class="sourceLine" id="cb4-6" title="6">_EnvT_associativity_law x f g <span class="ot">=</span></a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8">  [ (x <span class="op">&gt;&gt;=</span> f) <span class="op">&gt;&gt;=</span> g</a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-13" title="13">      unEnvT (x <span class="op">&gt;&gt;=</span> f) r</a>
<a class="sourceLine" id="cb4-14" title="14">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (g a) r)</a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb4-17" title="17"></a>
<a class="sourceLine" id="cb4-18" title="18">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-19" title="19">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r2 <span class="ot">-&gt;</span> unEnvT x r2 <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> unEnvT (f b) r2)) r</a>
<a class="sourceLine" id="cb4-20" title="20">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (g a) r)</a>
<a class="sourceLine" id="cb4-21" title="21"></a>
<a class="sourceLine" id="cb4-22" title="22">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb4-23" title="23"></a>
<a class="sourceLine" id="cb4-24" title="24">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-25" title="25">      (\r2 <span class="ot">-&gt;</span> unEnvT x r2 <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> unEnvT (f b) r2)) r</a>
<a class="sourceLine" id="cb4-26" title="26">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (g a) r)</a>
<a class="sourceLine" id="cb4-27" title="27"></a>
<a class="sourceLine" id="cb4-28" title="28">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb4-29" title="29"></a>
<a class="sourceLine" id="cb4-30" title="30">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-31" title="31">      (unEnvT x r <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> unEnvT (f b) r))</a>
<a class="sourceLine" id="cb4-32" title="32">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (g a) r)</a>
<a class="sourceLine" id="cb4-33" title="33"></a>
<a class="sourceLine" id="cb4-34" title="34">  <span class="co">-- (associativity law in m)</span></a>
<a class="sourceLine" id="cb4-35" title="35"></a>
<a class="sourceLine" id="cb4-36" title="36">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-37" title="37">      unEnvT x r</a>
<a class="sourceLine" id="cb4-38" title="38">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> (\b <span class="ot">-&gt;</span> unEnvT (f b) r) c</a>
<a class="sourceLine" id="cb4-39" title="39">          <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (g a) r))</a>
<a class="sourceLine" id="cb4-40" title="40"></a>
<a class="sourceLine" id="cb4-41" title="41">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb4-42" title="42"></a>
<a class="sourceLine" id="cb4-43" title="43">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-44" title="44">      unEnvT x r</a>
<a class="sourceLine" id="cb4-45" title="45">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (f c) r</a>
<a class="sourceLine" id="cb4-46" title="46">          <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (g a) r))</a>
<a class="sourceLine" id="cb4-47" title="47"></a>
<a class="sourceLine" id="cb4-48" title="48">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb4-49" title="49"></a>
<a class="sourceLine" id="cb4-50" title="50">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-51" title="51">      unEnvT x r</a>
<a class="sourceLine" id="cb4-52" title="52">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> (\r2 <span class="ot">-&gt;</span> unEnvT (f c) r2</a>
<a class="sourceLine" id="cb4-53" title="53">          <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (g a) r2)) r)</a>
<a class="sourceLine" id="cb4-54" title="54"></a>
<a class="sourceLine" id="cb4-55" title="55">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb4-56" title="56"></a>
<a class="sourceLine" id="cb4-57" title="57">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-58" title="58">      unEnvT x r</a>
<a class="sourceLine" id="cb4-59" title="59">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r2</a>
<a class="sourceLine" id="cb4-60" title="60">          <span class="ot">-&gt;</span> unEnvT (f c) r2 <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (g a) r2)) r)</a>
<a class="sourceLine" id="cb4-61" title="61"></a>
<a class="sourceLine" id="cb4-62" title="62">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb4-63" title="63"></a>
<a class="sourceLine" id="cb4-64" title="64">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-65" title="65">      unEnvT x r</a>
<a class="sourceLine" id="cb4-66" title="66">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (f c <span class="op">&gt;&gt;=</span> g) r)</a>
<a class="sourceLine" id="cb4-67" title="67"></a>
<a class="sourceLine" id="cb4-68" title="68">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb4-69" title="69"></a>
<a class="sourceLine" id="cb4-70" title="70">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-71" title="71">      unEnvT x r</a>
<a class="sourceLine" id="cb4-72" title="72">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT ((\a <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> g) c) r)</a>
<a class="sourceLine" id="cb4-73" title="73"></a>
<a class="sourceLine" id="cb4-74" title="74">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb4-75" title="75"></a>
<a class="sourceLine" id="cb4-76" title="76">  , x <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> g)</a>
<a class="sourceLine" id="cb4-77" title="77">  ]</a></code></pre></div>
</div>
</section>
<section class="level2">
<h2>Monad Transformer Laws</h2>
<p><a name='crossref-1'></a></p>
<p>Recall the two <em>monad transformer laws</em>:</p>
<dl>
<dt>Unit Law</dt>
<dd><code>lift . return</code> is equivalent to <code>return</code>
</dd>
<dt>Bind Law</dt>
<dd><code>lift (x &gt;&gt;= f)</code> is equivalent to <code>lift x &gt;&gt;= (lift . f)</code>
</dd>
</dl>
<p>Here we show that <code>EnvT s</code> is a monad transformer. First: <code>EnvT s</code> satisfies the unit law.</p>
<div class="example">
<div class="sourceCode" id="cb5"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1">_EnvT_unit_law</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r m a</a>
<a class="sourceLine" id="cb5-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="ot">=&gt;</span> a</a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m a]</a>
<a class="sourceLine" id="cb5-6" title="6">_EnvT_unit_law a <span class="ot">=</span></a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8">  [ lift (<span class="fu">return</span> a)</a>
<a class="sourceLine" id="cb5-9" title="9"></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb5-13" title="13"></a>
<a class="sourceLine" id="cb5-14" title="14">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb5-15" title="15"></a>
<a class="sourceLine" id="cb5-16" title="16">  , <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb5-17" title="17">  ]</a></code></pre></div>
</div>
<p>Second: <code>EnvT s</code> satisfies the bind law.</p>
<div class="example">
<div class="sourceCode" id="cb6"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1">_EnvT_bind_law</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r m a b</a>
<a class="sourceLine" id="cb6-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="ot">=&gt;</span> m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> m b)</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m b]</a>
<a class="sourceLine" id="cb6-6" title="6">_EnvT_bind_law x f <span class="ot">=</span></a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">  [ lift (x <span class="op">&gt;&gt;=</span> f)</a>
<a class="sourceLine" id="cb6-9" title="9"></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb6-11" title="11"></a>
<a class="sourceLine" id="cb6-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-13" title="13">      x <span class="op">&gt;&gt;=</span> f</a>
<a class="sourceLine" id="cb6-14" title="14"></a>
<a class="sourceLine" id="cb6-15" title="15">  <span class="co">-- (η-expansion)</span></a>
<a class="sourceLine" id="cb6-16" title="16"></a>
<a class="sourceLine" id="cb6-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-18" title="18">      x <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> f a)</a>
<a class="sourceLine" id="cb6-19" title="19"></a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb6-21" title="21"></a>
<a class="sourceLine" id="cb6-22" title="22">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-23" title="23">      x</a>
<a class="sourceLine" id="cb6-24" title="24">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> (\_ <span class="ot">-&gt;</span> f a) r)</a>
<a class="sourceLine" id="cb6-25" title="25"></a>
<a class="sourceLine" id="cb6-26" title="26">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb6-27" title="27"></a>
<a class="sourceLine" id="cb6-28" title="28">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-29" title="29">      x</a>
<a class="sourceLine" id="cb6-30" title="30">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> f a) r)</a>
<a class="sourceLine" id="cb6-31" title="31"></a>
<a class="sourceLine" id="cb6-32" title="32">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb6-33" title="33"></a>
<a class="sourceLine" id="cb6-34" title="34">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-35" title="35">      x</a>
<a class="sourceLine" id="cb6-36" title="36">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (lift (f a)) r)</a>
<a class="sourceLine" id="cb6-37" title="37"></a>
<a class="sourceLine" id="cb6-38" title="38">  <span class="co">-- (definition of .)</span></a>
<a class="sourceLine" id="cb6-39" title="39"></a>
<a class="sourceLine" id="cb6-40" title="40">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-41" title="41">      x</a>
<a class="sourceLine" id="cb6-42" title="42">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((lift <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb6-43" title="43"></a>
<a class="sourceLine" id="cb6-44" title="44">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb6-45" title="45"></a>
<a class="sourceLine" id="cb6-46" title="46">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-47" title="47">      (\_ <span class="ot">-&gt;</span> x) r</a>
<a class="sourceLine" id="cb6-48" title="48">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((lift <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb6-49" title="49"></a>
<a class="sourceLine" id="cb6-50" title="50">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb6-51" title="51"></a>
<a class="sourceLine" id="cb6-52" title="52">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-53" title="53">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> x) r</a>
<a class="sourceLine" id="cb6-54" title="54">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((lift <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb6-55" title="55"></a>
<a class="sourceLine" id="cb6-56" title="56">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb6-57" title="57"></a>
<a class="sourceLine" id="cb6-58" title="58">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-59" title="59">      unEnvT (lift x) r</a>
<a class="sourceLine" id="cb6-60" title="60">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((lift <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb6-61" title="61"></a>
<a class="sourceLine" id="cb6-62" title="62">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb6-63" title="63"></a>
<a class="sourceLine" id="cb6-64" title="64">  , lift x <span class="op">&gt;&gt;=</span> (lift <span class="op">.</span> f)</a>
<a class="sourceLine" id="cb6-65" title="65">  ]</a></code></pre></div>
</div>
</section>
<section class="level2">
<h2>MonadReadOnly Laws</h2>
<p><a name='crossref-2'></a></p>
<p>There are two different <code>MonadReadOnly</code> instances for <code>EnvT r m</code> that we need to verify. Recall the laws for <a href="../../../Monad.html#crossref-1"><code>MonadReadOnly</code></a>:</p>
<dl>
<dt>Local/Ask Law</dt>
<dd><code>local u ask</code> is equivalent to <code>fmap u ask</code>
</dd>
<dt>Local/Local Law</dt>
<dd><code>local u (local v x)</code> is equivalent to <code>local (v . u) x</code>
</dd>
<dt>Interchange Law</dt>
<dd><code>local u x &gt;&gt; ask</code> is equivalent to <code>ask &gt;&gt;= (\r -&gt; local u x &gt;&gt; return r)</code>
</dd>
<dd><code>local u x &gt;&gt;= (\a -&gt; ask &gt;&gt;= (\b -&gt; f a b))</code> is equivalent to <code>ask &gt;&gt;= (\b -&gt; local u x &gt;&gt;= (\a -&gt; f a b))</code>
</dd>
<dt>Local Unit Law</dt>
<dd><code>local u (return a)</code> is equivalent to <code>return a</code>
</dd>
<dt>Local Bind Law</dt>
<dd><code>local u (x &gt;&gt;= f)</code> is equivalent to <code>local u x &gt;&gt;= (local u . f)</code>
</dd>
</dl>
<p>Here we show that if <code>m</code> is a monad then <code>EnvT r m</code> satisfies the MonadReadOnly laws with environment type <code>r</code>.</p>
<p>First: <code>EnvT r m</code> satisfies the local/ask law:</p>
<div class="example">
<div class="sourceCode" id="cb7"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1">_EnvT_local_ask_law_natural</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r m</a>
<a class="sourceLine" id="cb7-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="ot">=&gt;</span> (r <span class="ot">-&gt;</span> r)</a>
<a class="sourceLine" id="cb7-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m r]</a>
<a class="sourceLine" id="cb7-6" title="6">_EnvT_local_ask_law_natural u <span class="ot">=</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8">  [ local u ask</a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb7-11" title="11"></a>
<a class="sourceLine" id="cb7-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-13" title="13">      unEnvT ask (u r)</a>
<a class="sourceLine" id="cb7-14" title="14"></a>
<a class="sourceLine" id="cb7-15" title="15">  <span class="co">-- (expand ask)</span></a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-18" title="18">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r2 <span class="ot">-&gt;</span> <span class="fu">return</span> r2) (u r)</a>
<a class="sourceLine" id="cb7-19" title="19"></a>
<a class="sourceLine" id="cb7-20" title="20">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb7-21" title="21"></a>
<a class="sourceLine" id="cb7-22" title="22">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-23" title="23">      (\r2 <span class="ot">-&gt;</span> <span class="fu">return</span> r2) (u r)</a>
<a class="sourceLine" id="cb7-24" title="24"></a>
<a class="sourceLine" id="cb7-25" title="25">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-26" title="26"></a>
<a class="sourceLine" id="cb7-27" title="27">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-28" title="28">      <span class="fu">return</span> (u r)</a>
<a class="sourceLine" id="cb7-29" title="29"></a>
<a class="sourceLine" id="cb7-30" title="30">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-31" title="31"></a>
<a class="sourceLine" id="cb7-32" title="32">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-33" title="33">      (\_ <span class="ot">-&gt;</span> <span class="fu">return</span> (u r)) r</a>
<a class="sourceLine" id="cb7-34" title="34"></a>
<a class="sourceLine" id="cb7-35" title="35">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb7-36" title="36"></a>
<a class="sourceLine" id="cb7-37" title="37">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-38" title="38">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> <span class="fu">return</span> (u r)) r</a>
<a class="sourceLine" id="cb7-39" title="39"></a>
<a class="sourceLine" id="cb7-40" title="40">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb7-41" title="41"></a>
<a class="sourceLine" id="cb7-42" title="42">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-43" title="43">      unEnvT (<span class="fu">return</span> (u r)) r</a>
<a class="sourceLine" id="cb7-44" title="44"></a>
<a class="sourceLine" id="cb7-45" title="45">  <span class="co">-- (condense .)</span></a>
<a class="sourceLine" id="cb7-46" title="46"></a>
<a class="sourceLine" id="cb7-47" title="47">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-48" title="48">      unEnvT ((<span class="fu">return</span> <span class="op">.</span> u) r) r</a>
<a class="sourceLine" id="cb7-49" title="49"></a>
<a class="sourceLine" id="cb7-50" title="50">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-51" title="51"></a>
<a class="sourceLine" id="cb7-52" title="52">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-53" title="53">      (\a <span class="ot">-&gt;</span> unEnvT ((<span class="fu">return</span> <span class="op">.</span> u) a) r) r</a>
<a class="sourceLine" id="cb7-54" title="54"></a>
<a class="sourceLine" id="cb7-55" title="55">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb7-56" title="56"></a>
<a class="sourceLine" id="cb7-57" title="57">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-58" title="58">      <span class="fu">return</span> r</a>
<a class="sourceLine" id="cb7-59" title="59">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((<span class="fu">return</span> <span class="op">.</span> u) a) r)</a>
<a class="sourceLine" id="cb7-60" title="60"></a>
<a class="sourceLine" id="cb7-61" title="61">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-62" title="62"></a>
<a class="sourceLine" id="cb7-63" title="63">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-64" title="64">      (\r2 <span class="ot">-&gt;</span> <span class="fu">return</span> r2) r</a>
<a class="sourceLine" id="cb7-65" title="65">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((<span class="fu">return</span> <span class="op">.</span> u) a) r)</a>
<a class="sourceLine" id="cb7-66" title="66"></a>
<a class="sourceLine" id="cb7-67" title="67">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb7-68" title="68"></a>
<a class="sourceLine" id="cb7-69" title="69">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-70" title="70">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r2 <span class="ot">-&gt;</span> <span class="fu">return</span> r2) r</a>
<a class="sourceLine" id="cb7-71" title="71">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((<span class="fu">return</span> <span class="op">.</span> u) a) r)</a>
<a class="sourceLine" id="cb7-72" title="72"></a>
<a class="sourceLine" id="cb7-73" title="73">  <span class="co">-- (condense ask)</span></a>
<a class="sourceLine" id="cb7-74" title="74"></a>
<a class="sourceLine" id="cb7-75" title="75">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-76" title="76">      unEnvT ask r</a>
<a class="sourceLine" id="cb7-77" title="77">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((<span class="fu">return</span> <span class="op">.</span> u) a) r)</a>
<a class="sourceLine" id="cb7-78" title="78"></a>
<a class="sourceLine" id="cb7-79" title="79">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb7-80" title="80"></a>
<a class="sourceLine" id="cb7-81" title="81">  , ask <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> u)</a>
<a class="sourceLine" id="cb7-82" title="82"></a>
<a class="sourceLine" id="cb7-83" title="83">  <span class="co">-- (condense fmap)</span></a>
<a class="sourceLine" id="cb7-84" title="84"></a>
<a class="sourceLine" id="cb7-85" title="85">  , <span class="fu">fmap</span> u ask</a>
<a class="sourceLine" id="cb7-86" title="86">  ]</a></code></pre></div>
</div>
<p>Second: <code>EnvT r m</code> satisfies the local/local law:</p>
<div class="example">
<div class="sourceCode" id="cb8"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1">_EnvT_local_local_law_natural</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r m a</a>
<a class="sourceLine" id="cb8-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="ot">=&gt;</span> (r <span class="ot">-&gt;</span> r) <span class="ot">-&gt;</span> (r <span class="ot">-&gt;</span> r) <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m a</a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m a]</a>
<a class="sourceLine" id="cb8-6" title="6">_EnvT_local_local_law_natural u v x <span class="ot">=</span></a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8">  [ local u (local v x)</a>
<a class="sourceLine" id="cb8-9" title="9"></a>
<a class="sourceLine" id="cb8-10" title="10">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-13" title="13">      unEnvT (local v x) (u r)</a>
<a class="sourceLine" id="cb8-14" title="14"></a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb8-16" title="16"></a>
<a class="sourceLine" id="cb8-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-18" title="18">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r2 <span class="ot">-&gt;</span> unEnvT x (v r2)) (u r)</a>
<a class="sourceLine" id="cb8-19" title="19"></a>
<a class="sourceLine" id="cb8-20" title="20">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb8-21" title="21"></a>
<a class="sourceLine" id="cb8-22" title="22">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-23" title="23">      (\r2 <span class="ot">-&gt;</span> unEnvT x (v r2)) (u r)</a>
<a class="sourceLine" id="cb8-24" title="24"></a>
<a class="sourceLine" id="cb8-25" title="25">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb8-26" title="26"></a>
<a class="sourceLine" id="cb8-27" title="27">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-28" title="28">      unEnvT x (v (u r))</a>
<a class="sourceLine" id="cb8-29" title="29"></a>
<a class="sourceLine" id="cb8-30" title="30">  <span class="co">-- (condense .)</span></a>
<a class="sourceLine" id="cb8-31" title="31"></a>
<a class="sourceLine" id="cb8-32" title="32">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-33" title="33">      unEnvT x ((v <span class="op">.</span> u) r)</a>
<a class="sourceLine" id="cb8-34" title="34"></a>
<a class="sourceLine" id="cb8-35" title="35">  <span class="co">-- (condense local)</span></a>
<a class="sourceLine" id="cb8-36" title="36"></a>
<a class="sourceLine" id="cb8-37" title="37">  , local (v <span class="op">.</span> u) x</a>
<a class="sourceLine" id="cb8-38" title="38">  ]</a></code></pre></div>
</div>
<p>Third: <code>EnvT r m</code> satisfies the interchange law:</p>
<div class="example">
<div class="sourceCode" id="cb9"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" title="1">_EnvT_interchange_law_natural</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r m a b</a>
<a class="sourceLine" id="cb9-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="ot">=&gt;</span> (r <span class="ot">-&gt;</span> r) <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> r <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m b)</a>
<a class="sourceLine" id="cb9-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m b]</a>
<a class="sourceLine" id="cb9-6" title="6">_EnvT_interchange_law_natural u x f <span class="ot">=</span></a>
<a class="sourceLine" id="cb9-7" title="7"></a>
<a class="sourceLine" id="cb9-8" title="8">  [ local u x <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> ask <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> f a b))</a>
<a class="sourceLine" id="cb9-9" title="9"></a>
<a class="sourceLine" id="cb9-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb9-11" title="11"></a>
<a class="sourceLine" id="cb9-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-13" title="13">      unEnvT (local u x) r</a>
<a class="sourceLine" id="cb9-14" title="14">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT ((\a <span class="ot">-&gt;</span> ask <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> f a b)) c) r)</a>
<a class="sourceLine" id="cb9-15" title="15"></a>
<a class="sourceLine" id="cb9-16" title="16">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb9-17" title="17"></a>
<a class="sourceLine" id="cb9-18" title="18">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-19" title="19">      unEnvT (local u x) r</a>
<a class="sourceLine" id="cb9-20" title="20">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (ask <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> f c b)) r)</a>
<a class="sourceLine" id="cb9-21" title="21"></a>
<a class="sourceLine" id="cb9-22" title="22">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb9-23" title="23"></a>
<a class="sourceLine" id="cb9-24" title="24">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-25" title="25">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r2 <span class="ot">-&gt;</span> unEnvT x (u r2)) r</a>
<a class="sourceLine" id="cb9-26" title="26">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (ask <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> f c b)) r)</a>
<a class="sourceLine" id="cb9-27" title="27"></a>
<a class="sourceLine" id="cb9-28" title="28">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb9-29" title="29"></a>
<a class="sourceLine" id="cb9-30" title="30">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-31" title="31">      (\r2 <span class="ot">-&gt;</span> unEnvT x (u r2)) r</a>
<a class="sourceLine" id="cb9-32" title="32">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (ask <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> f c b)) r)</a>
<a class="sourceLine" id="cb9-33" title="33"></a>
<a class="sourceLine" id="cb9-34" title="34">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb9-35" title="35"></a>
<a class="sourceLine" id="cb9-36" title="36">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-37" title="37">      unEnvT x (u r)</a>
<a class="sourceLine" id="cb9-38" title="38">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (ask <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> f c b)) r)</a>
<a class="sourceLine" id="cb9-39" title="39"><span class="co">{-</span></a>
<a class="sourceLine" id="cb9-40" title="40"><span class="co">  -- (β-reduction)</span></a>
<a class="sourceLine" id="cb9-41" title="41"></a>
<a class="sourceLine" id="cb9-42" title="42"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-43" title="43"><span class="co">      unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-44" title="44"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT ask r)</span></a>
<a class="sourceLine" id="cb9-45" title="45"></a>
<a class="sourceLine" id="cb9-46" title="46"><span class="co">  -- (expand ask)</span></a>
<a class="sourceLine" id="cb9-47" title="47"></a>
<a class="sourceLine" id="cb9-48" title="48"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-49" title="49"><span class="co">      unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-50" title="50"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT (EnvT $ \r2 -&gt; return r2) r)</span></a>
<a class="sourceLine" id="cb9-51" title="51"></a>
<a class="sourceLine" id="cb9-52" title="52"><span class="co">  -- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb9-53" title="53"></a>
<a class="sourceLine" id="cb9-54" title="54"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-55" title="55"><span class="co">      unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-56" title="56"><span class="co">        &gt;&gt;= (\a -&gt; (\r2 -&gt; return r2) r)</span></a>
<a class="sourceLine" id="cb9-57" title="57"></a>
<a class="sourceLine" id="cb9-58" title="58"><span class="co">  -- (β-reduction)</span></a>
<a class="sourceLine" id="cb9-59" title="59"></a>
<a class="sourceLine" id="cb9-60" title="60"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-61" title="61"><span class="co">      unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-62" title="62"><span class="co">        &gt;&gt;= (\a -&gt; return r)</span></a>
<a class="sourceLine" id="cb9-63" title="63"></a>
<a class="sourceLine" id="cb9-64" title="64"><span class="co">  -- (α-reduction)</span></a>
<a class="sourceLine" id="cb9-65" title="65"></a>
<a class="sourceLine" id="cb9-66" title="66"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-67" title="67"><span class="co">      unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-68" title="68"><span class="co">        &gt;&gt;= (\c -&gt; return r)</span></a>
<a class="sourceLine" id="cb9-69" title="69"></a>
<a class="sourceLine" id="cb9-70" title="70"><span class="co">  -- (β-expansion)</span></a>
<a class="sourceLine" id="cb9-71" title="71"></a>
<a class="sourceLine" id="cb9-72" title="72"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-73" title="73"><span class="co">      (\a -&gt; unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-74" title="74"><span class="co">          &gt;&gt;= (\c -&gt; return a)) r</span></a>
<a class="sourceLine" id="cb9-75" title="75"></a>
<a class="sourceLine" id="cb9-76" title="76"><span class="co">  -- (left identity law for r)</span></a>
<a class="sourceLine" id="cb9-77" title="77"></a>
<a class="sourceLine" id="cb9-78" title="78"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-79" title="79"><span class="co">      return r</span></a>
<a class="sourceLine" id="cb9-80" title="80"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-81" title="81"><span class="co">          &gt;&gt;= (\c -&gt; return a))</span></a>
<a class="sourceLine" id="cb9-82" title="82"></a>
<a class="sourceLine" id="cb9-83" title="83"><span class="co">  -- (β-expansion)</span></a>
<a class="sourceLine" id="cb9-84" title="84"></a>
<a class="sourceLine" id="cb9-85" title="85"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-86" title="86"><span class="co">      (\r2 -&gt; return r2) r</span></a>
<a class="sourceLine" id="cb9-87" title="87"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-88" title="88"><span class="co">          &gt;&gt;= (\c -&gt; return a))</span></a>
<a class="sourceLine" id="cb9-89" title="89"></a>
<a class="sourceLine" id="cb9-90" title="90"><span class="co">  -- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb9-91" title="91"></a>
<a class="sourceLine" id="cb9-92" title="92"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-93" title="93"><span class="co">      unEnvT (EnvT $ \r2 -&gt; return r2) r</span></a>
<a class="sourceLine" id="cb9-94" title="94"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-95" title="95"><span class="co">          &gt;&gt;= (\c -&gt; return a))</span></a>
<a class="sourceLine" id="cb9-96" title="96"></a>
<a class="sourceLine" id="cb9-97" title="97"><span class="co">  -- (condense ask)</span></a>
<a class="sourceLine" id="cb9-98" title="98"></a>
<a class="sourceLine" id="cb9-99" title="99"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-100" title="100"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-101" title="101"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-102" title="102"><span class="co">          &gt;&gt;= (\c -&gt; return a))</span></a>
<a class="sourceLine" id="cb9-103" title="103"></a>
<a class="sourceLine" id="cb9-104" title="104"><span class="co">  -- (β-expansion)</span></a>
<a class="sourceLine" id="cb9-105" title="105"></a>
<a class="sourceLine" id="cb9-106" title="106"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-107" title="107"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-108" title="108"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-109" title="109"><span class="co">          &gt;&gt;= (\c -&gt; (\_ -&gt; return a) r))</span></a>
<a class="sourceLine" id="cb9-110" title="110"></a>
<a class="sourceLine" id="cb9-111" title="111"><span class="co">  -- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb9-112" title="112"></a>
<a class="sourceLine" id="cb9-113" title="113"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-114" title="114"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-115" title="115"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-116" title="116"><span class="co">          &gt;&gt;= (\c -&gt; unEnvT (EnvT $ \_ -&gt; return a) r))</span></a>
<a class="sourceLine" id="cb9-117" title="117"></a>
<a class="sourceLine" id="cb9-118" title="118"><span class="co">  -- (condense return)</span></a>
<a class="sourceLine" id="cb9-119" title="119"></a>
<a class="sourceLine" id="cb9-120" title="120"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-121" title="121"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-122" title="122"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT x (u r)</span></a>
<a class="sourceLine" id="cb9-123" title="123"><span class="co">          &gt;&gt;= (\c -&gt; unEnvT (return a) r))</span></a>
<a class="sourceLine" id="cb9-124" title="124"></a>
<a class="sourceLine" id="cb9-125" title="125"><span class="co">  -- (β-expansion)</span></a>
<a class="sourceLine" id="cb9-126" title="126"></a>
<a class="sourceLine" id="cb9-127" title="127"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-128" title="128"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-129" title="129"><span class="co">        &gt;&gt;= (\a -&gt; (\r2 -&gt; unEnvT x (u r2)) r</span></a>
<a class="sourceLine" id="cb9-130" title="130"><span class="co">          &gt;&gt;= (\c -&gt; unEnvT (return a) r))</span></a>
<a class="sourceLine" id="cb9-131" title="131"></a>
<a class="sourceLine" id="cb9-132" title="132"><span class="co">  -- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb9-133" title="133"></a>
<a class="sourceLine" id="cb9-134" title="134"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-135" title="135"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-136" title="136"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT (EnvT $ \r2 -&gt; unEnvT x (u r2)) r</span></a>
<a class="sourceLine" id="cb9-137" title="137"><span class="co">          &gt;&gt;= (\c -&gt; unEnvT (return a) r))</span></a>
<a class="sourceLine" id="cb9-138" title="138"></a>
<a class="sourceLine" id="cb9-139" title="139"><span class="co">  -- (condense local)</span></a>
<a class="sourceLine" id="cb9-140" title="140"></a>
<a class="sourceLine" id="cb9-141" title="141"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-142" title="142"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-143" title="143"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT (local u x) r</span></a>
<a class="sourceLine" id="cb9-144" title="144"><span class="co">          &gt;&gt;= (\c -&gt; unEnvT (return a) r))</span></a>
<a class="sourceLine" id="cb9-145" title="145"></a>
<a class="sourceLine" id="cb9-146" title="146"><span class="co">  -- (β-expansion)</span></a>
<a class="sourceLine" id="cb9-147" title="147"></a>
<a class="sourceLine" id="cb9-148" title="148"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-149" title="149"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-150" title="150"><span class="co">        &gt;&gt;= (\a -&gt; (\r2 -&gt; unEnvT (local u x) r2</span></a>
<a class="sourceLine" id="cb9-151" title="151"><span class="co">          &gt;&gt;= (\c -&gt; unEnvT (return a) r2)) r)</span></a>
<a class="sourceLine" id="cb9-152" title="152"></a>
<a class="sourceLine" id="cb9-153" title="153"><span class="co">  -- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb9-154" title="154"></a>
<a class="sourceLine" id="cb9-155" title="155"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-156" title="156"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-157" title="157"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT (EnvT $ \r2 -&gt; unEnvT (local u x) r2</span></a>
<a class="sourceLine" id="cb9-158" title="158"><span class="co">          &gt;&gt;= (\c -&gt; unEnvT (return a) r2)) r)</span></a>
<a class="sourceLine" id="cb9-159" title="159"></a>
<a class="sourceLine" id="cb9-160" title="160"><span class="co">  -- (β-expansion)</span></a>
<a class="sourceLine" id="cb9-161" title="161"></a>
<a class="sourceLine" id="cb9-162" title="162"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-163" title="163"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-164" title="164"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT (EnvT $ \r2 -&gt; unEnvT (local u x) r2</span></a>
<a class="sourceLine" id="cb9-165" title="165"><span class="co">          &gt;&gt;= (\c -&gt; unEnvT ((\_ -&gt; return a) c) r2)) r)</span></a>
<a class="sourceLine" id="cb9-166" title="166"></a>
<a class="sourceLine" id="cb9-167" title="167"><span class="co">  -- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb9-168" title="168"></a>
<a class="sourceLine" id="cb9-169" title="169"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-170" title="170"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-171" title="171"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT (local u x &gt;&gt;= (\_ -&gt; return a)) r)</span></a>
<a class="sourceLine" id="cb9-172" title="172"></a>
<a class="sourceLine" id="cb9-173" title="173"><span class="co">  -- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb9-174" title="174"></a>
<a class="sourceLine" id="cb9-175" title="175"><span class="co">  , EnvT $ \r -&gt;</span></a>
<a class="sourceLine" id="cb9-176" title="176"><span class="co">      unEnvT (ask @r) r</span></a>
<a class="sourceLine" id="cb9-177" title="177"><span class="co">        &gt;&gt;= (\a -&gt; unEnvT (local u x &gt;&gt; return a) r)</span></a>
<a class="sourceLine" id="cb9-178" title="178"></a>
<a class="sourceLine" id="cb9-179" title="179"><span class="co">  -- (β-expansion)</span></a>
<a class="sourceLine" id="cb9-180" title="180"><span class="co">-}</span></a>
<a class="sourceLine" id="cb9-181" title="181">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-182" title="182">      unEnvT (ask <span class="op">@</span>r) r</a>
<a class="sourceLine" id="cb9-183" title="183">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT ((\b <span class="ot">-&gt;</span> local u x <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> f a b)) c) r)</a>
<a class="sourceLine" id="cb9-184" title="184"></a>
<a class="sourceLine" id="cb9-185" title="185">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb9-186" title="186"></a>
<a class="sourceLine" id="cb9-187" title="187">  , ask <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> local u x <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> f a b))</a>
<a class="sourceLine" id="cb9-188" title="188">  ]</a></code></pre></div>
</div>
<p>Fourth: <code>EnvT r m</code> satisfies the local unit law.</p>
<div class="example">
<div class="sourceCode" id="cb10"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" title="1">_EnvT_local_unit_law_natural</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r m a</a>
<a class="sourceLine" id="cb10-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="ot">=&gt;</span> (r <span class="ot">-&gt;</span> r) <span class="ot">-&gt;</span> a</a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m a]</a>
<a class="sourceLine" id="cb10-6" title="6">_EnvT_local_unit_law_natural u a <span class="ot">=</span></a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8">  [ local u (<span class="fu">return</span> a)</a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb10-11" title="11"></a>
<a class="sourceLine" id="cb10-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-13" title="13">      unEnvT (<span class="fu">return</span> a) (u r)</a>
<a class="sourceLine" id="cb10-14" title="14"></a>
<a class="sourceLine" id="cb10-15" title="15">  <span class="co">-- (expand return)</span></a>
<a class="sourceLine" id="cb10-16" title="16"></a>
<a class="sourceLine" id="cb10-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-18" title="18">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> <span class="fu">return</span> a) (u r)</a>
<a class="sourceLine" id="cb10-19" title="19"></a>
<a class="sourceLine" id="cb10-20" title="20">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb10-21" title="21"></a>
<a class="sourceLine" id="cb10-22" title="22">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-23" title="23">      (\_ <span class="ot">-&gt;</span> <span class="fu">return</span> a) (u r)</a>
<a class="sourceLine" id="cb10-24" title="24"></a>
<a class="sourceLine" id="cb10-25" title="25">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb10-26" title="26"></a>
<a class="sourceLine" id="cb10-27" title="27">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-28" title="28">      <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb10-29" title="29"></a>
<a class="sourceLine" id="cb10-30" title="30">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb10-31" title="31"></a>
<a class="sourceLine" id="cb10-32" title="32">  , <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb10-33" title="33">  ]</a></code></pre></div>
</div>
<p>Fifth: <code>EnvT r m</code> satisfies the local bind law.</p>
<div class="example">
<div class="sourceCode" id="cb11"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" title="1">_EnvT_local_bind_law_natural</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r m a b</a>
<a class="sourceLine" id="cb11-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m )</a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="ot">=&gt;</span> (r <span class="ot">-&gt;</span> r) <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m b)</a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m b]</a>
<a class="sourceLine" id="cb11-6" title="6">_EnvT_local_bind_law_natural u x f <span class="ot">=</span></a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">  [ local u (x <span class="op">&gt;&gt;=</span> f)</a>
<a class="sourceLine" id="cb11-9" title="9"></a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb11-11" title="11"></a>
<a class="sourceLine" id="cb11-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-13" title="13">      unEnvT (x <span class="op">&gt;&gt;=</span> f) (u r)</a>
<a class="sourceLine" id="cb11-14" title="14"></a>
<a class="sourceLine" id="cb11-15" title="15">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb11-16" title="16"></a>
<a class="sourceLine" id="cb11-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-18" title="18">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r2 <span class="ot">-&gt;</span> unEnvT x r2</a>
<a class="sourceLine" id="cb11-19" title="19">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (f a) r2)) (u r)</a>
<a class="sourceLine" id="cb11-20" title="20"></a>
<a class="sourceLine" id="cb11-21" title="21">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb11-22" title="22"></a>
<a class="sourceLine" id="cb11-23" title="23">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-24" title="24">      (\r2 <span class="ot">-&gt;</span> unEnvT x r2 <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (f a) r2)) (u r)</a>
<a class="sourceLine" id="cb11-25" title="25"></a>
<a class="sourceLine" id="cb11-26" title="26">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb11-27" title="27"></a>
<a class="sourceLine" id="cb11-28" title="28">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-29" title="29">      unEnvT x (u r) <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (f a) (u r))</a>
<a class="sourceLine" id="cb11-30" title="30"></a>
<a class="sourceLine" id="cb11-31" title="31">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb11-32" title="32"></a>
<a class="sourceLine" id="cb11-33" title="33">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-34" title="34">      unEnvT x (u r)</a>
<a class="sourceLine" id="cb11-35" title="35">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> (\r2 <span class="ot">-&gt;</span> unEnvT (f a) (u r2)) r)</a>
<a class="sourceLine" id="cb11-36" title="36"></a>
<a class="sourceLine" id="cb11-37" title="37">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb11-38" title="38"></a>
<a class="sourceLine" id="cb11-39" title="39">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-40" title="40">      unEnvT x (u r)</a>
<a class="sourceLine" id="cb11-41" title="41">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r2 <span class="ot">-&gt;</span> unEnvT (f a) (u r2)) r)</a>
<a class="sourceLine" id="cb11-42" title="42"></a>
<a class="sourceLine" id="cb11-43" title="43">  <span class="co">-- (condense local)</span></a>
<a class="sourceLine" id="cb11-44" title="44"></a>
<a class="sourceLine" id="cb11-45" title="45">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-46" title="46">      unEnvT x (u r)</a>
<a class="sourceLine" id="cb11-47" title="47">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (local u (f a)) r)</a>
<a class="sourceLine" id="cb11-48" title="48"></a>
<a class="sourceLine" id="cb11-49" title="49">  <span class="co">-- (condense .)</span></a>
<a class="sourceLine" id="cb11-50" title="50"></a>
<a class="sourceLine" id="cb11-51" title="51">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-52" title="52">      unEnvT x (u r)</a>
<a class="sourceLine" id="cb11-53" title="53">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((local u <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb11-54" title="54"></a>
<a class="sourceLine" id="cb11-55" title="55">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb11-56" title="56"></a>
<a class="sourceLine" id="cb11-57" title="57">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-58" title="58">      (\r2 <span class="ot">-&gt;</span> unEnvT x (u r2)) r</a>
<a class="sourceLine" id="cb11-59" title="59">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((local u <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb11-60" title="60"></a>
<a class="sourceLine" id="cb11-61" title="61">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb11-62" title="62"></a>
<a class="sourceLine" id="cb11-63" title="63">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-64" title="64">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r2 <span class="ot">-&gt;</span> unEnvT x (u r2)) r</a>
<a class="sourceLine" id="cb11-65" title="65">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((local u <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb11-66" title="66"></a>
<a class="sourceLine" id="cb11-67" title="67">  <span class="co">-- (condense local)</span></a>
<a class="sourceLine" id="cb11-68" title="68"></a>
<a class="sourceLine" id="cb11-69" title="69">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-70" title="70">      unEnvT (local u x) r</a>
<a class="sourceLine" id="cb11-71" title="71">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((local u <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb11-72" title="72"></a>
<a class="sourceLine" id="cb11-73" title="73">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb11-74" title="74"></a>
<a class="sourceLine" id="cb11-75" title="75">  , local u x <span class="op">&gt;&gt;=</span> (local u <span class="op">.</span> f)</a>
<a class="sourceLine" id="cb11-76" title="76">  ]</a></code></pre></div>
</div>
<p>Next we show that if <code>m</code> is a lawful instance of <code>MonadReadOnly</code> with environment type <code>t</code> different from <code>r</code>, then so is <code>EnvT r m</code>.</p>
<p>First: <code>EnvT r m</code> satisfies the local/ask law:</p>
<div class="example">
<div class="sourceCode" id="cb12"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" title="1">_EnvT_local_ask_law_lifted</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m</a>
<a class="sourceLine" id="cb12-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadReadOnly</span> t m, <span class="dt">Compare</span> r t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t)</a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m t]</a>
<a class="sourceLine" id="cb12-6" title="6">_EnvT_local_ask_law_lifted u <span class="ot">=</span></a>
<a class="sourceLine" id="cb12-7" title="7"></a>
<a class="sourceLine" id="cb12-8" title="8">  [ local u ask</a>
<a class="sourceLine" id="cb12-9" title="9"></a>
<a class="sourceLine" id="cb12-10" title="10">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb12-11" title="11"></a>
<a class="sourceLine" id="cb12-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-13" title="13">      local u (unEnvT ask r)</a>
<a class="sourceLine" id="cb12-14" title="14"></a>
<a class="sourceLine" id="cb12-15" title="15">  <span class="co">-- (expand ask)</span></a>
<a class="sourceLine" id="cb12-16" title="16"></a>
<a class="sourceLine" id="cb12-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-18" title="18">      local u (unEnvT (lift ask) r)</a>
<a class="sourceLine" id="cb12-19" title="19"></a>
<a class="sourceLine" id="cb12-20" title="20">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb12-21" title="21"></a>
<a class="sourceLine" id="cb12-22" title="22">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-23" title="23">      local u (unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> ask) r)</a>
<a class="sourceLine" id="cb12-24" title="24"></a>
<a class="sourceLine" id="cb12-25" title="25">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb12-26" title="26"></a>
<a class="sourceLine" id="cb12-27" title="27">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-28" title="28">      local u ((\_ <span class="ot">-&gt;</span> ask) r)</a>
<a class="sourceLine" id="cb12-29" title="29"></a>
<a class="sourceLine" id="cb12-30" title="30">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb12-31" title="31"></a>
<a class="sourceLine" id="cb12-32" title="32">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-33" title="33">      local u ask</a>
<a class="sourceLine" id="cb12-34" title="34"></a>
<a class="sourceLine" id="cb12-35" title="35">  <span class="co">-- (local/ask law in m)</span></a>
<a class="sourceLine" id="cb12-36" title="36"></a>
<a class="sourceLine" id="cb12-37" title="37">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb12-38" title="38">      <span class="fu">fmap</span> u ask</a>
<a class="sourceLine" id="cb12-39" title="39"></a>
<a class="sourceLine" id="cb12-40" title="40">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb12-41" title="41"></a>
<a class="sourceLine" id="cb12-42" title="42">  , lift (<span class="fu">fmap</span> u ask)</a>
<a class="sourceLine" id="cb12-43" title="43"></a>
<a class="sourceLine" id="cb12-44" title="44">  <span class="co">-- (lift/fmap)</span></a>
<a class="sourceLine" id="cb12-45" title="45"></a>
<a class="sourceLine" id="cb12-46" title="46">  , <span class="fu">fmap</span> u (lift ask)</a>
<a class="sourceLine" id="cb12-47" title="47"></a>
<a class="sourceLine" id="cb12-48" title="48">  <span class="co">-- (condense ask)</span></a>
<a class="sourceLine" id="cb12-49" title="49"></a>
<a class="sourceLine" id="cb12-50" title="50">  , <span class="fu">fmap</span> u ask</a>
<a class="sourceLine" id="cb12-51" title="51">  ]</a></code></pre></div>
</div>
<p>Second: <code>EnvT r m</code> satisfies the local/local law.</p>
<div class="example">
<div class="sourceCode" id="cb13"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" title="1">_EnvT_local_local_law_lifted</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m a</a>
<a class="sourceLine" id="cb13-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadReadOnly</span> t m, <span class="dt">Compare</span> r t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t) <span class="ot">-&gt;</span> (t <span class="ot">-&gt;</span> t) <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m a</a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m a]</a>
<a class="sourceLine" id="cb13-6" title="6">_EnvT_local_local_law_lifted u v x <span class="ot">=</span></a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8">  [ local u (local v x)</a>
<a class="sourceLine" id="cb13-9" title="9"></a>
<a class="sourceLine" id="cb13-10" title="10">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb13-11" title="11"></a>
<a class="sourceLine" id="cb13-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-13" title="13">      local u (unEnvT (local v x) r)</a>
<a class="sourceLine" id="cb13-14" title="14"></a>
<a class="sourceLine" id="cb13-15" title="15">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb13-16" title="16"></a>
<a class="sourceLine" id="cb13-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-18" title="18">      local u (unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r1 <span class="ot">-&gt;</span> local v (unEnvT x r1)) r)</a>
<a class="sourceLine" id="cb13-19" title="19"></a>
<a class="sourceLine" id="cb13-20" title="20">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb13-21" title="21"></a>
<a class="sourceLine" id="cb13-22" title="22">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-23" title="23">      local u ((\r1 <span class="ot">-&gt;</span> local v (unEnvT x r1)) r)</a>
<a class="sourceLine" id="cb13-24" title="24"></a>
<a class="sourceLine" id="cb13-25" title="25">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-26" title="26"></a>
<a class="sourceLine" id="cb13-27" title="27">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-28" title="28">      local u (local v (unEnvT x r))</a>
<a class="sourceLine" id="cb13-29" title="29"></a>
<a class="sourceLine" id="cb13-30" title="30">  <span class="co">-- (local/local law in m)</span></a>
<a class="sourceLine" id="cb13-31" title="31"></a>
<a class="sourceLine" id="cb13-32" title="32">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-33" title="33">      local (v <span class="op">.</span> u) (unEnvT x r)</a>
<a class="sourceLine" id="cb13-34" title="34"></a>
<a class="sourceLine" id="cb13-35" title="35">  <span class="co">-- (condense local)</span></a>
<a class="sourceLine" id="cb13-36" title="36"></a>
<a class="sourceLine" id="cb13-37" title="37">  , local (v <span class="op">.</span> u) x</a>
<a class="sourceLine" id="cb13-38" title="38">  ]</a></code></pre></div>
</div>
<p>Third: <code>EnvT r m</code> satisfies the interchange law.</p>
<div class="example">
<div class="sourceCode" id="cb14"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" title="1">_EnvT_interchange_law_lifted</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m a</a>
<a class="sourceLine" id="cb14-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadReadOnly</span> t m, <span class="dt">Compare</span> r t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t) <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m a</a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m t]</a>
<a class="sourceLine" id="cb14-6" title="6">_EnvT_interchange_law_lifted u x <span class="ot">=</span></a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8">  [ local u x <span class="op">&gt;&gt;</span> ask</a>
<a class="sourceLine" id="cb14-9" title="9"></a>
<a class="sourceLine" id="cb14-10" title="10">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb14-11" title="11"></a>
<a class="sourceLine" id="cb14-12" title="12">  , local u x <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> ask)</a>
<a class="sourceLine" id="cb14-13" title="13"></a>
<a class="sourceLine" id="cb14-14" title="14">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb14-15" title="15"></a>
<a class="sourceLine" id="cb14-16" title="16">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-17" title="17">      unEnvT (local u x) r</a>
<a class="sourceLine" id="cb14-18" title="18">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> ask) a) r)</a>
<a class="sourceLine" id="cb14-19" title="19"></a>
<a class="sourceLine" id="cb14-20" title="20">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb14-21" title="21"></a>
<a class="sourceLine" id="cb14-22" title="22">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-23" title="23">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r1 <span class="ot">-&gt;</span> local u (unEnvT x r1)) r</a>
<a class="sourceLine" id="cb14-24" title="24">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> ask) a) r)</a>
<a class="sourceLine" id="cb14-25" title="25"></a>
<a class="sourceLine" id="cb14-26" title="26">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb14-27" title="27"></a>
<a class="sourceLine" id="cb14-28" title="28">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-29" title="29">      (\r1 <span class="ot">-&gt;</span> local u (unEnvT x r1)) r</a>
<a class="sourceLine" id="cb14-30" title="30">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> ask) a) r)</a>
<a class="sourceLine" id="cb14-31" title="31"></a>
<a class="sourceLine" id="cb14-32" title="32">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb14-33" title="33"></a>
<a class="sourceLine" id="cb14-34" title="34">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-35" title="35">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-36" title="36">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> ask) a) r)</a>
<a class="sourceLine" id="cb14-37" title="37"></a>
<a class="sourceLine" id="cb14-38" title="38">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb14-39" title="39"></a>
<a class="sourceLine" id="cb14-40" title="40">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-41" title="41">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-42" title="42">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ask r)</a>
<a class="sourceLine" id="cb14-43" title="43"></a>
<a class="sourceLine" id="cb14-44" title="44">  <span class="co">-- (expand ask)</span></a>
<a class="sourceLine" id="cb14-45" title="45"></a>
<a class="sourceLine" id="cb14-46" title="46">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-47" title="47">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-48" title="48">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (lift ask) r)</a>
<a class="sourceLine" id="cb14-49" title="49"></a>
<a class="sourceLine" id="cb14-50" title="50">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb14-51" title="51"></a>
<a class="sourceLine" id="cb14-52" title="52">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-53" title="53">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-54" title="54">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> ask) r)</a>
<a class="sourceLine" id="cb14-55" title="55"></a>
<a class="sourceLine" id="cb14-56" title="56">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb14-57" title="57"></a>
<a class="sourceLine" id="cb14-58" title="58">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-59" title="59">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-60" title="60">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> (\_ <span class="ot">-&gt;</span> ask) r)</a>
<a class="sourceLine" id="cb14-61" title="61"></a>
<a class="sourceLine" id="cb14-62" title="62">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb14-63" title="63"></a>
<a class="sourceLine" id="cb14-64" title="64">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-65" title="65">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-66" title="66">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> ask)</a>
<a class="sourceLine" id="cb14-67" title="67"></a>
<a class="sourceLine" id="cb14-68" title="68">  <span class="co">-- (α-equivalence)</span></a>
<a class="sourceLine" id="cb14-69" title="69"></a>
<a class="sourceLine" id="cb14-70" title="70">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-71" title="71">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-72" title="72">        <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> ask)</a>
<a class="sourceLine" id="cb14-73" title="73"></a>
<a class="sourceLine" id="cb14-74" title="74">  <span class="co">-- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb14-75" title="75"></a>
<a class="sourceLine" id="cb14-76" title="76">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-77" title="77">      local u (unEnvT x r) <span class="op">&gt;&gt;</span> ask</a>
<a class="sourceLine" id="cb14-78" title="78"></a>
<a class="sourceLine" id="cb14-79" title="79">  <span class="co">-- (interchange law in m)</span></a>
<a class="sourceLine" id="cb14-80" title="80"></a>
<a class="sourceLine" id="cb14-81" title="81">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-82" title="82">      ask <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> local u (unEnvT x r) <span class="op">&gt;&gt;</span> <span class="fu">return</span> c)</a>
<a class="sourceLine" id="cb14-83" title="83"></a>
<a class="sourceLine" id="cb14-84" title="84">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb14-85" title="85"></a>
<a class="sourceLine" id="cb14-86" title="86">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-87" title="87">      ask</a>
<a class="sourceLine" id="cb14-88" title="88">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-89" title="89">          local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-90" title="90">            <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c))</a>
<a class="sourceLine" id="cb14-91" title="91"></a>
<a class="sourceLine" id="cb14-92" title="92">  <span class="co">-- (α-equivalence)</span></a>
<a class="sourceLine" id="cb14-93" title="93"></a>
<a class="sourceLine" id="cb14-94" title="94">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-95" title="95">      ask</a>
<a class="sourceLine" id="cb14-96" title="96">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-97" title="97">          local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-98" title="98">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> c))</a>
<a class="sourceLine" id="cb14-99" title="99"></a>
<a class="sourceLine" id="cb14-100" title="100">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb14-101" title="101"></a>
<a class="sourceLine" id="cb14-102" title="102">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-103" title="103">      ask</a>
<a class="sourceLine" id="cb14-104" title="104">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-105" title="105">          local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-106" title="106">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> (\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c) r))</a>
<a class="sourceLine" id="cb14-107" title="107"></a>
<a class="sourceLine" id="cb14-108" title="108">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb14-109" title="109"></a>
<a class="sourceLine" id="cb14-110" title="110">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-111" title="111">      ask</a>
<a class="sourceLine" id="cb14-112" title="112">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-113" title="113">          local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-114" title="114">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> <span class="fu">return</span> c) r))</a>
<a class="sourceLine" id="cb14-115" title="115"></a>
<a class="sourceLine" id="cb14-116" title="116">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb14-117" title="117"></a>
<a class="sourceLine" id="cb14-118" title="118">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-119" title="119">      ask</a>
<a class="sourceLine" id="cb14-120" title="120">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-121" title="121">          local u (unEnvT x r)</a>
<a class="sourceLine" id="cb14-122" title="122">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="fu">return</span> c) r))</a>
<a class="sourceLine" id="cb14-123" title="123"></a>
<a class="sourceLine" id="cb14-124" title="124">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb14-125" title="125"></a>
<a class="sourceLine" id="cb14-126" title="126">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-127" title="127">      ask</a>
<a class="sourceLine" id="cb14-128" title="128">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-129" title="129">          (\r1 <span class="ot">-&gt;</span> local u (unEnvT x r1)) r</a>
<a class="sourceLine" id="cb14-130" title="130">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="fu">return</span> c) r))</a>
<a class="sourceLine" id="cb14-131" title="131"></a>
<a class="sourceLine" id="cb14-132" title="132">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb14-133" title="133"></a>
<a class="sourceLine" id="cb14-134" title="134">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-135" title="135">      ask</a>
<a class="sourceLine" id="cb14-136" title="136">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-137" title="137">          unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r1 <span class="ot">-&gt;</span> local u (unEnvT x r1)) r</a>
<a class="sourceLine" id="cb14-138" title="138">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="fu">return</span> c) r))</a>
<a class="sourceLine" id="cb14-139" title="139"></a>
<a class="sourceLine" id="cb14-140" title="140">  <span class="co">-- (condense local)</span></a>
<a class="sourceLine" id="cb14-141" title="141"></a>
<a class="sourceLine" id="cb14-142" title="142">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-143" title="143">      ask</a>
<a class="sourceLine" id="cb14-144" title="144">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-145" title="145">          unEnvT (local u x) r</a>
<a class="sourceLine" id="cb14-146" title="146">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="fu">return</span> c) r))</a>
<a class="sourceLine" id="cb14-147" title="147"></a>
<a class="sourceLine" id="cb14-148" title="148">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb14-149" title="149"></a>
<a class="sourceLine" id="cb14-150" title="150">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-151" title="151">      ask</a>
<a class="sourceLine" id="cb14-152" title="152">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-153" title="153">          unEnvT (local u x) r</a>
<a class="sourceLine" id="cb14-154" title="154">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c) a) r))</a>
<a class="sourceLine" id="cb14-155" title="155"></a>
<a class="sourceLine" id="cb14-156" title="156">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb14-157" title="157"></a>
<a class="sourceLine" id="cb14-158" title="158">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-159" title="159">      (\_ <span class="ot">-&gt;</span> ask) r</a>
<a class="sourceLine" id="cb14-160" title="160">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-161" title="161">          unEnvT (local u x) r</a>
<a class="sourceLine" id="cb14-162" title="162">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c) a) r))</a>
<a class="sourceLine" id="cb14-163" title="163"></a>
<a class="sourceLine" id="cb14-164" title="164">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb14-165" title="165"></a>
<a class="sourceLine" id="cb14-166" title="166">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-167" title="167">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> ask) r</a>
<a class="sourceLine" id="cb14-168" title="168">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-169" title="169">          unEnvT (local u x) r</a>
<a class="sourceLine" id="cb14-170" title="170">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c) a) r))</a>
<a class="sourceLine" id="cb14-171" title="171"></a>
<a class="sourceLine" id="cb14-172" title="172">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb14-173" title="173"></a>
<a class="sourceLine" id="cb14-174" title="174">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-175" title="175">      unEnvT (lift ask) r</a>
<a class="sourceLine" id="cb14-176" title="176">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-177" title="177">          unEnvT (local u x) r</a>
<a class="sourceLine" id="cb14-178" title="178">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c) a) r))</a>
<a class="sourceLine" id="cb14-179" title="179"></a>
<a class="sourceLine" id="cb14-180" title="180">  <span class="co">-- (condense ask)</span></a>
<a class="sourceLine" id="cb14-181" title="181"></a>
<a class="sourceLine" id="cb14-182" title="182">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-183" title="183">      unEnvT ask r</a>
<a class="sourceLine" id="cb14-184" title="184">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-185" title="185">          unEnvT (local u x) r</a>
<a class="sourceLine" id="cb14-186" title="186">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c) a) r))</a>
<a class="sourceLine" id="cb14-187" title="187"></a>
<a class="sourceLine" id="cb14-188" title="188">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb14-189" title="189"></a>
<a class="sourceLine" id="cb14-190" title="190">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-191" title="191">      unEnvT ask r</a>
<a class="sourceLine" id="cb14-192" title="192">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> (\r1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-193" title="193">          unEnvT (local u x) r1</a>
<a class="sourceLine" id="cb14-194" title="194">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c) a) r1)) r)</a>
<a class="sourceLine" id="cb14-195" title="195"></a>
<a class="sourceLine" id="cb14-196" title="196">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb14-197" title="197"></a>
<a class="sourceLine" id="cb14-198" title="198">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-199" title="199">      unEnvT ask r</a>
<a class="sourceLine" id="cb14-200" title="200">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-201" title="201">          unEnvT (local u x) r1</a>
<a class="sourceLine" id="cb14-202" title="202">            <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c) a) r1)) r)</a>
<a class="sourceLine" id="cb14-203" title="203"></a>
<a class="sourceLine" id="cb14-204" title="204">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb14-205" title="205"></a>
<a class="sourceLine" id="cb14-206" title="206">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-207" title="207">      unEnvT ask r</a>
<a class="sourceLine" id="cb14-208" title="208">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (local u x <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> <span class="fu">return</span> c)) r)</a>
<a class="sourceLine" id="cb14-209" title="209"></a>
<a class="sourceLine" id="cb14-210" title="210">  <span class="co">-- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb14-211" title="211"></a>
<a class="sourceLine" id="cb14-212" title="212">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-213" title="213">      unEnvT ask r</a>
<a class="sourceLine" id="cb14-214" title="214">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (local u x <span class="op">&gt;&gt;</span> <span class="fu">return</span> c) r)</a>
<a class="sourceLine" id="cb14-215" title="215"></a>
<a class="sourceLine" id="cb14-216" title="216">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb14-217" title="217"></a>
<a class="sourceLine" id="cb14-218" title="218">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb14-219" title="219">      unEnvT ask r</a>
<a class="sourceLine" id="cb14-220" title="220">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT ((\a <span class="ot">-&gt;</span> local u x <span class="op">&gt;&gt;</span> <span class="fu">return</span> a) c) r)</a>
<a class="sourceLine" id="cb14-221" title="221"></a>
<a class="sourceLine" id="cb14-222" title="222">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb14-223" title="223"></a>
<a class="sourceLine" id="cb14-224" title="224">  , ask <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> local u x <span class="op">&gt;&gt;</span> <span class="fu">return</span> a)</a>
<a class="sourceLine" id="cb14-225" title="225">  ]</a></code></pre></div>
</div>
<p>Fourth: <code>EnvT r m</code> satisfies the local unit law.</p>
<div class="example">
<div class="sourceCode" id="cb15"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" title="1">_EnvT_local_unit_law_lifted</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m a</a>
<a class="sourceLine" id="cb15-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadReadOnly</span> t m, <span class="dt">Compare</span> r t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t) <span class="ot">-&gt;</span> a</a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m a]</a>
<a class="sourceLine" id="cb15-6" title="6">_EnvT_local_unit_law_lifted u a <span class="ot">=</span></a>
<a class="sourceLine" id="cb15-7" title="7"></a>
<a class="sourceLine" id="cb15-8" title="8">  [ local u (<span class="fu">return</span> a)</a>
<a class="sourceLine" id="cb15-9" title="9"></a>
<a class="sourceLine" id="cb15-10" title="10">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb15-11" title="11"></a>
<a class="sourceLine" id="cb15-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb15-13" title="13">      local u (unEnvT (<span class="fu">return</span> a) r)</a>
<a class="sourceLine" id="cb15-14" title="14"></a>
<a class="sourceLine" id="cb15-15" title="15">  <span class="co">-- (expand return)</span></a>
<a class="sourceLine" id="cb15-16" title="16"></a>
<a class="sourceLine" id="cb15-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb15-18" title="18">      local u (unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> <span class="fu">return</span> a) r)</a>
<a class="sourceLine" id="cb15-19" title="19"></a>
<a class="sourceLine" id="cb15-20" title="20">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb15-21" title="21"></a>
<a class="sourceLine" id="cb15-22" title="22">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb15-23" title="23">      local u ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> a) r)</a>
<a class="sourceLine" id="cb15-24" title="24"></a>
<a class="sourceLine" id="cb15-25" title="25">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb15-26" title="26"></a>
<a class="sourceLine" id="cb15-27" title="27">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb15-28" title="28">      local u (<span class="fu">return</span> a)</a>
<a class="sourceLine" id="cb15-29" title="29"></a>
<a class="sourceLine" id="cb15-30" title="30">  <span class="co">-- (local unit law in m)</span></a>
<a class="sourceLine" id="cb15-31" title="31"></a>
<a class="sourceLine" id="cb15-32" title="32">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb15-33" title="33">      <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb15-34" title="34"></a>
<a class="sourceLine" id="cb15-35" title="35">  <span class="co">-- (α-equivalence)</span></a>
<a class="sourceLine" id="cb15-36" title="36"></a>
<a class="sourceLine" id="cb15-37" title="37">  , <span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb15-38" title="38">      <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb15-39" title="39"></a>
<a class="sourceLine" id="cb15-40" title="40">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb15-41" title="41"></a>
<a class="sourceLine" id="cb15-42" title="42">  , <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb15-43" title="43">  ]</a></code></pre></div>
</div>
<p>Fifth: <code>EnvT r m</code> satisfies the local bind law.</p>
<div class="example">
<div class="sourceCode" id="cb16"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" title="1">_EnvT_local_bind_law_lifted</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m a b</a>
<a class="sourceLine" id="cb16-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadReadOnly</span> t m, <span class="dt">Compare</span> r t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t) <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m b)</a>
<a class="sourceLine" id="cb16-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m b]</a>
<a class="sourceLine" id="cb16-6" title="6">_EnvT_local_bind_law_lifted u x f <span class="ot">=</span></a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8">  [ local u (x <span class="op">&gt;&gt;=</span> f)</a>
<a class="sourceLine" id="cb16-9" title="9"></a>
<a class="sourceLine" id="cb16-10" title="10">  <span class="co">-- (expand local)</span></a>
<a class="sourceLine" id="cb16-11" title="11"></a>
<a class="sourceLine" id="cb16-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-13" title="13">      local u (unEnvT (x <span class="op">&gt;&gt;=</span> f) r)</a>
<a class="sourceLine" id="cb16-14" title="14"></a>
<a class="sourceLine" id="cb16-15" title="15">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb16-16" title="16"></a>
<a class="sourceLine" id="cb16-17" title="17">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-18" title="18">      local u (unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r1 <span class="ot">-&gt;</span> unEnvT x r1</a>
<a class="sourceLine" id="cb16-19" title="19">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (f a) r1)) r)</a>
<a class="sourceLine" id="cb16-20" title="20"></a>
<a class="sourceLine" id="cb16-21" title="21">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb16-22" title="22"></a>
<a class="sourceLine" id="cb16-23" title="23">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-24" title="24">      local u ((\r1 <span class="ot">-&gt;</span> unEnvT x r1</a>
<a class="sourceLine" id="cb16-25" title="25">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (f a) r1)) r)</a>
<a class="sourceLine" id="cb16-26" title="26"></a>
<a class="sourceLine" id="cb16-27" title="27">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb16-28" title="28"></a>
<a class="sourceLine" id="cb16-29" title="29">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-30" title="30">      local u (unEnvT x r</a>
<a class="sourceLine" id="cb16-31" title="31">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (f a) r))</a>
<a class="sourceLine" id="cb16-32" title="32"></a>
<a class="sourceLine" id="cb16-33" title="33">  <span class="co">-- (local bind law in m)</span></a>
<a class="sourceLine" id="cb16-34" title="34"></a>
<a class="sourceLine" id="cb16-35" title="35">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-36" title="36">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb16-37" title="37">        <span class="op">&gt;&gt;=</span> (local u <span class="op">.</span> (\a <span class="ot">-&gt;</span> unEnvT (f a) r))</a>
<a class="sourceLine" id="cb16-38" title="38"></a>
<a class="sourceLine" id="cb16-39" title="39">  <span class="co">-- (α-conversion)</span></a>
<a class="sourceLine" id="cb16-40" title="40"></a>
<a class="sourceLine" id="cb16-41" title="41">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-42" title="42">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb16-43" title="43">        <span class="op">&gt;&gt;=</span> (local u <span class="op">.</span> (\c <span class="ot">-&gt;</span> unEnvT (f c) r))</a>
<a class="sourceLine" id="cb16-44" title="44"></a>
<a class="sourceLine" id="cb16-45" title="45">  <span class="co">-- (η-expansion)</span></a>
<a class="sourceLine" id="cb16-46" title="46"></a>
<a class="sourceLine" id="cb16-47" title="47">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-48" title="48">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb16-49" title="49">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> (local u <span class="op">.</span> (\c <span class="ot">-&gt;</span> unEnvT (f c) r)) a)</a>
<a class="sourceLine" id="cb16-50" title="50"></a>
<a class="sourceLine" id="cb16-51" title="51">  <span class="co">-- (expand .)</span></a>
<a class="sourceLine" id="cb16-52" title="52"></a>
<a class="sourceLine" id="cb16-53" title="53">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-54" title="54">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb16-55" title="55">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> local u ((\c <span class="ot">-&gt;</span> unEnvT (f c) r) a))</a>
<a class="sourceLine" id="cb16-56" title="56"></a>
<a class="sourceLine" id="cb16-57" title="57">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb16-58" title="58"></a>
<a class="sourceLine" id="cb16-59" title="59">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-60" title="60">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb16-61" title="61">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> local u (unEnvT (f a) r))</a>
<a class="sourceLine" id="cb16-62" title="62"></a>
<a class="sourceLine" id="cb16-63" title="63">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb16-64" title="64"></a>
<a class="sourceLine" id="cb16-65" title="65">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-66" title="66">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb16-67" title="67">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> (\r1 <span class="ot">-&gt;</span> local u (unEnvT (f a) r1)) r)</a>
<a class="sourceLine" id="cb16-68" title="68"></a>
<a class="sourceLine" id="cb16-69" title="69">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb16-70" title="70"></a>
<a class="sourceLine" id="cb16-71" title="71">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-72" title="72">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb16-73" title="73">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r1 <span class="ot">-&gt;</span> local u (unEnvT (f a) r1)) r)</a>
<a class="sourceLine" id="cb16-74" title="74"></a>
<a class="sourceLine" id="cb16-75" title="75">  <span class="co">-- (condense local)</span></a>
<a class="sourceLine" id="cb16-76" title="76"></a>
<a class="sourceLine" id="cb16-77" title="77">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-78" title="78">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb16-79" title="79">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (local u (f a)) r)</a>
<a class="sourceLine" id="cb16-80" title="80"></a>
<a class="sourceLine" id="cb16-81" title="81">  <span class="co">-- (condense .)</span></a>
<a class="sourceLine" id="cb16-82" title="82"></a>
<a class="sourceLine" id="cb16-83" title="83">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-84" title="84">      local u (unEnvT x r)</a>
<a class="sourceLine" id="cb16-85" title="85">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((local u <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb16-86" title="86"></a>
<a class="sourceLine" id="cb16-87" title="87">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb16-88" title="88"></a>
<a class="sourceLine" id="cb16-89" title="89">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-90" title="90">      (\r1 <span class="ot">-&gt;</span> local u (unEnvT x r1)) r</a>
<a class="sourceLine" id="cb16-91" title="91">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((local u <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb16-92" title="92"></a>
<a class="sourceLine" id="cb16-93" title="93">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb16-94" title="94"></a>
<a class="sourceLine" id="cb16-95" title="95">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-96" title="96">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r1 <span class="ot">-&gt;</span> local u (unEnvT x r1)) r</a>
<a class="sourceLine" id="cb16-97" title="97">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((local u <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb16-98" title="98"></a>
<a class="sourceLine" id="cb16-99" title="99">  <span class="co">-- (condense local)</span></a>
<a class="sourceLine" id="cb16-100" title="100"></a>
<a class="sourceLine" id="cb16-101" title="101">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-102" title="102">      unEnvT (local u x) r</a>
<a class="sourceLine" id="cb16-103" title="103">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((local u <span class="op">.</span> f) a) r)</a>
<a class="sourceLine" id="cb16-104" title="104"></a>
<a class="sourceLine" id="cb16-105" title="105">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb16-106" title="106"></a>
<a class="sourceLine" id="cb16-107" title="107">  , local u x <span class="op">&gt;&gt;=</span> (local u <span class="op">.</span> f)</a>
<a class="sourceLine" id="cb16-108" title="108">  ]</a></code></pre></div>
</div>
</section>
<section class="level2">
<h2>MonadReadWrite Laws</h2>
<p><a name='crossref-3'></a></p>
<p>There is a <code>MonadReadWrite</code> instance for <code>EnvT r m</code> that we need to verify. Recall the laws for <a href="../../../Monad.html#crossref-0"><code>MonadReadWrite</code></a>:</p>
<dl>
<dt>Put/Put Law</dt>
<dd><code>put u1 &gt;&gt; put u2</code> is equivalent to <code>put u2</code>
</dd>
<dt>Put/Get Law</dt>
<dd><code>put u &gt;&gt; get</code> is equivalent to <code>put u &gt;&gt; return u</code>
</dd>
<dt>Get/Put Law</dt>
<dd><code>get &gt;&gt;= put</code> is equivalent to <code>return ()</code>
</dd>
<dt>Get/Get Law</dt>
<dd><code>get &gt;&gt;= (\u -&gt; get &gt;&gt;= k u)</code> is equivalent to <code>get &gt;&gt;= (\u -&gt; k u u)</code>
</dd>
</dl>
<p>Here we show that if <code>m</code> is an instance of <code>MonadReadWrite</code> with state <code>s</code>, then so is <code>EnvT r m</code>.</p>
<p>First: <code>EnvT s m</code> satisfies the put/put law:</p>
<div class="example">
<div class="sourceCode" id="cb17"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" title="1">_EnvT_put_put_law_lifted</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb17-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadReadWrite</span> t m )</a>
<a class="sourceLine" id="cb17-4" title="4">  <span class="ot">=&gt;</span> t <span class="ot">-&gt;</span> t</a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> s m ()]</a>
<a class="sourceLine" id="cb17-6" title="6">_EnvT_put_put_law_lifted u1 u2 <span class="ot">=</span></a>
<a class="sourceLine" id="cb17-7" title="7"></a>
<a class="sourceLine" id="cb17-8" title="8">  [ put u1 <span class="op">&gt;&gt;</span> put u2</a>
<a class="sourceLine" id="cb17-9" title="9"></a>
<a class="sourceLine" id="cb17-10" title="10">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb17-11" title="11"></a>
<a class="sourceLine" id="cb17-12" title="12">  , put u1 <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> put u2)</a>
<a class="sourceLine" id="cb17-13" title="13"></a>
<a class="sourceLine" id="cb17-14" title="14">  <span class="co">-- (condense const)</span></a>
<a class="sourceLine" id="cb17-15" title="15"></a>
<a class="sourceLine" id="cb17-16" title="16">  , put u1 <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (put u2)</a>
<a class="sourceLine" id="cb17-17" title="17"></a>
<a class="sourceLine" id="cb17-18" title="18">  <span class="co">-- (expand put)</span></a>
<a class="sourceLine" id="cb17-19" title="19"></a>
<a class="sourceLine" id="cb17-20" title="20">  , lift (put u1) <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (lift (put u2))</a>
<a class="sourceLine" id="cb17-21" title="21"></a>
<a class="sourceLine" id="cb17-22" title="22">  <span class="co">-- (property of const)</span></a>
<a class="sourceLine" id="cb17-23" title="23"></a>
<a class="sourceLine" id="cb17-24" title="24">  , lift (put u1) <span class="op">&gt;&gt;=</span> lift <span class="op">.</span> <span class="fu">const</span> (put u2)</a>
<a class="sourceLine" id="cb17-25" title="25"></a>
<a class="sourceLine" id="cb17-26" title="26">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb17-27" title="27"></a>
<a class="sourceLine" id="cb17-28" title="28">  , lift (put u1 <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (put u2))</a>
<a class="sourceLine" id="cb17-29" title="29"></a>
<a class="sourceLine" id="cb17-30" title="30">  <span class="co">-- (expand const)</span></a>
<a class="sourceLine" id="cb17-31" title="31"></a>
<a class="sourceLine" id="cb17-32" title="32">  , lift (put u1 <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> put u2))</a>
<a class="sourceLine" id="cb17-33" title="33"></a>
<a class="sourceLine" id="cb17-34" title="34">  <span class="co">-- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb17-35" title="35"></a>
<a class="sourceLine" id="cb17-36" title="36">  , lift (put u1 <span class="op">&gt;&gt;</span> put u2)</a>
<a class="sourceLine" id="cb17-37" title="37"></a>
<a class="sourceLine" id="cb17-38" title="38">  <span class="co">-- (put/put law in m)</span></a>
<a class="sourceLine" id="cb17-39" title="39"></a>
<a class="sourceLine" id="cb17-40" title="40">  , lift (put u2)</a>
<a class="sourceLine" id="cb17-41" title="41"></a>
<a class="sourceLine" id="cb17-42" title="42">  <span class="co">-- (condense put)</span></a>
<a class="sourceLine" id="cb17-43" title="43"></a>
<a class="sourceLine" id="cb17-44" title="44">  , put u2</a>
<a class="sourceLine" id="cb17-45" title="45">  ]</a></code></pre></div>
</div>
<p>Second: <code>EnvT s m</code> satisfies the put/get law:</p>
<div class="example">
<div class="sourceCode" id="cb18"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" title="1">_EnvT_put_get_law_lifted</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb18-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadReadWrite</span> t m )</a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="ot">=&gt;</span> t</a>
<a class="sourceLine" id="cb18-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> s m t]</a>
<a class="sourceLine" id="cb18-6" title="6">_EnvT_put_get_law_lifted u <span class="ot">=</span></a>
<a class="sourceLine" id="cb18-7" title="7"></a>
<a class="sourceLine" id="cb18-8" title="8">  [ put u <span class="op">&gt;&gt;</span> get</a>
<a class="sourceLine" id="cb18-9" title="9"></a>
<a class="sourceLine" id="cb18-10" title="10">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb18-11" title="11"></a>
<a class="sourceLine" id="cb18-12" title="12">  , put u <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> get)</a>
<a class="sourceLine" id="cb18-13" title="13"></a>
<a class="sourceLine" id="cb18-14" title="14">  <span class="co">-- (condense const)</span></a>
<a class="sourceLine" id="cb18-15" title="15"></a>
<a class="sourceLine" id="cb18-16" title="16">  , put u <span class="op">&gt;&gt;=</span> <span class="fu">const</span> get</a>
<a class="sourceLine" id="cb18-17" title="17"></a>
<a class="sourceLine" id="cb18-18" title="18">  <span class="co">-- (expand put and get)</span></a>
<a class="sourceLine" id="cb18-19" title="19"></a>
<a class="sourceLine" id="cb18-20" title="20">  , lift (put u) <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (lift get)</a>
<a class="sourceLine" id="cb18-21" title="21"></a>
<a class="sourceLine" id="cb18-22" title="22">  <span class="co">-- (property of const)</span></a>
<a class="sourceLine" id="cb18-23" title="23"></a>
<a class="sourceLine" id="cb18-24" title="24">  , lift (put u) <span class="op">&gt;&gt;=</span> lift <span class="op">.</span> <span class="fu">const</span> get</a>
<a class="sourceLine" id="cb18-25" title="25"></a>
<a class="sourceLine" id="cb18-26" title="26">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb18-27" title="27"></a>
<a class="sourceLine" id="cb18-28" title="28">  , lift (put u <span class="op">&gt;&gt;=</span> <span class="fu">const</span> get)</a>
<a class="sourceLine" id="cb18-29" title="29"></a>
<a class="sourceLine" id="cb18-30" title="30">  <span class="co">-- (expand const)</span></a>
<a class="sourceLine" id="cb18-31" title="31"></a>
<a class="sourceLine" id="cb18-32" title="32">  , lift (put u <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> get))</a>
<a class="sourceLine" id="cb18-33" title="33"></a>
<a class="sourceLine" id="cb18-34" title="34">  <span class="co">-- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb18-35" title="35"></a>
<a class="sourceLine" id="cb18-36" title="36">  , lift (put u <span class="op">&gt;&gt;</span> get)</a>
<a class="sourceLine" id="cb18-37" title="37"></a>
<a class="sourceLine" id="cb18-38" title="38">  <span class="co">-- (put/get law in m)</span></a>
<a class="sourceLine" id="cb18-39" title="39"></a>
<a class="sourceLine" id="cb18-40" title="40">  , lift (<span class="fu">return</span> u)</a>
<a class="sourceLine" id="cb18-41" title="41"></a>
<a class="sourceLine" id="cb18-42" title="42">  <span class="co">-- (unit law)</span></a>
<a class="sourceLine" id="cb18-43" title="43"></a>
<a class="sourceLine" id="cb18-44" title="44">  , <span class="fu">return</span> u</a>
<a class="sourceLine" id="cb18-45" title="45">  ]</a></code></pre></div>
</div>
<p>Third: <code>EnvT s m</code> satisfies the get/put law.</p>
<div class="example">
<div class="sourceCode" id="cb19"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" title="1">_EnvT_get_put_law_lifted</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb19-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadReadWrite</span> t m )</a>
<a class="sourceLine" id="cb19-4" title="4">  <span class="ot">=&gt;</span> [<span class="dt">EnvT</span> s m ()]</a>
<a class="sourceLine" id="cb19-5" title="5">_EnvT_get_put_law_lifted <span class="ot">=</span></a>
<a class="sourceLine" id="cb19-6" title="6"></a>
<a class="sourceLine" id="cb19-7" title="7">  [ get <span class="op">@</span>t <span class="op">&gt;&gt;=</span> put</a>
<a class="sourceLine" id="cb19-8" title="8"></a>
<a class="sourceLine" id="cb19-9" title="9">  <span class="co">-- (expand put and get)</span></a>
<a class="sourceLine" id="cb19-10" title="10"></a>
<a class="sourceLine" id="cb19-11" title="11">  , lift (get <span class="op">@</span>t) <span class="op">&gt;&gt;=</span> lift <span class="op">.</span> put</a>
<a class="sourceLine" id="cb19-12" title="12"></a>
<a class="sourceLine" id="cb19-13" title="13">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb19-14" title="14"></a>
<a class="sourceLine" id="cb19-15" title="15">  , lift (get <span class="op">@</span>t <span class="op">&gt;&gt;=</span> put)</a>
<a class="sourceLine" id="cb19-16" title="16"></a>
<a class="sourceLine" id="cb19-17" title="17">  <span class="co">-- (get/put law in m)</span></a>
<a class="sourceLine" id="cb19-18" title="18"></a>
<a class="sourceLine" id="cb19-19" title="19">  , lift (<span class="fu">return</span> ())</a>
<a class="sourceLine" id="cb19-20" title="20"></a>
<a class="sourceLine" id="cb19-21" title="21">  <span class="co">-- (unit law)</span></a>
<a class="sourceLine" id="cb19-22" title="22"></a>
<a class="sourceLine" id="cb19-23" title="23">  , <span class="fu">return</span> ()</a>
<a class="sourceLine" id="cb19-24" title="24">  ]</a></code></pre></div>
</div>
<p>Fourth: <code>EnvT s m</code> satisfies the get/get law.</p>
<div class="example">
<div class="sourceCode" id="cb20"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" title="1">_EnvT_get_get_law_lifted</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m a</a>
<a class="sourceLine" id="cb20-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadReadWrite</span> t m )</a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t <span class="ot">-&gt;</span> <span class="dt">EnvT</span> s m a)</a>
<a class="sourceLine" id="cb20-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> s m a]</a>
<a class="sourceLine" id="cb20-6" title="6">_EnvT_get_get_law_lifted k <span class="ot">=</span></a>
<a class="sourceLine" id="cb20-7" title="7"></a>
<a class="sourceLine" id="cb20-8" title="8">  [ get <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u)</a>
<a class="sourceLine" id="cb20-9" title="9"></a>
<a class="sourceLine" id="cb20-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb20-11" title="11"></a>
<a class="sourceLine" id="cb20-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-13" title="13">      unEnvT get r</a>
<a class="sourceLine" id="cb20-14" title="14">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb20-15" title="15"></a>
<a class="sourceLine" id="cb20-16" title="16">  <span class="co">-- (expand get)</span></a>
<a class="sourceLine" id="cb20-17" title="17"></a>
<a class="sourceLine" id="cb20-18" title="18">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-19" title="19">      unEnvT (lift get) r</a>
<a class="sourceLine" id="cb20-20" title="20">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb20-21" title="21"></a>
<a class="sourceLine" id="cb20-22" title="22">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb20-23" title="23"></a>
<a class="sourceLine" id="cb20-24" title="24">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-25" title="25">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> get) r</a>
<a class="sourceLine" id="cb20-26" title="26">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb20-27" title="27"></a>
<a class="sourceLine" id="cb20-28" title="28">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb20-29" title="29"></a>
<a class="sourceLine" id="cb20-30" title="30">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-31" title="31">      (\_ <span class="ot">-&gt;</span> get) r</a>
<a class="sourceLine" id="cb20-32" title="32">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb20-33" title="33"></a>
<a class="sourceLine" id="cb20-34" title="34">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-35" title="35"></a>
<a class="sourceLine" id="cb20-36" title="36">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-37" title="37">      get</a>
<a class="sourceLine" id="cb20-38" title="38">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb20-39" title="39"></a>
<a class="sourceLine" id="cb20-40" title="40">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-41" title="41"></a>
<a class="sourceLine" id="cb20-42" title="42">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-43" title="43">      get</a>
<a class="sourceLine" id="cb20-44" title="44">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (get <span class="op">&gt;&gt;=</span> k a) r)</a>
<a class="sourceLine" id="cb20-45" title="45"></a>
<a class="sourceLine" id="cb20-46" title="46">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb20-47" title="47"></a>
<a class="sourceLine" id="cb20-48" title="48">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-49" title="49">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-50" title="50">        (\a <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> unEnvT get s</a>
<a class="sourceLine" id="cb20-51" title="51">          <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (k a c) r)) r)</a>
<a class="sourceLine" id="cb20-52" title="52"></a>
<a class="sourceLine" id="cb20-53" title="53">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb20-54" title="54"></a>
<a class="sourceLine" id="cb20-55" title="55">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-56" title="56">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-57" title="57">        (\a <span class="ot">-&gt;</span> (\s <span class="ot">-&gt;</span> unEnvT get s <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (k a c) r)) r)</a>
<a class="sourceLine" id="cb20-58" title="58"></a>
<a class="sourceLine" id="cb20-59" title="59">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-60" title="60"></a>
<a class="sourceLine" id="cb20-61" title="61">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-62" title="62">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-63" title="63">        (\a <span class="ot">-&gt;</span> unEnvT get r <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (k a c) r))</a>
<a class="sourceLine" id="cb20-64" title="64"></a>
<a class="sourceLine" id="cb20-65" title="65">  <span class="co">-- (expand get)</span></a>
<a class="sourceLine" id="cb20-66" title="66"></a>
<a class="sourceLine" id="cb20-67" title="67">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-68" title="68">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-69" title="69">        (\a <span class="ot">-&gt;</span> unEnvT (lift get) r <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (k a c) r))</a>
<a class="sourceLine" id="cb20-70" title="70"></a>
<a class="sourceLine" id="cb20-71" title="71">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb20-72" title="72"></a>
<a class="sourceLine" id="cb20-73" title="73">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-74" title="74">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-75" title="75">        (\a <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> get) r</a>
<a class="sourceLine" id="cb20-76" title="76">          <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (k a c) r))</a>
<a class="sourceLine" id="cb20-77" title="77"></a>
<a class="sourceLine" id="cb20-78" title="78">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb20-79" title="79"></a>
<a class="sourceLine" id="cb20-80" title="80">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-81" title="81">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-82" title="82">        (\a <span class="ot">-&gt;</span> (\_ <span class="ot">-&gt;</span> get) r</a>
<a class="sourceLine" id="cb20-83" title="83">          <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> unEnvT (k a c) r))</a>
<a class="sourceLine" id="cb20-84" title="84"></a>
<a class="sourceLine" id="cb20-85" title="85">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-86" title="86"></a>
<a class="sourceLine" id="cb20-87" title="87">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-88" title="88">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-89" title="89">        (\a <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-90" title="90">          (\c <span class="ot">-&gt;</span> unEnvT (k a c) r))</a>
<a class="sourceLine" id="cb20-91" title="91"></a>
<a class="sourceLine" id="cb20-92" title="92">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb20-93" title="93"></a>
<a class="sourceLine" id="cb20-94" title="94">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-95" title="95">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-96" title="96">        (\a <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-97" title="97">          (\c <span class="ot">-&gt;</span> (\u v <span class="ot">-&gt;</span> unEnvT (k u v) r) a c))</a>
<a class="sourceLine" id="cb20-98" title="98"></a>
<a class="sourceLine" id="cb20-99" title="99">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb20-100" title="100"></a>
<a class="sourceLine" id="cb20-101" title="101">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-102" title="102">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-103" title="103">        (\a <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> (\u v <span class="ot">-&gt;</span> unEnvT (k u v) r) a)</a>
<a class="sourceLine" id="cb20-104" title="104"></a>
<a class="sourceLine" id="cb20-105" title="105">  <span class="co">-- (get/get law in m)</span></a>
<a class="sourceLine" id="cb20-106" title="106"></a>
<a class="sourceLine" id="cb20-107" title="107">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-108" title="108">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-109" title="109">        (\a <span class="ot">-&gt;</span> (\u v <span class="ot">-&gt;</span> unEnvT (k u v) r) a a)</a>
<a class="sourceLine" id="cb20-110" title="110"></a>
<a class="sourceLine" id="cb20-111" title="111">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-112" title="112"></a>
<a class="sourceLine" id="cb20-113" title="113">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-114" title="114">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-115" title="115">        (\a <span class="ot">-&gt;</span> unEnvT (k a a) r)</a>
<a class="sourceLine" id="cb20-116" title="116"></a>
<a class="sourceLine" id="cb20-117" title="117">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb20-118" title="118"></a>
<a class="sourceLine" id="cb20-119" title="119">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-120" title="120">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-121" title="121">        (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb20-122" title="122"></a>
<a class="sourceLine" id="cb20-123" title="123">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb20-124" title="124"></a>
<a class="sourceLine" id="cb20-125" title="125">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-126" title="126">      (\_ <span class="ot">-&gt;</span> get) r</a>
<a class="sourceLine" id="cb20-127" title="127">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb20-128" title="128"></a>
<a class="sourceLine" id="cb20-129" title="129">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb20-130" title="130"></a>
<a class="sourceLine" id="cb20-131" title="131">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-132" title="132">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> get) r</a>
<a class="sourceLine" id="cb20-133" title="133">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb20-134" title="134"></a>
<a class="sourceLine" id="cb20-135" title="135">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb20-136" title="136"></a>
<a class="sourceLine" id="cb20-137" title="137">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-138" title="138">      unEnvT (lift get) r</a>
<a class="sourceLine" id="cb20-139" title="139">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb20-140" title="140"></a>
<a class="sourceLine" id="cb20-141" title="141">  <span class="co">-- (condense get)</span></a>
<a class="sourceLine" id="cb20-142" title="142"></a>
<a class="sourceLine" id="cb20-143" title="143">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-144" title="144">      unEnvT get r</a>
<a class="sourceLine" id="cb20-145" title="145">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb20-146" title="146"></a>
<a class="sourceLine" id="cb20-147" title="147">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb20-148" title="148"></a>
<a class="sourceLine" id="cb20-149" title="149">  , get <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> k u u)</a>
<a class="sourceLine" id="cb20-150" title="150">  ]</a></code></pre></div>
</div>
</section>
<section class="level2">
<h2>MonadStream Laws</h2>
<p><a name='crossref-4'></a></p>
<p>There is a <code>MonadStream</code> instance for <code>EnvT r m</code> that we need to verify. Recall the laws for <a href="../../../Monad.html#crossref-2"><code>MonadStream</code></a>:</p>
<dl>
<dt>Next/Rest Law</dt>
<dd><code>(,) &lt;$&gt; next &lt;*&gt; rest</code> is equivalent to <code>advance &lt;$&gt; rest &lt;* next</code>
</dd>
<dt>Rest/Rest Law</dt>
<dd><code>rest &gt;&gt;= (\u -&gt; rest &gt;&gt;= k u)</code> is equivalent to <code>rest &gt;&gt;= (\u -&gt; k u u)</code>
</dd>
<dt>Fiddle/Id Law</dt>
<dd><code>fiddle id</code> is equivalent to <code>return ()</code>
</dd>
<dt>Fiddle/Compose Law</dt>
<dd><code>fiddle u &gt;&gt; fiddle v</code> is equivalent to <code>fiddle (v . u)</code>
</dd>
<dt>Fiddle/Rest Law</dt>
<dd><code>fiddle u &gt;&gt; rest</code> is equivalent to <code>rest &gt;&gt;= (\a -&gt; fiddle u &gt;&gt; return (u a))</code>
</dd>
</dl>
<p>Here we show that if <code>m</code> is a lawful instance of <code>MonadStream</code> with stream type <code>t</code> different from <code>s</code>, then so is <code>EnvT r m</code>.</p>
<p>First: <code>EnvT r m</code> satisfies the next/rest law:</p>
<div class="example">
<div class="sourceCode" id="cb21"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" title="1">_EnvT_next_rest_law_lifted</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m</a>
<a class="sourceLine" id="cb21-3" title="3">   <span class="op">.</span> ( <span class="dt">IsStream</span> t, <span class="dt">MonadStream</span> t m )</a>
<a class="sourceLine" id="cb21-4" title="4">  <span class="ot">=&gt;</span> [<span class="dt">EnvT</span> r m (<span class="dt">StreamValue</span> t, t)]</a>
<a class="sourceLine" id="cb21-5" title="5">_EnvT_next_rest_law_lifted <span class="ot">=</span></a>
<a class="sourceLine" id="cb21-6" title="6"></a>
<a class="sourceLine" id="cb21-7" title="7">  [ (advance <span class="op">&lt;$&gt;</span> rest) <span class="op">&lt;*</span> (next <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb21-8" title="8"></a>
<a class="sourceLine" id="cb21-9" title="9">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb21-10" title="10"></a>
<a class="sourceLine" id="cb21-11" title="11">  , (advance <span class="op">&lt;$&gt;</span> lift rest) <span class="op">&lt;*</span> (next <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb21-12" title="12"></a>
<a class="sourceLine" id="cb21-13" title="13">  <span class="co">-- (expand next)</span></a>
<a class="sourceLine" id="cb21-14" title="14"></a>
<a class="sourceLine" id="cb21-15" title="15">  , (advance <span class="op">&lt;$&gt;</span> lift rest) <span class="op">&lt;*</span> lift (next <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb21-16" title="16"></a>
<a class="sourceLine" id="cb21-17" title="17">  <span class="co">-- (lift/&lt;$&gt;)</span></a>
<a class="sourceLine" id="cb21-18" title="18"></a>
<a class="sourceLine" id="cb21-19" title="19">  , lift (advance <span class="op">&lt;$&gt;</span> rest) <span class="op">&lt;*</span> lift (next <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb21-20" title="20"></a>
<a class="sourceLine" id="cb21-21" title="21">  <span class="co">-- (lift/&lt;*)</span></a>
<a class="sourceLine" id="cb21-22" title="22"></a>
<a class="sourceLine" id="cb21-23" title="23">  , lift ((advance <span class="op">&lt;$&gt;</span> rest) <span class="op">&lt;*</span> (next <span class="op">@</span>t))</a>
<a class="sourceLine" id="cb21-24" title="24"></a>
<a class="sourceLine" id="cb21-25" title="25">  <span class="co">-- (next/rest law in m)</span></a>
<a class="sourceLine" id="cb21-26" title="26"></a>
<a class="sourceLine" id="cb21-27" title="27">  , lift ((,) <span class="op">&lt;$&gt;</span> next <span class="op">&lt;*&gt;</span> rest)</a>
<a class="sourceLine" id="cb21-28" title="28"></a>
<a class="sourceLine" id="cb21-29" title="29">  <span class="co">-- (lift/&lt;*&gt;)</span></a>
<a class="sourceLine" id="cb21-30" title="30"></a>
<a class="sourceLine" id="cb21-31" title="31">  , lift ((,) <span class="op">&lt;$&gt;</span> next) <span class="op">&lt;*&gt;</span> lift rest</a>
<a class="sourceLine" id="cb21-32" title="32"></a>
<a class="sourceLine" id="cb21-33" title="33">  <span class="co">-- (lift/&lt;$&gt;)</span></a>
<a class="sourceLine" id="cb21-34" title="34"></a>
<a class="sourceLine" id="cb21-35" title="35">  , (,) <span class="op">&lt;$&gt;</span> lift next <span class="op">&lt;*&gt;</span> lift rest</a>
<a class="sourceLine" id="cb21-36" title="36"></a>
<a class="sourceLine" id="cb21-37" title="37">  <span class="co">-- (condense next)</span></a>
<a class="sourceLine" id="cb21-38" title="38"></a>
<a class="sourceLine" id="cb21-39" title="39">  , (,) <span class="op">&lt;$&gt;</span> next <span class="op">&lt;*&gt;</span> lift rest</a>
<a class="sourceLine" id="cb21-40" title="40"></a>
<a class="sourceLine" id="cb21-41" title="41">  <span class="co">-- (condense rest)</span></a>
<a class="sourceLine" id="cb21-42" title="42"></a>
<a class="sourceLine" id="cb21-43" title="43">  , (,) <span class="op">&lt;$&gt;</span> next <span class="op">&lt;*&gt;</span> rest</a>
<a class="sourceLine" id="cb21-44" title="44">  ]</a></code></pre></div>
</div>
<p>Second: <code>EnvT r m</code> satisfies the rest/rest law with stream type <code>t</code>:</p>
<div class="example">
<div class="sourceCode" id="cb22"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb22-1" title="1">_EnvT_rest_rest_law_lifted</a>
<a class="sourceLine" id="cb22-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m a</a>
<a class="sourceLine" id="cb22-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadStream</span> t m, <span class="dt">IsStream</span> t )</a>
<a class="sourceLine" id="cb22-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t <span class="ot">-&gt;</span> <span class="dt">EnvT</span> r m a)</a>
<a class="sourceLine" id="cb22-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m a]</a>
<a class="sourceLine" id="cb22-6" title="6">_EnvT_rest_rest_law_lifted k <span class="ot">=</span></a>
<a class="sourceLine" id="cb22-7" title="7"></a>
<a class="sourceLine" id="cb22-8" title="8">  [ rest <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u)</a>
<a class="sourceLine" id="cb22-9" title="9"></a>
<a class="sourceLine" id="cb22-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb22-11" title="11"></a>
<a class="sourceLine" id="cb22-12" title="12">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-13" title="13">      unEnvT rest r</a>
<a class="sourceLine" id="cb22-14" title="14">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb22-15" title="15"></a>
<a class="sourceLine" id="cb22-16" title="16">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb22-17" title="17"></a>
<a class="sourceLine" id="cb22-18" title="18">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-19" title="19">      unEnvT (lift rest) r</a>
<a class="sourceLine" id="cb22-20" title="20">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb22-21" title="21"></a>
<a class="sourceLine" id="cb22-22" title="22">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb22-23" title="23"></a>
<a class="sourceLine" id="cb22-24" title="24">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-25" title="25">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> rest) r</a>
<a class="sourceLine" id="cb22-26" title="26">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb22-27" title="27"></a>
<a class="sourceLine" id="cb22-28" title="28">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb22-29" title="29"></a>
<a class="sourceLine" id="cb22-30" title="30">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-31" title="31">      (\_ <span class="ot">-&gt;</span> rest) r</a>
<a class="sourceLine" id="cb22-32" title="32">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb22-33" title="33"></a>
<a class="sourceLine" id="cb22-34" title="34">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb22-35" title="35"></a>
<a class="sourceLine" id="cb22-36" title="36">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-37" title="37">      rest</a>
<a class="sourceLine" id="cb22-38" title="38">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) r)</a>
<a class="sourceLine" id="cb22-39" title="39"></a>
<a class="sourceLine" id="cb22-40" title="40">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb22-41" title="41"></a>
<a class="sourceLine" id="cb22-42" title="42">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-43" title="43">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-44" title="44">        (\a <span class="ot">-&gt;</span> unEnvT (rest <span class="op">&gt;&gt;=</span> k a) r)</a>
<a class="sourceLine" id="cb22-45" title="45"></a>
<a class="sourceLine" id="cb22-46" title="46">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb22-47" title="47"></a>
<a class="sourceLine" id="cb22-48" title="48">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-49" title="49">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-50" title="50">        (\c <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \r1 <span class="ot">-&gt;</span> unEnvT rest r1</a>
<a class="sourceLine" id="cb22-51" title="51">          <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (k c a) r1)) r)</a>
<a class="sourceLine" id="cb22-52" title="52"></a>
<a class="sourceLine" id="cb22-53" title="53">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb22-54" title="54"></a>
<a class="sourceLine" id="cb22-55" title="55">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-56" title="56">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-57" title="57">        (\c <span class="ot">-&gt;</span> (\r1 <span class="ot">-&gt;</span> unEnvT rest r1</a>
<a class="sourceLine" id="cb22-58" title="58">          <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (k c a) r1)) r)</a>
<a class="sourceLine" id="cb22-59" title="59"></a>
<a class="sourceLine" id="cb22-60" title="60">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb22-61" title="61"></a>
<a class="sourceLine" id="cb22-62" title="62">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-63" title="63">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-64" title="64">        (\c <span class="ot">-&gt;</span> unEnvT rest r <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT (k c a) r))</a>
<a class="sourceLine" id="cb22-65" title="65"></a>
<a class="sourceLine" id="cb22-66" title="66">  <span class="co">-- (α-conversion)</span></a>
<a class="sourceLine" id="cb22-67" title="67"></a>
<a class="sourceLine" id="cb22-68" title="68">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-69" title="69">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-70" title="70">        (\a <span class="ot">-&gt;</span> unEnvT rest r <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> unEnvT (k a d) r))</a>
<a class="sourceLine" id="cb22-71" title="71"></a>
<a class="sourceLine" id="cb22-72" title="72">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb22-73" title="73"></a>
<a class="sourceLine" id="cb22-74" title="74">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-75" title="75">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-76" title="76">        (\a <span class="ot">-&gt;</span> unEnvT (lift rest) r <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> unEnvT (k a d) r))</a>
<a class="sourceLine" id="cb22-77" title="77"></a>
<a class="sourceLine" id="cb22-78" title="78">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb22-79" title="79"></a>
<a class="sourceLine" id="cb22-80" title="80">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-81" title="81">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-82" title="82">        (\a <span class="ot">-&gt;</span> unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> rest) r</a>
<a class="sourceLine" id="cb22-83" title="83">          <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> unEnvT (k a d) r))</a>
<a class="sourceLine" id="cb22-84" title="84"></a>
<a class="sourceLine" id="cb22-85" title="85">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb22-86" title="86"></a>
<a class="sourceLine" id="cb22-87" title="87">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-88" title="88">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-89" title="89">        (\a <span class="ot">-&gt;</span> (\_ <span class="ot">-&gt;</span> rest) r <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-90" title="90">          (\d <span class="ot">-&gt;</span> unEnvT (k a d) r))</a>
<a class="sourceLine" id="cb22-91" title="91"></a>
<a class="sourceLine" id="cb22-92" title="92">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb22-93" title="93"></a>
<a class="sourceLine" id="cb22-94" title="94">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-95" title="95">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-96" title="96">        (\a <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-97" title="97">          (\d <span class="ot">-&gt;</span> unEnvT (k a d) r))</a>
<a class="sourceLine" id="cb22-98" title="98"></a>
<a class="sourceLine" id="cb22-99" title="99">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb22-100" title="100"></a>
<a class="sourceLine" id="cb22-101" title="101">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-102" title="102">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-103" title="103">        (\a <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-104" title="104">          (\d <span class="ot">-&gt;</span> (\u v <span class="ot">-&gt;</span> unEnvT (k u v) r) a d))</a>
<a class="sourceLine" id="cb22-105" title="105"></a>
<a class="sourceLine" id="cb22-106" title="106">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb22-107" title="107"></a>
<a class="sourceLine" id="cb22-108" title="108">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-109" title="109">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-110" title="110">        (\a <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\u v <span class="ot">-&gt;</span> unEnvT (k u v) r) a)</a>
<a class="sourceLine" id="cb22-111" title="111"></a>
<a class="sourceLine" id="cb22-112" title="112">  <span class="co">-- (rest/rest law in m)</span></a>
<a class="sourceLine" id="cb22-113" title="113"></a>
<a class="sourceLine" id="cb22-114" title="114">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-115" title="115">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-116" title="116">        (\a <span class="ot">-&gt;</span> (\u v <span class="ot">-&gt;</span> unEnvT (k u v) r) a a)</a>
<a class="sourceLine" id="cb22-117" title="117"></a>
<a class="sourceLine" id="cb22-118" title="118">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb22-119" title="119"></a>
<a class="sourceLine" id="cb22-120" title="120">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-121" title="121">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb22-122" title="122">        (\a <span class="ot">-&gt;</span> unEnvT (k a a) r)</a>
<a class="sourceLine" id="cb22-123" title="123"></a>
<a class="sourceLine" id="cb22-124" title="124">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb22-125" title="125"></a>
<a class="sourceLine" id="cb22-126" title="126">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-127" title="127">      rest</a>
<a class="sourceLine" id="cb22-128" title="128">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb22-129" title="129"></a>
<a class="sourceLine" id="cb22-130" title="130">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb22-131" title="131"></a>
<a class="sourceLine" id="cb22-132" title="132">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-133" title="133">      (\_ <span class="ot">-&gt;</span> rest) r</a>
<a class="sourceLine" id="cb22-134" title="134">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb22-135" title="135"></a>
<a class="sourceLine" id="cb22-136" title="136">  <span class="co">-- (unEnvT . EnvT == id)</span></a>
<a class="sourceLine" id="cb22-137" title="137"></a>
<a class="sourceLine" id="cb22-138" title="138">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-139" title="139">      unEnvT (<span class="dt">EnvT</span> <span class="op">$</span> \_ <span class="ot">-&gt;</span> rest) r</a>
<a class="sourceLine" id="cb22-140" title="140">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb22-141" title="141"></a>
<a class="sourceLine" id="cb22-142" title="142">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb22-143" title="143"></a>
<a class="sourceLine" id="cb22-144" title="144">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-145" title="145">      unEnvT (lift rest) r</a>
<a class="sourceLine" id="cb22-146" title="146">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb22-147" title="147"></a>
<a class="sourceLine" id="cb22-148" title="148">  <span class="co">-- (condense rest)</span></a>
<a class="sourceLine" id="cb22-149" title="149"></a>
<a class="sourceLine" id="cb22-150" title="150">  , <span class="dt">EnvT</span> <span class="op">$</span> \r <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb22-151" title="151">      unEnvT rest r</a>
<a class="sourceLine" id="cb22-152" title="152">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> unEnvT ((\u <span class="ot">-&gt;</span> k u u) a) r)</a>
<a class="sourceLine" id="cb22-153" title="153"></a>
<a class="sourceLine" id="cb22-154" title="154">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb22-155" title="155"></a>
<a class="sourceLine" id="cb22-156" title="156">  , rest <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> k u u)</a>
<a class="sourceLine" id="cb22-157" title="157">  ]</a></code></pre></div>
</div>
<p>Third: <code>EnvT r m</code> satisfies the fiddle/id law with stream type <code>t</code>:</p>
<div class="example">
<div class="sourceCode" id="cb23"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" title="1">_EnvT_fiddle_id_law_lifted</a>
<a class="sourceLine" id="cb23-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m</a>
<a class="sourceLine" id="cb23-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadStream</span> t m, <span class="dt">IsStream</span> t )</a>
<a class="sourceLine" id="cb23-4" title="4">  <span class="ot">=&gt;</span> [<span class="dt">EnvT</span> r m ()]</a>
<a class="sourceLine" id="cb23-5" title="5">_EnvT_fiddle_id_law_lifted <span class="ot">=</span></a>
<a class="sourceLine" id="cb23-6" title="6"></a>
<a class="sourceLine" id="cb23-7" title="7">  [ fiddle (<span class="fu">id</span> <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb23-8" title="8"></a>
<a class="sourceLine" id="cb23-9" title="9">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb23-10" title="10"></a>
<a class="sourceLine" id="cb23-11" title="11">  , lift (fiddle (<span class="fu">id</span> <span class="op">@</span>t))</a>
<a class="sourceLine" id="cb23-12" title="12"></a>
<a class="sourceLine" id="cb23-13" title="13">  <span class="co">-- (fiddle/id law in m)</span></a>
<a class="sourceLine" id="cb23-14" title="14"></a>
<a class="sourceLine" id="cb23-15" title="15">  , (lift (<span class="fu">return</span> ()))</a>
<a class="sourceLine" id="cb23-16" title="16"></a>
<a class="sourceLine" id="cb23-17" title="17">  <span class="co">-- (unit law)</span></a>
<a class="sourceLine" id="cb23-18" title="18"></a>
<a class="sourceLine" id="cb23-19" title="19">  , <span class="fu">return</span> ()</a>
<a class="sourceLine" id="cb23-20" title="20">  ]</a></code></pre></div>
</div>
<p>Fourth: <code>EnvT r m</code> satisfies the fiddle/compose law with stream type <code>t</code>:</p>
<div class="example">
<div class="sourceCode" id="cb24"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb24-1" title="1">_EnvT_fiddle_compose_law_lifted</a>
<a class="sourceLine" id="cb24-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m</a>
<a class="sourceLine" id="cb24-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadStream</span> t m, <span class="dt">IsStream</span> t )</a>
<a class="sourceLine" id="cb24-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t) <span class="ot">-&gt;</span> (t <span class="ot">-&gt;</span> t)</a>
<a class="sourceLine" id="cb24-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m ()]</a>
<a class="sourceLine" id="cb24-6" title="6">_EnvT_fiddle_compose_law_lifted u v <span class="ot">=</span></a>
<a class="sourceLine" id="cb24-7" title="7"></a>
<a class="sourceLine" id="cb24-8" title="8">  [ fiddle u <span class="op">&gt;&gt;</span> fiddle v</a>
<a class="sourceLine" id="cb24-9" title="9"></a>
<a class="sourceLine" id="cb24-10" title="10">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb24-11" title="11"></a>
<a class="sourceLine" id="cb24-12" title="12">  , lift (fiddle u) <span class="op">&gt;&gt;</span> lift (fiddle v)</a>
<a class="sourceLine" id="cb24-13" title="13"></a>
<a class="sourceLine" id="cb24-14" title="14">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb24-15" title="15"></a>
<a class="sourceLine" id="cb24-16" title="16">  , lift (fiddle u) <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> lift (fiddle v))</a>
<a class="sourceLine" id="cb24-17" title="17"></a>
<a class="sourceLine" id="cb24-18" title="18">  <span class="co">-- (condense const)</span></a>
<a class="sourceLine" id="cb24-19" title="19"></a>
<a class="sourceLine" id="cb24-20" title="20">  , lift (fiddle u) <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (lift (fiddle v))</a>
<a class="sourceLine" id="cb24-21" title="21"></a>
<a class="sourceLine" id="cb24-22" title="22">  <span class="co">-- (const compose)</span></a>
<a class="sourceLine" id="cb24-23" title="23"></a>
<a class="sourceLine" id="cb24-24" title="24">  , lift (fiddle u) <span class="op">&gt;&gt;=</span> (lift <span class="op">.</span> <span class="fu">const</span> (fiddle v))</a>
<a class="sourceLine" id="cb24-25" title="25"></a>
<a class="sourceLine" id="cb24-26" title="26">  <span class="co">-- (expand const)</span></a>
<a class="sourceLine" id="cb24-27" title="27"></a>
<a class="sourceLine" id="cb24-28" title="28">  , lift (fiddle u) <span class="op">&gt;&gt;=</span> (lift <span class="op">.</span> (\_ <span class="ot">-&gt;</span> fiddle v))</a>
<a class="sourceLine" id="cb24-29" title="29"></a>
<a class="sourceLine" id="cb24-30" title="30">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb24-31" title="31"></a>
<a class="sourceLine" id="cb24-32" title="32">  , lift (fiddle u <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> fiddle v))</a>
<a class="sourceLine" id="cb24-33" title="33"></a>
<a class="sourceLine" id="cb24-34" title="34">  <span class="co">-- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb24-35" title="35"></a>
<a class="sourceLine" id="cb24-36" title="36">  , lift (fiddle u <span class="op">&gt;&gt;</span> fiddle v)</a>
<a class="sourceLine" id="cb24-37" title="37"></a>
<a class="sourceLine" id="cb24-38" title="38">  <span class="co">-- (fiddle/compose law in m)</span></a>
<a class="sourceLine" id="cb24-39" title="39"></a>
<a class="sourceLine" id="cb24-40" title="40">  , lift (fiddle (v <span class="op">.</span> u))</a>
<a class="sourceLine" id="cb24-41" title="41"></a>
<a class="sourceLine" id="cb24-42" title="42">  <span class="co">-- (condense fiddle)</span></a>
<a class="sourceLine" id="cb24-43" title="43"></a>
<a class="sourceLine" id="cb24-44" title="44">  , fiddle (v <span class="op">.</span> u)</a>
<a class="sourceLine" id="cb24-45" title="45">  ]</a></code></pre></div>
</div>
<p>Fifth: <code>EnvT r m</code> satisfies the fiddle/rest law:</p>
<div class="example">
<div class="sourceCode" id="cb25"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb25-1" title="1">_EnvT_fiddle_rest_law_lifted</a>
<a class="sourceLine" id="cb25-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> r t m</a>
<a class="sourceLine" id="cb25-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadStream</span> t m, <span class="dt">IsStream</span> t )</a>
<a class="sourceLine" id="cb25-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t)</a>
<a class="sourceLine" id="cb25-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">EnvT</span> r m t]</a>
<a class="sourceLine" id="cb25-6" title="6">_EnvT_fiddle_rest_law_lifted u <span class="ot">=</span></a>
<a class="sourceLine" id="cb25-7" title="7"></a>
<a class="sourceLine" id="cb25-8" title="8">  [ fiddle u <span class="op">&gt;&gt;</span> rest</a>
<a class="sourceLine" id="cb25-9" title="9"></a>
<a class="sourceLine" id="cb25-10" title="10">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb25-11" title="11"></a>
<a class="sourceLine" id="cb25-12" title="12">  , lift (fiddle u) <span class="op">&gt;&gt;</span> rest</a>
<a class="sourceLine" id="cb25-13" title="13"></a>
<a class="sourceLine" id="cb25-14" title="14">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb25-15" title="15"></a>
<a class="sourceLine" id="cb25-16" title="16">  , lift (fiddle u) <span class="op">&gt;&gt;</span> lift rest</a>
<a class="sourceLine" id="cb25-17" title="17"></a>
<a class="sourceLine" id="cb25-18" title="18">  <span class="co">-- (lift/&gt;&gt;)</span></a>
<a class="sourceLine" id="cb25-19" title="19"></a>
<a class="sourceLine" id="cb25-20" title="20">  , lift (fiddle u <span class="op">&gt;&gt;</span> rest)</a>
<a class="sourceLine" id="cb25-21" title="21"></a>
<a class="sourceLine" id="cb25-22" title="22">  <span class="co">-- (fiddle/rest law in m)</span></a>
<a class="sourceLine" id="cb25-23" title="23"></a>
<a class="sourceLine" id="cb25-24" title="24">  , lift (rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a)))</a>
<a class="sourceLine" id="cb25-25" title="25"></a>
<a class="sourceLine" id="cb25-26" title="26">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb25-27" title="27"></a>
<a class="sourceLine" id="cb25-28" title="28">  , lift rest <span class="op">&gt;&gt;=</span> lift <span class="op">.</span> (\a <span class="ot">-&gt;</span> fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a))</a>
<a class="sourceLine" id="cb25-29" title="29"></a>
<a class="sourceLine" id="cb25-30" title="30">  <span class="co">-- (compose lambda)</span></a>
<a class="sourceLine" id="cb25-31" title="31"></a>
<a class="sourceLine" id="cb25-32" title="32">  , lift rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> lift (fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a)))</a>
<a class="sourceLine" id="cb25-33" title="33"></a>
<a class="sourceLine" id="cb25-34" title="34">  <span class="co">-- (lift/&gt;&gt;)</span></a>
<a class="sourceLine" id="cb25-35" title="35"></a>
<a class="sourceLine" id="cb25-36" title="36">  , lift rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> lift (fiddle u) <span class="op">&gt;&gt;</span> lift (<span class="fu">return</span> (u a)))</a>
<a class="sourceLine" id="cb25-37" title="37"></a>
<a class="sourceLine" id="cb25-38" title="38">  <span class="co">-- (lift/unit law)</span></a>
<a class="sourceLine" id="cb25-39" title="39"></a>
<a class="sourceLine" id="cb25-40" title="40">  , lift rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> lift (fiddle u) <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a))</a>
<a class="sourceLine" id="cb25-41" title="41"></a>
<a class="sourceLine" id="cb25-42" title="42">  <span class="co">-- (condense rest)</span></a>
<a class="sourceLine" id="cb25-43" title="43"></a>
<a class="sourceLine" id="cb25-44" title="44">  , rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> lift (fiddle u) <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a))</a>
<a class="sourceLine" id="cb25-45" title="45"></a>
<a class="sourceLine" id="cb25-46" title="46">  <span class="co">-- (condense fiddle)</span></a>
<a class="sourceLine" id="cb25-47" title="47"></a>
<a class="sourceLine" id="cb25-48" title="48">  , rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a))</a>
<a class="sourceLine" id="cb25-49" title="49">  ]</a></code></pre></div>
</div>
</section>
</article>
</body>
</html>
