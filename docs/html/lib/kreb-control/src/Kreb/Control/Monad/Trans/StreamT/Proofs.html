<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="nbloomf">
  <title>Lawfulness Proofs for StreamT</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="../../../../../../../../../styles/style.css">
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
  <script>
    window.MathJax = {
      tex: {
        macros: {
          dom: "\\mathsf{dom}",
          cod: "\\mathsf{cod}",
          id:  "\\mathsf{id}",
          Hask: "\\mathsf{Hask}",
        }
      }
    };
  </script
</head>
<body>
<article>
<header>
<h1 class="title">Lawfulness Proofs for StreamT</h1>
<p class="byline">nbloomf</p>
</header>
<div class="frontmatter">
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="ot">{-# LANGUAGE TupleSections #-}</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">module</span> <span class="dt">Kreb.Control.Monad.Trans.StreamT.Proofs</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">import</span> <span class="dt">Kreb.Control.Compare</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">import</span> <span class="dt">Kreb.Control.Monad</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">import</span> <span class="dt">Kreb.Control.Monad.Trans</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">import</span> <span class="dt">Kreb.Control.Monad.Trans.StreamT</span></a></code></pre></div>
</div>
<section class="level2">
<h2>Introduction</h2>
<p>In this section we give lawfulness proofs for the class instances of <code>StreamT</code>.</p>
</section>
<section class="level2">
<h2>Monad Laws</h2>
<p><a name='crossref-0'></a></p>
<p>Recall the three <em>monad laws</em>:</p>
<dl>
<dt>Left Identity Law</dt>
<dd><code>return a &gt;&gt;= f</code> is equivalent to <code>f a</code>
</dd>
<dt>Right Identity Law</dt>
<dd><code>x &gt;&gt;= return</code> is equivalent to <code>x</code>
</dd>
<dt>Associative Law</dt>
<dd><code>(x &gt;&gt;= f) &gt;&gt;= g</code> is equivalent to <code>x &gt;&gt;= (\a -&gt; f a &gt;&gt;= g)</code>
</dd>
</dl>
<p>Here we show that if <code>m</code> is a monad, then <code>StreamT s m</code> is also a monad. To that end suppose <code>m</code> is a monad.</p>
<p>First: <code>StreamT s m</code> satisfies the left identity law.</p>
<div class="example">
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1">_StreamT_left_identity_law</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m a b</a>
<a class="sourceLine" id="cb2-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">StreamT</span> s m b)</a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m b]</a>
<a class="sourceLine" id="cb2-6" title="6">_StreamT_left_identity_law a f <span class="ot">=</span></a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8">  [ <span class="fu">return</span> a <span class="op">&gt;&gt;=</span> f</a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-13" title="13">      unStreamT (<span class="fu">return</span> a) s1</a>
<a class="sourceLine" id="cb2-14" title="14">        <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (f b) s2)</a>
<a class="sourceLine" id="cb2-15" title="15"></a>
<a class="sourceLine" id="cb2-16" title="16">  <span class="co">-- (expand return)</span></a>
<a class="sourceLine" id="cb2-17" title="17"></a>
<a class="sourceLine" id="cb2-18" title="18">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-19" title="19">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> <span class="fu">return</span> (a,s)) s1</a>
<a class="sourceLine" id="cb2-20" title="20">        <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (f b) s2)</a>
<a class="sourceLine" id="cb2-21" title="21"></a>
<a class="sourceLine" id="cb2-22" title="22">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb2-23" title="23"></a>
<a class="sourceLine" id="cb2-24" title="24">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-25" title="25">      (\s <span class="ot">-&gt;</span> <span class="fu">return</span> (a,s)) s1</a>
<a class="sourceLine" id="cb2-26" title="26">        <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (f b) s2)</a>
<a class="sourceLine" id="cb2-27" title="27"></a>
<a class="sourceLine" id="cb2-28" title="28">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb2-29" title="29"></a>
<a class="sourceLine" id="cb2-30" title="30">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-31" title="31">      <span class="fu">return</span> (a,s1)</a>
<a class="sourceLine" id="cb2-32" title="32">        <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (f b) s2)</a>
<a class="sourceLine" id="cb2-33" title="33"></a>
<a class="sourceLine" id="cb2-34" title="34">  <span class="co">-- (left identity law for m)</span></a>
<a class="sourceLine" id="cb2-35" title="35"></a>
<a class="sourceLine" id="cb2-36" title="36">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-37" title="37">      (\(b, s2) <span class="ot">-&gt;</span> unStreamT (f b) s2) (a, s1)</a>
<a class="sourceLine" id="cb2-38" title="38"></a>
<a class="sourceLine" id="cb2-39" title="39">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb2-40" title="40"></a>
<a class="sourceLine" id="cb2-41" title="41">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb2-42" title="42">      unStreamT (f a) s1</a>
<a class="sourceLine" id="cb2-43" title="43"></a>
<a class="sourceLine" id="cb2-44" title="44">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb2-45" title="45"></a>
<a class="sourceLine" id="cb2-46" title="46">  , <span class="dt">StreamT</span> <span class="op">$</span> (unStreamT (f a))</a>
<a class="sourceLine" id="cb2-47" title="47"></a>
<a class="sourceLine" id="cb2-48" title="48">  <span class="co">-- (StreamT . unStreamT == id)</span></a>
<a class="sourceLine" id="cb2-49" title="49"></a>
<a class="sourceLine" id="cb2-50" title="50">  , f a</a>
<a class="sourceLine" id="cb2-51" title="51">  ]</a></code></pre></div>
</div>
<p>Second: <code>StreamT s m</code> satisfies the right identity law.</p>
<div class="example">
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1">_StreamT_right_identity_law</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m a</a>
<a class="sourceLine" id="cb3-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="ot">=&gt;</span> (<span class="dt">StreamT</span> s m a)</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m a]</a>
<a class="sourceLine" id="cb3-6" title="6">_StreamT_right_identity_law x <span class="ot">=</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8">  [ x <span class="op">&gt;&gt;=</span> <span class="fu">return</span></a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-13" title="13">      unStreamT x s1</a>
<a class="sourceLine" id="cb3-14" title="14">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> a) s2)</a>
<a class="sourceLine" id="cb3-15" title="15"></a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="co">-- (expand return)</span></a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-19" title="19">      unStreamT x s1</a>
<a class="sourceLine" id="cb3-20" title="20">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> <span class="fu">return</span> (a,s)) s2)</a>
<a class="sourceLine" id="cb3-21" title="21"></a>
<a class="sourceLine" id="cb3-22" title="22">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb3-23" title="23"></a>
<a class="sourceLine" id="cb3-24" title="24">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-25" title="25">      unStreamT x s1</a>
<a class="sourceLine" id="cb3-26" title="26">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> (\s <span class="ot">-&gt;</span> <span class="fu">return</span> (a,s)) s2)</a>
<a class="sourceLine" id="cb3-27" title="27"></a>
<a class="sourceLine" id="cb3-28" title="28">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb3-29" title="29"></a>
<a class="sourceLine" id="cb3-30" title="30">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-31" title="31">      unStreamT x s1</a>
<a class="sourceLine" id="cb3-32" title="32">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> <span class="fu">return</span> (a, s2))</a>
<a class="sourceLine" id="cb3-33" title="33"></a>
<a class="sourceLine" id="cb3-34" title="34">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb3-35" title="35"></a>
<a class="sourceLine" id="cb3-36" title="36">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb3-37" title="37">      unStreamT x s1</a>
<a class="sourceLine" id="cb3-38" title="38">        <span class="op">&gt;&gt;=</span> <span class="fu">return</span></a>
<a class="sourceLine" id="cb3-39" title="39"></a>
<a class="sourceLine" id="cb3-40" title="40">  <span class="co">-- (right identity law for m)</span></a>
<a class="sourceLine" id="cb3-41" title="41"></a>
<a class="sourceLine" id="cb3-42" title="42">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> unStreamT x s1</a>
<a class="sourceLine" id="cb3-43" title="43"></a>
<a class="sourceLine" id="cb3-44" title="44">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb3-45" title="45"></a>
<a class="sourceLine" id="cb3-46" title="46">  , <span class="dt">StreamT</span> <span class="op">$</span> unStreamT x</a>
<a class="sourceLine" id="cb3-47" title="47"></a>
<a class="sourceLine" id="cb3-48" title="48">  <span class="co">-- (StreamT . unStreamT == id)</span></a>
<a class="sourceLine" id="cb3-49" title="49"></a>
<a class="sourceLine" id="cb3-50" title="50">  , x</a>
<a class="sourceLine" id="cb3-51" title="51">  ]</a></code></pre></div>
</div>
<p>Third: <code>StreamT s m</code> satisfies the associativity law.</p>
<div class="example">
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1">_StreamT_associativity_law</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m a b c</a>
<a class="sourceLine" id="cb4-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="ot">=&gt;</span> <span class="dt">StreamT</span> s m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> <span class="dt">StreamT</span> s m b) <span class="ot">-&gt;</span> (b <span class="ot">-&gt;</span> <span class="dt">StreamT</span> s m c)</a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m c]</a>
<a class="sourceLine" id="cb4-6" title="6">_StreamT_associativity_law x f g <span class="ot">=</span></a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8">  [ (x <span class="op">&gt;&gt;=</span> f) <span class="op">&gt;&gt;=</span> g</a>
<a class="sourceLine" id="cb4-9" title="9"></a>
<a class="sourceLine" id="cb4-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-13" title="13">      unStreamT (x <span class="op">&gt;&gt;=</span> f) s1</a>
<a class="sourceLine" id="cb4-14" title="14">        <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (g b) s2)</a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb4-17" title="17"></a>
<a class="sourceLine" id="cb4-18" title="18">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-19" title="19">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-20" title="20">        unStreamT x s2 <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span> unStreamT (f a) s3)) s1</a>
<a class="sourceLine" id="cb4-21" title="21">        <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (g b) s2)</a>
<a class="sourceLine" id="cb4-22" title="22"></a>
<a class="sourceLine" id="cb4-23" title="23">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb4-24" title="24"></a>
<a class="sourceLine" id="cb4-25" title="25">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-26" title="26">      (\s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-27" title="27">        unStreamT x s2 <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span> unStreamT (f a) s3)) s1</a>
<a class="sourceLine" id="cb4-28" title="28">        <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (g b) s2)</a>
<a class="sourceLine" id="cb4-29" title="29"></a>
<a class="sourceLine" id="cb4-30" title="30">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb4-31" title="31"></a>
<a class="sourceLine" id="cb4-32" title="32">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-33" title="33">      unStreamT x s1 <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span> unStreamT (f a) s3)</a>
<a class="sourceLine" id="cb4-34" title="34">        <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (g b) s2)</a>
<a class="sourceLine" id="cb4-35" title="35"></a>
<a class="sourceLine" id="cb4-36" title="36">  <span class="co">-- (associativity law in m)</span></a>
<a class="sourceLine" id="cb4-37" title="37"></a>
<a class="sourceLine" id="cb4-38" title="38">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-39" title="39">      unStreamT x s1 <span class="op">&gt;&gt;=</span> (\(c, s4) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-40" title="40">        (\(a, s3) <span class="ot">-&gt;</span> unStreamT (f a) s3) (c, s4)</a>
<a class="sourceLine" id="cb4-41" title="41">          <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (g b) s2))</a>
<a class="sourceLine" id="cb4-42" title="42"></a>
<a class="sourceLine" id="cb4-43" title="43">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb4-44" title="44"></a>
<a class="sourceLine" id="cb4-45" title="45">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-46" title="46">      unStreamT x s1 <span class="op">&gt;&gt;=</span> (\(c, s4) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-47" title="47">        unStreamT (f c) s4</a>
<a class="sourceLine" id="cb4-48" title="48">          <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (g b) s2))</a>
<a class="sourceLine" id="cb4-49" title="49"></a>
<a class="sourceLine" id="cb4-50" title="50">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb4-51" title="51"></a>
<a class="sourceLine" id="cb4-52" title="52">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-53" title="53">      unStreamT x s1 <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb4-54" title="54">        (\(c, s4) <span class="ot">-&gt;</span> (\s5 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-55" title="55">          unStreamT (f c) s5 <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (g b) s2)) s4)</a>
<a class="sourceLine" id="cb4-56" title="56"></a>
<a class="sourceLine" id="cb4-57" title="57">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb4-58" title="58"></a>
<a class="sourceLine" id="cb4-59" title="59">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-60" title="60">      unStreamT x s1 <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb4-61" title="61">        (\(c, s4) <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s5 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-62" title="62">          unStreamT (f c) s5 <span class="op">&gt;&gt;=</span> (\(b, s2) <span class="ot">-&gt;</span> unStreamT (g b) s2)) s4)</a>
<a class="sourceLine" id="cb4-63" title="63"></a>
<a class="sourceLine" id="cb4-64" title="64">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb4-65" title="65"></a>
<a class="sourceLine" id="cb4-66" title="66">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-67" title="67">      unStreamT x s1 <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb4-68" title="68">        (\(c, s4) <span class="ot">-&gt;</span> unStreamT (f c <span class="op">&gt;&gt;=</span> g) s4)</a>
<a class="sourceLine" id="cb4-69" title="69"></a>
<a class="sourceLine" id="cb4-70" title="70">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb4-71" title="71"></a>
<a class="sourceLine" id="cb4-72" title="72">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb4-73" title="73">      unStreamT x s1 <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb4-74" title="74">        (\(c, s4) <span class="ot">-&gt;</span> unStreamT ((\a <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> g) c) s4)</a>
<a class="sourceLine" id="cb4-75" title="75"></a>
<a class="sourceLine" id="cb4-76" title="76">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb4-77" title="77"></a>
<a class="sourceLine" id="cb4-78" title="78">  , x <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> g)</a>
<a class="sourceLine" id="cb4-79" title="79">  ]</a></code></pre></div>
</div>
</section>
<section class="level2">
<h2>Monad Transformer Laws</h2>
<p><a name='crossref-1'></a></p>
<p>Recall the two <em>monad transformer laws</em>:</p>
<dl>
<dt>Unit Law</dt>
<dd><code>lift . return</code> is equivalent to <code>return</code>
</dd>
<dt>Bind Law</dt>
<dd><code>lift (x &gt;&gt;= f)</code> is equivalent to <code>lift x &gt;&gt;= (lift . f)</code>
</dd>
</dl>
<p>Here we show that <code>StreamT s</code> is a monad transformer. First: <code>StreamT s</code> satisfies the unit law.</p>
<div class="example">
<div class="sourceCode" id="cb5"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1">_StreamT_unit_law</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m a</a>
<a class="sourceLine" id="cb5-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="ot">=&gt;</span> a</a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m a]</a>
<a class="sourceLine" id="cb5-6" title="6">_StreamT_unit_law a <span class="ot">=</span></a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8">  [ lift (<span class="fu">return</span> a)</a>
<a class="sourceLine" id="cb5-9" title="9"></a>
<a class="sourceLine" id="cb5-10" title="10">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-13" title="13">      <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb5-14" title="14">        <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))</a>
<a class="sourceLine" id="cb5-15" title="15"></a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="co">-- (left identity law for m)</span></a>
<a class="sourceLine" id="cb5-17" title="17"></a>
<a class="sourceLine" id="cb5-18" title="18">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-19" title="19">      (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s)) a</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb5-22" title="22"></a>
<a class="sourceLine" id="cb5-23" title="23">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb5-24" title="24">      <span class="fu">return</span> (a, s)</a>
<a class="sourceLine" id="cb5-25" title="25"></a>
<a class="sourceLine" id="cb5-26" title="26">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb5-27" title="27"></a>
<a class="sourceLine" id="cb5-28" title="28">  , <span class="fu">return</span> a</a>
<a class="sourceLine" id="cb5-29" title="29">  ]</a></code></pre></div>
</div>
<p>Second: <code>StreamT s</code> satisfies the bind law.</p>
<div class="example">
<div class="sourceCode" id="cb6"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1">_StreamT_bind_law</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m a b</a>
<a class="sourceLine" id="cb6-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="ot">=&gt;</span> m a <span class="ot">-&gt;</span> (a <span class="ot">-&gt;</span> m b)</a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m b]</a>
<a class="sourceLine" id="cb6-6" title="6">_StreamT_bind_law x f <span class="ot">=</span></a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">  [ lift (x <span class="op">&gt;&gt;=</span> f)</a>
<a class="sourceLine" id="cb6-9" title="9"></a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb6-11" title="11"></a>
<a class="sourceLine" id="cb6-12" title="12">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-13" title="13">      (x <span class="op">&gt;&gt;=</span> f)</a>
<a class="sourceLine" id="cb6-14" title="14">        <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (a, s))</a>
<a class="sourceLine" id="cb6-15" title="15"></a>
<a class="sourceLine" id="cb6-16" title="16">  <span class="co">-- (associativity law for m)</span></a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-19" title="19">      x</a>
<a class="sourceLine" id="cb6-20" title="20">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> f c <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (a, s)))</a>
<a class="sourceLine" id="cb6-21" title="21"></a>
<a class="sourceLine" id="cb6-22" title="22">  <span class="co">-- (α-conversion)</span></a>
<a class="sourceLine" id="cb6-23" title="23"></a>
<a class="sourceLine" id="cb6-24" title="24">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-25" title="25">      x</a>
<a class="sourceLine" id="cb6-26" title="26">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> f c <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> <span class="fu">return</span> (d, s1)))</a>
<a class="sourceLine" id="cb6-27" title="27"></a>
<a class="sourceLine" id="cb6-28" title="28">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb6-29" title="29"></a>
<a class="sourceLine" id="cb6-30" title="30">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-31" title="31">      x</a>
<a class="sourceLine" id="cb6-32" title="32">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-33" title="33">          (\(a, s2) <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> <span class="fu">return</span> (d, s2))) (c, s1))</a>
<a class="sourceLine" id="cb6-34" title="34"></a>
<a class="sourceLine" id="cb6-35" title="35">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb6-36" title="36"></a>
<a class="sourceLine" id="cb6-37" title="37">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-38" title="38">      x</a>
<a class="sourceLine" id="cb6-39" title="39">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> <span class="fu">return</span> (c, s1)</a>
<a class="sourceLine" id="cb6-40" title="40">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> <span class="fu">return</span> (d, s2))))</a>
<a class="sourceLine" id="cb6-41" title="41"></a>
<a class="sourceLine" id="cb6-42" title="42">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb6-43" title="43"></a>
<a class="sourceLine" id="cb6-44" title="44">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-45" title="45">      x</a>
<a class="sourceLine" id="cb6-46" title="46">        <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)) c</a>
<a class="sourceLine" id="cb6-47" title="47">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> <span class="fu">return</span> (d, s2))))</a>
<a class="sourceLine" id="cb6-48" title="48"></a>
<a class="sourceLine" id="cb6-49" title="49">  <span class="co">-- (associativity law in m)</span></a>
<a class="sourceLine" id="cb6-50" title="50"></a>
<a class="sourceLine" id="cb6-51" title="51">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-52" title="52">      x</a>
<a class="sourceLine" id="cb6-53" title="53">        <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1))</a>
<a class="sourceLine" id="cb6-54" title="54">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> <span class="fu">return</span> (d, s2)))</a>
<a class="sourceLine" id="cb6-55" title="55"></a>
<a class="sourceLine" id="cb6-56" title="56">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb6-57" title="57"></a>
<a class="sourceLine" id="cb6-58" title="58">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-59" title="59">      x</a>
<a class="sourceLine" id="cb6-60" title="60">        <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1))</a>
<a class="sourceLine" id="cb6-61" title="61">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> (\s <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> <span class="fu">return</span> (d, s))) s2)</a>
<a class="sourceLine" id="cb6-62" title="62"></a>
<a class="sourceLine" id="cb6-63" title="63">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb6-64" title="64"></a>
<a class="sourceLine" id="cb6-65" title="65">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-66" title="66">      x</a>
<a class="sourceLine" id="cb6-67" title="67">        <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1))</a>
<a class="sourceLine" id="cb6-68" title="68">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> f a <span class="op">&gt;&gt;=</span> (\d <span class="ot">-&gt;</span> <span class="fu">return</span> (d, s))) s2)</a>
<a class="sourceLine" id="cb6-69" title="69"></a>
<a class="sourceLine" id="cb6-70" title="70">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb6-71" title="71"></a>
<a class="sourceLine" id="cb6-72" title="72">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-73" title="73">      x</a>
<a class="sourceLine" id="cb6-74" title="74">        <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1))</a>
<a class="sourceLine" id="cb6-75" title="75">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (lift (f a)) s2)</a>
<a class="sourceLine" id="cb6-76" title="76"></a>
<a class="sourceLine" id="cb6-77" title="77">  <span class="co">-- (definition of .)</span></a>
<a class="sourceLine" id="cb6-78" title="78"></a>
<a class="sourceLine" id="cb6-79" title="79">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-80" title="80">      x</a>
<a class="sourceLine" id="cb6-81" title="81">        <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1))</a>
<a class="sourceLine" id="cb6-82" title="82">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((lift <span class="op">.</span> f) a) s2)</a>
<a class="sourceLine" id="cb6-83" title="83"></a>
<a class="sourceLine" id="cb6-84" title="84">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb6-85" title="85"></a>
<a class="sourceLine" id="cb6-86" title="86">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-87" title="87">      ((\s <span class="ot">-&gt;</span> x <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1)</a>
<a class="sourceLine" id="cb6-88" title="88">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((lift <span class="op">.</span> f) a) s2)</a>
<a class="sourceLine" id="cb6-89" title="89"></a>
<a class="sourceLine" id="cb6-90" title="90">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb6-91" title="91"></a>
<a class="sourceLine" id="cb6-92" title="92">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-93" title="93">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> x <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb6-94" title="94">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((lift <span class="op">.</span> f) a) s2)</a>
<a class="sourceLine" id="cb6-95" title="95"></a>
<a class="sourceLine" id="cb6-96" title="96">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb6-97" title="97"></a>
<a class="sourceLine" id="cb6-98" title="98">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-99" title="99">      unStreamT (lift x) s1</a>
<a class="sourceLine" id="cb6-100" title="100">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((lift <span class="op">.</span> f) a) s2)</a>
<a class="sourceLine" id="cb6-101" title="101"></a>
<a class="sourceLine" id="cb6-102" title="102">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb6-103" title="103"></a>
<a class="sourceLine" id="cb6-104" title="104">  , lift x <span class="op">&gt;&gt;=</span> (lift <span class="op">.</span> f)</a>
<a class="sourceLine" id="cb6-105" title="105">  ]</a></code></pre></div>
</div>
</section>
<section class="level2">
<h2>MonadStream Laws</h2>
<p><a name='crossref-2'></a></p>
<p>There are two different <code>MonadStream</code> instances for <code>StreamT s m</code> that we need to verify. Recall the <code>MonadStream</code> laws:</p>
<dl>
<dt>Next/Rest Law</dt>
<dd><code>(,) &lt;$&gt; next &lt;*&gt; rest</code> is equivalent to <code>advance &lt;$&gt; rest &lt;* next</code>
</dd>
<dt>Rest/Rest Law</dt>
<dd><code>rest &gt;&gt;= (\u -&gt; rest &gt;&gt;= k u)</code> is equivalent to <code>rest &gt;&gt;= (\u -&gt; k u u)</code>
</dd>
<dt>Fiddle/Id Law</dt>
<dd><code>fiddle id</code> is equivalent to <code>return ()</code>
</dd>
<dt>Fiddle/Compose Law</dt>
<dd><code>fiddle u &gt;&gt; fiddle v</code> is equivalent to <code>fiddle (v . u)</code>
</dd>
<dt>Fiddle/Rest Law</dt>
<dd><code>fiddle u &gt;&gt; rest</code> is equivalent to <code>rest &gt;&gt;= (\a -&gt; fiddle u &gt;&gt; return (u a))</code>
</dd>
</dl>
<p>Here we show that if <code>m</code> is a monad then <code>StreamT s m</code> satisfies the <code>MonadStream</code> laws with stream type <code>s</code>.</p>
<p>First: <code>StreamT s m</code> satisfies the next/rest law with stream type <code>s</code>.</p>
<div class="example">
<div class="sourceCode" id="cb7"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1">_StreamT_next_rest_law_natural</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m</a>
<a class="sourceLine" id="cb7-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="ot">=&gt;</span> [ <span class="dt">StreamT</span> s m (<span class="dt">StreamValue</span> s, s) ]</a>
<a class="sourceLine" id="cb7-5" title="5">_StreamT_next_rest_law_natural <span class="ot">=</span></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7">  [ (advance <span class="op">&lt;$&gt;</span> rest) <span class="op">&lt;*</span> (next <span class="op">@</span>s)</a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9">  <span class="co">-- (expand &lt;*)</span></a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11">  , <span class="fu">const</span> <span class="op">&lt;$&gt;</span> (advance <span class="op">&lt;$&gt;</span> rest) <span class="op">&lt;*&gt;</span> (next <span class="op">@</span>s)</a>
<a class="sourceLine" id="cb7-12" title="12"></a>
<a class="sourceLine" id="cb7-13" title="13">  <span class="co">-- (expand &lt;$&gt;)</span></a>
<a class="sourceLine" id="cb7-14" title="14"></a>
<a class="sourceLine" id="cb7-15" title="15">  , (<span class="fu">fmap</span> <span class="fu">const</span> (advance <span class="op">&lt;$&gt;</span> rest)) <span class="op">&lt;*&gt;</span> (next <span class="op">@</span>s)</a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">  <span class="co">-- (expand &lt;$&gt;)</span></a>
<a class="sourceLine" id="cb7-18" title="18"></a>
<a class="sourceLine" id="cb7-19" title="19">  , (<span class="fu">fmap</span> <span class="fu">const</span> (<span class="fu">fmap</span> advance rest)) <span class="op">&lt;*&gt;</span> (next <span class="op">@</span>s)</a>
<a class="sourceLine" id="cb7-20" title="20"></a>
<a class="sourceLine" id="cb7-21" title="21">  <span class="co">-- (composite law for StreamT s m)</span></a>
<a class="sourceLine" id="cb7-22" title="22"></a>
<a class="sourceLine" id="cb7-23" title="23">  , (<span class="fu">fmap</span> (<span class="fu">const</span> <span class="op">.</span> advance) rest) <span class="op">&lt;*&gt;</span> (next <span class="op">@</span>s)</a>
<a class="sourceLine" id="cb7-24" title="24"></a>
<a class="sourceLine" id="cb7-25" title="25">  <span class="co">-- (expand &lt;*&gt;)</span></a>
<a class="sourceLine" id="cb7-26" title="26"></a>
<a class="sourceLine" id="cb7-27" title="27">  , (<span class="fu">fmap</span> (<span class="fu">const</span> <span class="op">.</span> advance) rest)</a>
<a class="sourceLine" id="cb7-28" title="28">      <span class="op">&gt;&gt;=</span> (\f <span class="ot">-&gt;</span> (next <span class="op">@</span>s) <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (f a)))</a>
<a class="sourceLine" id="cb7-29" title="29"></a>
<a class="sourceLine" id="cb7-30" title="30">  <span class="co">-- (expand fmap)</span></a>
<a class="sourceLine" id="cb7-31" title="31"></a>
<a class="sourceLine" id="cb7-32" title="32">  , (rest <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> <span class="fu">const</span> <span class="op">.</span> advance))</a>
<a class="sourceLine" id="cb7-33" title="33">      <span class="op">&gt;&gt;=</span> (\f <span class="ot">-&gt;</span> (next <span class="op">@</span>s) <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (f a)))</a>
<a class="sourceLine" id="cb7-34" title="34"></a>
<a class="sourceLine" id="cb7-35" title="35">  <span class="co">-- (associative law in StreamT s m)</span></a>
<a class="sourceLine" id="cb7-36" title="36"></a>
<a class="sourceLine" id="cb7-37" title="37">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> (<span class="fu">return</span> <span class="op">.</span> <span class="fu">const</span> <span class="op">.</span> advance) c</a>
<a class="sourceLine" id="cb7-38" title="38">      <span class="op">&gt;&gt;=</span> (\f <span class="ot">-&gt;</span> (next <span class="op">@</span>s) <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (f a))))</a>
<a class="sourceLine" id="cb7-39" title="39"></a>
<a class="sourceLine" id="cb7-40" title="40">  <span class="co">-- (expand .)</span></a>
<a class="sourceLine" id="cb7-41" title="41"></a>
<a class="sourceLine" id="cb7-42" title="42">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span> <span class="fu">return</span> (<span class="fu">const</span> (advance c))</a>
<a class="sourceLine" id="cb7-43" title="43">      <span class="op">&gt;&gt;=</span> (\f <span class="ot">-&gt;</span> (next <span class="op">@</span>s) <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (f a))))</a>
<a class="sourceLine" id="cb7-44" title="44"></a>
<a class="sourceLine" id="cb7-45" title="45">  <span class="co">-- (left identity law in StreamT s m)</span></a>
<a class="sourceLine" id="cb7-46" title="46"></a>
<a class="sourceLine" id="cb7-47" title="47">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-48" title="48">      (\f <span class="ot">-&gt;</span> (next <span class="op">@</span>s) <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (f a))) (<span class="fu">const</span> (advance c)))</a>
<a class="sourceLine" id="cb7-49" title="49"></a>
<a class="sourceLine" id="cb7-50" title="50">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-51" title="51"></a>
<a class="sourceLine" id="cb7-52" title="52">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-53" title="53">      (next <span class="op">@</span>s) <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (<span class="fu">const</span> (advance c) a)))</a>
<a class="sourceLine" id="cb7-54" title="54"></a>
<a class="sourceLine" id="cb7-55" title="55">  <span class="co">-- (expand const)</span></a>
<a class="sourceLine" id="cb7-56" title="56"></a>
<a class="sourceLine" id="cb7-57" title="57">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-58" title="58">      (next <span class="op">@</span>s) <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (advance c)))</a>
<a class="sourceLine" id="cb7-59" title="59"></a>
<a class="sourceLine" id="cb7-60" title="60">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb7-61" title="61"></a>
<a class="sourceLine" id="cb7-62" title="62">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-63" title="63">      <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-64" title="64">        unStreamT (next <span class="op">@</span>s) s2</a>
<a class="sourceLine" id="cb7-65" title="65">          <span class="op">&gt;&gt;=</span> (\(b, s1) <span class="ot">-&gt;</span> unStreamT ((\a <span class="ot">-&gt;</span> <span class="fu">return</span> (advance c)) b) s1))</a>
<a class="sourceLine" id="cb7-66" title="66"></a>
<a class="sourceLine" id="cb7-67" title="67">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-68" title="68"></a>
<a class="sourceLine" id="cb7-69" title="69">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-70" title="70">      <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-71" title="71">        unStreamT (next <span class="op">@</span>s) s2</a>
<a class="sourceLine" id="cb7-72" title="72">          <span class="op">&gt;&gt;=</span> (\(b, s1) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (advance c)) s1))</a>
<a class="sourceLine" id="cb7-73" title="73"></a>
<a class="sourceLine" id="cb7-74" title="74">  <span class="co">-- (expand next)</span></a>
<a class="sourceLine" id="cb7-75" title="75"></a>
<a class="sourceLine" id="cb7-76" title="76">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-77" title="77">      <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-78" title="78">        unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s3 <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s3)) s2</a>
<a class="sourceLine" id="cb7-79" title="79">          <span class="op">&gt;&gt;=</span> (\(b, s1) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (advance c)) s1))</a>
<a class="sourceLine" id="cb7-80" title="80"></a>
<a class="sourceLine" id="cb7-81" title="81">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-82" title="82"></a>
<a class="sourceLine" id="cb7-83" title="83">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-84" title="84">      <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-85" title="85">        (\s3 <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s3)) s2</a>
<a class="sourceLine" id="cb7-86" title="86">          <span class="op">&gt;&gt;=</span> (\(b, s1) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (advance c)) s1))</a>
<a class="sourceLine" id="cb7-87" title="87"></a>
<a class="sourceLine" id="cb7-88" title="88">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-89" title="89"></a>
<a class="sourceLine" id="cb7-90" title="90">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-91" title="91">      <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-92" title="92">        <span class="fu">return</span> (advance s2)</a>
<a class="sourceLine" id="cb7-93" title="93">          <span class="op">&gt;&gt;=</span> (\(b, s1) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (advance c)) s1))</a>
<a class="sourceLine" id="cb7-94" title="94"></a>
<a class="sourceLine" id="cb7-95" title="95">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb7-96" title="96"></a>
<a class="sourceLine" id="cb7-97" title="97">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-98" title="98">      <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-99" title="99">        (\(b, s1) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (advance c)) s1) (advance s2))</a>
<a class="sourceLine" id="cb7-100" title="100"></a>
<a class="sourceLine" id="cb7-101" title="101">  <span class="co">-- (expand return)</span></a>
<a class="sourceLine" id="cb7-102" title="102"></a>
<a class="sourceLine" id="cb7-103" title="103">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-104" title="104">      <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-105" title="105">        (\(b, s1) <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-106" title="106">          <span class="fu">return</span> (advance c, s2)) s1) (advance s2))</a>
<a class="sourceLine" id="cb7-107" title="107"></a>
<a class="sourceLine" id="cb7-108" title="108">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-109" title="109"></a>
<a class="sourceLine" id="cb7-110" title="110">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-111" title="111">      <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-112" title="112">        (\(b, s1) <span class="ot">-&gt;</span> (\s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-113" title="113">          <span class="fu">return</span> (advance c, s2)) s1) (advance s2))</a>
<a class="sourceLine" id="cb7-114" title="114"></a>
<a class="sourceLine" id="cb7-115" title="115">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-116" title="116"></a>
<a class="sourceLine" id="cb7-117" title="117">  , rest <span class="op">&gt;&gt;=</span> (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-118" title="118">      <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-119" title="119">        (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance c, s1)) (advance s2))</a>
<a class="sourceLine" id="cb7-120" title="120"></a>
<a class="sourceLine" id="cb7-121" title="121">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb7-122" title="122"></a>
<a class="sourceLine" id="cb7-123" title="123">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-124" title="124">      unStreamT rest s</a>
<a class="sourceLine" id="cb7-125" title="125">        <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span> unStreamT ((\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-126" title="126">          <span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-127" title="127">            (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance c, s1)) (advance s2)) a) s3)</a>
<a class="sourceLine" id="cb7-128" title="128"></a>
<a class="sourceLine" id="cb7-129" title="129">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-130" title="130"></a>
<a class="sourceLine" id="cb7-131" title="131">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-132" title="132">      unStreamT rest s</a>
<a class="sourceLine" id="cb7-133" title="133">        <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-134" title="134">          (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s3, s1)) (advance s2)) a)</a>
<a class="sourceLine" id="cb7-135" title="135"></a>
<a class="sourceLine" id="cb7-136" title="136">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-137" title="137"></a>
<a class="sourceLine" id="cb7-138" title="138">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-139" title="139">      unStreamT rest s</a>
<a class="sourceLine" id="cb7-140" title="140">        <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span> (\s2 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-141" title="141">          (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s3, s1)) (advance s2)) a)</a>
<a class="sourceLine" id="cb7-142" title="142"></a>
<a class="sourceLine" id="cb7-143" title="143">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-144" title="144"></a>
<a class="sourceLine" id="cb7-145" title="145">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-146" title="146">      unStreamT rest s</a>
<a class="sourceLine" id="cb7-147" title="147">        <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-148" title="148">          (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s3, s1)) (advance a))</a>
<a class="sourceLine" id="cb7-149" title="149"></a>
<a class="sourceLine" id="cb7-150" title="150">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb7-151" title="151"></a>
<a class="sourceLine" id="cb7-152" title="152">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-153" title="153">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span> <span class="fu">return</span> (s2, s2)) s</a>
<a class="sourceLine" id="cb7-154" title="154">        <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-155" title="155">          (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s3, s1)) (advance a))</a>
<a class="sourceLine" id="cb7-156" title="156"></a>
<a class="sourceLine" id="cb7-157" title="157">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-158" title="158"></a>
<a class="sourceLine" id="cb7-159" title="159">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-160" title="160">      (\s2 <span class="ot">-&gt;</span> <span class="fu">return</span> (s2, s2)) s</a>
<a class="sourceLine" id="cb7-161" title="161">        <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-162" title="162">          (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s3, s1)) (advance a))</a>
<a class="sourceLine" id="cb7-163" title="163"></a>
<a class="sourceLine" id="cb7-164" title="164">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-165" title="165"></a>
<a class="sourceLine" id="cb7-166" title="166">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-167" title="167">      <span class="fu">return</span> (s, s)</a>
<a class="sourceLine" id="cb7-168" title="168">        <span class="op">&gt;&gt;=</span> (\(a, s3) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-169" title="169">          (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s3, s1)) (advance a))</a>
<a class="sourceLine" id="cb7-170" title="170"></a>
<a class="sourceLine" id="cb7-171" title="171">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb7-172" title="172"></a>
<a class="sourceLine" id="cb7-173" title="173">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-174" title="174">      (\(a, s3) <span class="ot">-&gt;</span> (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s3, s1)) (advance a)) (s, s)</a>
<a class="sourceLine" id="cb7-175" title="175"></a>
<a class="sourceLine" id="cb7-176" title="176">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-177" title="177"></a>
<a class="sourceLine" id="cb7-178" title="178">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-179" title="179">      (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s, s1)) (advance s)</a>
<a class="sourceLine" id="cb7-180" title="180"></a>
<a class="sourceLine" id="cb7-181" title="181">  <span class="co">-- (condense snd)</span></a>
<a class="sourceLine" id="cb7-182" title="182"></a>
<a class="sourceLine" id="cb7-183" title="183">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-184" title="184">      (\(b, s1) <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s, <span class="fu">snd</span> (b, s1))) (advance s)</a>
<a class="sourceLine" id="cb7-185" title="185"></a>
<a class="sourceLine" id="cb7-186" title="186">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb7-187" title="187"></a>
<a class="sourceLine" id="cb7-188" title="188">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-189" title="189">      <span class="fu">return</span> (advance s, <span class="fu">snd</span> (advance s))</a>
<a class="sourceLine" id="cb7-190" title="190"></a>
<a class="sourceLine" id="cb7-191" title="191">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-192" title="192"></a>
<a class="sourceLine" id="cb7-193" title="193">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-194" title="194">      (\(c, s3) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, s3), <span class="fu">snd</span> (c, s3))) (advance s)</a>
<a class="sourceLine" id="cb7-195" title="195"></a>
<a class="sourceLine" id="cb7-196" title="196">  <span class="co">-- (expand snd)</span></a>
<a class="sourceLine" id="cb7-197" title="197"></a>
<a class="sourceLine" id="cb7-198" title="198">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-199" title="199">      (\(c, s3) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, s3), s3)) (advance s)</a>
<a class="sourceLine" id="cb7-200" title="200"></a>
<a class="sourceLine" id="cb7-201" title="201">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb7-202" title="202"></a>
<a class="sourceLine" id="cb7-203" title="203">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-204" title="204">      <span class="fu">return</span> (advance s) <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-205" title="205">        (\(c, s3) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, s3), s3))</a>
<a class="sourceLine" id="cb7-206" title="206"></a>
<a class="sourceLine" id="cb7-207" title="207">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-208" title="208"></a>
<a class="sourceLine" id="cb7-209" title="209">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-210" title="210">      (\s1 <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s1)) s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-211" title="211">        (\(c, s3) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, s3), s3))</a>
<a class="sourceLine" id="cb7-212" title="212"></a>
<a class="sourceLine" id="cb7-213" title="213">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-214" title="214"></a>
<a class="sourceLine" id="cb7-215" title="215">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-216" title="216">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> <span class="fu">return</span> (advance s1)) s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-217" title="217">        (\(c, s3) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, s3), s3))</a>
<a class="sourceLine" id="cb7-218" title="218"></a>
<a class="sourceLine" id="cb7-219" title="219">  <span class="co">-- (condense next)</span></a>
<a class="sourceLine" id="cb7-220" title="220"></a>
<a class="sourceLine" id="cb7-221" title="221">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-222" title="222">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-223" title="223">        (\(c, s3) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, s3), s3))</a>
<a class="sourceLine" id="cb7-224" title="224"></a>
<a class="sourceLine" id="cb7-225" title="225">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-226" title="226"></a>
<a class="sourceLine" id="cb7-227" title="227">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-228" title="228">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-229" title="229">        (\(c, s3) <span class="ot">-&gt;</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, b), s4)) (s3, s3))</a>
<a class="sourceLine" id="cb7-230" title="230"></a>
<a class="sourceLine" id="cb7-231" title="231">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb7-232" title="232"></a>
<a class="sourceLine" id="cb7-233" title="233">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-234" title="234">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-235" title="235">        (\(c, s3) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-236" title="236">          <span class="fu">return</span> (s3, s3)</a>
<a class="sourceLine" id="cb7-237" title="237">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, b), s4)))</a>
<a class="sourceLine" id="cb7-238" title="238"></a>
<a class="sourceLine" id="cb7-239" title="239">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-240" title="240"></a>
<a class="sourceLine" id="cb7-241" title="241">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-242" title="242">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-243" title="243">        (\(c, s3) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-244" title="244">          (\s2 <span class="ot">-&gt;</span> <span class="fu">return</span> (s2, s2)) s3</a>
<a class="sourceLine" id="cb7-245" title="245">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, b), s4)))</a>
<a class="sourceLine" id="cb7-246" title="246"></a>
<a class="sourceLine" id="cb7-247" title="247">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-248" title="248"></a>
<a class="sourceLine" id="cb7-249" title="249">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-250" title="250">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-251" title="251">        (\(c, s3) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-252" title="252">          unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s2 <span class="ot">-&gt;</span> <span class="fu">return</span> (s2, s2)) s3</a>
<a class="sourceLine" id="cb7-253" title="253">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, b), s4)))</a>
<a class="sourceLine" id="cb7-254" title="254"></a>
<a class="sourceLine" id="cb7-255" title="255">  <span class="co">-- (condense rest)</span></a>
<a class="sourceLine" id="cb7-256" title="256"></a>
<a class="sourceLine" id="cb7-257" title="257">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-258" title="258">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-259" title="259">        (\(c, s3) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-260" title="260">          unStreamT rest s3</a>
<a class="sourceLine" id="cb7-261" title="261">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c, b), s4)))</a>
<a class="sourceLine" id="cb7-262" title="262"></a>
<a class="sourceLine" id="cb7-263" title="263">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-264" title="264"></a>
<a class="sourceLine" id="cb7-265" title="265">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-266" title="266">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-267" title="267">        (\(c, s3) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-268" title="268">          unStreamT rest s3</a>
<a class="sourceLine" id="cb7-269" title="269">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c,) b, s4)))</a>
<a class="sourceLine" id="cb7-270" title="270"></a>
<a class="sourceLine" id="cb7-271" title="271">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-272" title="272"></a>
<a class="sourceLine" id="cb7-273" title="273">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-274" title="274">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-275" title="275">        (\(c, s3) <span class="ot">-&gt;</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-276" title="276">          unStreamT rest s2</a>
<a class="sourceLine" id="cb7-277" title="277">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4))) ((c,), s3))</a>
<a class="sourceLine" id="cb7-278" title="278"></a>
<a class="sourceLine" id="cb7-279" title="279">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb7-280" title="280"></a>
<a class="sourceLine" id="cb7-281" title="281">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-282" title="282">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-283" title="283">        (\(c, s3) <span class="ot">-&gt;</span> <span class="fu">return</span> ((c,), s3)</a>
<a class="sourceLine" id="cb7-284" title="284">          <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-285" title="285">            unStreamT rest s2</a>
<a class="sourceLine" id="cb7-286" title="286">              <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4))))</a>
<a class="sourceLine" id="cb7-287" title="287"></a>
<a class="sourceLine" id="cb7-288" title="288">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-289" title="289"></a>
<a class="sourceLine" id="cb7-290" title="290">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-291" title="291">      unStreamT next s <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb7-292" title="292">        (\(c, s3) <span class="ot">-&gt;</span> (\(a, s5) <span class="ot">-&gt;</span> <span class="fu">return</span> ((a,), s5)) (c, s3)</a>
<a class="sourceLine" id="cb7-293" title="293">          <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-294" title="294">            unStreamT rest s2</a>
<a class="sourceLine" id="cb7-295" title="295">              <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4))))</a>
<a class="sourceLine" id="cb7-296" title="296"></a>
<a class="sourceLine" id="cb7-297" title="297">  <span class="co">-- (associative law in m)</span></a>
<a class="sourceLine" id="cb7-298" title="298"></a>
<a class="sourceLine" id="cb7-299" title="299">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-300" title="300">      (unStreamT next s</a>
<a class="sourceLine" id="cb7-301" title="301">        <span class="op">&gt;&gt;=</span> (\(a, s5) <span class="ot">-&gt;</span> <span class="fu">return</span> ((a,), s5)))</a>
<a class="sourceLine" id="cb7-302" title="302">          <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-303" title="303">            unStreamT rest s2</a>
<a class="sourceLine" id="cb7-304" title="304">              <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4)))</a>
<a class="sourceLine" id="cb7-305" title="305"></a>
<a class="sourceLine" id="cb7-306" title="306">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-307" title="307"></a>
<a class="sourceLine" id="cb7-308" title="308">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-309" title="309">      (unStreamT next s</a>
<a class="sourceLine" id="cb7-310" title="310">        <span class="op">&gt;&gt;=</span> (\(a, s5) <span class="ot">-&gt;</span> (\s3 <span class="ot">-&gt;</span> <span class="fu">return</span> ((a,), s3)) s5))</a>
<a class="sourceLine" id="cb7-311" title="311">          <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-312" title="312">            unStreamT rest s2</a>
<a class="sourceLine" id="cb7-313" title="313">              <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4)))</a>
<a class="sourceLine" id="cb7-314" title="314"></a>
<a class="sourceLine" id="cb7-315" title="315">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-316" title="316"></a>
<a class="sourceLine" id="cb7-317" title="317">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-318" title="318">      (unStreamT next s</a>
<a class="sourceLine" id="cb7-319" title="319">        <span class="op">&gt;&gt;=</span> (\(a, s5) <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s3 <span class="ot">-&gt;</span> <span class="fu">return</span> ((a,), s3)) s5))</a>
<a class="sourceLine" id="cb7-320" title="320">          <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-321" title="321">            unStreamT rest s2</a>
<a class="sourceLine" id="cb7-322" title="322">              <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4)))</a>
<a class="sourceLine" id="cb7-323" title="323"></a>
<a class="sourceLine" id="cb7-324" title="324">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb7-325" title="325"></a>
<a class="sourceLine" id="cb7-326" title="326">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-327" title="327">      (unStreamT next s</a>
<a class="sourceLine" id="cb7-328" title="328">        <span class="op">&gt;&gt;=</span> (\(a, s5) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (a,)) s5))</a>
<a class="sourceLine" id="cb7-329" title="329">          <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-330" title="330">            unStreamT rest s2</a>
<a class="sourceLine" id="cb7-331" title="331">              <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4)))</a>
<a class="sourceLine" id="cb7-332" title="332"></a>
<a class="sourceLine" id="cb7-333" title="333">  <span class="co">-- (condense .)</span></a>
<a class="sourceLine" id="cb7-334" title="334"></a>
<a class="sourceLine" id="cb7-335" title="335">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-336" title="336">      (unStreamT next s</a>
<a class="sourceLine" id="cb7-337" title="337">        <span class="op">&gt;&gt;=</span> (\(a, s5) <span class="ot">-&gt;</span> unStreamT ((<span class="fu">return</span> <span class="op">.</span> (,)) a) s5))</a>
<a class="sourceLine" id="cb7-338" title="338">          <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-339" title="339">            unStreamT rest s2</a>
<a class="sourceLine" id="cb7-340" title="340">              <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4)))</a>
<a class="sourceLine" id="cb7-341" title="341"></a>
<a class="sourceLine" id="cb7-342" title="342">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-343" title="343"></a>
<a class="sourceLine" id="cb7-344" title="344">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-345" title="345">      (\s3 <span class="ot">-&gt;</span> unStreamT next s3</a>
<a class="sourceLine" id="cb7-346" title="346">        <span class="op">&gt;&gt;=</span> (\(a, s5) <span class="ot">-&gt;</span> unStreamT ((<span class="fu">return</span> <span class="op">.</span> (,)) a) s5)) s</a>
<a class="sourceLine" id="cb7-347" title="347">          <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-348" title="348">            unStreamT rest s2</a>
<a class="sourceLine" id="cb7-349" title="349">              <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4)))</a>
<a class="sourceLine" id="cb7-350" title="350"></a>
<a class="sourceLine" id="cb7-351" title="351">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-352" title="352"></a>
<a class="sourceLine" id="cb7-353" title="353">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-354" title="354">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s3 <span class="ot">-&gt;</span> unStreamT next s3</a>
<a class="sourceLine" id="cb7-355" title="355">        <span class="op">&gt;&gt;=</span> (\(a, s5) <span class="ot">-&gt;</span> unStreamT ((<span class="fu">return</span> <span class="op">.</span> (,)) a) s5)) s</a>
<a class="sourceLine" id="cb7-356" title="356">          <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-357" title="357">            unStreamT rest s2</a>
<a class="sourceLine" id="cb7-358" title="358">              <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4)))</a>
<a class="sourceLine" id="cb7-359" title="359"></a>
<a class="sourceLine" id="cb7-360" title="360">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb7-361" title="361"></a>
<a class="sourceLine" id="cb7-362" title="362">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-363" title="363">      unStreamT (next <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> (,))) s</a>
<a class="sourceLine" id="cb7-364" title="364">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-365" title="365">          unStreamT rest s2</a>
<a class="sourceLine" id="cb7-366" title="366">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s4)))</a>
<a class="sourceLine" id="cb7-367" title="367"></a>
<a class="sourceLine" id="cb7-368" title="368">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-369" title="369"></a>
<a class="sourceLine" id="cb7-370" title="370">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-371" title="371">      unStreamT (next <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> (,))) s</a>
<a class="sourceLine" id="cb7-372" title="372">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-373" title="373">          unStreamT rest s2</a>
<a class="sourceLine" id="cb7-374" title="374">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> (\s3 <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s3)) s4))</a>
<a class="sourceLine" id="cb7-375" title="375"></a>
<a class="sourceLine" id="cb7-376" title="376">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-377" title="377"></a>
<a class="sourceLine" id="cb7-378" title="378">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-379" title="379">      unStreamT (next <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> (,))) s</a>
<a class="sourceLine" id="cb7-380" title="380">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-381" title="381">          unStreamT rest s2</a>
<a class="sourceLine" id="cb7-382" title="382">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s3 <span class="ot">-&gt;</span> <span class="fu">return</span> (g b, s3)) s4))</a>
<a class="sourceLine" id="cb7-383" title="383"></a>
<a class="sourceLine" id="cb7-384" title="384">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb7-385" title="385"></a>
<a class="sourceLine" id="cb7-386" title="386">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-387" title="387">      unStreamT (next <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> (,))) s</a>
<a class="sourceLine" id="cb7-388" title="388">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-389" title="389">          unStreamT rest s2</a>
<a class="sourceLine" id="cb7-390" title="390">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (g b)) s4))</a>
<a class="sourceLine" id="cb7-391" title="391"></a>
<a class="sourceLine" id="cb7-392" title="392">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-393" title="393"></a>
<a class="sourceLine" id="cb7-394" title="394">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-395" title="395">      unStreamT (next <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> (,))) s</a>
<a class="sourceLine" id="cb7-396" title="396">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-397" title="397">          unStreamT rest s2</a>
<a class="sourceLine" id="cb7-398" title="398">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> unStreamT ((\a <span class="ot">-&gt;</span> <span class="fu">return</span> (g a)) b) s4))</a>
<a class="sourceLine" id="cb7-399" title="399"></a>
<a class="sourceLine" id="cb7-400" title="400">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-401" title="401"></a>
<a class="sourceLine" id="cb7-402" title="402">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-403" title="403">      unStreamT (next <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> (,))) s</a>
<a class="sourceLine" id="cb7-404" title="404">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span> (\s3 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-405" title="405">          unStreamT rest s3</a>
<a class="sourceLine" id="cb7-406" title="406">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> unStreamT ((\a <span class="ot">-&gt;</span> <span class="fu">return</span> (g a)) b) s4)) s2)</a>
<a class="sourceLine" id="cb7-407" title="407"></a>
<a class="sourceLine" id="cb7-408" title="408">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb7-409" title="409"></a>
<a class="sourceLine" id="cb7-410" title="410">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-411" title="411">      unStreamT (next <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> (,))) s</a>
<a class="sourceLine" id="cb7-412" title="412">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s3 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-413" title="413">          unStreamT rest s3</a>
<a class="sourceLine" id="cb7-414" title="414">            <span class="op">&gt;&gt;=</span> (\(b, s4) <span class="ot">-&gt;</span> unStreamT ((\a <span class="ot">-&gt;</span> <span class="fu">return</span> (g a)) b) s4)) s2)</a>
<a class="sourceLine" id="cb7-415" title="415"></a>
<a class="sourceLine" id="cb7-416" title="416">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb7-417" title="417"></a>
<a class="sourceLine" id="cb7-418" title="418">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-419" title="419">      unStreamT (next <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> (,))) s</a>
<a class="sourceLine" id="cb7-420" title="420">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span> unStreamT (rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (g a))) s2)</a>
<a class="sourceLine" id="cb7-421" title="421"></a>
<a class="sourceLine" id="cb7-422" title="422">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb7-423" title="423"></a>
<a class="sourceLine" id="cb7-424" title="424">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-425" title="425">      unStreamT (next <span class="op">&gt;&gt;=</span> (<span class="fu">return</span> <span class="op">.</span> (,))) s</a>
<a class="sourceLine" id="cb7-426" title="426">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span> unStreamT ((\f <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (f a))) g) s2)</a>
<a class="sourceLine" id="cb7-427" title="427"></a>
<a class="sourceLine" id="cb7-428" title="428">  <span class="co">-- (condense fmap)</span></a>
<a class="sourceLine" id="cb7-429" title="429"></a>
<a class="sourceLine" id="cb7-430" title="430">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-431" title="431">      unStreamT (<span class="fu">fmap</span> (,) next) s</a>
<a class="sourceLine" id="cb7-432" title="432">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span> unStreamT ((\f <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (f a))) g) s2)</a>
<a class="sourceLine" id="cb7-433" title="433"></a>
<a class="sourceLine" id="cb7-434" title="434">  <span class="co">-- (condense &lt;$&gt;)</span></a>
<a class="sourceLine" id="cb7-435" title="435"></a>
<a class="sourceLine" id="cb7-436" title="436">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb7-437" title="437">      unStreamT ((,) <span class="op">&lt;$&gt;</span> next) s</a>
<a class="sourceLine" id="cb7-438" title="438">        <span class="op">&gt;&gt;=</span> (\(g, s2) <span class="ot">-&gt;</span> unStreamT ((\f <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (f a))) g) s2)</a>
<a class="sourceLine" id="cb7-439" title="439"></a>
<a class="sourceLine" id="cb7-440" title="440">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb7-441" title="441"></a>
<a class="sourceLine" id="cb7-442" title="442">  , ((,) <span class="op">&lt;$&gt;</span> next) <span class="op">&gt;&gt;=</span> (\f <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> <span class="fu">return</span> (f a)))</a>
<a class="sourceLine" id="cb7-443" title="443"></a>
<a class="sourceLine" id="cb7-444" title="444">  <span class="co">-- (condense &lt;*&gt;)</span></a>
<a class="sourceLine" id="cb7-445" title="445"></a>
<a class="sourceLine" id="cb7-446" title="446">  , (,) <span class="op">&lt;$&gt;</span> next <span class="op">&lt;*&gt;</span> rest</a>
<a class="sourceLine" id="cb7-447" title="447">  ]</a></code></pre></div>
</div>
<p>Second: <code>StreamT s m</code> satisfies the rest/rest law with stream type <code>s</code>.</p>
<div class="example">
<div class="sourceCode" id="cb8"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1">_StreamT_rest_rest_law_natural</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m a</a>
<a class="sourceLine" id="cb8-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="ot">=&gt;</span> (s <span class="ot">-&gt;</span> s <span class="ot">-&gt;</span> <span class="dt">StreamT</span> s m a)</a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m a]</a>
<a class="sourceLine" id="cb8-6" title="6">_StreamT_rest_rest_law_natural k <span class="ot">=</span></a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8">  [ rest <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u)</a>
<a class="sourceLine" id="cb8-9" title="9"></a>
<a class="sourceLine" id="cb8-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-13" title="13">      unStreamT rest s1</a>
<a class="sourceLine" id="cb8-14" title="14">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb8-15" title="15"></a>
<a class="sourceLine" id="cb8-16" title="16">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb8-17" title="17"></a>
<a class="sourceLine" id="cb8-18" title="18">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-19" title="19">      unStreamT rest s1</a>
<a class="sourceLine" id="cb8-20" title="20">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (rest <span class="op">&gt;&gt;=</span> k a) s2)</a>
<a class="sourceLine" id="cb8-21" title="21"></a>
<a class="sourceLine" id="cb8-22" title="22">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb8-23" title="23"></a>
<a class="sourceLine" id="cb8-24" title="24">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-25" title="25">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> <span class="fu">return</span> (s, s)) s1</a>
<a class="sourceLine" id="cb8-26" title="26">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (rest <span class="op">&gt;&gt;=</span> k a) s2)</a>
<a class="sourceLine" id="cb8-27" title="27"></a>
<a class="sourceLine" id="cb8-28" title="28">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb8-29" title="29"></a>
<a class="sourceLine" id="cb8-30" title="30">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-31" title="31">      (\s <span class="ot">-&gt;</span> <span class="fu">return</span> (s, s)) s1</a>
<a class="sourceLine" id="cb8-32" title="32">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (rest <span class="op">&gt;&gt;=</span> k a) s2)</a>
<a class="sourceLine" id="cb8-33" title="33"></a>
<a class="sourceLine" id="cb8-34" title="34">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb8-35" title="35"></a>
<a class="sourceLine" id="cb8-36" title="36">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-37" title="37">      <span class="fu">return</span> (s1, s1)</a>
<a class="sourceLine" id="cb8-38" title="38">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (rest <span class="op">&gt;&gt;=</span> k a) s2)</a>
<a class="sourceLine" id="cb8-39" title="39"></a>
<a class="sourceLine" id="cb8-40" title="40">  <span class="co">-- (left identity law for m)</span></a>
<a class="sourceLine" id="cb8-41" title="41"></a>
<a class="sourceLine" id="cb8-42" title="42">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-43" title="43">      (\(a, s2) <span class="ot">-&gt;</span> unStreamT (rest <span class="op">&gt;&gt;=</span> k a) s2) (s1, s1)</a>
<a class="sourceLine" id="cb8-44" title="44"></a>
<a class="sourceLine" id="cb8-45" title="45">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb8-46" title="46"></a>
<a class="sourceLine" id="cb8-47" title="47">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-48" title="48">      unStreamT (rest <span class="op">&gt;&gt;=</span> k s1) s1</a>
<a class="sourceLine" id="cb8-49" title="49"></a>
<a class="sourceLine" id="cb8-50" title="50">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb8-51" title="51"></a>
<a class="sourceLine" id="cb8-52" title="52">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-53" title="53">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-54" title="54">        unStreamT rest s <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k s1 a) s2)) s1</a>
<a class="sourceLine" id="cb8-55" title="55"></a>
<a class="sourceLine" id="cb8-56" title="56">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb8-57" title="57"></a>
<a class="sourceLine" id="cb8-58" title="58">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-59" title="59">      (\s <span class="ot">-&gt;</span> unStreamT rest s <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k s1 a) s2)) s1</a>
<a class="sourceLine" id="cb8-60" title="60"></a>
<a class="sourceLine" id="cb8-61" title="61">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb8-62" title="62"></a>
<a class="sourceLine" id="cb8-63" title="63">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-64" title="64">      unStreamT rest s1</a>
<a class="sourceLine" id="cb8-65" title="65">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k s1 a) s2)</a>
<a class="sourceLine" id="cb8-66" title="66"></a>
<a class="sourceLine" id="cb8-67" title="67">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb8-68" title="68"></a>
<a class="sourceLine" id="cb8-69" title="69">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-70" title="70">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> <span class="fu">return</span> (s, s)) s1</a>
<a class="sourceLine" id="cb8-71" title="71">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k s1 a) s2)</a>
<a class="sourceLine" id="cb8-72" title="72"></a>
<a class="sourceLine" id="cb8-73" title="73">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb8-74" title="74"></a>
<a class="sourceLine" id="cb8-75" title="75">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-76" title="76">      (\s <span class="ot">-&gt;</span> <span class="fu">return</span> (s, s)) s1</a>
<a class="sourceLine" id="cb8-77" title="77">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k s1 a) s2)</a>
<a class="sourceLine" id="cb8-78" title="78"></a>
<a class="sourceLine" id="cb8-79" title="79">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb8-80" title="80"></a>
<a class="sourceLine" id="cb8-81" title="81">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-82" title="82">      <span class="fu">return</span> (s1, s1)</a>
<a class="sourceLine" id="cb8-83" title="83">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k s1 a) s2)</a>
<a class="sourceLine" id="cb8-84" title="84"></a>
<a class="sourceLine" id="cb8-85" title="85">  <span class="co">-- (left identity law for m)</span></a>
<a class="sourceLine" id="cb8-86" title="86"></a>
<a class="sourceLine" id="cb8-87" title="87">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-88" title="88">      (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k s1 a) s2) (s1, s1)</a>
<a class="sourceLine" id="cb8-89" title="89"></a>
<a class="sourceLine" id="cb8-90" title="90">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb8-91" title="91"></a>
<a class="sourceLine" id="cb8-92" title="92">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-93" title="93">      unStreamT (k s1 s1) s1</a>
<a class="sourceLine" id="cb8-94" title="94"></a>
<a class="sourceLine" id="cb8-95" title="95">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb8-96" title="96"></a>
<a class="sourceLine" id="cb8-97" title="97">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-98" title="98">      unStreamT ((\u <span class="ot">-&gt;</span> k u u) s1) s1</a>
<a class="sourceLine" id="cb8-99" title="99"></a>
<a class="sourceLine" id="cb8-100" title="100">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb8-101" title="101"></a>
<a class="sourceLine" id="cb8-102" title="102">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-103" title="103">      (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2) (s1, s1)</a>
<a class="sourceLine" id="cb8-104" title="104"></a>
<a class="sourceLine" id="cb8-105" title="105">  <span class="co">-- (left identity law for m)</span></a>
<a class="sourceLine" id="cb8-106" title="106"></a>
<a class="sourceLine" id="cb8-107" title="107">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-108" title="108">      <span class="fu">return</span> (s1, s1)</a>
<a class="sourceLine" id="cb8-109" title="109">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb8-110" title="110"></a>
<a class="sourceLine" id="cb8-111" title="111">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb8-112" title="112"></a>
<a class="sourceLine" id="cb8-113" title="113">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-114" title="114">      (\s <span class="ot">-&gt;</span> <span class="fu">return</span> (s, s)) s1</a>
<a class="sourceLine" id="cb8-115" title="115">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb8-116" title="116"></a>
<a class="sourceLine" id="cb8-117" title="117">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb8-118" title="118"></a>
<a class="sourceLine" id="cb8-119" title="119">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-120" title="120">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> <span class="fu">return</span> (s, s)) s1</a>
<a class="sourceLine" id="cb8-121" title="121">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb8-122" title="122"></a>
<a class="sourceLine" id="cb8-123" title="123">  <span class="co">-- (condense rest)</span></a>
<a class="sourceLine" id="cb8-124" title="124"></a>
<a class="sourceLine" id="cb8-125" title="125">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-126" title="126">      unStreamT rest s1</a>
<a class="sourceLine" id="cb8-127" title="127">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb8-128" title="128"></a>
<a class="sourceLine" id="cb8-129" title="129">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb8-130" title="130"></a>
<a class="sourceLine" id="cb8-131" title="131">  , rest <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> k u u)</a>
<a class="sourceLine" id="cb8-132" title="132">  ]</a></code></pre></div>
</div>
<p>Third: <code>StreamT s m</code> satisfies the fiddle/id law with stream type <code>s</code>.</p>
<div class="example">
<div class="sourceCode" id="cb9"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" title="1">_StreamT_fiddle_id_law_natural</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m</a>
<a class="sourceLine" id="cb9-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="ot">=&gt;</span> [<span class="dt">StreamT</span> s m ()]</a>
<a class="sourceLine" id="cb9-5" title="5">_StreamT_fiddle_id_law_natural <span class="ot">=</span></a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7">  [ fiddle (<span class="fu">id</span> <span class="op">@</span>s)</a>
<a class="sourceLine" id="cb9-8" title="8"></a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb9-10" title="10"></a>
<a class="sourceLine" id="cb9-11" title="11">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-12" title="12">      <span class="fu">return</span> ((), <span class="fu">id</span> s)</a>
<a class="sourceLine" id="cb9-13" title="13"></a>
<a class="sourceLine" id="cb9-14" title="14">  <span class="co">-- (expand id)</span></a>
<a class="sourceLine" id="cb9-15" title="15"></a>
<a class="sourceLine" id="cb9-16" title="16">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb9-17" title="17">      <span class="fu">return</span> ((), s)</a>
<a class="sourceLine" id="cb9-18" title="18"></a>
<a class="sourceLine" id="cb9-19" title="19">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb9-20" title="20"></a>
<a class="sourceLine" id="cb9-21" title="21">  , <span class="fu">return</span> ()</a>
<a class="sourceLine" id="cb9-22" title="22">  ]</a></code></pre></div>
</div>
<p>Fourth: <code>StreamT s m</code> satisfies the fiddle/compose law with stream type <code>s</code>.</p>
<div class="example">
<div class="sourceCode" id="cb10"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" title="1">_StreamT_fiddle_compose_law_natural</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m</a>
<a class="sourceLine" id="cb10-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="ot">=&gt;</span> (s <span class="ot">-&gt;</span> s) <span class="ot">-&gt;</span> (s <span class="ot">-&gt;</span> s)</a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m ()]</a>
<a class="sourceLine" id="cb10-6" title="6">_StreamT_fiddle_compose_law_natural u v <span class="ot">=</span></a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8">  [ fiddle u <span class="op">&gt;&gt;</span> fiddle v</a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb10-11" title="11"></a>
<a class="sourceLine" id="cb10-12" title="12">  , fiddle u <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> fiddle v)</a>
<a class="sourceLine" id="cb10-13" title="13"></a>
<a class="sourceLine" id="cb10-14" title="14">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb10-15" title="15"></a>
<a class="sourceLine" id="cb10-16" title="16">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-17" title="17">      unStreamT (fiddle u) s</a>
<a class="sourceLine" id="cb10-18" title="18">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\_ <span class="ot">-&gt;</span> fiddle v) a) s2)</a>
<a class="sourceLine" id="cb10-19" title="19"></a>
<a class="sourceLine" id="cb10-20" title="20">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb10-21" title="21"></a>
<a class="sourceLine" id="cb10-22" title="22">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-23" title="23">      unStreamT (fiddle u) s</a>
<a class="sourceLine" id="cb10-24" title="24">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (fiddle v) s2)</a>
<a class="sourceLine" id="cb10-25" title="25"></a>
<a class="sourceLine" id="cb10-26" title="26">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb10-27" title="27"></a>
<a class="sourceLine" id="cb10-28" title="28">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-29" title="29">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> <span class="fu">return</span> ((), u s1)) s</a>
<a class="sourceLine" id="cb10-30" title="30">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (fiddle v) s2)</a>
<a class="sourceLine" id="cb10-31" title="31"></a>
<a class="sourceLine" id="cb10-32" title="32">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb10-33" title="33"></a>
<a class="sourceLine" id="cb10-34" title="34">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-35" title="35">      (\s1 <span class="ot">-&gt;</span> <span class="fu">return</span> ((), u s1)) s</a>
<a class="sourceLine" id="cb10-36" title="36">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (fiddle v) s2)</a>
<a class="sourceLine" id="cb10-37" title="37"></a>
<a class="sourceLine" id="cb10-38" title="38">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb10-39" title="39"></a>
<a class="sourceLine" id="cb10-40" title="40">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-41" title="41">      <span class="fu">return</span> ((), u s)</a>
<a class="sourceLine" id="cb10-42" title="42">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (fiddle v) s2)</a>
<a class="sourceLine" id="cb10-43" title="43"></a>
<a class="sourceLine" id="cb10-44" title="44">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb10-45" title="45"></a>
<a class="sourceLine" id="cb10-46" title="46">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-47" title="47">      (\(a, s2) <span class="ot">-&gt;</span> unStreamT (fiddle v) s2) ((), u s)</a>
<a class="sourceLine" id="cb10-48" title="48"></a>
<a class="sourceLine" id="cb10-49" title="49">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb10-50" title="50"></a>
<a class="sourceLine" id="cb10-51" title="51">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-52" title="52">      unStreamT (fiddle v) (u s)</a>
<a class="sourceLine" id="cb10-53" title="53"></a>
<a class="sourceLine" id="cb10-54" title="54">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb10-55" title="55"></a>
<a class="sourceLine" id="cb10-56" title="56">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-57" title="57">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> <span class="fu">return</span> ((), v s1)) (u s)</a>
<a class="sourceLine" id="cb10-58" title="58"></a>
<a class="sourceLine" id="cb10-59" title="59">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb10-60" title="60"></a>
<a class="sourceLine" id="cb10-61" title="61">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-62" title="62">      (\s1 <span class="ot">-&gt;</span> <span class="fu">return</span> ((), v s1)) (u s)</a>
<a class="sourceLine" id="cb10-63" title="63"></a>
<a class="sourceLine" id="cb10-64" title="64">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb10-65" title="65"></a>
<a class="sourceLine" id="cb10-66" title="66">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-67" title="67">      <span class="fu">return</span> ((), v (u s))</a>
<a class="sourceLine" id="cb10-68" title="68"></a>
<a class="sourceLine" id="cb10-69" title="69">  <span class="co">-- (condense .)</span></a>
<a class="sourceLine" id="cb10-70" title="70"></a>
<a class="sourceLine" id="cb10-71" title="71">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb10-72" title="72">      <span class="fu">return</span> ((), (v <span class="op">.</span> u) s)</a>
<a class="sourceLine" id="cb10-73" title="73"></a>
<a class="sourceLine" id="cb10-74" title="74">  <span class="co">-- (condense fiddle)</span></a>
<a class="sourceLine" id="cb10-75" title="75"></a>
<a class="sourceLine" id="cb10-76" title="76">  , fiddle (v <span class="op">.</span> u)</a>
<a class="sourceLine" id="cb10-77" title="77">  ]</a></code></pre></div>
</div>
<p>Fifth: <code>StreamT s m</code> satisfies the fiddle/rest law with stream type <code>s</code>.</p>
<div class="example">
<div class="sourceCode" id="cb11"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" title="1">_StreamT_fiddle_rest_law_natural</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s m</a>
<a class="sourceLine" id="cb11-3" title="3">   <span class="op">.</span> ( <span class="dt">Monad</span> m, <span class="dt">IsStream</span> s )</a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="ot">=&gt;</span> (s <span class="ot">-&gt;</span> s)</a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m s]</a>
<a class="sourceLine" id="cb11-6" title="6">_StreamT_fiddle_rest_law_natural u <span class="ot">=</span></a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">  [ fiddle u <span class="op">&gt;&gt;</span> rest</a>
<a class="sourceLine" id="cb11-9" title="9"></a>
<a class="sourceLine" id="cb11-10" title="10">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb11-11" title="11"></a>
<a class="sourceLine" id="cb11-12" title="12">  , fiddle u <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> rest)</a>
<a class="sourceLine" id="cb11-13" title="13"></a>
<a class="sourceLine" id="cb11-14" title="14">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb11-15" title="15"></a>
<a class="sourceLine" id="cb11-16" title="16">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-17" title="17">      unStreamT (fiddle u) s</a>
<a class="sourceLine" id="cb11-18" title="18">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\_ <span class="ot">-&gt;</span> rest) a) s2)</a>
<a class="sourceLine" id="cb11-19" title="19"></a>
<a class="sourceLine" id="cb11-20" title="20">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb11-21" title="21"></a>
<a class="sourceLine" id="cb11-22" title="22">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-23" title="23">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> <span class="fu">return</span> ((), u s1)) s</a>
<a class="sourceLine" id="cb11-24" title="24">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\_ <span class="ot">-&gt;</span> rest) a) s2)</a>
<a class="sourceLine" id="cb11-25" title="25"></a>
<a class="sourceLine" id="cb11-26" title="26">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb11-27" title="27"></a>
<a class="sourceLine" id="cb11-28" title="28">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-29" title="29">      (\s1 <span class="ot">-&gt;</span> <span class="fu">return</span> ((), u s1)) s</a>
<a class="sourceLine" id="cb11-30" title="30">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\_ <span class="ot">-&gt;</span> rest) a) s2)</a>
<a class="sourceLine" id="cb11-31" title="31"></a>
<a class="sourceLine" id="cb11-32" title="32">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb11-33" title="33"></a>
<a class="sourceLine" id="cb11-34" title="34">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-35" title="35">      <span class="fu">return</span> ((), u s)</a>
<a class="sourceLine" id="cb11-36" title="36">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\_ <span class="ot">-&gt;</span> rest) a) s2)</a>
<a class="sourceLine" id="cb11-37" title="37"></a>
<a class="sourceLine" id="cb11-38" title="38">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb11-39" title="39"></a>
<a class="sourceLine" id="cb11-40" title="40">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-41" title="41">      (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\_ <span class="ot">-&gt;</span> rest) a) s2) ((), u s)</a>
<a class="sourceLine" id="cb11-42" title="42"></a>
<a class="sourceLine" id="cb11-43" title="43">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb11-44" title="44"></a>
<a class="sourceLine" id="cb11-45" title="45">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-46" title="46">      unStreamT ((\_ <span class="ot">-&gt;</span> rest) ()) (u s)</a>
<a class="sourceLine" id="cb11-47" title="47"></a>
<a class="sourceLine" id="cb11-48" title="48">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb11-49" title="49"></a>
<a class="sourceLine" id="cb11-50" title="50">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-51" title="51">      unStreamT rest (u s)</a>
<a class="sourceLine" id="cb11-52" title="52"></a>
<a class="sourceLine" id="cb11-53" title="53">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb11-54" title="54"></a>
<a class="sourceLine" id="cb11-55" title="55">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-56" title="56">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> <span class="fu">return</span> (s1, s1)) (u s)</a>
<a class="sourceLine" id="cb11-57" title="57"></a>
<a class="sourceLine" id="cb11-58" title="58">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb11-59" title="59"></a>
<a class="sourceLine" id="cb11-60" title="60">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-61" title="61">      (\s1 <span class="ot">-&gt;</span> <span class="fu">return</span> (s1, s1)) (u s)</a>
<a class="sourceLine" id="cb11-62" title="62"></a>
<a class="sourceLine" id="cb11-63" title="63">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb11-64" title="64"></a>
<a class="sourceLine" id="cb11-65" title="65">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-66" title="66">      <span class="fu">return</span> (u s, u s)</a>
<a class="sourceLine" id="cb11-67" title="67"></a>
<a class="sourceLine" id="cb11-68" title="68">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb11-69" title="69"></a>
<a class="sourceLine" id="cb11-70" title="70">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-71" title="71">      (\s1 <span class="ot">-&gt;</span> <span class="fu">return</span> (u s, s1)) (u s)</a>
<a class="sourceLine" id="cb11-72" title="72"></a>
<a class="sourceLine" id="cb11-73" title="73">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb11-74" title="74"></a>
<a class="sourceLine" id="cb11-75" title="75">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-76" title="76">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> <span class="fu">return</span> (u s, s1)) (u s)</a>
<a class="sourceLine" id="cb11-77" title="77"></a>
<a class="sourceLine" id="cb11-78" title="78">  <span class="co">-- (condense return)</span></a>
<a class="sourceLine" id="cb11-79" title="79"></a>
<a class="sourceLine" id="cb11-80" title="80">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-81" title="81">      unStreamT (<span class="fu">return</span> (u s)) (u s)</a>
<a class="sourceLine" id="cb11-82" title="82"></a>
<a class="sourceLine" id="cb11-83" title="83">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb11-84" title="84"></a>
<a class="sourceLine" id="cb11-85" title="85">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-86" title="86">      (\(a, s2) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (u s)) s2) ((), u s)</a>
<a class="sourceLine" id="cb11-87" title="87"></a>
<a class="sourceLine" id="cb11-88" title="88">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb11-89" title="89"></a>
<a class="sourceLine" id="cb11-90" title="90">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-91" title="91">      <span class="fu">return</span> ((), u s)</a>
<a class="sourceLine" id="cb11-92" title="92">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (u s)) s2)</a>
<a class="sourceLine" id="cb11-93" title="93"></a>
<a class="sourceLine" id="cb11-94" title="94">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb11-95" title="95"></a>
<a class="sourceLine" id="cb11-96" title="96">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-97" title="97">      (\s1 <span class="ot">-&gt;</span> <span class="fu">return</span> ((), u s1)) s</a>
<a class="sourceLine" id="cb11-98" title="98">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (u s)) s2)</a>
<a class="sourceLine" id="cb11-99" title="99"></a>
<a class="sourceLine" id="cb11-100" title="100">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb11-101" title="101"></a>
<a class="sourceLine" id="cb11-102" title="102">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-103" title="103">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> <span class="fu">return</span> ((), u s1)) s</a>
<a class="sourceLine" id="cb11-104" title="104">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (u s)) s2)</a>
<a class="sourceLine" id="cb11-105" title="105"></a>
<a class="sourceLine" id="cb11-106" title="106">  <span class="co">-- (condense fiddle)</span></a>
<a class="sourceLine" id="cb11-107" title="107"></a>
<a class="sourceLine" id="cb11-108" title="108">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-109" title="109">      unStreamT (fiddle u) s</a>
<a class="sourceLine" id="cb11-110" title="110">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (<span class="fu">return</span> (u s)) s2)</a>
<a class="sourceLine" id="cb11-111" title="111"></a>
<a class="sourceLine" id="cb11-112" title="112">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb11-113" title="113"></a>
<a class="sourceLine" id="cb11-114" title="114">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-115" title="115">      unStreamT (fiddle u) s</a>
<a class="sourceLine" id="cb11-116" title="116">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> (u s)) a) s2)</a>
<a class="sourceLine" id="cb11-117" title="117"></a>
<a class="sourceLine" id="cb11-118" title="118">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb11-119" title="119"></a>
<a class="sourceLine" id="cb11-120" title="120">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-121" title="121">      (\s1 <span class="ot">-&gt;</span> unStreamT (fiddle u) s1</a>
<a class="sourceLine" id="cb11-122" title="122">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> (u s)) a) s2)) s</a>
<a class="sourceLine" id="cb11-123" title="123"></a>
<a class="sourceLine" id="cb11-124" title="124">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb11-125" title="125"></a>
<a class="sourceLine" id="cb11-126" title="126">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-127" title="127">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> unStreamT (fiddle u) s1</a>
<a class="sourceLine" id="cb11-128" title="128">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\_ <span class="ot">-&gt;</span> <span class="fu">return</span> (u s)) a) s2)) s</a>
<a class="sourceLine" id="cb11-129" title="129"></a>
<a class="sourceLine" id="cb11-130" title="130">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb11-131" title="131"></a>
<a class="sourceLine" id="cb11-132" title="132">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-133" title="133">      unStreamT (fiddle u <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span><span class="fu">return</span> (u s))) s</a>
<a class="sourceLine" id="cb11-134" title="134"></a>
<a class="sourceLine" id="cb11-135" title="135">  <span class="co">-- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb11-136" title="136"></a>
<a class="sourceLine" id="cb11-137" title="137">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-138" title="138">      unStreamT (fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u s)) s</a>
<a class="sourceLine" id="cb11-139" title="139"></a>
<a class="sourceLine" id="cb11-140" title="140">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb11-141" title="141"></a>
<a class="sourceLine" id="cb11-142" title="142">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-143" title="143">      (\(c, s2) <span class="ot">-&gt;</span> unStreamT (fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u c)) s2) (s, s)</a>
<a class="sourceLine" id="cb11-144" title="144"></a>
<a class="sourceLine" id="cb11-145" title="145">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb11-146" title="146"></a>
<a class="sourceLine" id="cb11-147" title="147">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-148" title="148">      <span class="fu">return</span> (s, s)</a>
<a class="sourceLine" id="cb11-149" title="149">        <span class="op">&gt;&gt;=</span> (\(c, s2) <span class="ot">-&gt;</span> unStreamT (fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u c)) s2)</a>
<a class="sourceLine" id="cb11-150" title="150"></a>
<a class="sourceLine" id="cb11-151" title="151">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb11-152" title="152"></a>
<a class="sourceLine" id="cb11-153" title="153">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-154" title="154">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span> <span class="fu">return</span> (s1, s1)) s</a>
<a class="sourceLine" id="cb11-155" title="155">        <span class="op">&gt;&gt;=</span> (\(c, s2) <span class="ot">-&gt;</span> unStreamT (fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u c)) s2)</a>
<a class="sourceLine" id="cb11-156" title="156"></a>
<a class="sourceLine" id="cb11-157" title="157">  <span class="co">-- (condense rest)</span></a>
<a class="sourceLine" id="cb11-158" title="158"></a>
<a class="sourceLine" id="cb11-159" title="159">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-160" title="160">      unStreamT rest s</a>
<a class="sourceLine" id="cb11-161" title="161">        <span class="op">&gt;&gt;=</span> (\(c, s2) <span class="ot">-&gt;</span> unStreamT (fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u c)) s2)</a>
<a class="sourceLine" id="cb11-162" title="162"></a>
<a class="sourceLine" id="cb11-163" title="163">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb11-164" title="164"></a>
<a class="sourceLine" id="cb11-165" title="165">  , <span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb11-166" title="166">      unStreamT rest s</a>
<a class="sourceLine" id="cb11-167" title="167">        <span class="op">&gt;&gt;=</span> (\(c, s2) <span class="ot">-&gt;</span> unStreamT ((\a <span class="ot">-&gt;</span> fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a)) c) s2)</a>
<a class="sourceLine" id="cb11-168" title="168"></a>
<a class="sourceLine" id="cb11-169" title="169">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb11-170" title="170"></a>
<a class="sourceLine" id="cb11-171" title="171">  , rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a))</a>
<a class="sourceLine" id="cb11-172" title="172">  ]</a></code></pre></div>
</div>
<p>Next we show that if <code>m</code> is a lawful instance of <code>MonadStream</code> with stream type <code>t</code> different from <code>s</code>, then so is <code>StreamT s m</code>.</p>
<p>First: <code>StreamT s m</code> satisfies the next/rest law:</p>
<div class="example">
<div class="sourceCode" id="cb12"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" title="1">_StreamT_next_rest_law_lifted</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb12-3" title="3">   <span class="op">.</span> ( <span class="dt">IsStream</span> t, <span class="dt">IsStream</span> s, <span class="dt">MonadStream</span> t m, <span class="dt">Compare</span> s t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="ot">=&gt;</span> [<span class="dt">StreamT</span> s m (<span class="dt">StreamValue</span> t, t)]</a>
<a class="sourceLine" id="cb12-5" title="5">_StreamT_next_rest_law_lifted <span class="ot">=</span></a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7">  [ (advance <span class="op">&lt;$&gt;</span> rest) <span class="op">&lt;*</span> (next <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb12-8" title="8"></a>
<a class="sourceLine" id="cb12-9" title="9">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb12-10" title="10"></a>
<a class="sourceLine" id="cb12-11" title="11">  , (advance <span class="op">&lt;$&gt;</span> lift rest) <span class="op">&lt;*</span> (next <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb12-12" title="12"></a>
<a class="sourceLine" id="cb12-13" title="13">  <span class="co">-- (expand next)</span></a>
<a class="sourceLine" id="cb12-14" title="14"></a>
<a class="sourceLine" id="cb12-15" title="15">  , (advance <span class="op">&lt;$&gt;</span> lift rest) <span class="op">&lt;*</span> lift (next <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb12-16" title="16"></a>
<a class="sourceLine" id="cb12-17" title="17">  <span class="co">-- (lift/&lt;$&gt;)</span></a>
<a class="sourceLine" id="cb12-18" title="18"></a>
<a class="sourceLine" id="cb12-19" title="19">  , lift (advance <span class="op">&lt;$&gt;</span> rest) <span class="op">&lt;*</span> lift (next <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb12-20" title="20"></a>
<a class="sourceLine" id="cb12-21" title="21">  <span class="co">-- (lift/&lt;*)</span></a>
<a class="sourceLine" id="cb12-22" title="22"></a>
<a class="sourceLine" id="cb12-23" title="23">  , lift ((advance <span class="op">&lt;$&gt;</span> rest) <span class="op">&lt;*</span> (next <span class="op">@</span>t))</a>
<a class="sourceLine" id="cb12-24" title="24"></a>
<a class="sourceLine" id="cb12-25" title="25">  <span class="co">-- (next/rest law in m)</span></a>
<a class="sourceLine" id="cb12-26" title="26"></a>
<a class="sourceLine" id="cb12-27" title="27">  , lift ((,) <span class="op">&lt;$&gt;</span> next <span class="op">&lt;*&gt;</span> rest)</a>
<a class="sourceLine" id="cb12-28" title="28"></a>
<a class="sourceLine" id="cb12-29" title="29">  <span class="co">-- (lift/&lt;*&gt;)</span></a>
<a class="sourceLine" id="cb12-30" title="30"></a>
<a class="sourceLine" id="cb12-31" title="31">  , lift ((,) <span class="op">&lt;$&gt;</span> next) <span class="op">&lt;*&gt;</span> lift rest</a>
<a class="sourceLine" id="cb12-32" title="32"></a>
<a class="sourceLine" id="cb12-33" title="33">  <span class="co">-- (lift/&lt;$&gt;)</span></a>
<a class="sourceLine" id="cb12-34" title="34"></a>
<a class="sourceLine" id="cb12-35" title="35">  , (,) <span class="op">&lt;$&gt;</span> lift next <span class="op">&lt;*&gt;</span> lift rest</a>
<a class="sourceLine" id="cb12-36" title="36"></a>
<a class="sourceLine" id="cb12-37" title="37">  <span class="co">-- (condense next)</span></a>
<a class="sourceLine" id="cb12-38" title="38"></a>
<a class="sourceLine" id="cb12-39" title="39">  , (,) <span class="op">&lt;$&gt;</span> next <span class="op">&lt;*&gt;</span> lift rest</a>
<a class="sourceLine" id="cb12-40" title="40"></a>
<a class="sourceLine" id="cb12-41" title="41">  <span class="co">-- (condense rest)</span></a>
<a class="sourceLine" id="cb12-42" title="42"></a>
<a class="sourceLine" id="cb12-43" title="43">  , (,) <span class="op">&lt;$&gt;</span> next <span class="op">&lt;*&gt;</span> rest</a>
<a class="sourceLine" id="cb12-44" title="44">  ]</a></code></pre></div>
</div>
<p>Second: <code>StreamT s m</code> satisfies the rest/rest law with stream type <code>t</code>:</p>
<div class="example">
<div class="sourceCode" id="cb13"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" title="1">_StreamT_rest_rest_law_lifted</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m a</a>
<a class="sourceLine" id="cb13-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadStream</span> t m, <span class="dt">IsStream</span> t, <span class="dt">IsStream</span> s, <span class="dt">Compare</span> s t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t <span class="ot">-&gt;</span> <span class="dt">StreamT</span> s m a)</a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m a]</a>
<a class="sourceLine" id="cb13-6" title="6">_StreamT_rest_rest_law_lifted k <span class="ot">=</span></a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8">  [ rest <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u)</a>
<a class="sourceLine" id="cb13-9" title="9"></a>
<a class="sourceLine" id="cb13-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb13-11" title="11"></a>
<a class="sourceLine" id="cb13-12" title="12">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-13" title="13">      unStreamT rest s1</a>
<a class="sourceLine" id="cb13-14" title="14">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb13-15" title="15"></a>
<a class="sourceLine" id="cb13-16" title="16">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb13-17" title="17"></a>
<a class="sourceLine" id="cb13-18" title="18">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-19" title="19">      unStreamT (lift rest) s1</a>
<a class="sourceLine" id="cb13-20" title="20">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb13-21" title="21"></a>
<a class="sourceLine" id="cb13-22" title="22">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb13-23" title="23"></a>
<a class="sourceLine" id="cb13-24" title="24">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-25" title="25">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb13-26" title="26">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb13-27" title="27"></a>
<a class="sourceLine" id="cb13-28" title="28">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb13-29" title="29"></a>
<a class="sourceLine" id="cb13-30" title="30">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-31" title="31">      (\s <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb13-32" title="32">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb13-33" title="33"></a>
<a class="sourceLine" id="cb13-34" title="34">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-35" title="35"></a>
<a class="sourceLine" id="cb13-36" title="36">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-37" title="37">      (rest <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)))</a>
<a class="sourceLine" id="cb13-38" title="38">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb13-39" title="39"></a>
<a class="sourceLine" id="cb13-40" title="40">  <span class="co">-- (associative law in m)</span></a>
<a class="sourceLine" id="cb13-41" title="41"></a>
<a class="sourceLine" id="cb13-42" title="42">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-43" title="43">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-44" title="44">        (\c <span class="ot">-&gt;</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)) c</a>
<a class="sourceLine" id="cb13-45" title="45">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) s2))</a>
<a class="sourceLine" id="cb13-46" title="46"></a>
<a class="sourceLine" id="cb13-47" title="47">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-48" title="48"></a>
<a class="sourceLine" id="cb13-49" title="49">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-50" title="50">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-51" title="51">        (\c <span class="ot">-&gt;</span> <span class="fu">return</span> (c, s1)</a>
<a class="sourceLine" id="cb13-52" title="52">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) s2))</a>
<a class="sourceLine" id="cb13-53" title="53"></a>
<a class="sourceLine" id="cb13-54" title="54">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb13-55" title="55"></a>
<a class="sourceLine" id="cb13-56" title="56">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-57" title="57">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-58" title="58">        (\c <span class="ot">-&gt;</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) a) s2) (c, s1))</a>
<a class="sourceLine" id="cb13-59" title="59"></a>
<a class="sourceLine" id="cb13-60" title="60">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-61" title="61"></a>
<a class="sourceLine" id="cb13-62" title="62">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-63" title="63">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-64" title="64">        (\c <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> k u) c) s1)</a>
<a class="sourceLine" id="cb13-65" title="65"></a>
<a class="sourceLine" id="cb13-66" title="66">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-67" title="67"></a>
<a class="sourceLine" id="cb13-68" title="68">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-69" title="69">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-70" title="70">        (\c <span class="ot">-&gt;</span> unStreamT (rest <span class="op">&gt;&gt;=</span> k c) s1)</a>
<a class="sourceLine" id="cb13-71" title="71"></a>
<a class="sourceLine" id="cb13-72" title="72">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb13-73" title="73"></a>
<a class="sourceLine" id="cb13-74" title="74">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-75" title="75">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-76" title="76">        (\c <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> unStreamT rest s</a>
<a class="sourceLine" id="cb13-77" title="77">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2)) s1)</a>
<a class="sourceLine" id="cb13-78" title="78"></a>
<a class="sourceLine" id="cb13-79" title="79">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb13-80" title="80"></a>
<a class="sourceLine" id="cb13-81" title="81">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-82" title="82">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-83" title="83">        (\c <span class="ot">-&gt;</span> (\s <span class="ot">-&gt;</span> unStreamT rest s <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2)) s1)</a>
<a class="sourceLine" id="cb13-84" title="84"></a>
<a class="sourceLine" id="cb13-85" title="85">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-86" title="86"></a>
<a class="sourceLine" id="cb13-87" title="87">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-88" title="88">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-89" title="89">        (\c <span class="ot">-&gt;</span> unStreamT rest s1 <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb13-90" title="90"></a>
<a class="sourceLine" id="cb13-91" title="91">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb13-92" title="92"></a>
<a class="sourceLine" id="cb13-93" title="93">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-94" title="94">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-95" title="95">        (\c <span class="ot">-&gt;</span> unStreamT (lift rest) s1 <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb13-96" title="96"></a>
<a class="sourceLine" id="cb13-97" title="97">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb13-98" title="98"></a>
<a class="sourceLine" id="cb13-99" title="99">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-100" title="100">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-101" title="101">        (\c <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> rest</a>
<a class="sourceLine" id="cb13-102" title="102">          <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1 <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb13-103" title="103"></a>
<a class="sourceLine" id="cb13-104" title="104">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb13-105" title="105"></a>
<a class="sourceLine" id="cb13-106" title="106">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-107" title="107">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-108" title="108">        (\c <span class="ot">-&gt;</span> (\s <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb13-109" title="109">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb13-110" title="110"></a>
<a class="sourceLine" id="cb13-111" title="111">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-112" title="112"></a>
<a class="sourceLine" id="cb13-113" title="113">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-114" title="114">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-115" title="115">        (\c <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1))</a>
<a class="sourceLine" id="cb13-116" title="116">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb13-117" title="117"></a>
<a class="sourceLine" id="cb13-118" title="118">  <span class="co">-- (associative law in m)</span></a>
<a class="sourceLine" id="cb13-119" title="119"></a>
<a class="sourceLine" id="cb13-120" title="120">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-121" title="121">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-122" title="122">        (\c <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-123" title="123">          (\d <span class="ot">-&gt;</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)) d <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2)))</a>
<a class="sourceLine" id="cb13-124" title="124"></a>
<a class="sourceLine" id="cb13-125" title="125">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-126" title="126"></a>
<a class="sourceLine" id="cb13-127" title="127">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-128" title="128">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-129" title="129">        (\c <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-130" title="130">          (\d <span class="ot">-&gt;</span> <span class="fu">return</span> (d, s1) <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2)))</a>
<a class="sourceLine" id="cb13-131" title="131"></a>
<a class="sourceLine" id="cb13-132" title="132">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb13-133" title="133"></a>
<a class="sourceLine" id="cb13-134" title="134">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-135" title="135">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-136" title="136">        (\c <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-137" title="137">          (\d <span class="ot">-&gt;</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2) (d, s1)))</a>
<a class="sourceLine" id="cb13-138" title="138"></a>
<a class="sourceLine" id="cb13-139" title="139">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-140" title="140"></a>
<a class="sourceLine" id="cb13-141" title="141">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-142" title="142">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-143" title="143">        (\c <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-144" title="144">          (\d <span class="ot">-&gt;</span> unStreamT (k c d) s1))</a>
<a class="sourceLine" id="cb13-145" title="145"></a>
<a class="sourceLine" id="cb13-146" title="146">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb13-147" title="147"></a>
<a class="sourceLine" id="cb13-148" title="148">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-149" title="149">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-150" title="150">        (\c <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-151" title="151">          (\d <span class="ot">-&gt;</span> (\u v <span class="ot">-&gt;</span> unStreamT (k u v) s1) c d))</a>
<a class="sourceLine" id="cb13-152" title="152"></a>
<a class="sourceLine" id="cb13-153" title="153">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb13-154" title="154"></a>
<a class="sourceLine" id="cb13-155" title="155">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-156" title="156">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-157" title="157">        (\c <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\u v <span class="ot">-&gt;</span> unStreamT (k u v) s1) c)</a>
<a class="sourceLine" id="cb13-158" title="158"></a>
<a class="sourceLine" id="cb13-159" title="159">  <span class="co">-- (rest/rest law in m)</span></a>
<a class="sourceLine" id="cb13-160" title="160"></a>
<a class="sourceLine" id="cb13-161" title="161">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-162" title="162">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-163" title="163">        (\c <span class="ot">-&gt;</span> (\u v <span class="ot">-&gt;</span> unStreamT (k u v) s1) c c)</a>
<a class="sourceLine" id="cb13-164" title="164"></a>
<a class="sourceLine" id="cb13-165" title="165">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb13-166" title="166"></a>
<a class="sourceLine" id="cb13-167" title="167">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-168" title="168">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-169" title="169">        (\c <span class="ot">-&gt;</span> unStreamT (k c c) s1)</a>
<a class="sourceLine" id="cb13-170" title="170"></a>
<a class="sourceLine" id="cb13-171" title="171">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb13-172" title="172"></a>
<a class="sourceLine" id="cb13-173" title="173">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-174" title="174">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-175" title="175">        (\c <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) c) s1)</a>
<a class="sourceLine" id="cb13-176" title="176"></a>
<a class="sourceLine" id="cb13-177" title="177">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb13-178" title="178"></a>
<a class="sourceLine" id="cb13-179" title="179">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-180" title="180">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-181" title="181">        (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-182" title="182">          (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2) (c, s1))</a>
<a class="sourceLine" id="cb13-183" title="183"></a>
<a class="sourceLine" id="cb13-184" title="184">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb13-185" title="185"></a>
<a class="sourceLine" id="cb13-186" title="186">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-187" title="187">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-188" title="188">        (\c <span class="ot">-&gt;</span> <span class="fu">return</span> (c, s1)</a>
<a class="sourceLine" id="cb13-189" title="189">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2))</a>
<a class="sourceLine" id="cb13-190" title="190"></a>
<a class="sourceLine" id="cb13-191" title="191">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb13-192" title="192"></a>
<a class="sourceLine" id="cb13-193" title="193">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-194" title="194">      rest <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb13-195" title="195">        (\c <span class="ot">-&gt;</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)) c</a>
<a class="sourceLine" id="cb13-196" title="196">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2))</a>
<a class="sourceLine" id="cb13-197" title="197"></a>
<a class="sourceLine" id="cb13-198" title="198">  <span class="co">-- (associativity law in m)</span></a>
<a class="sourceLine" id="cb13-199" title="199"></a>
<a class="sourceLine" id="cb13-200" title="200">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-201" title="201">      (rest <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)))</a>
<a class="sourceLine" id="cb13-202" title="202">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb13-203" title="203"></a>
<a class="sourceLine" id="cb13-204" title="204">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb13-205" title="205"></a>
<a class="sourceLine" id="cb13-206" title="206">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-207" title="207">      (\s <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb13-208" title="208">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb13-209" title="209"></a>
<a class="sourceLine" id="cb13-210" title="210">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb13-211" title="211"></a>
<a class="sourceLine" id="cb13-212" title="212">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-213" title="213">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> rest <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb13-214" title="214">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb13-215" title="215"></a>
<a class="sourceLine" id="cb13-216" title="216">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb13-217" title="217"></a>
<a class="sourceLine" id="cb13-218" title="218">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-219" title="219">      unStreamT (lift rest) s1</a>
<a class="sourceLine" id="cb13-220" title="220">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb13-221" title="221"></a>
<a class="sourceLine" id="cb13-222" title="222">  <span class="co">-- (condense rest)</span></a>
<a class="sourceLine" id="cb13-223" title="223"></a>
<a class="sourceLine" id="cb13-224" title="224">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb13-225" title="225">      unStreamT rest s1</a>
<a class="sourceLine" id="cb13-226" title="226">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb13-227" title="227"></a>
<a class="sourceLine" id="cb13-228" title="228">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb13-229" title="229"></a>
<a class="sourceLine" id="cb13-230" title="230">  , rest <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> k u u)</a>
<a class="sourceLine" id="cb13-231" title="231">  ]</a></code></pre></div>
</div>
<p>Third: <code>StreamT s m</code> satisfies the fiddle/id law with stream type <code>t</code>:</p>
<div class="example">
<div class="sourceCode" id="cb14"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" title="1">_StreamT_fiddle_id_law_lifted</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb14-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadStream</span> t m, <span class="dt">IsStream</span> t, <span class="dt">IsStream</span> s, <span class="dt">Compare</span> s t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="ot">=&gt;</span> [<span class="dt">StreamT</span> s m ()]</a>
<a class="sourceLine" id="cb14-5" title="5">_StreamT_fiddle_id_law_lifted <span class="ot">=</span></a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7">  [ fiddle (<span class="fu">id</span> <span class="op">@</span>t)</a>
<a class="sourceLine" id="cb14-8" title="8"></a>
<a class="sourceLine" id="cb14-9" title="9">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb14-10" title="10"></a>
<a class="sourceLine" id="cb14-11" title="11">  , lift (fiddle (<span class="fu">id</span> <span class="op">@</span>t))</a>
<a class="sourceLine" id="cb14-12" title="12"></a>
<a class="sourceLine" id="cb14-13" title="13">  <span class="co">-- (fiddle/id law in m)</span></a>
<a class="sourceLine" id="cb14-14" title="14"></a>
<a class="sourceLine" id="cb14-15" title="15">  , (lift (<span class="fu">return</span> ()))</a>
<a class="sourceLine" id="cb14-16" title="16"></a>
<a class="sourceLine" id="cb14-17" title="17">  <span class="co">-- (unit law)</span></a>
<a class="sourceLine" id="cb14-18" title="18"></a>
<a class="sourceLine" id="cb14-19" title="19">  , <span class="fu">return</span> ()</a>
<a class="sourceLine" id="cb14-20" title="20">  ]</a></code></pre></div>
</div>
<p>Fourth: <code>StreamT s m</code> satisfies the fiddle/compose law with stream type <code>t</code>:</p>
<div class="example">
<div class="sourceCode" id="cb15"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" title="1">_StreamT_fiddle_compose_law_lifted</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb15-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadStream</span> t m, <span class="dt">IsStream</span> t, <span class="dt">IsStream</span> s, <span class="dt">Compare</span> s t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t) <span class="ot">-&gt;</span> (t <span class="ot">-&gt;</span> t)</a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m ()]</a>
<a class="sourceLine" id="cb15-6" title="6">_StreamT_fiddle_compose_law_lifted u v <span class="ot">=</span></a>
<a class="sourceLine" id="cb15-7" title="7"></a>
<a class="sourceLine" id="cb15-8" title="8">  [ fiddle u <span class="op">&gt;&gt;</span> fiddle v</a>
<a class="sourceLine" id="cb15-9" title="9"></a>
<a class="sourceLine" id="cb15-10" title="10">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb15-11" title="11"></a>
<a class="sourceLine" id="cb15-12" title="12">  , lift (fiddle u) <span class="op">&gt;&gt;</span> lift (fiddle v)</a>
<a class="sourceLine" id="cb15-13" title="13"></a>
<a class="sourceLine" id="cb15-14" title="14">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb15-15" title="15"></a>
<a class="sourceLine" id="cb15-16" title="16">  , lift (fiddle u) <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> lift (fiddle v))</a>
<a class="sourceLine" id="cb15-17" title="17"></a>
<a class="sourceLine" id="cb15-18" title="18">  <span class="co">-- (condense const)</span></a>
<a class="sourceLine" id="cb15-19" title="19"></a>
<a class="sourceLine" id="cb15-20" title="20">  , lift (fiddle u) <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (lift (fiddle v))</a>
<a class="sourceLine" id="cb15-21" title="21"></a>
<a class="sourceLine" id="cb15-22" title="22">  <span class="co">-- (const compose)</span></a>
<a class="sourceLine" id="cb15-23" title="23"></a>
<a class="sourceLine" id="cb15-24" title="24">  , lift (fiddle u) <span class="op">&gt;&gt;=</span> (lift <span class="op">.</span> <span class="fu">const</span> (fiddle v))</a>
<a class="sourceLine" id="cb15-25" title="25"></a>
<a class="sourceLine" id="cb15-26" title="26">  <span class="co">-- (expand const)</span></a>
<a class="sourceLine" id="cb15-27" title="27"></a>
<a class="sourceLine" id="cb15-28" title="28">  , lift (fiddle u) <span class="op">&gt;&gt;=</span> (lift <span class="op">.</span> (\_ <span class="ot">-&gt;</span> fiddle v))</a>
<a class="sourceLine" id="cb15-29" title="29"></a>
<a class="sourceLine" id="cb15-30" title="30">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb15-31" title="31"></a>
<a class="sourceLine" id="cb15-32" title="32">  , lift (fiddle u <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> fiddle v))</a>
<a class="sourceLine" id="cb15-33" title="33"></a>
<a class="sourceLine" id="cb15-34" title="34">  <span class="co">-- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb15-35" title="35"></a>
<a class="sourceLine" id="cb15-36" title="36">  , lift (fiddle u <span class="op">&gt;&gt;</span> fiddle v)</a>
<a class="sourceLine" id="cb15-37" title="37"></a>
<a class="sourceLine" id="cb15-38" title="38">  <span class="co">-- (fiddle/compose law in m)</span></a>
<a class="sourceLine" id="cb15-39" title="39"></a>
<a class="sourceLine" id="cb15-40" title="40">  , lift (fiddle (v <span class="op">.</span> u))</a>
<a class="sourceLine" id="cb15-41" title="41"></a>
<a class="sourceLine" id="cb15-42" title="42">  <span class="co">-- (condense fiddle)</span></a>
<a class="sourceLine" id="cb15-43" title="43"></a>
<a class="sourceLine" id="cb15-44" title="44">  , fiddle (v <span class="op">.</span> u)</a>
<a class="sourceLine" id="cb15-45" title="45">  ]</a></code></pre></div>
</div>
<p>Fifth: <code>StreamT s m</code> satisfies the fiddle/rest law:</p>
<div class="example">
<div class="sourceCode" id="cb16"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" title="1">_StreamT_fiddle_rest_law_lifted</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb16-3" title="3">   <span class="op">.</span> ( <span class="dt">MonadStream</span> t m, <span class="dt">IsStream</span> t, <span class="dt">IsStream</span> s, <span class="dt">Compare</span> s t <span class="op">~</span> <span class="dt">NotEqual</span> )</a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t)</a>
<a class="sourceLine" id="cb16-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m t]</a>
<a class="sourceLine" id="cb16-6" title="6">_StreamT_fiddle_rest_law_lifted u <span class="ot">=</span></a>
<a class="sourceLine" id="cb16-7" title="7"></a>
<a class="sourceLine" id="cb16-8" title="8">  [ fiddle u <span class="op">&gt;&gt;</span> rest</a>
<a class="sourceLine" id="cb16-9" title="9"></a>
<a class="sourceLine" id="cb16-10" title="10">  <span class="co">-- (expand fiddle)</span></a>
<a class="sourceLine" id="cb16-11" title="11"></a>
<a class="sourceLine" id="cb16-12" title="12">  , lift (fiddle u) <span class="op">&gt;&gt;</span> rest</a>
<a class="sourceLine" id="cb16-13" title="13"></a>
<a class="sourceLine" id="cb16-14" title="14">  <span class="co">-- (expand rest)</span></a>
<a class="sourceLine" id="cb16-15" title="15"></a>
<a class="sourceLine" id="cb16-16" title="16">  , lift (fiddle u) <span class="op">&gt;&gt;</span> lift rest</a>
<a class="sourceLine" id="cb16-17" title="17"></a>
<a class="sourceLine" id="cb16-18" title="18">  <span class="co">-- (lift/&gt;&gt;)</span></a>
<a class="sourceLine" id="cb16-19" title="19"></a>
<a class="sourceLine" id="cb16-20" title="20">  , lift (fiddle u <span class="op">&gt;&gt;</span> rest)</a>
<a class="sourceLine" id="cb16-21" title="21"></a>
<a class="sourceLine" id="cb16-22" title="22">  <span class="co">-- (fiddle/rest law in m)</span></a>
<a class="sourceLine" id="cb16-23" title="23"></a>
<a class="sourceLine" id="cb16-24" title="24">  , lift (rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a)))</a>
<a class="sourceLine" id="cb16-25" title="25"></a>
<a class="sourceLine" id="cb16-26" title="26">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb16-27" title="27"></a>
<a class="sourceLine" id="cb16-28" title="28">  , lift rest <span class="op">&gt;&gt;=</span> lift <span class="op">.</span> (\a <span class="ot">-&gt;</span> fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a))</a>
<a class="sourceLine" id="cb16-29" title="29"></a>
<a class="sourceLine" id="cb16-30" title="30">  <span class="co">-- (compose lambda)</span></a>
<a class="sourceLine" id="cb16-31" title="31"></a>
<a class="sourceLine" id="cb16-32" title="32">  , lift rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> lift (fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a)))</a>
<a class="sourceLine" id="cb16-33" title="33"></a>
<a class="sourceLine" id="cb16-34" title="34">  <span class="co">-- (lift/&gt;&gt;)</span></a>
<a class="sourceLine" id="cb16-35" title="35"></a>
<a class="sourceLine" id="cb16-36" title="36">  , lift rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> lift (fiddle u) <span class="op">&gt;&gt;</span> lift (<span class="fu">return</span> (u a)))</a>
<a class="sourceLine" id="cb16-37" title="37"></a>
<a class="sourceLine" id="cb16-38" title="38">  <span class="co">-- (lift/unit law)</span></a>
<a class="sourceLine" id="cb16-39" title="39"></a>
<a class="sourceLine" id="cb16-40" title="40">  , lift rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> lift (fiddle u) <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a))</a>
<a class="sourceLine" id="cb16-41" title="41"></a>
<a class="sourceLine" id="cb16-42" title="42">  <span class="co">-- (condense rest)</span></a>
<a class="sourceLine" id="cb16-43" title="43"></a>
<a class="sourceLine" id="cb16-44" title="44">  , rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> lift (fiddle u) <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a))</a>
<a class="sourceLine" id="cb16-45" title="45"></a>
<a class="sourceLine" id="cb16-46" title="46">  <span class="co">-- (condense fiddle)</span></a>
<a class="sourceLine" id="cb16-47" title="47"></a>
<a class="sourceLine" id="cb16-48" title="48">  , rest <span class="op">&gt;&gt;=</span> (\a <span class="ot">-&gt;</span> fiddle u <span class="op">&gt;&gt;</span> <span class="fu">return</span> (u a))</a>
<a class="sourceLine" id="cb16-49" title="49">  ]</a></code></pre></div>
</div>
</section>
<section class="level2">
<h2>MonadReadOnly Laws</h2>
<p><a name='crossref-3'></a></p>
<p>TODO</p>
</section>
<section class="level2">
<h2>MonadReadWrite Laws</h2>
<p><a name='crossref-4'></a></p>
<p>There is a <code>MonadReadWrite</code> instance for <code>StreamT s m</code> that we need to verify. Recall the laws for <a href="../../../Monad.html#crossref-0"><code>MonadReadWrite</code></a>:</p>
<dl>
<dt>Put/Put Law</dt>
<dd><code>put u1 &gt;&gt; put u2</code> is equivalent to <code>put u2</code>
</dd>
<dt>Put/Get Law</dt>
<dd><code>put u &gt;&gt; get</code> is equivalent to <code>put u &gt;&gt; return u</code>
</dd>
<dt>Get/Put Law</dt>
<dd><code>get &gt;&gt;= put</code> is equivalent to <code>return ()</code>
</dd>
<dt>Get/Get Law</dt>
<dd><code>get &gt;&gt;= (\u -&gt; get &gt;&gt;= k u)</code> is equivalent to <code>get &gt;&gt;= (\u -&gt; k u u)</code>
</dd>
</dl>
<p>Here we show that if <code>m</code> is a lawful instance of <code>MonadReadWrite</code> with state type <code>t</code> different from <code>s</code>, then so is <code>StreamT s m</code>.</p>
<p>First: <code>StreamT s m</code> satisfies the put/put law:</p>
<div class="example">
<div class="sourceCode" id="cb17"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" title="1">_StreamT_put_put_law_lifted</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb17-3" title="3">   <span class="op">.</span> ( <span class="dt">IsStream</span> s, <span class="dt">MonadReadWrite</span> t m )</a>
<a class="sourceLine" id="cb17-4" title="4">  <span class="ot">=&gt;</span> t <span class="ot">-&gt;</span> t</a>
<a class="sourceLine" id="cb17-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m ()]</a>
<a class="sourceLine" id="cb17-6" title="6">_StreamT_put_put_law_lifted u1 u2 <span class="ot">=</span></a>
<a class="sourceLine" id="cb17-7" title="7"></a>
<a class="sourceLine" id="cb17-8" title="8">  [ put u1 <span class="op">&gt;&gt;</span> put u2</a>
<a class="sourceLine" id="cb17-9" title="9"></a>
<a class="sourceLine" id="cb17-10" title="10">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb17-11" title="11"></a>
<a class="sourceLine" id="cb17-12" title="12">  , put u1 <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> put u2)</a>
<a class="sourceLine" id="cb17-13" title="13"></a>
<a class="sourceLine" id="cb17-14" title="14">  <span class="co">-- (condense const)</span></a>
<a class="sourceLine" id="cb17-15" title="15"></a>
<a class="sourceLine" id="cb17-16" title="16">  , put u1 <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (put u2)</a>
<a class="sourceLine" id="cb17-17" title="17"></a>
<a class="sourceLine" id="cb17-18" title="18">  <span class="co">-- (expand put)</span></a>
<a class="sourceLine" id="cb17-19" title="19"></a>
<a class="sourceLine" id="cb17-20" title="20">  , lift (put u1) <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (lift (put u2))</a>
<a class="sourceLine" id="cb17-21" title="21"></a>
<a class="sourceLine" id="cb17-22" title="22">  <span class="co">-- (property of const)</span></a>
<a class="sourceLine" id="cb17-23" title="23"></a>
<a class="sourceLine" id="cb17-24" title="24">  , lift (put u1) <span class="op">&gt;&gt;=</span> lift <span class="op">.</span> <span class="fu">const</span> (put u2)</a>
<a class="sourceLine" id="cb17-25" title="25"></a>
<a class="sourceLine" id="cb17-26" title="26">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb17-27" title="27"></a>
<a class="sourceLine" id="cb17-28" title="28">  , lift (put u1 <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (put u2))</a>
<a class="sourceLine" id="cb17-29" title="29"></a>
<a class="sourceLine" id="cb17-30" title="30">  <span class="co">-- (expand const)</span></a>
<a class="sourceLine" id="cb17-31" title="31"></a>
<a class="sourceLine" id="cb17-32" title="32">  , lift (put u1 <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> put u2))</a>
<a class="sourceLine" id="cb17-33" title="33"></a>
<a class="sourceLine" id="cb17-34" title="34">  <span class="co">-- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb17-35" title="35"></a>
<a class="sourceLine" id="cb17-36" title="36">  , lift (put u1 <span class="op">&gt;&gt;</span> put u2)</a>
<a class="sourceLine" id="cb17-37" title="37"></a>
<a class="sourceLine" id="cb17-38" title="38">  <span class="co">-- (put/put law in m)</span></a>
<a class="sourceLine" id="cb17-39" title="39"></a>
<a class="sourceLine" id="cb17-40" title="40">  , lift (put u2)</a>
<a class="sourceLine" id="cb17-41" title="41"></a>
<a class="sourceLine" id="cb17-42" title="42">  <span class="co">-- (condense put)</span></a>
<a class="sourceLine" id="cb17-43" title="43"></a>
<a class="sourceLine" id="cb17-44" title="44">  , put u2</a>
<a class="sourceLine" id="cb17-45" title="45">  ]</a></code></pre></div>
</div>
<p>Second: <code>StreamT s m</code> satisfies the put/get law:</p>
<div class="example">
<div class="sourceCode" id="cb18"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" title="1">_StreamT_put_get_law_lifted</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb18-3" title="3">   <span class="op">.</span> ( <span class="dt">IsStream</span> s, <span class="dt">MonadReadWrite</span> t m )</a>
<a class="sourceLine" id="cb18-4" title="4">  <span class="ot">=&gt;</span> t</a>
<a class="sourceLine" id="cb18-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m t]</a>
<a class="sourceLine" id="cb18-6" title="6">_StreamT_put_get_law_lifted u <span class="ot">=</span></a>
<a class="sourceLine" id="cb18-7" title="7"></a>
<a class="sourceLine" id="cb18-8" title="8">  [ put u <span class="op">&gt;&gt;</span> get</a>
<a class="sourceLine" id="cb18-9" title="9"></a>
<a class="sourceLine" id="cb18-10" title="10">  <span class="co">-- (expand &gt;&gt;)</span></a>
<a class="sourceLine" id="cb18-11" title="11"></a>
<a class="sourceLine" id="cb18-12" title="12">  , put u <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> get)</a>
<a class="sourceLine" id="cb18-13" title="13"></a>
<a class="sourceLine" id="cb18-14" title="14">  <span class="co">-- (condense const)</span></a>
<a class="sourceLine" id="cb18-15" title="15"></a>
<a class="sourceLine" id="cb18-16" title="16">  , put u <span class="op">&gt;&gt;=</span> <span class="fu">const</span> get</a>
<a class="sourceLine" id="cb18-17" title="17"></a>
<a class="sourceLine" id="cb18-18" title="18">  <span class="co">-- (expand put and get)</span></a>
<a class="sourceLine" id="cb18-19" title="19"></a>
<a class="sourceLine" id="cb18-20" title="20">  , lift (put u) <span class="op">&gt;&gt;=</span> <span class="fu">const</span> (lift get)</a>
<a class="sourceLine" id="cb18-21" title="21"></a>
<a class="sourceLine" id="cb18-22" title="22">  <span class="co">-- (property of const)</span></a>
<a class="sourceLine" id="cb18-23" title="23"></a>
<a class="sourceLine" id="cb18-24" title="24">  , lift (put u) <span class="op">&gt;&gt;=</span> lift <span class="op">.</span> <span class="fu">const</span> get</a>
<a class="sourceLine" id="cb18-25" title="25"></a>
<a class="sourceLine" id="cb18-26" title="26">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb18-27" title="27"></a>
<a class="sourceLine" id="cb18-28" title="28">  , lift (put u <span class="op">&gt;&gt;=</span> <span class="fu">const</span> get)</a>
<a class="sourceLine" id="cb18-29" title="29"></a>
<a class="sourceLine" id="cb18-30" title="30">  <span class="co">-- (expand const)</span></a>
<a class="sourceLine" id="cb18-31" title="31"></a>
<a class="sourceLine" id="cb18-32" title="32">  , lift (put u <span class="op">&gt;&gt;=</span> (\_ <span class="ot">-&gt;</span> get))</a>
<a class="sourceLine" id="cb18-33" title="33"></a>
<a class="sourceLine" id="cb18-34" title="34">  <span class="co">-- (condense &gt;&gt;)</span></a>
<a class="sourceLine" id="cb18-35" title="35"></a>
<a class="sourceLine" id="cb18-36" title="36">  , lift (put u <span class="op">&gt;&gt;</span> get)</a>
<a class="sourceLine" id="cb18-37" title="37"></a>
<a class="sourceLine" id="cb18-38" title="38">  <span class="co">-- (put/get law in m)</span></a>
<a class="sourceLine" id="cb18-39" title="39"></a>
<a class="sourceLine" id="cb18-40" title="40">  , lift (<span class="fu">return</span> u)</a>
<a class="sourceLine" id="cb18-41" title="41"></a>
<a class="sourceLine" id="cb18-42" title="42">  <span class="co">-- (unit law)</span></a>
<a class="sourceLine" id="cb18-43" title="43"></a>
<a class="sourceLine" id="cb18-44" title="44">  , <span class="fu">return</span> u</a>
<a class="sourceLine" id="cb18-45" title="45">  ]</a></code></pre></div>
</div>
<p>Third: <code>StreamT s m</code> satisfies the get/put law.</p>
<div class="example">
<div class="sourceCode" id="cb19"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" title="1">_StreamT_get_put_law_lifted</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m</a>
<a class="sourceLine" id="cb19-3" title="3">   <span class="op">.</span> ( <span class="dt">IsStream</span> s, <span class="dt">MonadReadWrite</span> t m )</a>
<a class="sourceLine" id="cb19-4" title="4">  <span class="ot">=&gt;</span> [<span class="dt">StreamT</span> s m ()]</a>
<a class="sourceLine" id="cb19-5" title="5">_StreamT_get_put_law_lifted <span class="ot">=</span></a>
<a class="sourceLine" id="cb19-6" title="6"></a>
<a class="sourceLine" id="cb19-7" title="7">  [ get <span class="op">@</span>t <span class="op">&gt;&gt;=</span> put</a>
<a class="sourceLine" id="cb19-8" title="8"></a>
<a class="sourceLine" id="cb19-9" title="9">  <span class="co">-- (expand put and get)</span></a>
<a class="sourceLine" id="cb19-10" title="10"></a>
<a class="sourceLine" id="cb19-11" title="11">  , lift (get <span class="op">@</span>t) <span class="op">&gt;&gt;=</span> lift <span class="op">.</span> put</a>
<a class="sourceLine" id="cb19-12" title="12"></a>
<a class="sourceLine" id="cb19-13" title="13">  <span class="co">-- (bind law)</span></a>
<a class="sourceLine" id="cb19-14" title="14"></a>
<a class="sourceLine" id="cb19-15" title="15">  , lift (get <span class="op">@</span>t <span class="op">&gt;&gt;=</span> put)</a>
<a class="sourceLine" id="cb19-16" title="16"></a>
<a class="sourceLine" id="cb19-17" title="17">  <span class="co">-- (get/put law in m)</span></a>
<a class="sourceLine" id="cb19-18" title="18"></a>
<a class="sourceLine" id="cb19-19" title="19">  , lift (<span class="fu">return</span> ())</a>
<a class="sourceLine" id="cb19-20" title="20"></a>
<a class="sourceLine" id="cb19-21" title="21">  <span class="co">-- (unit law)</span></a>
<a class="sourceLine" id="cb19-22" title="22"></a>
<a class="sourceLine" id="cb19-23" title="23">  , <span class="fu">return</span> ()</a>
<a class="sourceLine" id="cb19-24" title="24">  ]</a></code></pre></div>
</div>
<p>Fourth: <code>StreamT s m</code> satisfies the get/get law.</p>
<div class="example">
<div class="sourceCode" id="cb20"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" title="1">_StreamT_get_get_law_lifted</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="ot">  ::</span> <span class="kw">forall</span> s t m a</a>
<a class="sourceLine" id="cb20-3" title="3">   <span class="op">.</span> ( <span class="dt">IsStream</span> s, <span class="dt">MonadReadWrite</span> t m )</a>
<a class="sourceLine" id="cb20-4" title="4">  <span class="ot">=&gt;</span> (t <span class="ot">-&gt;</span> t <span class="ot">-&gt;</span> <span class="dt">StreamT</span> s m a)</a>
<a class="sourceLine" id="cb20-5" title="5">  <span class="ot">-&gt;</span> [<span class="dt">StreamT</span> s m a]</a>
<a class="sourceLine" id="cb20-6" title="6">_StreamT_get_get_law_lifted k <span class="ot">=</span></a>
<a class="sourceLine" id="cb20-7" title="7"></a>
<a class="sourceLine" id="cb20-8" title="8">  [ get <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u)</a>
<a class="sourceLine" id="cb20-9" title="9"></a>
<a class="sourceLine" id="cb20-10" title="10">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb20-11" title="11"></a>
<a class="sourceLine" id="cb20-12" title="12">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-13" title="13">      unStreamT get s1</a>
<a class="sourceLine" id="cb20-14" title="14">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb20-15" title="15"></a>
<a class="sourceLine" id="cb20-16" title="16">  <span class="co">-- (expand get)</span></a>
<a class="sourceLine" id="cb20-17" title="17"></a>
<a class="sourceLine" id="cb20-18" title="18">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-19" title="19">      unStreamT (lift get) s1</a>
<a class="sourceLine" id="cb20-20" title="20">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb20-21" title="21"></a>
<a class="sourceLine" id="cb20-22" title="22">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb20-23" title="23"></a>
<a class="sourceLine" id="cb20-24" title="24">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-25" title="25">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb20-26" title="26">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb20-27" title="27"></a>
<a class="sourceLine" id="cb20-28" title="28">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb20-29" title="29"></a>
<a class="sourceLine" id="cb20-30" title="30">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-31" title="31">      (\s <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb20-32" title="32">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb20-33" title="33"></a>
<a class="sourceLine" id="cb20-34" title="34">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-35" title="35"></a>
<a class="sourceLine" id="cb20-36" title="36">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-37" title="37">      (get <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)))</a>
<a class="sourceLine" id="cb20-38" title="38">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) s2)</a>
<a class="sourceLine" id="cb20-39" title="39"></a>
<a class="sourceLine" id="cb20-40" title="40">  <span class="co">-- (associative law in m)</span></a>
<a class="sourceLine" id="cb20-41" title="41"></a>
<a class="sourceLine" id="cb20-42" title="42">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-43" title="43">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-44" title="44">        (\c <span class="ot">-&gt;</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)) c</a>
<a class="sourceLine" id="cb20-45" title="45">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) s2))</a>
<a class="sourceLine" id="cb20-46" title="46"></a>
<a class="sourceLine" id="cb20-47" title="47">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-48" title="48"></a>
<a class="sourceLine" id="cb20-49" title="49">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-50" title="50">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-51" title="51">        (\c <span class="ot">-&gt;</span> <span class="fu">return</span> (c, s1)</a>
<a class="sourceLine" id="cb20-52" title="52">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) s2))</a>
<a class="sourceLine" id="cb20-53" title="53"></a>
<a class="sourceLine" id="cb20-54" title="54">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb20-55" title="55"></a>
<a class="sourceLine" id="cb20-56" title="56">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-57" title="57">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-58" title="58">        (\c <span class="ot">-&gt;</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) a) s2) (c, s1))</a>
<a class="sourceLine" id="cb20-59" title="59"></a>
<a class="sourceLine" id="cb20-60" title="60">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-61" title="61"></a>
<a class="sourceLine" id="cb20-62" title="62">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-63" title="63">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-64" title="64">        (\c <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> k u) c) s1)</a>
<a class="sourceLine" id="cb20-65" title="65"></a>
<a class="sourceLine" id="cb20-66" title="66">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-67" title="67"></a>
<a class="sourceLine" id="cb20-68" title="68">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-69" title="69">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-70" title="70">        (\c <span class="ot">-&gt;</span> unStreamT (get <span class="op">&gt;&gt;=</span> k c) s1)</a>
<a class="sourceLine" id="cb20-71" title="71"></a>
<a class="sourceLine" id="cb20-72" title="72">  <span class="co">-- (expand &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb20-73" title="73"></a>
<a class="sourceLine" id="cb20-74" title="74">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-75" title="75">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-76" title="76">        (\c <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> unStreamT get s</a>
<a class="sourceLine" id="cb20-77" title="77">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2)) s1)</a>
<a class="sourceLine" id="cb20-78" title="78"></a>
<a class="sourceLine" id="cb20-79" title="79">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb20-80" title="80"></a>
<a class="sourceLine" id="cb20-81" title="81">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-82" title="82">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-83" title="83">        (\c <span class="ot">-&gt;</span> (\s <span class="ot">-&gt;</span> unStreamT get s <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2)) s1)</a>
<a class="sourceLine" id="cb20-84" title="84"></a>
<a class="sourceLine" id="cb20-85" title="85">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-86" title="86"></a>
<a class="sourceLine" id="cb20-87" title="87">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-88" title="88">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-89" title="89">        (\c <span class="ot">-&gt;</span> unStreamT get s1 <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb20-90" title="90"></a>
<a class="sourceLine" id="cb20-91" title="91">  <span class="co">-- (expand get)</span></a>
<a class="sourceLine" id="cb20-92" title="92"></a>
<a class="sourceLine" id="cb20-93" title="93">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-94" title="94">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-95" title="95">        (\c <span class="ot">-&gt;</span> unStreamT (lift get) s1 <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb20-96" title="96"></a>
<a class="sourceLine" id="cb20-97" title="97">  <span class="co">-- (expand lift)</span></a>
<a class="sourceLine" id="cb20-98" title="98"></a>
<a class="sourceLine" id="cb20-99" title="99">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-100" title="100">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-101" title="101">        (\c <span class="ot">-&gt;</span> unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> get</a>
<a class="sourceLine" id="cb20-102" title="102">          <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1 <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb20-103" title="103"></a>
<a class="sourceLine" id="cb20-104" title="104">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb20-105" title="105"></a>
<a class="sourceLine" id="cb20-106" title="106">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-107" title="107">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-108" title="108">        (\c <span class="ot">-&gt;</span> (\s <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb20-109" title="109">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb20-110" title="110"></a>
<a class="sourceLine" id="cb20-111" title="111">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-112" title="112"></a>
<a class="sourceLine" id="cb20-113" title="113">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-114" title="114">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-115" title="115">        (\c <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1))</a>
<a class="sourceLine" id="cb20-116" title="116">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2))</a>
<a class="sourceLine" id="cb20-117" title="117"></a>
<a class="sourceLine" id="cb20-118" title="118">  <span class="co">-- (associative law in m)</span></a>
<a class="sourceLine" id="cb20-119" title="119"></a>
<a class="sourceLine" id="cb20-120" title="120">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-121" title="121">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-122" title="122">        (\c <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-123" title="123">          (\d <span class="ot">-&gt;</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)) d <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2)))</a>
<a class="sourceLine" id="cb20-124" title="124"></a>
<a class="sourceLine" id="cb20-125" title="125">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-126" title="126"></a>
<a class="sourceLine" id="cb20-127" title="127">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-128" title="128">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-129" title="129">        (\c <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-130" title="130">          (\d <span class="ot">-&gt;</span> <span class="fu">return</span> (d, s1) <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2)))</a>
<a class="sourceLine" id="cb20-131" title="131"></a>
<a class="sourceLine" id="cb20-132" title="132">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb20-133" title="133"></a>
<a class="sourceLine" id="cb20-134" title="134">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-135" title="135">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-136" title="136">        (\c <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-137" title="137">          (\d <span class="ot">-&gt;</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT (k c a) s2) (d, s1)))</a>
<a class="sourceLine" id="cb20-138" title="138"></a>
<a class="sourceLine" id="cb20-139" title="139">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-140" title="140"></a>
<a class="sourceLine" id="cb20-141" title="141">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-142" title="142">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-143" title="143">        (\c <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-144" title="144">          (\d <span class="ot">-&gt;</span> unStreamT (k c d) s1))</a>
<a class="sourceLine" id="cb20-145" title="145"></a>
<a class="sourceLine" id="cb20-146" title="146">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb20-147" title="147"></a>
<a class="sourceLine" id="cb20-148" title="148">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-149" title="149">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-150" title="150">        (\c <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-151" title="151">          (\d <span class="ot">-&gt;</span> (\u v <span class="ot">-&gt;</span> unStreamT (k u v) s1) c d))</a>
<a class="sourceLine" id="cb20-152" title="152"></a>
<a class="sourceLine" id="cb20-153" title="153">  <span class="co">-- (η-reduction)</span></a>
<a class="sourceLine" id="cb20-154" title="154"></a>
<a class="sourceLine" id="cb20-155" title="155">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-156" title="156">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-157" title="157">        (\c <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> (\u v <span class="ot">-&gt;</span> unStreamT (k u v) s1) c)</a>
<a class="sourceLine" id="cb20-158" title="158"></a>
<a class="sourceLine" id="cb20-159" title="159">  <span class="co">-- (get/get law in m)</span></a>
<a class="sourceLine" id="cb20-160" title="160"></a>
<a class="sourceLine" id="cb20-161" title="161">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-162" title="162">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-163" title="163">        (\c <span class="ot">-&gt;</span> (\u v <span class="ot">-&gt;</span> unStreamT (k u v) s1) c c)</a>
<a class="sourceLine" id="cb20-164" title="164"></a>
<a class="sourceLine" id="cb20-165" title="165">  <span class="co">-- (β-reduction)</span></a>
<a class="sourceLine" id="cb20-166" title="166"></a>
<a class="sourceLine" id="cb20-167" title="167">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-168" title="168">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-169" title="169">        (\c <span class="ot">-&gt;</span> unStreamT (k c c) s1)</a>
<a class="sourceLine" id="cb20-170" title="170"></a>
<a class="sourceLine" id="cb20-171" title="171">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb20-172" title="172"></a>
<a class="sourceLine" id="cb20-173" title="173">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-174" title="174">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-175" title="175">        (\c <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) c) s1)</a>
<a class="sourceLine" id="cb20-176" title="176"></a>
<a class="sourceLine" id="cb20-177" title="177">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb20-178" title="178"></a>
<a class="sourceLine" id="cb20-179" title="179">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-180" title="180">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-181" title="181">        (\c <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-182" title="182">          (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2) (c, s1))</a>
<a class="sourceLine" id="cb20-183" title="183"></a>
<a class="sourceLine" id="cb20-184" title="184">  <span class="co">-- (left identity law in m)</span></a>
<a class="sourceLine" id="cb20-185" title="185"></a>
<a class="sourceLine" id="cb20-186" title="186">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-187" title="187">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-188" title="188">        (\c <span class="ot">-&gt;</span> <span class="fu">return</span> (c, s1)</a>
<a class="sourceLine" id="cb20-189" title="189">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2))</a>
<a class="sourceLine" id="cb20-190" title="190"></a>
<a class="sourceLine" id="cb20-191" title="191">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb20-192" title="192"></a>
<a class="sourceLine" id="cb20-193" title="193">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-194" title="194">      get <span class="op">&gt;&gt;=</span></a>
<a class="sourceLine" id="cb20-195" title="195">        (\c <span class="ot">-&gt;</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)) c</a>
<a class="sourceLine" id="cb20-196" title="196">          <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2))</a>
<a class="sourceLine" id="cb20-197" title="197"></a>
<a class="sourceLine" id="cb20-198" title="198">  <span class="co">-- (associativity law in m)</span></a>
<a class="sourceLine" id="cb20-199" title="199"></a>
<a class="sourceLine" id="cb20-200" title="200">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-201" title="201">      (get <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s1)))</a>
<a class="sourceLine" id="cb20-202" title="202">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb20-203" title="203"></a>
<a class="sourceLine" id="cb20-204" title="204">  <span class="co">-- (β-expansion)</span></a>
<a class="sourceLine" id="cb20-205" title="205"></a>
<a class="sourceLine" id="cb20-206" title="206">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-207" title="207">      (\s <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb20-208" title="208">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb20-209" title="209"></a>
<a class="sourceLine" id="cb20-210" title="210">  <span class="co">-- (unStreamT . StreamT == id)</span></a>
<a class="sourceLine" id="cb20-211" title="211"></a>
<a class="sourceLine" id="cb20-212" title="212">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-213" title="213">      unStreamT (<span class="dt">StreamT</span> <span class="op">$</span> \s <span class="ot">-&gt;</span> get <span class="op">&gt;&gt;=</span> (\b <span class="ot">-&gt;</span> <span class="fu">return</span> (b, s))) s1</a>
<a class="sourceLine" id="cb20-214" title="214">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb20-215" title="215"></a>
<a class="sourceLine" id="cb20-216" title="216">  <span class="co">-- (condense lift)</span></a>
<a class="sourceLine" id="cb20-217" title="217"></a>
<a class="sourceLine" id="cb20-218" title="218">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-219" title="219">      unStreamT (lift get) s1</a>
<a class="sourceLine" id="cb20-220" title="220">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb20-221" title="221"></a>
<a class="sourceLine" id="cb20-222" title="222">  <span class="co">-- (condense get)</span></a>
<a class="sourceLine" id="cb20-223" title="223"></a>
<a class="sourceLine" id="cb20-224" title="224">  , <span class="dt">StreamT</span> <span class="op">$</span> \s1 <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-225" title="225">      unStreamT get s1</a>
<a class="sourceLine" id="cb20-226" title="226">        <span class="op">&gt;&gt;=</span> (\(a, s2) <span class="ot">-&gt;</span> unStreamT ((\u <span class="ot">-&gt;</span> k u u) a) s2)</a>
<a class="sourceLine" id="cb20-227" title="227"></a>
<a class="sourceLine" id="cb20-228" title="228">  <span class="co">-- (condense &gt;&gt;=)</span></a>
<a class="sourceLine" id="cb20-229" title="229"></a>
<a class="sourceLine" id="cb20-230" title="230">  , get <span class="op">&gt;&gt;=</span> (\u <span class="ot">-&gt;</span> k u u)</a>
<a class="sourceLine" id="cb20-231" title="231">  ]</a></code></pre></div>
</div>
</section>
</article>
</body>
</html>
