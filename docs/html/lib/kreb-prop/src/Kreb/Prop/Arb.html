<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="nbloomf">
  <title>Generatable Types</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="../../../../../../styles/style.css">
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
  <script>
    window.MathJax = {
      tex: {
        macros: {
          dom: "\\mathsf{dom}",
          cod: "\\mathsf{cod}",
          id:  "\\mathsf{id}",
          Hask: "\\mathsf{Hask}",
        }
      }
    };
  </script
</head>
<body>
<article>
<header>
<h1 class="title">Generatable Types</h1>
<p class="byline">nbloomf</p>
</header>
<div class="frontmatter">
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">module</span> <span class="dt">Kreb.Prop.Arb</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">import</span> <span class="dt">Data.Proxy</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">import</span> <span class="dt">Data.Void</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">import</span> <span class="dt">Data.Char</span> (ord)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">import</span> <span class="dt">Data.Monoid</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">import</span> <span class="dt">System.Random</span> (newStdGen)</a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Map</span> <span class="kw">as</span> <span class="dt">M</span></a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">import</span> <span class="dt">Kreb.Control</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">import</span> <span class="dt">Kreb.Format</span></a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="kw">import</span> <span class="dt">Kreb.Prop.Sample</span></a></code></pre></div>
</div>
<section class="level2">
<h2>Introduction</h2>
<p>The <code>Sample</code> monad gives us a context for generating random data. What we need now is a class of types which can be generated. This is <code>Arb</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">class</span> <span class="dt">Arb</span> t <span class="kw">where</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="ot">  arb ::</span> <span class="dt">Sample</span> t</a></code></pre></div>
<p>Related, for reasons we'll see later, we need a class of types which can alter the distribution of some other type. (Hint: it's how we generate functions.) This is <code>CoArb</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">class</span> <span class="dt">CoArb</span> t <span class="kw">where</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="ot">  coarb ::</span> t <span class="ot">-&gt;</span> <span class="dt">Sample</span> u <span class="ot">-&gt;</span> <span class="dt">Sample</span> u</a></code></pre></div>
<p>Finally, it will be useful to have a class for types whose inhabitants can be "shrunk" in a meaningful sense. This is <code>Prune</code>. The <code>prune</code> function should return a list of <em>smaller</em> but related values, or an empty list if this can't be done. In particular, iterating <code>prune</code> on a given value should eventually terminate. It's difficult to enforce this invariant with either laws or types, so we'll just need to be careful.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">class</span> <span class="dt">Prune</span> t <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="ot">  prune ::</span> t <span class="ot">-&gt;</span> [t]</a></code></pre></div>
</section>
<section class="level2">
<h2>Instances</h2>
<p>This part is kind of boring. To avoid orphan instances we have to define a ton of instances here.</p>
<p><code>Void</code>: we cannot generate arbitrary values of type <code>Void</code>, but we can give it a <code>CoArb</code> and <code>Prune</code> instance.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">instance</span> <span class="dt">CoArb</span> <span class="dt">Void</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb5-2" title="2">  coarb _ <span class="ot">=</span> <span class="fu">id</span></a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">instance</span> <span class="dt">Prune</span> <span class="dt">Void</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb5-5" title="5">  prune _ <span class="ot">=</span> []</a></code></pre></div>
<p>The unit type is boring but important.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">instance</span> <span class="dt">Arb</span> () <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-2" title="2">  arb <span class="ot">=</span> <span class="fu">return</span> ()</a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">instance</span> <span class="dt">CoArb</span> () <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-5" title="5">  coarb _ <span class="ot">=</span> <span class="fu">id</span></a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw">instance</span> <span class="dt">Prune</span> () <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-8" title="8">  prune _ <span class="ot">=</span> []</a></code></pre></div>
<p><code>Bool</code> has the first interesting <code>CoArb</code> instance, and illustrates the basic structure of <code>coarb</code> -- use the internal structure of a value to pass different integers to <code>twiddle</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">instance</span> <span class="dt">Arb</span> <span class="dt">Bool</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-2" title="2">  arb <span class="ot">=</span> pickFrom2</a>
<a class="sourceLine" id="cb7-3" title="3">    ( <span class="fu">return</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb7-4" title="4">    , <span class="fu">return</span> <span class="dt">False</span></a>
<a class="sourceLine" id="cb7-5" title="5">    )</a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="kw">instance</span> <span class="dt">CoArb</span> <span class="dt">Bool</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-8" title="8">  coarb p <span class="ot">=</span></a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="kw">if</span> p</a>
<a class="sourceLine" id="cb7-10" title="10">      <span class="kw">then</span> twiddle <span class="dv">0</span></a>
<a class="sourceLine" id="cb7-11" title="11">      <span class="kw">else</span> twiddle <span class="dv">1</span></a>
<a class="sourceLine" id="cb7-12" title="12"></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="kw">instance</span> <span class="dt">Prune</span> <span class="dt">Bool</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-14" title="14">  prune _ <span class="ot">=</span> []</a></code></pre></div>
<p><code>Int</code> has the first interesting <code>Prune</code> instance. In this case interpreting what <em>smaller</em> means is pretty straightforward; pruning a number moves closer to zero. Also note that pruning should generally be aggressive, shrinking as much as possible at first, and more subtly later in the list. This is because of how pruning will be used to shrink failing test cases -- we want to converge on a <em>minimal</em> failing test case as quickly as possible.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">instance</span> <span class="dt">Arb</span> <span class="dt">Int</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb8-2" title="2">  arb <span class="ot">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb8-3" title="3">    k <span class="ot">&lt;-</span> size</a>
<a class="sourceLine" id="cb8-4" title="4">    randIn (<span class="op">-</span>(<span class="dv">5</span><span class="op">*</span>k), <span class="dv">5</span><span class="op">*</span>k)</a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="kw">instance</span> <span class="dt">CoArb</span> <span class="dt">Int</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb8-7" title="7">  coarb <span class="ot">=</span> twiddle</a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="kw">instance</span> <span class="dt">Prune</span> <span class="dt">Int</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb8-10" title="10">  prune k <span class="ot">=</span> <span class="kw">case</span> <span class="fu">compare</span> k <span class="dv">0</span> <span class="kw">of</span></a>
<a class="sourceLine" id="cb8-11" title="11">    <span class="dt">LT</span> <span class="ot">-&gt;</span> <span class="fu">filter</span> (<span class="op">&gt;</span> k) [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, k<span class="ot">`div`</span><span class="dv">2</span>, k<span class="op">+</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb8-12" title="12">    <span class="dt">EQ</span> <span class="ot">-&gt;</span> []</a>
<a class="sourceLine" id="cb8-13" title="13">    <span class="dt">GT</span> <span class="ot">-&gt;</span> <span class="fu">filter</span> (<span class="op">&lt;</span> k) [<span class="dv">0</span>, <span class="dv">1</span>, k<span class="ot">`div`</span><span class="dv">2</span>, k<span class="op">-</span><span class="dv">1</span>]</a></code></pre></div>
<p><code>Integer</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">instance</span> <span class="dt">Arb</span> <span class="dt">Integer</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb9-2" title="2">  arb <span class="ot">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb9-3" title="3">    n <span class="ot">&lt;-</span> size</a>
<a class="sourceLine" id="cb9-4" title="4">    <span class="kw">let</span> m <span class="ot">=</span> <span class="dv">5</span> <span class="op">*</span> <span class="fu">toInteger</span> n</a>
<a class="sourceLine" id="cb9-5" title="5">    randIn (<span class="op">-</span>m, m)</a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="kw">instance</span> <span class="dt">CoArb</span> <span class="dt">Integer</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb9-8" title="8">  coarb <span class="ot">=</span> twiddle</a>
<a class="sourceLine" id="cb9-9" title="9"></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="kw">instance</span> <span class="dt">Prune</span> <span class="dt">Integer</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb9-11" title="11">  prune k <span class="ot">=</span> <span class="kw">case</span> <span class="fu">compare</span> k <span class="dv">0</span> <span class="kw">of</span></a>
<a class="sourceLine" id="cb9-12" title="12">    <span class="dt">LT</span> <span class="ot">-&gt;</span> <span class="fu">filter</span> (<span class="op">&gt;</span> k) [<span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, k<span class="ot">`div`</span><span class="dv">2</span>, k<span class="op">+</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb9-13" title="13">    <span class="dt">EQ</span> <span class="ot">-&gt;</span> []</a>
<a class="sourceLine" id="cb9-14" title="14">    <span class="dt">GT</span> <span class="ot">-&gt;</span> <span class="fu">filter</span> (<span class="op">&lt;</span> k) [<span class="dv">0</span>, <span class="dv">1</span>, k<span class="ot">`div`</span><span class="dv">2</span>, k<span class="op">-</span><span class="dv">1</span>]</a></code></pre></div>
<p><code>Char</code> is biased toward generating ascii.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">instance</span> <span class="dt">Arb</span> <span class="dt">Char</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb10-2" title="2">  arb <span class="ot">=</span> freq</a>
<a class="sourceLine" id="cb10-3" title="3">    [ (<span class="dv">4</span>, arbAsciiChar)</a>
<a class="sourceLine" id="cb10-4" title="4">    , (<span class="dv">1</span>, arbUnicodeChar)</a>
<a class="sourceLine" id="cb10-5" title="5">    ]</a>
<a class="sourceLine" id="cb10-6" title="6"></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="kw">instance</span> <span class="dt">CoArb</span> <span class="dt">Char</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb10-8" title="8">  coarb c <span class="ot">=</span> coarb (<span class="fu">ord</span> c)</a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="kw">instance</span> <span class="dt">Prune</span> <span class="dt">Char</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb10-11" title="11">  prune c <span class="ot">=</span> <span class="kw">if</span> c <span class="op">==</span> <span class="ch">&#39;a&#39;</span> <span class="kw">then</span> [] <span class="kw">else</span> [<span class="ch">&#39;a&#39;</span>]</a></code></pre></div>
<p><code>Maybe</code> is our first type constructor. Note what's going on with <code>CoArb</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb11-2" title="2">  ( <span class="dt">Arb</span> a</a>
<a class="sourceLine" id="cb11-3" title="3">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (<span class="dt">Maybe</span> a)</a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb11-5" title="5">    arb <span class="ot">=</span> freq</a>
<a class="sourceLine" id="cb11-6" title="6">      [ (<span class="dv">1</span>, <span class="fu">return</span> <span class="dt">Nothing</span>)</a>
<a class="sourceLine" id="cb11-7" title="7">      , (<span class="dv">5</span>, <span class="dt">Just</span> <span class="op">&lt;$&gt;</span> arb)</a>
<a class="sourceLine" id="cb11-8" title="8">      ]</a>
<a class="sourceLine" id="cb11-9" title="9"></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb11-11" title="11">  ( <span class="dt">CoArb</span> a</a>
<a class="sourceLine" id="cb11-12" title="12">  ) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (<span class="dt">Maybe</span> a)</a>
<a class="sourceLine" id="cb11-13" title="13">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb11-14" title="14">    coarb x <span class="ot">=</span> <span class="kw">case</span> x <span class="kw">of</span></a>
<a class="sourceLine" id="cb11-15" title="15">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> twiddle <span class="dv">0</span></a>
<a class="sourceLine" id="cb11-16" title="16">      <span class="dt">Just</span> a  <span class="ot">-&gt;</span> twiddle <span class="dv">1</span> <span class="op">.</span> coarb a</a>
<a class="sourceLine" id="cb11-17" title="17"></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb11-19" title="19">  ( <span class="dt">Prune</span> a</a>
<a class="sourceLine" id="cb11-20" title="20">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (<span class="dt">Maybe</span> a)</a>
<a class="sourceLine" id="cb11-21" title="21">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb11-22" title="22">    prune x <span class="ot">=</span> <span class="kw">case</span> x <span class="kw">of</span></a>
<a class="sourceLine" id="cb11-23" title="23">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> []</a>
<a class="sourceLine" id="cb11-24" title="24">      <span class="dt">Just</span> a <span class="ot">-&gt;</span> <span class="dt">Nothing</span> <span class="op">:</span> (<span class="fu">fmap</span> <span class="dt">Just</span> <span class="op">$</span> prune a)</a></code></pre></div>
<p><code>Either</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">instance</span> (<span class="dt">Arb</span> a, <span class="dt">Arb</span> b) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (<span class="dt">Either</span> a b) <span class="kw">where</span></a>
<a class="sourceLine" id="cb12-2" title="2">  arb <span class="ot">=</span> freq</a>
<a class="sourceLine" id="cb12-3" title="3">    [ (<span class="dv">1</span>, <span class="fu">fmap</span> <span class="dt">Left</span> arb)</a>
<a class="sourceLine" id="cb12-4" title="4">    , (<span class="dv">1</span>, <span class="fu">fmap</span> <span class="dt">Right</span> arb)</a>
<a class="sourceLine" id="cb12-5" title="5">    ]</a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="kw">instance</span> (<span class="dt">CoArb</span> a, <span class="dt">CoArb</span> b) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (<span class="dt">Either</span> a b) <span class="kw">where</span></a>
<a class="sourceLine" id="cb12-8" title="8">  coarb x <span class="ot">=</span> <span class="kw">case</span> x <span class="kw">of</span></a>
<a class="sourceLine" id="cb12-9" title="9">    <span class="dt">Left</span> a  <span class="ot">-&gt;</span> twiddle <span class="dv">0</span> <span class="op">.</span> coarb a</a>
<a class="sourceLine" id="cb12-10" title="10">    <span class="dt">Right</span> b <span class="ot">-&gt;</span> twiddle <span class="dv">1</span> <span class="op">.</span> coarb b</a>
<a class="sourceLine" id="cb12-11" title="11"></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="kw">instance</span> (<span class="dt">Prune</span> a, <span class="dt">Prune</span> b) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (<span class="dt">Either</span> a b) <span class="kw">where</span></a>
<a class="sourceLine" id="cb12-13" title="13">  prune x <span class="ot">=</span> <span class="kw">case</span> x <span class="kw">of</span></a>
<a class="sourceLine" id="cb12-14" title="14">    <span class="dt">Left</span> a  <span class="ot">-&gt;</span> <span class="fu">fmap</span> <span class="dt">Left</span> <span class="op">$</span> prune a</a>
<a class="sourceLine" id="cb12-15" title="15">    <span class="dt">Right</span> b <span class="ot">-&gt;</span> <span class="fu">fmap</span> <span class="dt">Right</span> <span class="op">$</span> prune b</a></code></pre></div>
<p>Tuples are super interesting and not at all repetitive. Note what's happening with <code>prune</code>: we are careful to shrink only one entry in the tuple at each step.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-2" title="2">  ( <span class="dt">Arb</span> a1, <span class="dt">Arb</span> a2</a>
<a class="sourceLine" id="cb13-3" title="3">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (a1, a2)</a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-5" title="5">    arb <span class="ot">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb13-6" title="6">      a1 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-7" title="7">      a2 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-8" title="8">      <span class="fu">return</span> (a1, a2)</a>
<a class="sourceLine" id="cb13-9" title="9"></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-11" title="11">  ( <span class="dt">Prune</span> a1, <span class="dt">Prune</span> a2</a>
<a class="sourceLine" id="cb13-12" title="12">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (a1, a2)</a>
<a class="sourceLine" id="cb13-13" title="13">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-14" title="14">    prune (a1,a2) <span class="ot">=</span> <span class="fu">concat</span></a>
<a class="sourceLine" id="cb13-15" title="15">      [ [ (u1,a2) <span class="op">|</span> u1 <span class="ot">&lt;-</span> prune a1 ]</a>
<a class="sourceLine" id="cb13-16" title="16">      , [ (a1,u2) <span class="op">|</span> u2 <span class="ot">&lt;-</span> prune a2 ]</a>
<a class="sourceLine" id="cb13-17" title="17">      ]</a>
<a class="sourceLine" id="cb13-18" title="18"></a>
<a class="sourceLine" id="cb13-19" title="19"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-20" title="20">  ( <span class="dt">CoArb</span> a1, <span class="dt">CoArb</span> a2</a>
<a class="sourceLine" id="cb13-21" title="21">  ) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (a1,a2)</a>
<a class="sourceLine" id="cb13-22" title="22">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-23" title="23">    coarb (a1,a2) <span class="ot">=</span></a>
<a class="sourceLine" id="cb13-24" title="24">      coarb a1 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-25" title="25">      coarb a2</a>
<a class="sourceLine" id="cb13-26" title="26"></a>
<a class="sourceLine" id="cb13-27" title="27"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-28" title="28">  ( <span class="dt">Arb</span> a1, <span class="dt">Arb</span> a2, <span class="dt">Arb</span> a3</a>
<a class="sourceLine" id="cb13-29" title="29">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (a1, a2, a3)</a>
<a class="sourceLine" id="cb13-30" title="30">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-31" title="31">    arb <span class="ot">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb13-32" title="32">      a1 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-33" title="33">      a2 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-34" title="34">      a3 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-35" title="35">      <span class="fu">return</span> (a1, a2, a3)</a>
<a class="sourceLine" id="cb13-36" title="36"></a>
<a class="sourceLine" id="cb13-37" title="37"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-38" title="38">  ( <span class="dt">Prune</span> a1, <span class="dt">Prune</span> a2, <span class="dt">Prune</span> a3</a>
<a class="sourceLine" id="cb13-39" title="39">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (a1, a2, a3)</a>
<a class="sourceLine" id="cb13-40" title="40">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-41" title="41">    prune (a1,a2,a3) <span class="ot">=</span> <span class="fu">concat</span></a>
<a class="sourceLine" id="cb13-42" title="42">      [ [ (u1,a2,a3) <span class="op">|</span> u1 <span class="ot">&lt;-</span> prune a1 ]</a>
<a class="sourceLine" id="cb13-43" title="43">      , [ (a1,u2,a3) <span class="op">|</span> u2 <span class="ot">&lt;-</span> prune a2 ]</a>
<a class="sourceLine" id="cb13-44" title="44">      , [ (a1,a2,u3) <span class="op">|</span> u3 <span class="ot">&lt;-</span> prune a3 ]</a>
<a class="sourceLine" id="cb13-45" title="45">      ]</a>
<a class="sourceLine" id="cb13-46" title="46"></a>
<a class="sourceLine" id="cb13-47" title="47"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-48" title="48">  ( <span class="dt">CoArb</span> a1, <span class="dt">CoArb</span> a2, <span class="dt">CoArb</span> a3</a>
<a class="sourceLine" id="cb13-49" title="49">  ) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (a1,a2,a3)</a>
<a class="sourceLine" id="cb13-50" title="50">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-51" title="51">    coarb (a1,a2,a3) <span class="ot">=</span></a>
<a class="sourceLine" id="cb13-52" title="52">      coarb a1 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-53" title="53">      coarb a2 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-54" title="54">      coarb a3</a>
<a class="sourceLine" id="cb13-55" title="55"></a>
<a class="sourceLine" id="cb13-56" title="56"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-57" title="57">  ( <span class="dt">Arb</span> a1, <span class="dt">Arb</span> a2, <span class="dt">Arb</span> a3, <span class="dt">Arb</span> a4</a>
<a class="sourceLine" id="cb13-58" title="58">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (a1, a2, a3, a4)</a>
<a class="sourceLine" id="cb13-59" title="59">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-60" title="60">    arb <span class="ot">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb13-61" title="61">      a1 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-62" title="62">      a2 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-63" title="63">      a3 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-64" title="64">      a4 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-65" title="65">      <span class="fu">return</span> (a1, a2, a3, a4)</a>
<a class="sourceLine" id="cb13-66" title="66"></a>
<a class="sourceLine" id="cb13-67" title="67"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-68" title="68">  ( <span class="dt">Prune</span> a1, <span class="dt">Prune</span> a2, <span class="dt">Prune</span> a3, <span class="dt">Prune</span> a4</a>
<a class="sourceLine" id="cb13-69" title="69">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (a1, a2, a3, a4)</a>
<a class="sourceLine" id="cb13-70" title="70">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-71" title="71">    prune (a1,a2,a3,a4) <span class="ot">=</span> <span class="fu">concat</span></a>
<a class="sourceLine" id="cb13-72" title="72">      [ [ (u1,a2,a3,a4) <span class="op">|</span> u1 <span class="ot">&lt;-</span> prune a1 ]</a>
<a class="sourceLine" id="cb13-73" title="73">      , [ (a1,u2,a3,a4) <span class="op">|</span> u2 <span class="ot">&lt;-</span> prune a2 ]</a>
<a class="sourceLine" id="cb13-74" title="74">      , [ (a1,a2,u3,a4) <span class="op">|</span> u3 <span class="ot">&lt;-</span> prune a3 ]</a>
<a class="sourceLine" id="cb13-75" title="75">      , [ (a1,a2,a3,u4) <span class="op">|</span> u4 <span class="ot">&lt;-</span> prune a4 ]</a>
<a class="sourceLine" id="cb13-76" title="76">      ]</a>
<a class="sourceLine" id="cb13-77" title="77"></a>
<a class="sourceLine" id="cb13-78" title="78"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-79" title="79">  ( <span class="dt">CoArb</span> a1, <span class="dt">CoArb</span> a2, <span class="dt">CoArb</span> a3, <span class="dt">CoArb</span> a4</a>
<a class="sourceLine" id="cb13-80" title="80">  ) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (a1,a2,a3,a4)</a>
<a class="sourceLine" id="cb13-81" title="81">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-82" title="82">    coarb (a1,a2,a3,a4) <span class="ot">=</span></a>
<a class="sourceLine" id="cb13-83" title="83">      coarb a1 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-84" title="84">      coarb a2 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-85" title="85">      coarb a3 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-86" title="86">      coarb a4</a>
<a class="sourceLine" id="cb13-87" title="87"></a>
<a class="sourceLine" id="cb13-88" title="88"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-89" title="89">  ( <span class="dt">Arb</span> a1, <span class="dt">Arb</span> a2, <span class="dt">Arb</span> a3, <span class="dt">Arb</span> a4, <span class="dt">Arb</span> a5</a>
<a class="sourceLine" id="cb13-90" title="90">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (a1, a2, a3, a4, a5)</a>
<a class="sourceLine" id="cb13-91" title="91">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-92" title="92">    arb <span class="ot">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb13-93" title="93">      a1 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-94" title="94">      a2 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-95" title="95">      a3 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-96" title="96">      a4 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-97" title="97">      a5 <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb13-98" title="98">      <span class="fu">return</span> (a1, a2, a3, a4, a5)</a>
<a class="sourceLine" id="cb13-99" title="99"></a>
<a class="sourceLine" id="cb13-100" title="100"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-101" title="101">  ( <span class="dt">Prune</span> a1, <span class="dt">Prune</span> a2, <span class="dt">Prune</span> a3, <span class="dt">Prune</span> a4, <span class="dt">Prune</span> a5</a>
<a class="sourceLine" id="cb13-102" title="102">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (a1, a2, a3, a4, a5)</a>
<a class="sourceLine" id="cb13-103" title="103">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-104" title="104">    prune (a1,a2,a3,a4,a5) <span class="ot">=</span> <span class="fu">concat</span></a>
<a class="sourceLine" id="cb13-105" title="105">      [ [ (u1,a2,a3,a4,a5) <span class="op">|</span> u1 <span class="ot">&lt;-</span> prune a1 ]</a>
<a class="sourceLine" id="cb13-106" title="106">      , [ (a1,u2,a3,a4,a5) <span class="op">|</span> u2 <span class="ot">&lt;-</span> prune a2 ]</a>
<a class="sourceLine" id="cb13-107" title="107">      , [ (a1,a2,u3,a4,a5) <span class="op">|</span> u3 <span class="ot">&lt;-</span> prune a3 ]</a>
<a class="sourceLine" id="cb13-108" title="108">      , [ (a1,a2,a3,u4,a5) <span class="op">|</span> u4 <span class="ot">&lt;-</span> prune a4 ]</a>
<a class="sourceLine" id="cb13-109" title="109">      , [ (a1,a2,a3,a4,u5) <span class="op">|</span> u5 <span class="ot">&lt;-</span> prune a5 ]</a>
<a class="sourceLine" id="cb13-110" title="110">      ]</a>
<a class="sourceLine" id="cb13-111" title="111"></a>
<a class="sourceLine" id="cb13-112" title="112"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb13-113" title="113">  ( <span class="dt">CoArb</span> a1, <span class="dt">CoArb</span> a2, <span class="dt">CoArb</span> a3, <span class="dt">CoArb</span> a4, <span class="dt">CoArb</span> a5</a>
<a class="sourceLine" id="cb13-114" title="114">  ) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (a1,a2,a3,a4,a5)</a>
<a class="sourceLine" id="cb13-115" title="115">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb13-116" title="116">    coarb (a1,a2,a3,a4,a5) <span class="ot">=</span></a>
<a class="sourceLine" id="cb13-117" title="117">      coarb a1 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-118" title="118">      coarb a2 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-119" title="119">      coarb a3 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-120" title="120">      coarb a4 <span class="op">.</span></a>
<a class="sourceLine" id="cb13-121" title="121">      coarb a5</a></code></pre></div>
<p>Lists:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb14-2" title="2">  ( <span class="dt">Arb</span> a</a>
<a class="sourceLine" id="cb14-3" title="3">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> [a]</a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb14-5" title="5">    arb <span class="ot">=</span> nestOf arb</a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb14-8" title="8">  ( <span class="dt">Prune</span> a</a>
<a class="sourceLine" id="cb14-9" title="9">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> [a]</a>
<a class="sourceLine" id="cb14-10" title="10">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb14-11" title="11">    prune z <span class="ot">=</span> <span class="kw">case</span> z <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-12" title="12">      [] <span class="ot">-&gt;</span> []</a>
<a class="sourceLine" id="cb14-13" title="13">      x<span class="op">:</span>xs <span class="ot">-&gt;</span> <span class="fu">concat</span></a>
<a class="sourceLine" id="cb14-14" title="14">       [ [[]]</a>
<a class="sourceLine" id="cb14-15" title="15">       , <span class="kw">if</span> <span class="fu">null</span> xs <span class="kw">then</span> [] <span class="kw">else</span> [[x], xs]</a>
<a class="sourceLine" id="cb14-16" title="16">       , <span class="fu">map</span> (x<span class="op">:</span>) (prune xs)</a>
<a class="sourceLine" id="cb14-17" title="17">       , <span class="fu">map</span> (<span class="op">:</span>xs) (prune x)</a>
<a class="sourceLine" id="cb14-18" title="18">       ]</a>
<a class="sourceLine" id="cb14-19" title="19"></a>
<a class="sourceLine" id="cb14-20" title="20"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb14-21" title="21">  ( <span class="dt">CoArb</span> a</a>
<a class="sourceLine" id="cb14-22" title="22">  ) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> [a]</a>
<a class="sourceLine" id="cb14-23" title="23">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb14-24" title="24">    coarb z <span class="ot">=</span> <span class="kw">case</span> z <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-25" title="25">      []   <span class="ot">-&gt;</span> twiddle <span class="dv">0</span></a>
<a class="sourceLine" id="cb14-26" title="26">      x<span class="op">:</span>xs <span class="ot">-&gt;</span> twiddle <span class="dv">1</span> <span class="op">.</span> coarb (x,xs)</a></code></pre></div>
<p>We have <code>Arb</code> and <code>CoArb</code> instances for function types, but not prune. There's a really clever way around this in the paper <a href="https://dl.acm.org/doi/10.1145/2364506.2364516">Shrinking and showing functions</a> by Koen Claessen, which we'll build out later.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb15-2" title="2">  ( <span class="dt">CoArb</span> a, <span class="dt">Arb</span> b</a>
<a class="sourceLine" id="cb15-3" title="3">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (a <span class="ot">-&gt;</span> b)</a>
<a class="sourceLine" id="cb15-4" title="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb15-5" title="5">    arb <span class="ot">=</span> promoteSample <span class="op">$</span> \a <span class="ot">-&gt;</span> coarb a arb</a>
<a class="sourceLine" id="cb15-6" title="6"></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb15-8" title="8">  ( <span class="dt">Arb</span> a, <span class="dt">CoArb</span> b</a>
<a class="sourceLine" id="cb15-9" title="9">  ) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (a <span class="ot">-&gt;</span> b)</a>
<a class="sourceLine" id="cb15-10" title="10">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb15-11" title="11">    coarb f gen <span class="ot">=</span> <span class="kw">do</span></a>
<a class="sourceLine" id="cb15-12" title="12">      xs <span class="ot">&lt;-</span> arb</a>
<a class="sourceLine" id="cb15-13" title="13">      coarb (<span class="fu">map</span> f xs) gen</a></code></pre></div>
<p>Now we're getting to the non-prelude standard library types. Map:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb16-2" title="2">  ( <span class="dt">Arb</span> k, <span class="dt">Arb</span> a, <span class="dt">Ord</span> k</a>
<a class="sourceLine" id="cb16-3" title="3">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (<span class="dt">M.Map</span> k a)</a>
<a class="sourceLine" id="cb16-4" title="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb16-5" title="5">    arb <span class="ot">=</span> M.fromList <span class="op">&lt;$&gt;</span> arb</a>
<a class="sourceLine" id="cb16-6" title="6"></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb16-8" title="8">  ( <span class="dt">Prune</span> k, <span class="dt">Prune</span> a, <span class="dt">Ord</span> k</a>
<a class="sourceLine" id="cb16-9" title="9">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (<span class="dt">M.Map</span> k a)</a>
<a class="sourceLine" id="cb16-10" title="10">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb16-11" title="11">    prune <span class="ot">=</span></a>
<a class="sourceLine" id="cb16-12" title="12">      <span class="fu">map</span> M.fromList <span class="op">.</span> prune <span class="op">.</span> M.toList</a></code></pre></div>
<p>The wrapper types from <code>Monoid</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">instance</span> (<span class="dt">Arb</span> a) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (<span class="dt">Sum</span> a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb17-2" title="2">  arb <span class="ot">=</span> <span class="dt">Sum</span> <span class="op">&lt;$&gt;</span> arb</a>
<a class="sourceLine" id="cb17-3" title="3"></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="kw">instance</span> (<span class="dt">Prune</span> a) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (<span class="dt">Sum</span> a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb17-5" title="5">  prune (<span class="dt">Sum</span> a) <span class="ot">=</span> <span class="fu">fmap</span> <span class="dt">Sum</span> <span class="op">$</span> prune a</a>
<a class="sourceLine" id="cb17-6" title="6"></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="kw">instance</span> (<span class="dt">CoArb</span> a) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (<span class="dt">Sum</span> a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb17-8" title="8">  coarb (<span class="dt">Sum</span> a) <span class="ot">=</span> coarb a</a></code></pre></div>
<p>Now we get to the data types defined in <code>kreb-control</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">instance</span> ( <span class="dt">Arb</span> a ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (<span class="dt">Identity</span> a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb18-2" title="2">  arb <span class="ot">=</span> <span class="fu">fmap</span> <span class="dt">Identity</span> arb</a>
<a class="sourceLine" id="cb18-3" title="3"></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="kw">instance</span> ( <span class="dt">CoArb</span> a ) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (<span class="dt">Identity</span> a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb18-5" title="5">  coarb (<span class="dt">Identity</span> a) <span class="ot">=</span> coarb a</a>
<a class="sourceLine" id="cb18-6" title="6"></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="kw">instance</span> ( <span class="dt">Prune</span> a ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (<span class="dt">Identity</span> a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb18-8" title="8">  prune <span class="ot">=</span> <span class="fu">map</span> <span class="dt">Identity</span> <span class="op">.</span> prune <span class="op">.</span> unIdentity</a>
<a class="sourceLine" id="cb18-9" title="9"></a>
<a class="sourceLine" id="cb18-10" title="10"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb18-11" title="11">  ( <span class="dt">Arb</span> (f (g a))</a>
<a class="sourceLine" id="cb18-12" title="12">  ) <span class="ot">=&gt;</span> <span class="dt">Arb</span> (<span class="dt">Compose</span> f g a)</a>
<a class="sourceLine" id="cb18-13" title="13">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb18-14" title="14">    arb <span class="ot">=</span> <span class="fu">fmap</span> <span class="dt">Compose</span> arb</a>
<a class="sourceLine" id="cb18-15" title="15"></a>
<a class="sourceLine" id="cb18-16" title="16"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb18-17" title="17">  ( <span class="dt">CoArb</span> (f (g a))</a>
<a class="sourceLine" id="cb18-18" title="18">  ) <span class="ot">=&gt;</span> <span class="dt">CoArb</span> (<span class="dt">Compose</span> f g a)</a>
<a class="sourceLine" id="cb18-19" title="19">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb18-20" title="20">    coarb (<span class="dt">Compose</span> x) <span class="ot">=</span> coarb x</a>
<a class="sourceLine" id="cb18-21" title="21"></a>
<a class="sourceLine" id="cb18-22" title="22"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb18-23" title="23">  ( <span class="dt">Prune</span> (f (g a))</a>
<a class="sourceLine" id="cb18-24" title="24">  ) <span class="ot">=&gt;</span> <span class="dt">Prune</span> (<span class="dt">Compose</span> f g a)</a>
<a class="sourceLine" id="cb18-25" title="25">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb18-26" title="26">    prune <span class="ot">=</span> <span class="fu">fmap</span> <span class="dt">Compose</span> <span class="op">.</span> prune <span class="op">.</span> unCompose</a></code></pre></div>
</section>
</article>
</body>
</html>
