<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Ned.Data.FingerTreeZip</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <style type="text/css">
  /* Kudos to Pascal Hertleif                  */
  /* https://gist.github.com/killercup/5917178 */
  
  html {
    font-size: 100%;
    overflow-y: scroll;
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
  }
  
  body {
    color: #444;
    font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif;
    font-size: 12px;
    line-height: 1.7;
    padding: 1em;
    margin: auto;
    max-width: 42em;
    background: #fefefe;
  }
  
  a {
    color: #0645ad;
    text-decoration: none;
  }
  
  a:visited {
    color: #0b0080;
  }
  
  a:hover {
    color: #06e;
  }
  
  a:active {
    color: #faa700;
  }
  
  a:focus {
    outline: thin dotted;
  }
  
  *::-moz-selection {
    background: rgba(255, 255, 0, 0.3);
    color: #000;
  }
  
  *::selection {
    background: rgba(255, 255, 0, 0.3);
    color: #000;
  }
  
  a::-moz-selection {
    background: rgba(255, 255, 0, 0.3);
    color: #0645ad;
  }
  
  a::selection {
    background: rgba(255, 255, 0, 0.3);
    color: #0645ad;
  }
  
  p {
    margin: 1em 0;
  }
  
  img {
    max-width: 100%;
  }
  
  h1, h2, h3, h4, h5, h6 {
    color: #111;
    line-height: 125%;
    margin-top: 2em;
    font-weight: normal;
  }
  
  h4, h5, h6 {
    font-weight: bold;
  }
  
  h1 {
    font-size: 2.5em;
  }
  
  h2 {
    font-size: 2em;
  }
  
  h3 {
    font-size: 1.5em;
  }
  
  h4 {
    font-size: 1.2em;
  }
  
  h5 {
    font-size: 1em;
  }
  
  h6 {
    font-size: 0.9em;
  }
  
  blockquote {
    display: block;
    color: #666666;
    margin: 0;
    padding-left: 3em;
    border-left: 0.5em #EEE solid;
  }
  
  hr {
    display: block;
    height: 2px;
    border: 0;
    border-top: 1px solid #aaa;
    border-bottom: 1px solid #eee;
    margin: 1em 0;
    padding: 0;
  }
  
  pre, code, kbd, samp {
    color: #000;
    font-family: monospace, monospace;
    _font-family: 'courier new', monospace;
    font-size: 0.98em;
  }
  
  pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  b, strong {
    font-weight: bold;
  }
  
  dfn {
    font-style: italic;
  }
  
  ins {
    background: #ff9;
    color: #000;
    text-decoration: none;
  }
  
  mark {
    background: #ff0;
    color: #000;
    font-style: italic;
    font-weight: bold;
  }
  
  sub, sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
  }
  
  sup {
    top: -0.5em;
  }
  
  sub {
    bottom: -0.25em;
  }
  
  ul, ol {
    margin: 1em 0;
    padding: 0 0 0 2em;
  }
  
  li p:last-child {
    margin-bottom: 0;
  }
  
  ul ul, ol ol {
    margin: .3em 0;
  }
  
  dl {
    margin-bottom: 1em;
  }
  
  dt {
    font-weight: bold;
    margin-bottom: .8em;
  }
  
  dd {
    margin: 0 0 .8em 2em;
  }
  
  dd:last-child {
    margin-bottom: 0;
  }
  
  img {
    border: 0;
    -ms-interpolation-mode: bicubic;
    vertical-align: middle;
  }
  
  figure {
    display: block;
    text-align: center;
    margin: 1em 0;
  }
  
  figure img {
    border: none;
    margin: 0 auto;
  }
  
  figcaption {
    font-size: 0.8em;
    font-style: italic;
    margin: 0 0 .8em;
  }
  
  table {
    margin-bottom: 2em;
    border-bottom: 1px solid #ddd;
    border-right: 1px solid #ddd;
    border-spacing: 0;
    border-collapse: collapse;
  }
  
  table th {
    padding: .2em 1em;
    background-color: #eee;
    border-top: 1px solid #ddd;
    border-left: 1px solid #ddd;
  }
  
  table td {
    padding: .2em 1em;
    border-top: 1px solid #ddd;
    border-left: 1px solid #ddd;
    vertical-align: top;
  }
  
  .author {
    font-size: 1.2em;
    text-align: center;
  }
  
  .sourceCode {
    background-color: #eee;
  }
  
  @media only screen and (min-width: 480px) {
    body {
      font-size: 14px;
    }
  }
  @media only screen and (min-width: 768px) {
    body {
      font-size: 16px;
    }
  }
  @media print {
    * {
      background: transparent !important;
      color: black !important;
      filter: none !important;
      -ms-filter: none !important;
    }
  
    body {
      font-size: 12pt;
      max-width: 100%;
    }
  
    a, a:visited {
      text-decoration: underline;
    }
  
    hr {
      height: 1px;
      border: 0;
      border-bottom: 1px solid black;
    }
  
    a[href]:after {
      content: " (" attr(href) ")";
    }
  
    abbr[title]:after {
      content: " (" attr(title) ")";
    }
  
    .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
      content: "";
    }
  
    pre, blockquote {
      border: 1px solid #999;
      padding-right: 1em;
      page-break-inside: avoid;
    }
  
    tr, img {
      page-break-inside: avoid;
    }
  
    img {
      max-width: 100% !important;
    }
  
    @page :left {
      margin: 15mm 20mm 15mm 10mm;
  }
  
    @page :right {
      margin: 15mm 10mm 15mm 20mm;
  }
  
    p, h2, h3 {
      orphans: 3;
      widows: 3;
    }
  
    h2, h3 {
      page-break-after: avoid;
    }
  }
  </style>
</head>
<body>
<header>
<h1 class="title">Ned.Data.FingerTreeZip</h1>
</header>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#exposed-api">Exposed API</a></li>
<li><a href="#the-zipper">The Zipper</a></li>
<li><a href="#the-tape-class">The Tape class</a></li>
<li><a href="#testing-and-debugging">Testing and debugging</a></li>
</ul>
<h1 id="introduction">Introduction</h1>
<p>In <a href="src/Ned/Data/FingerTree.html">Ned.Data.FingerTree</a> we developed a list-like data structure with efficient amortized cons and splitting. Our goal is to use this structure as the basis for a text buffer. But before we get there we need something extra: a <em>zipper</em>. Zippers are a powerful technique for turning an algebraic data type into a new type with a distinguished ‘pointer’ position, or in our case, a <em>cursor</em>, where we have constant-time access to data. Think about how when editing text there’s a special position in the character stream where any new edits happen; this is the cursor position, and the edits there need to be as efficient as possible.</p>
<p>This code uses the following extensions:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ot">{-# LANGUAGE</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ot">    MultiParamTypeClasses</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="ot">  , FlexibleInstances</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="ot">#-}</span></a></code></pre></div>
<p>These are necessary so we can use the <code>Valued</code> type class from <code>FingerTree</code> as a constraint, and because the <code>Tape</code> class introduced here has two parameters.</p>
<h1 id="exposed-api">Exposed API</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">module</span> <span class="dt">Ned.Data.FingerTreeZip</span> (</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="co">-- ** FingerTreeZip</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">    <span class="dt">FingerTreeZip</span>(<span class="fu">..</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  , splitFTZ</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  , integrateFTZ</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  , remeasureFTZ</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  , emptyFTZ</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  , valueAtHeadFTZ</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  <span class="co">-- ** The Tape Class</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  , <span class="dt">Tape</span>(<span class="fu">..</span>)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  , isEmptyFTZ</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  , mkTapeFTZ</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">  , mkTapeFocusFTZ</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">  , unTapeFTZ</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">  , isAtInitFTZ</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">  , isAtLastFTZ</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">  , initReadFTZ  </a>
<a class="sourceLine" id="cb2-19" data-line-number="19">  , initAlterFTZ  </a>
<a class="sourceLine" id="cb2-20" data-line-number="20">  , initMoveFTZ  </a>
<a class="sourceLine" id="cb2-21" data-line-number="21">  , initInsertFTZ  </a>
<a class="sourceLine" id="cb2-22" data-line-number="22">  , initDeleteFTZ  </a>
<a class="sourceLine" id="cb2-23" data-line-number="23">  , lastReadFTZ  </a>
<a class="sourceLine" id="cb2-24" data-line-number="24">  , lastAlterFTZ  </a>
<a class="sourceLine" id="cb2-25" data-line-number="25">  , lastMoveFTZ  </a>
<a class="sourceLine" id="cb2-26" data-line-number="26">  , lastInsertFTZ  </a>
<a class="sourceLine" id="cb2-27" data-line-number="27">  , lastDeleteFTZ  </a>
<a class="sourceLine" id="cb2-28" data-line-number="28">  , headReadFTZ  </a>
<a class="sourceLine" id="cb2-29" data-line-number="29">  , headAlterFTZ  </a>
<a class="sourceLine" id="cb2-30" data-line-number="30">  , headMoveLFTZ  </a>
<a class="sourceLine" id="cb2-31" data-line-number="31">  , headMoveRFTZ  </a>
<a class="sourceLine" id="cb2-32" data-line-number="32">  , headInsertLFTZ  </a>
<a class="sourceLine" id="cb2-33" data-line-number="33">  , headInsertRFTZ  </a>
<a class="sourceLine" id="cb2-34" data-line-number="34">  , headDeleteLFTZ  </a>
<a class="sourceLine" id="cb2-35" data-line-number="35">  , headDeleteRFTZ</a>
<a class="sourceLine" id="cb2-36" data-line-number="36"></a>
<a class="sourceLine" id="cb2-37" data-line-number="37">  <span class="co">-- ** Testing and Debugging</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38">  , toListDebugFTZ</a>
<a class="sourceLine" id="cb2-39" data-line-number="39">  , depthFTZ</a>
<a class="sourceLine" id="cb2-40" data-line-number="40">  , showInternalFTZ</a>
<a class="sourceLine" id="cb2-41" data-line-number="41">  , validateFTZ</a>
<a class="sourceLine" id="cb2-42" data-line-number="42">) <span class="kw">where</span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43"></a>
<a class="sourceLine" id="cb2-44" data-line-number="44"><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Foldable</span> <span class="kw">as</span> <span class="dt">Fold</span></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="kw">import</span> <span class="dt">Data.List</span> (unwords)</a>
<a class="sourceLine" id="cb2-46" data-line-number="46"> </a>
<a class="sourceLine" id="cb2-47" data-line-number="47"><span class="kw">import</span> <span class="dt">Ned.Data.FingerTree</span></a></code></pre></div>
<h1 id="the-zipper">The Zipper</h1>
<p>The general strategy for constructing a zipper over a type involves expressing it as a functor, calculusifying it, and taking the derivative. Our <code>FingerTree</code> type is a little odd though, because of its non-uniform recursion. Actually differentiating the type directly is surely possible, but complicated enough that I don’t feel bad cheating a little bit here. Our <code>FingerTree</code> is isomorphic to the type of lists, so the derivative is isomorphic to pairs of lists. We can split this into two cases, where the list is either empty or not, like so.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">newtype</span> <span class="dt">FingerTreeZip</span> m a <span class="fu">=</span> <span class="dt">FingerTreeZip</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  { unFingerTreeZip</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="ot">      ::</span> <span class="dt">Maybe</span> (<span class="dt">FingerTree</span> m a, a, <span class="dt">FingerTree</span> m a)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  } <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Show</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="ot">emptyFTZ ::</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">emptyFTZ <span class="fu">=</span> <span class="dt">FingerTreeZip</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">  { unFingerTreeZip <span class="fu">=</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">  }</a></code></pre></div>
<p>We can turn a zippered finger tree back into a normal finger tree, by “integrating”. :)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1">integrateFTZ</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTree</span> m a</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">integrateFTZ w <span class="fu">=</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    <span class="dt">Nothing</span>          <span class="ot">-&gt;</span> mempty</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> as <span class="fu">&lt;&gt;</span> (cons x bs)</a></code></pre></div>
<p>And the signature of <code>splitFT</code> is very close to returning a <code>FingerTreeZip</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1">splitFTZ</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="ot">=&gt;</span> (m <span class="ot">-&gt;</span> <span class="dt">Bool</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">FingerTree</span> m a</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">splitFTZ p <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">.</span> splitFT p</a></code></pre></div>
<p>Like <code>FingerTree</code>, zippered finger trees inherit a <code>Valued</code> instance:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">instance</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  ( <span class="dt">Valued</span> m a</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  ) <span class="ot">=&gt;</span> <span class="dt">Valued</span> m (<span class="dt">FingerTreeZip</span> m a)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    value (<span class="dt">FingerTreeZip</span> w) <span class="fu">=</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> mempty</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">      <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> mconcat</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">        [ value as, value x, value bs ]</a></code></pre></div>
<p>Now for a couple of handy value related functions. First we will often need the accumulated monoid value at the read head.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1">valueAtHeadFTZ</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> m</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">valueAtHeadFTZ w <span class="fu">=</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    <span class="dt">Just</span> (as, x, _) <span class="ot">-&gt;</span> <span class="dt">Just</span> (value as <span class="fu">&lt;&gt;</span> value x)</a></code></pre></div>
<p>Next, just as we could adjust the value monoid type on the fly for finger trees, we can for zipped trees.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1">remeasureFTZ</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m1 a, <span class="dt">Valued</span> m2 a )</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m1 a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m2 a</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">remeasureFTZ (<span class="dt">FingerTreeZip</span> w) <span class="fu">=</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="dt">FingerTreeZip</span> <span class="fu">$</span> <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">      <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">    <span class="dt">Just</span> (as,x,bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9">      <span class="dt">Just</span> ( remeasureFT as, x, remeasureFT bs )</a></code></pre></div>
<h1 id="the-tape-class">The Tape class</h1>
<p>Note that the zippered finger tree is like a list with a pointer into a specific index, where access is cheap. Moreover the properties of finger trees allow moving the pointer left and right and seeking to the beginning or end of the list is also cheap. This is something like magnetic <em>tape</em>, where we have a single read head that can see only a small part of the tape at once and by spooling the tape can move the head around from left to right.</p>
<p>(The tape analogy isn’t perfect because efficient splitting on finger trees gives us something like logarithmic random access, but it goes far enough.)</p>
<p>We’ll want to implement a couple of different linear structures on top of <code>FingerTreeZip</code> by choosing a specific value monoid, but in each case we’ll have this linear read-head like structure. So we’ll wrap an interface for this into the <code>Tape</code> type class.</p>
<p>A <code>Tape</code> has three special positions where access is cheap: the <em>initial</em> element, the <em>last</em> element, and the <em>head</em> where the pointer points. We can move the head to the initial or last position, and can move the read head left or right. For any position we can read, alter, or delete the value there, with two variants of these for the read head depending on what direction the head should shift after the action is done.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">class</span> <span class="dt">Tape</span> t a <span class="kw">where</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="ot">  isEmpty ::</span> t a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="ot">  isAtInit ::</span> t a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="ot">  isAtLast ::</span> t a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="ot">  mkTape ::</span> [a] <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="ot">  mkTapeFocus ::</span> [a] <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="ot">  unTape ::</span> t a <span class="ot">-&gt;</span> [a]</a>
<a class="sourceLine" id="cb9-10" data-line-number="10"></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="ot">  initRead ::</span> t a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="ot">  initAlter ::</span> (a <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="ot">  initMove ::</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="ot">  initInsert ::</span> a <span class="ot">-&gt;</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="ot">  initDelete ::</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-16" data-line-number="16"></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="ot">  lastRead ::</span> t a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="ot">  lastAlter ::</span> (a <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="ot">  lastMove ::</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="ot">  lastInsert ::</span> a <span class="ot">-&gt;</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="ot">  lastDelete ::</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-22" data-line-number="22"></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="ot">  headRead ::</span> t a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="ot">  headAlter ::</span> (a <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="ot">  headMoveL ::</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="ot">  headMoveR ::</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="ot">  headInsertL ::</span> a <span class="ot">-&gt;</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-28" data-line-number="28"><span class="ot">  headInsertR ::</span> a <span class="ot">-&gt;</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="ot">  headDeleteL ::</span> t a <span class="ot">-&gt;</span> t a</a>
<a class="sourceLine" id="cb9-30" data-line-number="30"><span class="ot">  headDeleteR ::</span> t a <span class="ot">-&gt;</span> t a</a></code></pre></div>
<p>Due to limitations in the semantics of type classes, we can’t actually give an instance of <code>Tape</code> for <code>FingerTreeZip</code>. (The problem is that weird multi parameter type class, <code>Valued</code>.) Instead, we can give ad-hoc implementations of these functions with <code>Valued</code> constraints in the signature and use those to give <code>Tape</code> instances for individual types based on <code>FingerTreeZip</code> with the value type fixed.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb10-1" data-line-number="1">isEmptyFTZ</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">isEmptyFTZ w <span class="fu">=</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    <span class="dt">Just</span> _  <span class="ot">-&gt;</span> <span class="dt">False</span></a></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" data-line-number="1">mkTapeFTZ</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">mkTapeFTZ xs <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="kw">case</span> uncons (fromListFT xs) <span class="kw">of</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7">    <span class="dt">Just</span> (a,as) <span class="ot">-&gt;</span> <span class="dt">Just</span> (mempty, a, as)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">mkTapeFocusFTZ</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">  <span class="ot">=&gt;</span> [a] <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> [a] <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">mkTapeFocusFTZ as x bs <span class="fu">=</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13">  <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">    <span class="dt">Just</span> (fromListFT as, x, fromListFT bs)</a></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" data-line-number="1">unTapeFTZ</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> [a]</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">unTapeFTZ w <span class="fu">=</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> []</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">    <span class="dt">Just</span> (as,x,bs) <span class="ot">-&gt;</span> Fold.concat</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">      [ Fold.toList as, [x], Fold.toList bs ]</a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb13-1" data-line-number="1">isAtInitFTZ</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">isAtInitFTZ w <span class="fu">=</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">    <span class="dt">Just</span> (as,_,_) <span class="ot">-&gt;</span> isEmptyFT as</a>
<a class="sourceLine" id="cb13-8" data-line-number="8"></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">isAtLastFTZ</a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12">isAtLastFTZ w <span class="fu">=</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">True</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15">    <span class="dt">Just</span> (_,_,bs) <span class="ot">-&gt;</span> isEmptyFT bs</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb14-1" data-line-number="1">initReadFTZ</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">initReadFTZ w <span class="fu">=</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">      <span class="dt">Just</span> (a,_) <span class="ot">-&gt;</span> <span class="dt">Just</span> a</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"></a>
<a class="sourceLine" id="cb14-11" data-line-number="11">initAlterFTZ</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">  <span class="ot">=&gt;</span> (a <span class="ot">-&gt;</span> a)</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">  <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb14-15" data-line-number="15">initAlterFTZ f w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (mempty, f x, bs)</a>
<a class="sourceLine" id="cb14-20" data-line-number="20">      <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (cons (f a) as&#39;, x, bs)</a></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb15-1" data-line-number="1">initMoveFTZ  </a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">initMoveFTZ w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">      <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10">        <span class="dt">Just</span> (mempty, a, as&#39; <span class="fu">&lt;&gt;</span> (cons x bs))</a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb16-1" data-line-number="1">initInsertFTZ</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">initInsertFTZ a w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">      <span class="dt">Just</span> (mempty, a, mempty)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">      <span class="dt">Just</span> (cons a as, x, bs)</a>
<a class="sourceLine" id="cb16-10" data-line-number="10"></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">initDeleteFTZ</a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb16-14" data-line-number="14">initDeleteFTZ w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> uncons as <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19">        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20">        <span class="dt">Just</span> (b,bs&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (mempty, b, bs&#39;)</a>
<a class="sourceLine" id="cb16-21" data-line-number="21">      <span class="dt">Just</span> (_,as&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (as&#39;, x, bs)</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" data-line-number="1">lastReadFTZ</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">lastReadFTZ w <span class="fu">=</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">      <span class="dt">Just</span> (b,_) <span class="ot">-&gt;</span> <span class="dt">Just</span> b</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb18-1" data-line-number="1">lastMoveFTZ</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">lastMoveFTZ w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span> </a>
<a class="sourceLine" id="cb18-10" data-line-number="10">        <span class="dt">Just</span> (as <span class="fu">&lt;&gt;</span> (cons x bs&#39;), b, mempty)</a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb19-1" data-line-number="1">lastAlterFTZ</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">  <span class="ot">=&gt;</span> (a <span class="ot">-&gt;</span> a)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">  <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">lastAlterFTZ f w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (as, f x, mempty)</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">      <span class="dt">Just</span> (b,bs&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (as, x, snoc (f b) bs&#39;)</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb20-1" data-line-number="1">lastInsertFTZ</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">lastInsertFTZ a w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7">      <span class="dt">Just</span> (mempty, a, mempty)</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9">      <span class="dt">Just</span> (as, x, snoc a bs)</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb21-1" data-line-number="1">lastDeleteFTZ</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">lastDeleteFTZ w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> unsnoc bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9">        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10">        <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (as&#39;, a, mempty)</a>
<a class="sourceLine" id="cb21-11" data-line-number="11">      <span class="dt">Just</span> (_,bs&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (as, x, bs&#39;)</a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb22-1" data-line-number="1">headReadFTZ</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="ot">  ::</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">Maybe</span> a</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">headReadFTZ w <span class="fu">=</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6">    <span class="dt">Just</span> (_,x,_) <span class="ot">-&gt;</span> <span class="dt">Just</span> x</a>
<a class="sourceLine" id="cb22-7" data-line-number="7"></a>
<a class="sourceLine" id="cb22-8" data-line-number="8">headAlterFTZ</a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb22-10" data-line-number="10">  <span class="ot">=&gt;</span> (a <span class="ot">-&gt;</span> a)</a>
<a class="sourceLine" id="cb22-11" data-line-number="11">  <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb22-12" data-line-number="12">headAlterFTZ f w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb22-14" data-line-number="14">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb22-15" data-line-number="15">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Just</span> (as, f x, bs)</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb23-1" data-line-number="1">headMoveLFTZ</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">headMoveLFTZ w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (mempty, x, bs)</a>
<a class="sourceLine" id="cb23-9" data-line-number="9">      <span class="dt">Just</span> (a, as&#39;) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb23-10" data-line-number="10">        <span class="dt">Just</span> (as&#39;, a, cons x bs)</a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb24-1" data-line-number="1">headMoveRFTZ</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">headMoveRFTZ w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (as, x, mempty)</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">      <span class="dt">Just</span> (b, bs&#39;) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10">        <span class="dt">Just</span> (snoc x as, b, bs&#39;)</a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb25-1" data-line-number="1">headInsertLFTZ</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">headInsertLFTZ a w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (mempty, a, mempty)</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Just</span> (as, a, cons x bs)</a></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb26-1" data-line-number="1">headInsertRFTZ</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">  <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">headInsertRFTZ a w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Just</span> (mempty, a, mempty)</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="dt">Just</span> (snoc x as, a, bs)</a></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb27-1" data-line-number="1">headDeleteRFTZ</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">headDeleteRFTZ w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9">        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10">        <span class="dt">Just</span> (a,as&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (as&#39;, a, mempty)</a>
<a class="sourceLine" id="cb27-11" data-line-number="11">      <span class="dt">Just</span> (b,bs&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (as, b, bs&#39;)</a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb28-1" data-line-number="1">headDeleteLFTZ</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">FingerTreeZip</span> m a</a>
<a class="sourceLine" id="cb28-4" data-line-number="4">headDeleteLFTZ w <span class="fu">=</span> <span class="dt">FingerTreeZip</span> <span class="fu">$</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5">  <span class="kw">case</span> unFingerTreeZip w <span class="kw">of</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span> <span class="kw">case</span> unsnoc as <span class="kw">of</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8">      <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">case</span> uncons bs <span class="kw">of</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9">        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="dt">Nothing</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10">        <span class="dt">Just</span> (b,bs&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (mempty, b, bs&#39;)</a>
<a class="sourceLine" id="cb28-11" data-line-number="11">      <span class="dt">Just</span> (a,as&#39;) <span class="ot">-&gt;</span> <span class="dt">Just</span> (as&#39;, a, bs)</a></code></pre></div>
<h1 id="testing-and-debugging">Testing and debugging</h1>
<div class="sourceCode" id="cb29"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb29-1" data-line-number="1">depthFTZ</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">depthFTZ <span class="fu">=</span> depthFT <span class="fu">.</span> integrateFTZ</a></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb30-1" data-line-number="1">toListDebugFTZ</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> [(a,m)]</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">toListDebugFTZ (<span class="dt">FingerTreeZip</span> w) <span class="fu">=</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5">  <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> []</a>
<a class="sourceLine" id="cb30-7" data-line-number="7">    <span class="dt">Just</span> (as, x, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8">      toListDebugFT (as <span class="fu">&lt;&gt;</span> cons x bs)</a></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb31-1" data-line-number="1">showInternalFTZ</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Valued</span> m a, <span class="dt">Show</span> m, <span class="dt">Show</span> a )</a>
<a class="sourceLine" id="cb31-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4">showInternalFTZ (<span class="dt">FingerTreeZip</span> w) <span class="fu">=</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5">  <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="st">&quot;FingerTreeZip Nothing&quot;</span></a>
<a class="sourceLine" id="cb31-7" data-line-number="7">    <span class="dt">Just</span> (as,x,bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8">      <span class="kw">let</span></a>
<a class="sourceLine" id="cb31-9" data-line-number="9">        p cs <span class="fu">=</span> <span class="kw">if</span> elem <span class="ch">&#39; &#39;</span> cs</a>
<a class="sourceLine" id="cb31-10" data-line-number="10">          <span class="kw">then</span> concat [<span class="st">&quot;(&quot;</span>,cs,<span class="st">&quot;)&quot;</span>]</a>
<a class="sourceLine" id="cb31-11" data-line-number="11">          <span class="kw">else</span> cs</a>
<a class="sourceLine" id="cb31-12" data-line-number="12">      <span class="kw">in</span></a>
<a class="sourceLine" id="cb31-13" data-line-number="13">        unwords</a>
<a class="sourceLine" id="cb31-14" data-line-number="14">          [ <span class="st">&quot;Just&quot;</span>, <span class="st">&quot;(&quot;</span></a>
<a class="sourceLine" id="cb31-15" data-line-number="15">          , p <span class="fu">$</span> (showInternalFT as) <span class="fu">++</span> <span class="st">&quot;,&quot;</span></a>
<a class="sourceLine" id="cb31-16" data-line-number="16">          , p <span class="fu">$</span> (show x) <span class="fu">++</span> <span class="st">&quot;,&quot;</span></a>
<a class="sourceLine" id="cb31-17" data-line-number="17">          , p <span class="fu">$</span> (showInternalFT bs) <span class="fu">++</span> <span class="st">&quot;)&quot;</span></a>
<a class="sourceLine" id="cb31-18" data-line-number="18">          ]</a></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb32-1" data-line-number="1">validateFTZ</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="ot">  ::</span> ( <span class="dt">Eq</span> m, <span class="dt">Valued</span> m a )</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">  <span class="ot">=&gt;</span> <span class="dt">FingerTreeZip</span> m a <span class="ot">-&gt;</span> <span class="dt">Bool</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4">validateFTZ (<span class="dt">FingerTreeZip</span> w) <span class="fu">=</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5">  <span class="kw">case</span> w <span class="kw">of</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6">    <span class="dt">Nothing</span> <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7">      <span class="dt">True</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8">    <span class="dt">Just</span> (as, _, bs) <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb32-9" data-line-number="9">      (validateFT as) <span class="fu">&amp;&amp;</span> (validateFT bs)</a></code></pre></div>
</body>
</html>
